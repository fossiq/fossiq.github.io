import{c as createRoot,a as createRenderEffect,b as createMemo,u as untrack,d as createComponent,S as Show,e as createSignal,o as onMount,f as createContext,g as useContext,F as For,h as createEffect,$ as $PROXY,i as batch,j as $TRACK,k as getListener,m as mergeProps,l as createComputed,n as onCleanup}from"./vendor-CoOntuJf.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const memo$2=e=>createMemo(()=>e());function reconcileArrays(e,t,i){let n=i.length,r=t.length,s=n,o=0,a=0,l=t[r-1].nextSibling,c=null;for(;o<r||a<s;)if(t[o]!==i[a]){for(;t[r-1]===i[s-1];)r--,s--;if(r===o){const t=s<n?a?i[a-1].nextSibling:i[s-a]:l;for(;a<s;)e.insertBefore(i[a++],t)}else if(s===a)for(;o<r;)c&&c.has(t[o])||t[o].remove(),o++;else if(t[o]===i[s-1]&&i[a]===t[r-1]){const n=t[--r].nextSibling;e.insertBefore(i[a++],t[o++].nextSibling),e.insertBefore(i[--s],n),t[r]=i[s]}else{if(!c){c=new Map;let e=a;for(;e<s;)c.set(i[e],e++)}const n=c.get(t[o]);if(null!=n)if(a<n&&n<s){let l,h=o,u=1;for(;++h<r&&h<s&&null!=(l=c.get(t[h]))&&l===n+u;)u++;if(u>n-a){const r=t[o];for(;a<n;)e.insertBefore(i[a++],r)}else e.replaceChild(i[a++],t[o++])}else o++;else t[o++].remove()}}else o++,a++}const $$EVENTS="_$DX_DELEGATE";function render(e,t,i,n={}){let r;return createRoot(n=>{r=n,t===document?e():insert$1(t,e(),t.firstChild?null:void 0,i)},n.owner),()=>{r(),t.textContent=""}}function template(e,t,i,n){let r;const s=()=>(r||(r=(()=>{const t=document.createElement("template");return t.innerHTML=e,t.content.firstChild})())).cloneNode(!0);return s.cloneNode=s,s}function delegateEvents(e,t=window.document){const i=t[$$EVENTS]||(t[$$EVENTS]=new Set);for(let n=0,r=e.length;n<r;n++){const r=e[n];i.has(r)||(i.add(r),t.addEventListener(r,eventHandler))}}function setAttribute(e,t,i){null==i?e.removeAttribute(t):e.setAttribute(t,i)}function addEventListener(e,t,i,n){Array.isArray(i)?(e[`$$${t}`]=i[0],e[`$$${t}Data`]=i[1]):e[`$$${t}`]=i}function setStyleProperty(e,t,i){null!=i?e.style.setProperty(t,i):e.style.removeProperty(t)}function use(e,t,i){return untrack(()=>e(t,i))}function insert$1(e,t,i,n){if(void 0===i||n||(n=[]),"function"!=typeof t)return insertExpression(e,t,n,i);createRenderEffect(n=>insertExpression(e,t(),n,i),n)}function eventHandler(e){let t=e.target;const i=`$$${e.type}`,n=e.target,r=e.currentTarget,s=t=>Object.defineProperty(e,"target",{configurable:!0,value:t}),o=()=>{const n=t[i];if(n&&!t.disabled){const r=t[`${i}Data`];if(void 0!==r?n.call(t,r,e):n.call(t,e),e.cancelBubble)return}return t.host&&"string"!=typeof t.host&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},a=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get:()=>t||document}),e.composedPath){const i=e.composedPath();s(i[0]);for(let e=0;e<i.length-2&&(t=i[e],o());e++){if(t._$host){t=t._$host,a();break}if(t.parentNode===r)break}}else a();s(n)}function insertExpression(e,t,i,n,r){for(;"function"==typeof i;)i=i();if(t===i)return i;const s=typeof t,o=void 0!==n;if(e=o&&i[0]&&i[0].parentNode||e,"string"===s||"number"===s){if("number"===s&&(t=t.toString())===i)return i;if(o){let r=i[0];r&&3===r.nodeType?r.data!==t&&(r.data=t):r=document.createTextNode(t),i=cleanChildren(e,i,n,r)}else i=""!==i&&"string"==typeof i?e.firstChild.data=t:e.textContent=t}else if(null==t||"boolean"===s)i=cleanChildren(e,i,n);else{if("function"===s)return createRenderEffect(()=>{let r=t();for(;"function"==typeof r;)r=r();i=insertExpression(e,r,i,n)}),()=>i;if(Array.isArray(t)){const s=[],a=i&&Array.isArray(i);if(normalizeIncomingArray(s,t,i,r))return createRenderEffect(()=>i=insertExpression(e,s,i,n,!0)),()=>i;if(0===s.length){if(i=cleanChildren(e,i,n),o)return i}else a?0===i.length?appendNodes(e,s,n):reconcileArrays(e,i,s):(i&&cleanChildren(e),appendNodes(e,s));i=s}else if(t.nodeType){if(Array.isArray(i)){if(o)return i=cleanChildren(e,i,n,t);cleanChildren(e,i,null,t)}else null!=i&&""!==i&&e.firstChild?e.replaceChild(t,e.firstChild):e.appendChild(t);i=t}}return i}function normalizeIncomingArray(e,t,i,n){let r=!1;for(let s=0,o=t.length;s<o;s++){let o,a=t[s],l=i&&i[e.length];if(null==a||!0===a||!1===a);else if("object"==(o=typeof a)&&a.nodeType)e.push(a);else if(Array.isArray(a))r=normalizeIncomingArray(e,a,l)||r;else if("function"===o)if(n){for(;"function"==typeof a;)a=a();r=normalizeIncomingArray(e,Array.isArray(a)?a:[a],Array.isArray(l)?l:[l])||r}else e.push(a),r=!0;else{const t=String(a);l&&3===l.nodeType&&l.data===t?e.push(l):e.push(document.createTextNode(t))}}return r}function appendNodes(e,t,i=null){for(let n=0,r=t.length;n<r;n++)e.insertBefore(t[n],i)}function cleanChildren(e,t,i,n){if(void 0===i)return e.textContent="";const r=n||document.createTextNode("");if(t.length){let n=!1;for(let s=t.length-1;s>=0;s--){const o=t[s];if(r!==o){const t=o.parentNode===e;n||s?t&&o.remove():t?e.replaceChild(r,o):e.insertBefore(r,i)}else n=!0}}else e.insertBefore(r,i);return[r]}const icons={"plus-circle":{viewBox:"0 0 24 24",path:'<g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd">\n      <path d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12m10-8a8 8 0 1 0 0 16 8 8 0 0 0 0-16"/>\n      <path d="M13 7a1 1 0 1 0-2 0v4H7a1 1 0 1 0 0 2h4v4a1 1 0 1 0 2 0v-4h4a1 1 0 1 0 0-2h-4z"/>\n    </g>'},logo:{viewBox:"0 0 24 24",path:'<path fill="currentColor" d="M8.976 12 4.733 7.757 3.32 9.172 6.147 12 3.32 14.828l1.414 1.415zM12 19a1 1 0 0 1-1-1V6a1 1 0 1 1 2 0v12a1 1 0 0 1-1 1M15.024 12l4.243 4.243 1.414-1.415L17.853 12l2.828-2.828-1.414-1.415z"/>'},table:{viewBox:"0 0 24 24",path:'<path fill="currentColor" d="M4 4h16v16H4V4zm2 5h12V6H6v3zm0 2v7h5v-7H6zm7 0v7h5v-7h-5z"/>'},column:{viewBox:"0 0 24 24",path:'<path fill="currentColor" fill-rule="evenodd" d="M2 8a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3zm14-1h3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-3zm-2 0h-4v10h4zM8 17V7H5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1z" clip-rule="evenodd"/>'},theme:{viewBox:"0 0 24 24",path:'<path fill="currentColor" d="M12 16a4 4 0 0 0 0-8z"/><path fill="currentColor" fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m0 2v4a4 4 0 1 0 0 8v4a8 8 0 1 0 0-16" clip-rule="evenodd"/>'},"chevron-right":{viewBox:"0 0 24 24",path:'<path fill="currentColor" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>'},"chevron-down":{viewBox:"0 0 24 24",path:'<path fill="currentColor" d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"/>'},"x-circle":{viewBox:"0 0 24 24",path:'<path fill="currentColor" d="M6.225 4.811a1 1 0 0 0-1.414 1.414L10.586 12 4.81 17.775a1 1 0 1 0 1.414 1.414L12 13.414l5.775 5.775a1 1 0 0 0 1.414-1.414L13.414 12l5.775-5.775a1 1 0 0 0-1.414-1.414L12 10.586z"/>'}};var _tmpl$$6=template("<span>‚ùå"),_tmpl$2$3=template("<svg xmlns=http://www.w3.org/2000/svg><g>");const Icon=e=>{const t=()=>{const t=e.size||24;return"number"==typeof t?`${t}px`:t};return createComponent(Show,{get when(){return icons[e.name]},get fallback(){return t=_tmpl$$6(),createRenderEffect(()=>setAttribute(t,"title",`Icon "${e.name}" not found`)),t;var t},children:i=>{return n=_tmpl$2$3(),r=n.firstChild,createRenderEffect(s=>{var o=`icon icon-${e.name} ${e.class||""}`,a=t(),l=t(),c=t(),h=t(),u=!e.title,d=e.title?"img":void 0,p=i().viewBox,f=i().path;return o!==s.e&&setAttribute(n,"class",s.e=o),a!==s.t&&setStyleProperty(n,"width",s.t=a),l!==s.a&&setStyleProperty(n,"height",s.a=l),c!==s.o&&setStyleProperty(n,"min-width",s.o=c),h!==s.i&&setStyleProperty(n,"min-height",s.i=h),u!==s.n&&setAttribute(n,"aria-hidden",s.n=u),d!==s.s&&setAttribute(n,"role",s.s=d),p!==s.h&&setAttribute(n,"viewBox",s.h=p),f!==s.r&&(r.innerHTML=s.r=f),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0}),n;var n,r}})};var _tmpl$$5=template('<header class=header role=banner><div style=display:flex;align-items:center;gap:0.75rem><h1>Fossiq</h1></div><div style=display:flex;align-items:center;gap:0.5rem><button title="Toggle theme"class=secondary style=padding:0.5rem>');const Header=e=>{return t=_tmpl$$5(),i=t.firstChild,n=i.firstChild,r=i.nextSibling.firstChild,insert$1(i,createComponent(Icon,{name:"logo",size:24}),n),addEventListener(r,"click",e.onThemeToggle),insert$1(r,createComponent(Icon,{name:"theme",size:20})),t;var t,i,n,r};function __awaiter(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((n=n.apply(e,t||[])).next())})}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(e,t||[]),s=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){r[e]&&(n[e]=function(t){return new Promise(function(i,n){s.push([e,t,i,n])>1||a(e,t)})},t&&(n[e]=t(n[e])))}function a(e,t){try{(i=r[e](t)).value instanceof __await?Promise.resolve(i.value.v).then(l,c):h(s[0][2],i)}catch(n){h(s[0][3],n)}var i}function l(e){a("next",e)}function c(e){a("throw",e)}function h(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function __asyncDelegator(e){var t,i;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,r){t[n]=e[n]?function(t){return(i=!i)?{value:__await(e[n](t)),done:!1}:r?r(t):t}:r}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=e[i]&&function(t){return new Promise(function(n,r){(function(e,t,i,n){Promise.resolve(n).then(function(t){e({value:t,done:i})},t)})(n,r,(t=e[i](t)).done,t.value)})}}}delegateEvents(["click"]),"function"==typeof SuppressedError&&SuppressedError;const decoder=new TextDecoder("utf-8"),decodeUtf8=e=>decoder.decode(e),encoder=new TextEncoder,encodeUtf8=e=>encoder.encode(e),isNumber=e=>"number"==typeof e,isBoolean=e=>"boolean"==typeof e,isFunction$1=e=>"function"==typeof e,isObject=e=>null!=e&&Object(e)===e,isPromise=e=>isObject(e)&&isFunction$1(e.then),isIterable=e=>isObject(e)&&isFunction$1(e[Symbol.iterator]),isAsyncIterable=e=>isObject(e)&&isFunction$1(e[Symbol.asyncIterator]),isArrowJSON=e=>isObject(e)&&isObject(e.schema),isIteratorResult=e=>isObject(e)&&"done"in e&&"value"in e,isFileHandle=e=>isObject(e)&&isFunction$1(e.stat)&&isNumber(e.fd),isFetchResponse=e=>isObject(e)&&isReadableDOMStream(e.body),isReadableInterop=e=>"_getDOMStream"in e&&"_getNodeStream"in e,isWritableDOMStream=e=>isObject(e)&&isFunction$1(e.abort)&&isFunction$1(e.getWriter)&&!isReadableInterop(e),isReadableDOMStream=e=>isObject(e)&&isFunction$1(e.cancel)&&isFunction$1(e.getReader)&&!isReadableInterop(e),isWritableNodeStream=e=>isObject(e)&&isFunction$1(e.end)&&isFunction$1(e.write)&&isBoolean(e.writable)&&!isReadableInterop(e),isReadableNodeStream=e=>isObject(e)&&isFunction$1(e.read)&&isFunction$1(e.pipe)&&isBoolean(e.readable)&&!isReadableInterop(e),isFlatbuffersByteBuffer=e=>isObject(e)&&isFunction$1(e.clear)&&isFunction$1(e.bytes)&&isFunction$1(e.position)&&isFunction$1(e.setPosition)&&isFunction$1(e.capacity)&&isFunction$1(e.getBufferIdentifier)&&isFunction$1(e.createLong),SharedArrayBuf="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;function collapseContiguousByteRanges(e){const t=e[0]?[e[0]]:[];let i,n,r,s;for(let o,a,l=0,c=0,h=e.length;++l<h;)o=t[c],a=e[l],!o||!a||o.buffer!==a.buffer||a.byteOffset<o.byteOffset?a&&(t[++c]=a):(({byteOffset:i,byteLength:r}=o),({byteOffset:n,byteLength:s}=a),i+r<n||n+s<i?a&&(t[++c]=a):t[c]=new Uint8Array(o.buffer,i,n-i+s));return t}function memcpy(e,t,i=0,n=t.byteLength){const r=e.byteLength,s=new Uint8Array(e.buffer,e.byteOffset,r),o=new Uint8Array(t.buffer,t.byteOffset,Math.min(n,r));return s.set(o,i),e}function joinUint8Arrays(e,t){const i=collapseContiguousByteRanges(e),n=i.reduce((e,t)=>e+t.byteLength,0);let r,s,o,a=0,l=-1;const c=Math.min(t||Number.POSITIVE_INFINITY,n);for(const h=i.length;++l<h;){if(r=i[l],s=r.subarray(0,Math.min(r.length,c-a)),c<=a+s.length){s.length<r.length?i[l]=r.subarray(s.length):s.length===r.length&&l++,o?memcpy(o,s,a):o=s;break}memcpy(o||(o=new Uint8Array(c)),s,a),a+=s.length}return[o||new Uint8Array(0),i.slice(l),n-(o?o.byteLength:0)]}function toArrayBufferView(e,t){let i=isIteratorResult(t)?t.value:t;return i instanceof e?e===Uint8Array?new e(i.buffer,i.byteOffset,i.byteLength):i:i?("string"==typeof i&&(i=encodeUtf8(i)),i instanceof ArrayBuffer||i instanceof SharedArrayBuf?new e(i):isFlatbuffersByteBuffer(i)?toArrayBufferView(e,i.bytes()):ArrayBuffer.isView(i)?i.byteLength<=0?new e(0):new e(i.buffer,i.byteOffset,i.byteLength/e.BYTES_PER_ELEMENT):e.from(i)):new e(0)}const toInt32Array=e=>toArrayBufferView(Int32Array,e),toBigInt64Array=e=>toArrayBufferView(BigInt64Array,e),toUint8Array=e=>toArrayBufferView(Uint8Array,e),pump$1=e=>(e.next(),e);function*toArrayBufferViewIterator(e,t){const i=function*(e){yield e},n="string"==typeof t||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof SharedArrayBuf?i(t):isIterable(t)?t:i(t);return yield*pump$1(function*(t){let i=null;do{i=t.next(yield toArrayBufferView(e,i))}while(!i.done)}(n[Symbol.iterator]())),new e}const toUint8ArrayIterator=e=>toArrayBufferViewIterator(Uint8Array,e);function toArrayBufferViewAsyncIterator(e,t){return __asyncGenerator(this,arguments,function*(){if(isPromise(t))return yield __await(yield __await(yield*__asyncDelegator(__asyncValues(toArrayBufferViewAsyncIterator(e,yield __await(t))))));const i=function(e){return __asyncGenerator(this,arguments,function*(){yield yield __await(yield __await(e))})},n="string"==typeof t||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof SharedArrayBuf?i(t):isIterable(t)?function(e){return __asyncGenerator(this,arguments,function*(){yield __await(yield*__asyncDelegator(__asyncValues(pump$1(function*(e){let t=null;do{t=e.next(yield null==t?void 0:t.value)}while(!t.done)}(e[Symbol.iterator]())))))})}(t):isAsyncIterable(t)?t:i(t);return yield __await(yield*__asyncDelegator(__asyncValues(pump$1(function(t){return __asyncGenerator(this,arguments,function*(){let i=null;do{i=yield __await(t.next(yield yield __await(toArrayBufferView(e,i))))}while(!i.done)})}(n[Symbol.asyncIterator]()))))),yield __await(new e)})}const toUint8ArrayAsyncIterator=e=>toArrayBufferViewAsyncIterator(Uint8Array,e);function rebaseValueOffsets(e,t,i){if(0!==e)for(let n=-1,r=(i=i.slice(0,t)).length;++n<r;)i[n]+=e;return i.subarray(0,t)}function compareArrayLike(e,t){let i=0;const n=e.length;if(n!==t.length)return!1;if(n>0)do{if(e[i]!==t[i])return!1}while(++i<n);return!0}const streamAdapters={fromIterable:e=>pump(fromIterable(e)),fromAsyncIterable:e=>pump(fromAsyncIterable(e)),fromDOMStream:e=>pump(fromDOMStream(e)),fromNodeStream:e=>pump(fromNodeStream(e)),toDOMStream(e,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(e,t){throw new Error('"toNodeStream" not available in this environment')}},pump=e=>(e.next(),e);function*fromIterable(e){let t,i,n,r,s=!1,o=[],a=0;function l(){return"peek"===n?joinUint8Arrays(o,r)[0]:([i,o,a]=joinUint8Arrays(o,r),i)}({cmd:n,size:r}=(yield(()=>null)())||{cmd:"read",size:0});const c=toUint8ArrayIterator(e)[Symbol.iterator]();try{do{if(({done:t,value:i}=Number.isNaN(r-a)?c.next():c.next(r-a)),!t&&i.byteLength>0&&(o.push(i),a+=i.byteLength),t||r<=a)do{({cmd:n,size:r}=yield l())}while(r<a)}while(!t)}catch(h){(s=!0)&&"function"==typeof c.throw&&c.throw(h)}finally{!1===s&&"function"==typeof c.return&&c.return(null)}return null}function fromAsyncIterable(e){return __asyncGenerator(this,arguments,function*(){let t,i,n,r,s=!1,o=[],a=0;function l(){return"peek"===n?joinUint8Arrays(o,r)[0]:([i,o,a]=joinUint8Arrays(o,r),i)}({cmd:n,size:r}=(yield yield __await((()=>null)()))||{cmd:"read",size:0});const c=toUint8ArrayAsyncIterator(e)[Symbol.asyncIterator]();try{do{if(({done:t,value:i}=Number.isNaN(r-a)?yield __await(c.next()):yield __await(c.next(r-a))),!t&&i.byteLength>0&&(o.push(i),a+=i.byteLength),t||r<=a)do{({cmd:n,size:r}=yield yield __await(l()))}while(r<a)}while(!t)}catch(h){(s=!0)&&"function"==typeof c.throw&&(yield __await(c.throw(h)))}finally{!1===s&&"function"==typeof c.return&&(yield __await(c.return(new Uint8Array(0))))}return yield __await(null)})}function fromDOMStream(e){return __asyncGenerator(this,arguments,function*(){let t,i,n,r=!1,s=!1,o=[],a=0;function l(){return"peek"===i?joinUint8Arrays(o,n)[0]:([t,o,a]=joinUint8Arrays(o,n),t)}({cmd:i,size:n}=(yield yield __await((()=>null)()))||{cmd:"read",size:0});const c=new AdaptiveByteReader(e);try{do{if(({done:r,value:t}=Number.isNaN(n-a)?yield __await(c.read()):yield __await(c.read(n-a))),!r&&t.byteLength>0&&(o.push(toUint8Array(t)),a+=t.byteLength),r||n<=a)do{({cmd:i,size:n}=yield yield __await(l()))}while(n<a)}while(!r)}catch(h){(s=!0)&&(yield __await(c.cancel(h)))}finally{!1===s?yield __await(c.cancel()):e.locked&&c.releaseLock()}return yield __await(null)})}class AdaptiveByteReader{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return __awaiter(this,void 0,void 0,function*(){const{reader:t,source:i}=this;t&&(yield t.cancel(e).catch(()=>{})),i&&i.locked&&this.releaseLock()})}read(e){return __awaiter(this,void 0,void 0,function*(){if(0===e)return{done:null==this.reader,value:new Uint8Array(0)};const t=yield this.reader.read();return!t.done&&(t.value=toUint8Array(t)),t})}}const onEvent=(e,t)=>{const i=e=>n([t,e]);let n;return[t,i,new Promise(r=>(n=r)&&e.once(t,i))]};function fromNodeStream(e){return __asyncGenerator(this,arguments,function*(){const t=[];let i,n,r,s="error",o=!1,a=null,l=0,c=[];function h(){return"peek"===i?joinUint8Arrays(c,n)[0]:([r,c,l]=joinUint8Arrays(c,n),r)}if(({cmd:i,size:n}=(yield yield __await((()=>null)()))||{cmd:"read",size:0}),e.isTTY)return yield yield __await(new Uint8Array(0)),yield __await(null);try{t[0]=onEvent(e,"end"),t[1]=onEvent(e,"error");do{if(t[2]=onEvent(e,"readable"),[s,a]=yield __await(Promise.race(t.map(e=>e[2]))),"error"===s)break;if((o="end"===s)||(Number.isFinite(n-l)?(r=toUint8Array(e.read(n-l)),r.byteLength<n-l&&(r=toUint8Array(e.read()))):r=toUint8Array(e.read()),r.byteLength>0&&(c.push(r),l+=r.byteLength)),o||n<=l)do{({cmd:i,size:n}=yield yield __await(h()))}while(n<l)}while(!o)}finally{yield __await((u=t,d="error"===s?a:null,r=c=null,new Promise((t,i)=>{for(const[r,s]of u)e.off(r,s);try{const t=e.destroy;t&&t.call(e,d),d=void 0}catch(n){d=n||d}finally{null!=d?i(d):t()}})))}var u,d;return yield __await(null)})}var MetadataVersion,MetadataVersion2,UnionMode,UnionMode2,Precision,Precision2,DateUnit,DateUnit2,TimeUnit,TimeUnit2,IntervalUnit,IntervalUnit2;MetadataVersion2=MetadataVersion||(MetadataVersion={}),MetadataVersion2[MetadataVersion2.V1=0]="V1",MetadataVersion2[MetadataVersion2.V2=1]="V2",MetadataVersion2[MetadataVersion2.V3=2]="V3",MetadataVersion2[MetadataVersion2.V4=3]="V4",MetadataVersion2[MetadataVersion2.V5=4]="V5",UnionMode2=UnionMode||(UnionMode={}),UnionMode2[UnionMode2.Sparse=0]="Sparse",UnionMode2[UnionMode2.Dense=1]="Dense",Precision2=Precision||(Precision={}),Precision2[Precision2.HALF=0]="HALF",Precision2[Precision2.SINGLE=1]="SINGLE",Precision2[Precision2.DOUBLE=2]="DOUBLE",DateUnit2=DateUnit||(DateUnit={}),DateUnit2[DateUnit2.DAY=0]="DAY",DateUnit2[DateUnit2.MILLISECOND=1]="MILLISECOND",TimeUnit2=TimeUnit||(TimeUnit={}),TimeUnit2[TimeUnit2.SECOND=0]="SECOND",TimeUnit2[TimeUnit2.MILLISECOND=1]="MILLISECOND",TimeUnit2[TimeUnit2.MICROSECOND=2]="MICROSECOND",TimeUnit2[TimeUnit2.NANOSECOND=3]="NANOSECOND",IntervalUnit2=IntervalUnit||(IntervalUnit={}),IntervalUnit2[IntervalUnit2.YEAR_MONTH=0]="YEAR_MONTH",IntervalUnit2[IntervalUnit2.DAY_TIME=1]="DAY_TIME",IntervalUnit2[IntervalUnit2.MONTH_DAY_NANO=2]="MONTH_DAY_NANO";const SIZEOF_SHORT=2,SIZEOF_INT=4,FILE_IDENTIFIER_LENGTH=4,SIZE_PREFIX_LENGTH=4,int32=new Int32Array(2),float32=new Float32Array(int32.buffer),float64=new Float64Array(int32.buffer),isLittleEndian=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];var Encoding,Encoding2;Encoding2=Encoding||(Encoding={}),Encoding2[Encoding2.UTF8_BYTES=1]="UTF8_BYTES",Encoding2[Encoding2.UTF16_STRING=2]="UTF16_STRING";let ByteBuffer$2=class e{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new e(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return int32[0]=this.readInt32(e),float32[0]}readFloat64(e){return int32[isLittleEndian?0:1]=this.readInt32(e),int32[isLittleEndian?1:0]=this.readInt32(e+4),float64[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){float32[0]=t,this.writeInt32(e,int32[0])}writeFloat64(e,t){float64[0]=t,this.writeInt32(e,int32[isLittleEndian?0:1]),this.writeInt32(e+4,int32[isLittleEndian?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+SIZEOF_INT+FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<FILE_IDENTIFIER_LENGTH;t++)e+=String.fromCharCode(this.readInt8(this.position_+SIZEOF_INT+t));return e}__offset(e,t){const i=e-this.readInt32(e);return t<this.readInt16(i)?this.readInt16(i+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const i=this.readInt32(e);e+=SIZEOF_INT;const n=this.bytes_.subarray(e,e+i);return t===Encoding.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(e,t){return"string"==typeof e?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+SIZEOF_INT}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+FILE_IDENTIFIER_LENGTH);for(let t=0;t<FILE_IDENTIFIER_LENGTH;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+SIZEOF_INT+t))return!1;return!0}createScalarList(e,t){const i=[];for(let n=0;n<t;++n){const t=e(n);null!==t&&i.push(t)}return i}createObjList(e,t){const i=[];for(let n=0;n<t;++n){const t=e(n);null!==t&&i.push(t.unpack())}return i}},Builder$2=class e{constructor(e){let t;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,t=e||1024,this.bb=ByteBuffer$2.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,i){t>this.minalign&&(this.minalign=t);const n=1+~(this.bb.capacity()-this.space+i)&t-1;for(;this.space<n+t+i;){const t=this.bb.capacity();this.bb=e.growByteBuffer(this.bb),this.space+=this.bb.capacity()-t}this.pad(n)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,i){(this.force_defaults||t!=i)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,i){(this.force_defaults||t!=i)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,i){(this.force_defaults||t!=i)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,i){(this.force_defaults||t!==i)&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,i){(this.force_defaults||t!=i)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,i){t!=i&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){null!==this.vtable&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(3221225472&t)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=t<<1,n=ByteBuffer$2.allocate(i);return n.setPosition(i-t),n.bytes().set(e.bytes(),i-t),n}addOffset(e){this.prep(SIZEOF_INT,0),this.writeInt32(this.offset()-e+SIZEOF_INT)}startObject(e){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&0==this.vtable[t];t--);const i=t+1;for(;t>=0;t--)this.addInt16(0!=this.vtable[t]?e-this.vtable[t]:0);this.addInt16(e-this.object_start);const n=(i+2)*SIZEOF_SHORT;this.addInt16(n);let r=0;const s=this.space;e:for(t=0;t<this.vtables.length;t++){const e=this.bb.capacity()-this.vtables[t];if(n==this.bb.readInt16(e)){for(let t=SIZEOF_SHORT;t<n;t+=SIZEOF_SHORT)if(this.bb.readInt16(s+t)!=this.bb.readInt16(e+t))continue e;r=this.vtables[t];break}}return r?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,r-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,i){const n=i?SIZE_PREFIX_LENGTH:0;if(t){const e=t;if(this.prep(this.minalign,SIZEOF_INT+FILE_IDENTIFIER_LENGTH+n),e.length!=FILE_IDENTIFIER_LENGTH)throw new TypeError("FlatBuffers: file identifier must be length "+FILE_IDENTIFIER_LENGTH);for(let t=FILE_IDENTIFIER_LENGTH-1;t>=0;t--)this.writeInt8(e.charCodeAt(t))}this.prep(this.minalign,SIZEOF_INT+n),this.addOffset(e),n&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const i=this.bb.capacity()-e,n=i-this.bb.readInt32(i);if(!(t<this.bb.readInt16(n)&&0!=this.bb.readInt16(n+t)))throw new TypeError("FlatBuffers: field "+t+" must be set")}startVector(e,t,i){this.notNested(),this.vector_num_elems=t,this.prep(SIZEOF_INT,e*t),this.prep(i,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(null==e)return 0;let t;return t=e instanceof Uint8Array?e:this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector()}createByteVector(e){return null==e?0:(this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector())}createObjectOffset(e){return null===e?0:"string"==typeof e?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let i=0;i<e.length;++i){const n=e[i];if(null===n)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");t.push(this.createObjectOffset(n))}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}};var BodyCompressionMethod,BodyCompressionMethod2,CompressionType,CompressionType2;BodyCompressionMethod2=BodyCompressionMethod||(BodyCompressionMethod={}),BodyCompressionMethod2[BodyCompressionMethod2.BUFFER=0]="BUFFER",CompressionType2=CompressionType||(CompressionType={}),CompressionType2[CompressionType2.LZ4_FRAME=0]="LZ4_FRAME",CompressionType2[CompressionType2.ZSTD=1]="ZSTD";class BodyCompression{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBodyCompression(e,t){return(t||new BodyCompression).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new BodyCompression).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):CompressionType.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):BodyCompressionMethod.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,t){e.addFieldInt8(0,t,CompressionType.LZ4_FRAME)}static addMethod(e,t){e.addFieldInt8(1,t,BodyCompressionMethod.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,t,i){return BodyCompression.startBodyCompression(e),BodyCompression.addCodec(e,t),BodyCompression.addMethod(e,i),BodyCompression.endBodyCompression(e)}}class Buffer{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,t,i){return e.prep(8,16),e.writeInt64(BigInt(null!=i?i:0)),e.writeInt64(BigInt(null!=t?t:0)),e.offset()}}let FieldNode$1=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,t,i){return e.prep(8,16),e.writeInt64(BigInt(null!=i?i:0)),e.writeInt64(BigInt(null!=t?t:0)),e.offset()}},RecordBatch$2=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsRecordBatch(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,t){const i=this.bb.__offset(this.bb_pos,6);return i?(t||new FieldNode$1).__init(this.bb.__vector(this.bb_pos+i)+16*e,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new Buffer).__init(this.bb.__vector(this.bb_pos+i)+16*e,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new BodyCompression).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addNodes(e,t){e.addFieldOffset(1,t,0)}static startNodesVector(e,t){e.startVector(16,t,8)}static addBuffers(e,t){e.addFieldOffset(2,t,0)}static startBuffersVector(e,t){e.startVector(16,t,8)}static addCompression(e,t){e.addFieldOffset(3,t,0)}static endRecordBatch(e){return e.endObject()}},DictionaryBatch$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryBatch(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new RecordBatch$2).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}static startDictionaryBatch(e){e.startObject(3)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addData(e,t){e.addFieldOffset(1,t,0)}static addIsDelta(e,t){e.addFieldInt8(2,+t,0)}static endDictionaryBatch(e){return e.endObject()}};var Endianness,Endianness2,DictionaryKind,DictionaryKind2;Endianness2=Endianness||(Endianness={}),Endianness2[Endianness2.Little=0]="Little",Endianness2[Endianness2.Big=1]="Big",DictionaryKind2=DictionaryKind||(DictionaryKind={}),DictionaryKind2[DictionaryKind2.DenseArray=0]="DenseArray";class Int{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInt(e,t){return(t||new Int).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new Int).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}static startInt(e){e.startObject(2)}static addBitWidth(e,t){e.addFieldInt32(0,t,0)}static addIsSigned(e,t){e.addFieldInt8(1,+t,0)}static endInt(e){return e.endObject()}static createInt(e,t,i){return Int.startInt(e),Int.addBitWidth(e,t),Int.addIsSigned(e,i),Int.endInt(e)}}class DictionaryEncoding{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryEncoding(e,t){return(t||new DictionaryEncoding).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new DictionaryEncoding).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new Int).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):DictionaryKind.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addIndexType(e,t){e.addFieldOffset(1,t,0)}static addIsOrdered(e,t){e.addFieldInt8(2,+t,0)}static addDictionaryKind(e,t){e.addFieldInt16(3,t,DictionaryKind.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}}class KeyValue{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsKeyValue(e,t){return(t||new KeyValue).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new KeyValue).__init(e.readInt32(e.position())+e.position(),e)}key(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}value(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,t){e.addFieldOffset(0,t,0)}static addValue(e,t){e.addFieldOffset(1,t,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,t,i){return KeyValue.startKeyValue(e),KeyValue.addKey(e,t),KeyValue.addValue(e,i),KeyValue.endKeyValue(e)}}let Binary$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBinary(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(t){return e.startBinary(t),e.endBinary(t)}},Bool$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBool(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(t){return e.startBool(t),e.endBool(t)}},Date$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDate(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):DateUnit.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,DateUnit.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(t,i){return e.startDate(t),e.addUnit(t,i),e.endDate(t)}},Decimal$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDecimal(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,t){e.addFieldInt32(0,t,0)}static addScale(e,t){e.addFieldInt32(1,t,0)}static addBitWidth(e,t){e.addFieldInt32(2,t,128)}static endDecimal(e){return e.endObject()}static createDecimal(t,i,n,r){return e.startDecimal(t),e.addPrecision(t,i),e.addScale(t,n),e.addBitWidth(t,r),e.endDecimal(t)}},Duration$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDuration(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDuration(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):TimeUnit.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,TimeUnit.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(t,i){return e.startDuration(t),e.addUnit(t,i),e.endDuration(t)}},FixedSizeBinary$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeBinary(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(t,i){return e.startFixedSizeBinary(t),e.addByteWidth(t,i),e.endFixedSizeBinary(t)}},FixedSizeList$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeList(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(t,i){return e.startFixedSizeList(t),e.addListSize(t,i),e.endFixedSizeList(t)}};class FloatingPoint{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFloatingPoint(e,t){return(t||new FloatingPoint).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new FloatingPoint).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Precision.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,t){e.addFieldInt16(0,t,Precision.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,t){return FloatingPoint.startFloatingPoint(e),FloatingPoint.addPrecision(e,t),FloatingPoint.endFloatingPoint(e)}}class Interval{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInterval(e,t){return(t||new Interval).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new Interval).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):IntervalUnit.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,IntervalUnit.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,t){return Interval.startInterval(e),Interval.addUnit(e,t),Interval.endInterval(e)}}let LargeBinary$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsLargeBinary(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeBinary(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeBinary(e){e.startObject(0)}static endLargeBinary(e){return e.endObject()}static createLargeBinary(t){return e.startLargeBinary(t),e.endLargeBinary(t)}},LargeUtf8$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsLargeUtf8(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeUtf8(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeUtf8(e){e.startObject(0)}static endLargeUtf8(e){return e.endObject()}static createLargeUtf8(t){return e.startLargeUtf8(t),e.endLargeUtf8(t)}},List$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsList(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(t){return e.startList(t),e.endList(t)}},Map$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMap(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}static startMap(e){e.startObject(1)}static addKeysSorted(e,t){e.addFieldInt8(0,+t,0)}static endMap(e){return e.endObject()}static createMap(t,i){return e.startMap(t),e.addKeysSorted(t,i),e.endMap(t)}},Null$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsNull(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(t){return e.startNull(t),e.endNull(t)}};class Struct_{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsStruct_(e,t){return(t||new Struct_).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new Struct_).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return Struct_.startStruct_(e),Struct_.endStruct_(e)}}class Time{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTime(e,t){return(t||new Time).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new Time).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):TimeUnit.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,TimeUnit.MILLISECOND)}static addBitWidth(e,t){e.addFieldInt32(1,t,32)}static endTime(e){return e.endObject()}static createTime(e,t,i){return Time.startTime(e),Time.addUnit(e,t),Time.addBitWidth(e,i),Time.endTime(e)}}class Timestamp{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTimestamp(e,t){return(t||new Timestamp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new Timestamp).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):TimeUnit.SECOND}timezone(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,TimeUnit.SECOND)}static addTimezone(e,t){e.addFieldOffset(1,t,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,t,i){return Timestamp.startTimestamp(e),Timestamp.addUnit(e,t),Timestamp.addTimezone(e,i),Timestamp.endTimestamp(e)}}class Union{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUnion(e,t){return(t||new Union).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new Union).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):UnionMode.Sparse}typeIds(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+4*e):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,t){e.addFieldInt16(0,t,UnionMode.Sparse)}static addTypeIds(e,t){e.addFieldOffset(1,t,0)}static createTypeIdsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addInt32(t[i]);return e.endVector()}static startTypeIdsVector(e,t){e.startVector(4,t,4)}static endUnion(e){return e.endObject()}static createUnion(e,t,i){return Union.startUnion(e),Union.addMode(e,t),Union.addTypeIds(e,i),Union.endUnion(e)}}let Utf8$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUtf8(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(t){return e.startUtf8(t),e.endUtf8(t)}};var Type$1,Type2;Type2=Type$1||(Type$1={}),Type2[Type2.NONE=0]="NONE",Type2[Type2.Null=1]="Null",Type2[Type2.Int=2]="Int",Type2[Type2.FloatingPoint=3]="FloatingPoint",Type2[Type2.Binary=4]="Binary",Type2[Type2.Utf8=5]="Utf8",Type2[Type2.Bool=6]="Bool",Type2[Type2.Decimal=7]="Decimal",Type2[Type2.Date=8]="Date",Type2[Type2.Time=9]="Time",Type2[Type2.Timestamp=10]="Timestamp",Type2[Type2.Interval=11]="Interval",Type2[Type2.List=12]="List",Type2[Type2.Struct_=13]="Struct_",Type2[Type2.Union=14]="Union",Type2[Type2.FixedSizeBinary=15]="FixedSizeBinary",Type2[Type2.FixedSizeList=16]="FixedSizeList",Type2[Type2.Map=17]="Map",Type2[Type2.Duration=18]="Duration",Type2[Type2.LargeBinary=19]="LargeBinary",Type2[Type2.LargeUtf8=20]="LargeUtf8",Type2[Type2.LargeList=21]="LargeList",Type2[Type2.RunEndEncoded=22]="RunEndEncoded";let Field$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsField(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Type$1.NONE}type(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__union(e,this.bb_pos+t):null}dictionary(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new DictionaryEncoding).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}children(t,i){const n=this.bb.__offset(this.bb_pos,14);return n?(i||new e).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,16);return i?(t||new KeyValue).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*e),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,t){e.addFieldOffset(0,t,0)}static addNullable(e,t){e.addFieldInt8(1,+t,0)}static addTypeType(e,t){e.addFieldInt8(2,t,Type$1.NONE)}static addType(e,t){e.addFieldOffset(3,t,0)}static addDictionary(e,t){e.addFieldOffset(4,t,0)}static addChildren(e,t){e.addFieldOffset(5,t,0)}static createChildrenVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startChildrenVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(6,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endField(e){return e.endObject()}},Schema$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSchema(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Endianness.Little}fields(e,t){const i=this.bb.__offset(this.bb_pos,6);return i?(t||new Field$1).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*e),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new KeyValue).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*e),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,t){e.addFieldInt16(0,t,Endianness.Little)}static addFields(e,t){e.addFieldOffset(1,t,0)}static createFieldsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startFieldsVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(2,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static addFeatures(e,t){e.addFieldOffset(3,t,0)}static createFeaturesVector(e,t){e.startVector(8,t.length,8);for(let i=t.length-1;i>=0;i--)e.addInt64(t[i]);return e.endVector()}static startFeaturesVector(e,t){e.startVector(8,t,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,t){e.finish(t)}static finishSizePrefixedSchemaBuffer(e,t){e.finish(t,void 0,!0)}static createSchema(t,i,n,r,s){return e.startSchema(t),e.addEndianness(t,i),e.addFields(t,n),e.addCustomMetadata(t,r),e.addFeatures(t,s),e.endSchema(t)}};var MessageHeader,MessageHeader2,Type,BufferType,BufferType2;MessageHeader2=MessageHeader||(MessageHeader={}),MessageHeader2[MessageHeader2.NONE=0]="NONE",MessageHeader2[MessageHeader2.Schema=1]="Schema",MessageHeader2[MessageHeader2.DictionaryBatch=2]="DictionaryBatch",MessageHeader2[MessageHeader2.RecordBatch=3]="RecordBatch",MessageHeader2[MessageHeader2.Tensor=4]="Tensor",MessageHeader2[MessageHeader2.SparseTensor=5]="SparseTensor",function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth",e[e.DurationSecond=-27]="DurationSecond",e[e.DurationMillisecond=-28]="DurationMillisecond",e[e.DurationMicrosecond=-29]="DurationMicrosecond",e[e.DurationNanosecond=-30]="DurationNanosecond"}(Type||(Type={})),BufferType2=BufferType||(BufferType={}),BufferType2[BufferType2.OFFSET=0]="OFFSET",BufferType2[BufferType2.DATA=1]="DATA",BufferType2[BufferType2.VALIDITY=2]="VALIDITY",BufferType2[BufferType2.TYPE=3]="TYPE";const undf=void 0;function valueToString(e){if(null===e)return"null";if(e===undf)return"undefined";switch(typeof e){case"number":case"bigint":return`${e}`;case"string":return`"${e}"`}return"function"==typeof e[Symbol.toPrimitive]?e[Symbol.toPrimitive]("string"):ArrayBuffer.isView(e)?e instanceof BigInt64Array||e instanceof BigUint64Array?`[${[...e].map(e=>valueToString(e))}]`:`[${e}]`:ArrayBuffer.isView(e)?`[${e}]`:JSON.stringify(e,(e,t)=>"bigint"==typeof t?`${t}`:t)}function bigIntToNumber(e){if("bigint"==typeof e&&(e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER))throw new TypeError(`${e} is not safe to convert to a number.`);return Number(e)}function divideBigInts(e,t){return bigIntToNumber(e/t)+bigIntToNumber(e%t)/bigIntToNumber(t)}const isArrowBigNumSymbol=Symbol.for("isArrowBigNum");function BigNum(e,...t){return 0===t.length?Object.setPrototypeOf(toArrayBufferView(this.TypedArray,e),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(e,...t),this.constructor.prototype)}function SignedBigNum(...e){return BigNum.apply(this,e)}function UnsignedBigNum(...e){return BigNum.apply(this,e)}function DecimalBigNum(...e){return BigNum.apply(this,e)}BigNum.prototype[isArrowBigNumSymbol]=!0,BigNum.prototype.toJSON=function(){return`"${bigNumToString(this)}"`},BigNum.prototype.valueOf=function(e){return bigNumToNumber(this,e)},BigNum.prototype.toString=function(){return bigNumToString(this)},BigNum.prototype[Symbol.toPrimitive]=function(e="default"){switch(e){case"number":return bigNumToNumber(this);case"string":return bigNumToString(this);case"default":return bigNumToBigInt(this)}return bigNumToString(this)},Object.setPrototypeOf(SignedBigNum.prototype,Object.create(Int32Array.prototype)),Object.setPrototypeOf(UnsignedBigNum.prototype,Object.create(Uint32Array.prototype)),Object.setPrototypeOf(DecimalBigNum.prototype,Object.create(Uint32Array.prototype)),Object.assign(SignedBigNum.prototype,BigNum.prototype,{constructor:SignedBigNum,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array}),Object.assign(UnsignedBigNum.prototype,BigNum.prototype,{constructor:UnsignedBigNum,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array}),Object.assign(DecimalBigNum.prototype,BigNum.prototype,{constructor:DecimalBigNum,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});const TWO_TO_THE_64=BigInt(4294967296)*BigInt(4294967296),TWO_TO_THE_64_MINUS_1=TWO_TO_THE_64-BigInt(1);function bigNumToNumber(e,t){const{buffer:i,byteOffset:n,byteLength:r,signed:s}=e,o=new BigUint64Array(i,n,r/8),a=s&&o.at(-1)&BigInt(1)<<BigInt(63);let l=BigInt(0),c=0;if(a){for(const e of o)l|=(e^TWO_TO_THE_64_MINUS_1)*(BigInt(1)<<BigInt(64*c++));l*=BigInt(-1),l-=BigInt(1)}else for(const h of o)l|=h*(BigInt(1)<<BigInt(64*c++));if("number"==typeof t){const e=BigInt(Math.pow(10,t)),i=l%e;return bigIntToNumber(l/e)+bigIntToNumber(i)/bigIntToNumber(e)}return bigIntToNumber(l)}function bigNumToString(e){if(8===e.byteLength){return`${new e.BigIntArray(e.buffer,e.byteOffset,1)[0]}`}if(!e.signed)return unsignedBigNumToString(e);let t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);if(new Int16Array([t.at(-1)])[0]>=0)return unsignedBigNumToString(e);t=t.slice();let i=1;for(let n=0;n<t.length;n++){const e=t[n],r=~e+i;t[n]=r,i&=0===e?1:0}return`-${unsignedBigNumToString(t)}`}function bigNumToBigInt(e){if(8===e.byteLength){return new e.BigIntArray(e.buffer,e.byteOffset,1)[0]}return bigNumToString(e)}function unsignedBigNumToString(e){let t="";const i=new Uint32Array(2);let n=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);const r=new Uint32Array((n=new Uint16Array(n).reverse()).buffer);let s=-1;const o=n.length-1;do{for(i[0]=n[s=0];s<o;)n[s++]=i[1]=i[0]/10,i[0]=(i[0]-10*i[1]<<16)+n[s];n[s]=i[1]=i[0]/10,i[0]=i[0]-10*i[1],t=`${i[0]}${t}`}while(r[0]||r[1]||r[2]||r[3]);return null!=t?t:"0"}class BN{static new(e,t){switch(t){case!0:return new SignedBigNum(e);case!1:return new UnsignedBigNum(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new SignedBigNum(e)}return 16===e.byteLength?new DecimalBigNum(e):new UnsignedBigNum(e)}static signed(e){return new SignedBigNum(e)}static unsigned(e){return new UnsignedBigNum(e)}static decimal(e){return new DecimalBigNum(e)}constructor(e,t){return BN.new(e,t)}}var _a$4,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,proto;class DataType{static isNull(e){return(null==e?void 0:e.typeId)===Type.Null}static isInt(e){return(null==e?void 0:e.typeId)===Type.Int}static isFloat(e){return(null==e?void 0:e.typeId)===Type.Float}static isBinary(e){return(null==e?void 0:e.typeId)===Type.Binary}static isLargeBinary(e){return(null==e?void 0:e.typeId)===Type.LargeBinary}static isUtf8(e){return(null==e?void 0:e.typeId)===Type.Utf8}static isLargeUtf8(e){return(null==e?void 0:e.typeId)===Type.LargeUtf8}static isBool(e){return(null==e?void 0:e.typeId)===Type.Bool}static isDecimal(e){return(null==e?void 0:e.typeId)===Type.Decimal}static isDate(e){return(null==e?void 0:e.typeId)===Type.Date}static isTime(e){return(null==e?void 0:e.typeId)===Type.Time}static isTimestamp(e){return(null==e?void 0:e.typeId)===Type.Timestamp}static isInterval(e){return(null==e?void 0:e.typeId)===Type.Interval}static isDuration(e){return(null==e?void 0:e.typeId)===Type.Duration}static isList(e){return(null==e?void 0:e.typeId)===Type.List}static isStruct(e){return(null==e?void 0:e.typeId)===Type.Struct}static isUnion(e){return(null==e?void 0:e.typeId)===Type.Union}static isFixedSizeBinary(e){return(null==e?void 0:e.typeId)===Type.FixedSizeBinary}static isFixedSizeList(e){return(null==e?void 0:e.typeId)===Type.FixedSizeList}static isMap(e){return(null==e?void 0:e.typeId)===Type.Map}static isDictionary(e){return(null==e?void 0:e.typeId)===Type.Dictionary}static isDenseUnion(e){return DataType.isUnion(e)&&e.mode===UnionMode.Dense}static isSparseUnion(e){return DataType.isUnion(e)&&e.mode===UnionMode.Sparse}constructor(e){this.typeId=e}}_a$4=Symbol.toStringTag,DataType[_a$4]=(proto=DataType.prototype,proto.children=null,proto.ArrayType=Array,proto.OffsetArrayType=Int32Array,proto[Symbol.toStringTag]="DataType");class Null extends DataType{constructor(){super(Type.Null)}toString(){return"Null"}}_b=Symbol.toStringTag,Null[_b]=Null.prototype[Symbol.toStringTag]="Null";class Int_ extends DataType{constructor(e,t){super(Type.Int),this.isSigned=e,this.bitWidth=t}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}_c=Symbol.toStringTag,Int_[_c]=(e=>(e.isSigned=null,e.bitWidth=null,e[Symbol.toStringTag]="Int"))(Int_.prototype);class Int32 extends Int_{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(Int32.prototype,"ArrayType",{value:Int32Array});class Float extends DataType{constructor(e){super(Type.Float),this.precision=e}get ArrayType(){switch(this.precision){case Precision.HALF:return Uint16Array;case Precision.SINGLE:return Float32Array;case Precision.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}_d=Symbol.toStringTag,Float[_d]=(e=>(e.precision=null,e[Symbol.toStringTag]="Float"))(Float.prototype);class Binary extends DataType{constructor(){super(Type.Binary)}toString(){return"Binary"}}_e=Symbol.toStringTag,Binary[_e]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Binary"))(Binary.prototype);class LargeBinary extends DataType{constructor(){super(Type.LargeBinary)}toString(){return"LargeBinary"}}_f=Symbol.toStringTag,LargeBinary[_f]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeBinary"))(LargeBinary.prototype);class Utf8 extends DataType{constructor(){super(Type.Utf8)}toString(){return"Utf8"}}_g=Symbol.toStringTag,Utf8[_g]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Utf8"))(Utf8.prototype);class LargeUtf8 extends DataType{constructor(){super(Type.LargeUtf8)}toString(){return"LargeUtf8"}}_h=Symbol.toStringTag,LargeUtf8[_h]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeUtf8"))(LargeUtf8.prototype);class Bool extends DataType{constructor(){super(Type.Bool)}toString(){return"Bool"}}_j=Symbol.toStringTag,Bool[_j]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Bool"))(Bool.prototype);class Decimal extends DataType{constructor(e,t,i=128){super(Type.Decimal),this.scale=e,this.precision=t,this.bitWidth=i}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}_k=Symbol.toStringTag,Decimal[_k]=(e=>(e.scale=null,e.precision=null,e.ArrayType=Uint32Array,e[Symbol.toStringTag]="Decimal"))(Decimal.prototype);class Date_ extends DataType{constructor(e){super(Type.Date),this.unit=e}toString(){return`Date${32*(this.unit+1)}<${DateUnit[this.unit]}>`}get ArrayType(){return this.unit===DateUnit.DAY?Int32Array:BigInt64Array}}_l=Symbol.toStringTag,Date_[_l]=(e=>(e.unit=null,e[Symbol.toStringTag]="Date"))(Date_.prototype);class Time_ extends DataType{constructor(e,t){super(Type.Time),this.unit=e,this.bitWidth=t}toString(){return`Time${this.bitWidth}<${TimeUnit[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}_m=Symbol.toStringTag,Time_[_m]=(e=>(e.unit=null,e.bitWidth=null,e[Symbol.toStringTag]="Time"))(Time_.prototype);class Timestamp_ extends DataType{constructor(e,t){super(Type.Timestamp),this.unit=e,this.timezone=t}toString(){return`Timestamp<${TimeUnit[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}_o=Symbol.toStringTag,Timestamp_[_o]=(e=>(e.unit=null,e.timezone=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Timestamp"))(Timestamp_.prototype);class Interval_ extends DataType{constructor(e){super(Type.Interval),this.unit=e}toString(){return`Interval<${IntervalUnit[this.unit]}>`}}_p=Symbol.toStringTag,Interval_[_p]=(e=>(e.unit=null,e.ArrayType=Int32Array,e[Symbol.toStringTag]="Interval"))(Interval_.prototype);class Duration extends DataType{constructor(e){super(Type.Duration),this.unit=e}toString(){return`Duration<${TimeUnit[this.unit]}>`}}_q=Symbol.toStringTag,Duration[_q]=(e=>(e.unit=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Duration"))(Duration.prototype);class List extends DataType{constructor(e){super(Type.List),this.children=[e]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}_r=Symbol.toStringTag,List[_r]=(e=>(e.children=null,e[Symbol.toStringTag]="List"))(List.prototype);class Struct extends DataType{constructor(e){super(Type.Struct),this.children=e}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}_s=Symbol.toStringTag,Struct[_s]=(e=>(e.children=null,e[Symbol.toStringTag]="Struct"))(Struct.prototype);class Union_ extends DataType{constructor(e,t,i){super(Type.Union),this.mode=e,this.children=i,this.typeIds=t=Int32Array.from(t),this.typeIdToChildIndex=t.reduce((e,t,i)=>(e[t]=i)&&e||e,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}}_t=Symbol.toStringTag,Union_[_t]=(e=>(e.mode=null,e.typeIds=null,e.children=null,e.typeIdToChildIndex=null,e.ArrayType=Int8Array,e[Symbol.toStringTag]="Union"))(Union_.prototype);class FixedSizeBinary extends DataType{constructor(e){super(Type.FixedSizeBinary),this.byteWidth=e}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}_u=Symbol.toStringTag,FixedSizeBinary[_u]=(e=>(e.byteWidth=null,e.ArrayType=Uint8Array,e[Symbol.toStringTag]="FixedSizeBinary"))(FixedSizeBinary.prototype);class FixedSizeList extends DataType{constructor(e,t){super(Type.FixedSizeList),this.listSize=e,this.children=[t]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}_v=Symbol.toStringTag,FixedSizeList[_v]=(e=>(e.children=null,e.listSize=null,e[Symbol.toStringTag]="FixedSizeList"))(FixedSizeList.prototype);class Map_ extends DataType{constructor(e,t=!1){var i,n,r;if(super(Type.Map),this.children=[e],this.keysSorted=t,e&&(e.name="entries",null===(i=null==e?void 0:e.type)||void 0===i?void 0:i.children)){const t=null===(n=null==e?void 0:e.type)||void 0===n?void 0:n.children[0];t&&(t.name="key");const i=null===(r=null==e?void 0:e.type)||void 0===r?void 0:r.children[1];i&&(i.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}_w=Symbol.toStringTag,Map_[_w]=(e=>(e.children=null,e.keysSorted=null,e[Symbol.toStringTag]="Map_"))(Map_.prototype);const getId=(e=>()=>++e)(-1);class Dictionary extends DataType{constructor(e,t,i,n){super(Type.Dictionary),this.indices=t,this.dictionary=e,this.isOrdered=n||!1,this.id=null==i?getId():bigIntToNumber(i)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}function strideForType(e){const t=e;switch(e.typeId){case Type.Decimal:return e.bitWidth/32;case Type.Interval:return 1+t.unit;case Type.FixedSizeList:return t.listSize;case Type.FixedSizeBinary:return t.byteWidth;default:return 1}}_x=Symbol.toStringTag,Dictionary[_x]=(e=>(e.id=null,e.indices=null,e.isOrdered=null,e.dictionary=null,e[Symbol.toStringTag]="Dictionary"))(Dictionary.prototype);class Visitor{visitMany(e,...t){return e.map((e,i)=>this.visit(e,...t.map(e=>e[i])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,t=!0){return getVisitFn(this,e,t)}getVisitFnByTypeId(e,t=!0){return getVisitFnByTypeId(this,e,t)}visitNull(e,...t){return null}visitBool(e,...t){return null}visitInt(e,...t){return null}visitFloat(e,...t){return null}visitUtf8(e,...t){return null}visitLargeUtf8(e,...t){return null}visitBinary(e,...t){return null}visitLargeBinary(e,...t){return null}visitFixedSizeBinary(e,...t){return null}visitDate(e,...t){return null}visitTimestamp(e,...t){return null}visitTime(e,...t){return null}visitDecimal(e,...t){return null}visitList(e,...t){return null}visitStruct(e,...t){return null}visitUnion(e,...t){return null}visitDictionary(e,...t){return null}visitInterval(e,...t){return null}visitDuration(e,...t){return null}visitFixedSizeList(e,...t){return null}visitMap(e,...t){return null}}function getVisitFn(e,t,i=!0){return"number"==typeof t?getVisitFnByTypeId(e,t,i):"string"==typeof t&&t in Type?getVisitFnByTypeId(e,Type[t],i):t&&t instanceof DataType?getVisitFnByTypeId(e,inferDType(t),i):(null==t?void 0:t.type)&&t.type instanceof DataType?getVisitFnByTypeId(e,inferDType(t.type),i):getVisitFnByTypeId(e,Type.NONE,i)}function getVisitFnByTypeId(e,t,i=!0){let n=null;switch(t){case Type.Null:n=e.visitNull;break;case Type.Bool:n=e.visitBool;break;case Type.Int:n=e.visitInt;break;case Type.Int8:n=e.visitInt8||e.visitInt;break;case Type.Int16:n=e.visitInt16||e.visitInt;break;case Type.Int32:n=e.visitInt32||e.visitInt;break;case Type.Int64:n=e.visitInt64||e.visitInt;break;case Type.Uint8:n=e.visitUint8||e.visitInt;break;case Type.Uint16:n=e.visitUint16||e.visitInt;break;case Type.Uint32:n=e.visitUint32||e.visitInt;break;case Type.Uint64:n=e.visitUint64||e.visitInt;break;case Type.Float:n=e.visitFloat;break;case Type.Float16:n=e.visitFloat16||e.visitFloat;break;case Type.Float32:n=e.visitFloat32||e.visitFloat;break;case Type.Float64:n=e.visitFloat64||e.visitFloat;break;case Type.Utf8:n=e.visitUtf8;break;case Type.LargeUtf8:n=e.visitLargeUtf8;break;case Type.Binary:n=e.visitBinary;break;case Type.LargeBinary:n=e.visitLargeBinary;break;case Type.FixedSizeBinary:n=e.visitFixedSizeBinary;break;case Type.Date:n=e.visitDate;break;case Type.DateDay:n=e.visitDateDay||e.visitDate;break;case Type.DateMillisecond:n=e.visitDateMillisecond||e.visitDate;break;case Type.Timestamp:n=e.visitTimestamp;break;case Type.TimestampSecond:n=e.visitTimestampSecond||e.visitTimestamp;break;case Type.TimestampMillisecond:n=e.visitTimestampMillisecond||e.visitTimestamp;break;case Type.TimestampMicrosecond:n=e.visitTimestampMicrosecond||e.visitTimestamp;break;case Type.TimestampNanosecond:n=e.visitTimestampNanosecond||e.visitTimestamp;break;case Type.Time:n=e.visitTime;break;case Type.TimeSecond:n=e.visitTimeSecond||e.visitTime;break;case Type.TimeMillisecond:n=e.visitTimeMillisecond||e.visitTime;break;case Type.TimeMicrosecond:n=e.visitTimeMicrosecond||e.visitTime;break;case Type.TimeNanosecond:n=e.visitTimeNanosecond||e.visitTime;break;case Type.Decimal:n=e.visitDecimal;break;case Type.List:n=e.visitList;break;case Type.Struct:n=e.visitStruct;break;case Type.Union:n=e.visitUnion;break;case Type.DenseUnion:n=e.visitDenseUnion||e.visitUnion;break;case Type.SparseUnion:n=e.visitSparseUnion||e.visitUnion;break;case Type.Dictionary:n=e.visitDictionary;break;case Type.Interval:n=e.visitInterval;break;case Type.IntervalDayTime:n=e.visitIntervalDayTime||e.visitInterval;break;case Type.IntervalYearMonth:n=e.visitIntervalYearMonth||e.visitInterval;break;case Type.Duration:n=e.visitDuration;break;case Type.DurationSecond:n=e.visitDurationSecond||e.visitDuration;break;case Type.DurationMillisecond:n=e.visitDurationMillisecond||e.visitDuration;break;case Type.DurationMicrosecond:n=e.visitDurationMicrosecond||e.visitDuration;break;case Type.DurationNanosecond:n=e.visitDurationNanosecond||e.visitDuration;break;case Type.FixedSizeList:n=e.visitFixedSizeList;break;case Type.Map:n=e.visitMap}if("function"==typeof n)return n;if(!i)return()=>null;throw new Error(`Unrecognized type '${Type[t]}'`)}function inferDType(e){switch(e.typeId){case Type.Null:return Type.Null;case Type.Int:{const{bitWidth:t,isSigned:i}=e;switch(t){case 8:return i?Type.Int8:Type.Uint8;case 16:return i?Type.Int16:Type.Uint16;case 32:return i?Type.Int32:Type.Uint32;case 64:return i?Type.Int64:Type.Uint64}return Type.Int}case Type.Float:switch(e.precision){case Precision.HALF:return Type.Float16;case Precision.SINGLE:return Type.Float32;case Precision.DOUBLE:return Type.Float64}return Type.Float;case Type.Binary:return Type.Binary;case Type.LargeBinary:return Type.LargeBinary;case Type.Utf8:return Type.Utf8;case Type.LargeUtf8:return Type.LargeUtf8;case Type.Bool:return Type.Bool;case Type.Decimal:return Type.Decimal;case Type.Time:switch(e.unit){case TimeUnit.SECOND:return Type.TimeSecond;case TimeUnit.MILLISECOND:return Type.TimeMillisecond;case TimeUnit.MICROSECOND:return Type.TimeMicrosecond;case TimeUnit.NANOSECOND:return Type.TimeNanosecond}return Type.Time;case Type.Timestamp:switch(e.unit){case TimeUnit.SECOND:return Type.TimestampSecond;case TimeUnit.MILLISECOND:return Type.TimestampMillisecond;case TimeUnit.MICROSECOND:return Type.TimestampMicrosecond;case TimeUnit.NANOSECOND:return Type.TimestampNanosecond}return Type.Timestamp;case Type.Date:switch(e.unit){case DateUnit.DAY:return Type.DateDay;case DateUnit.MILLISECOND:return Type.DateMillisecond}return Type.Date;case Type.Interval:switch(e.unit){case IntervalUnit.DAY_TIME:return Type.IntervalDayTime;case IntervalUnit.YEAR_MONTH:return Type.IntervalYearMonth}return Type.Interval;case Type.Duration:switch(e.unit){case TimeUnit.SECOND:return Type.DurationSecond;case TimeUnit.MILLISECOND:return Type.DurationMillisecond;case TimeUnit.MICROSECOND:return Type.DurationMicrosecond;case TimeUnit.NANOSECOND:return Type.DurationNanosecond}return Type.Duration;case Type.Map:return Type.Map;case Type.List:return Type.List;case Type.Struct:return Type.Struct;case Type.Union:switch(e.mode){case UnionMode.Dense:return Type.DenseUnion;case UnionMode.Sparse:return Type.SparseUnion}return Type.Union;case Type.FixedSizeBinary:return Type.FixedSizeBinary;case Type.FixedSizeList:return Type.FixedSizeList;case Type.Dictionary:return Type.Dictionary}throw new Error(`Unrecognized type '${Type[e.typeId]}'`)}Visitor.prototype.visitInt8=null,Visitor.prototype.visitInt16=null,Visitor.prototype.visitInt32=null,Visitor.prototype.visitInt64=null,Visitor.prototype.visitUint8=null,Visitor.prototype.visitUint16=null,Visitor.prototype.visitUint32=null,Visitor.prototype.visitUint64=null,Visitor.prototype.visitFloat16=null,Visitor.prototype.visitFloat32=null,Visitor.prototype.visitFloat64=null,Visitor.prototype.visitDateDay=null,Visitor.prototype.visitDateMillisecond=null,Visitor.prototype.visitTimestampSecond=null,Visitor.prototype.visitTimestampMillisecond=null,Visitor.prototype.visitTimestampMicrosecond=null,Visitor.prototype.visitTimestampNanosecond=null,Visitor.prototype.visitTimeSecond=null,Visitor.prototype.visitTimeMillisecond=null,Visitor.prototype.visitTimeMicrosecond=null,Visitor.prototype.visitTimeNanosecond=null,Visitor.prototype.visitDenseUnion=null,Visitor.prototype.visitSparseUnion=null,Visitor.prototype.visitIntervalDayTime=null,Visitor.prototype.visitIntervalYearMonth=null,Visitor.prototype.visitDuration=null,Visitor.prototype.visitDurationSecond=null,Visitor.prototype.visitDurationMillisecond=null,Visitor.prototype.visitDurationMicrosecond=null,Visitor.prototype.visitDurationNanosecond=null;const f64=new Float64Array(1),u32=new Uint32Array(f64.buffer);function uint16ToFloat64(e){const t=(31744&e)>>10,i=(1023&e)/1024,n=Math.pow(-1,(32768&e)>>15);switch(t){case 31:return n*(i?Number.NaN:1/0);case 0:return n*(i?6103515625e-14*i:0)}return n*Math.pow(2,t-15)*(1+i)}function float64ToUint16(e){if(e!=e)return 32256;f64[0]=e;const t=(2147483648&u32[1])>>16&65535;let i=2146435072&u32[1],n=0;return i>=1089470464?u32[0]>0?i=31744:(i=(2080374784&i)>>16,n=(1048575&u32[1])>>10):i<=1056964608?(n=1048576+(1048575&u32[1]),n=1048576+(n<<(i>>20)-998)>>21,i=0):(i=i-1056964608>>10,n=512+(1048575&u32[1])>>10),t|i|65535&n}class SetVisitor extends Visitor{}function wrapSet(e){return(t,i,n)=>{if(t.setValid(i,null!=n))return e(t,i,n)}}const setEpochMsToDays=(e,t,i)=>{e[t]=Math.floor(i/864e5)},setVariableWidthBytes=(e,t,i,n)=>{if(i+1<t.length){const r=bigIntToNumber(t[i]),s=bigIntToNumber(t[i+1]);e.set(n.subarray(0,s-r),r)}},setBool=({offset:e,values:t},i,n)=>{const r=e+i;n?t[r>>3]|=1<<r%8:t[r>>3]&=~(1<<r%8)},setInt=({values:e},t,i)=>{e[t]=i},setFloat=({values:e},t,i)=>{e[t]=i},setFloat16=({values:e},t,i)=>{e[t]=float64ToUint16(i)},setAnyFloat=(e,t,i)=>{switch(e.type.precision){case Precision.HALF:return setFloat16(e,t,i);case Precision.SINGLE:case Precision.DOUBLE:return setFloat(e,t,i)}},setDateDay=({values:e},t,i)=>{setEpochMsToDays(e,t,i.valueOf())},setDateMillisecond=({values:e},t,i)=>{e[t]=BigInt(i)},setFixedSizeBinary=({stride:e,values:t},i,n)=>{t.set(n.subarray(0,e),e*i)},setBinary=({values:e,valueOffsets:t},i,n)=>setVariableWidthBytes(e,t,i,n),setUtf8=({values:e,valueOffsets:t},i,n)=>setVariableWidthBytes(e,t,i,encodeUtf8(n)),setDate=(e,t,i)=>{e.type.unit===DateUnit.DAY?setDateDay(e,t,i):setDateMillisecond(e,t,i)},setTimestampSecond=({values:e},t,i)=>{e[t]=BigInt(i/1e3)},setTimestampMillisecond=({values:e},t,i)=>{e[t]=BigInt(i)},setTimestampMicrosecond=({values:e},t,i)=>{e[t]=BigInt(1e3*i)},setTimestampNanosecond=({values:e},t,i)=>{e[t]=BigInt(1e6*i)},setTimestamp=(e,t,i)=>{switch(e.type.unit){case TimeUnit.SECOND:return setTimestampSecond(e,t,i);case TimeUnit.MILLISECOND:return setTimestampMillisecond(e,t,i);case TimeUnit.MICROSECOND:return setTimestampMicrosecond(e,t,i);case TimeUnit.NANOSECOND:return setTimestampNanosecond(e,t,i)}},setTimeSecond=({values:e},t,i)=>{e[t]=i},setTimeMillisecond=({values:e},t,i)=>{e[t]=i},setTimeMicrosecond=({values:e},t,i)=>{e[t]=i},setTimeNanosecond=({values:e},t,i)=>{e[t]=i},setTime=(e,t,i)=>{switch(e.type.unit){case TimeUnit.SECOND:return setTimeSecond(e,t,i);case TimeUnit.MILLISECOND:return setTimeMillisecond(e,t,i);case TimeUnit.MICROSECOND:return setTimeMicrosecond(e,t,i);case TimeUnit.NANOSECOND:return setTimeNanosecond(e,t,i)}},setDecimal=({values:e,stride:t},i,n)=>{e.set(n.subarray(0,t),t*i)},setList=(e,t,i)=>{const n=e.children[0],r=e.valueOffsets,s=instance$5.getVisitFn(n);if(Array.isArray(i))for(let o=-1,a=r[t],l=r[t+1];a<l;)s(n,a++,i[++o]);else for(let o=-1,a=r[t],l=r[t+1];a<l;)s(n,a++,i.get(++o))},setMap=(e,t,i)=>{const n=e.children[0],{valueOffsets:r}=e,s=instance$5.getVisitFn(n);let{[t]:o,[t+1]:a}=r;const l=i instanceof Map?i.entries():Object.entries(i);for(const c of l)if(s(n,o,c),++o>=a)break},_setStructArrayValue=(e,t)=>(i,n,r,s)=>n&&i(n,e,t[s]),_setStructVectorValue=(e,t)=>(i,n,r,s)=>n&&i(n,e,t.get(s)),_setStructMapValue=(e,t)=>(i,n,r,s)=>n&&i(n,e,t.get(r.name)),_setStructObjectValue=(e,t)=>(i,n,r,s)=>n&&i(n,e,t[r.name]),setStruct=(e,t,i)=>{const n=e.type.children.map(e=>instance$5.getVisitFn(e.type)),r=i instanceof Map?_setStructMapValue(t,i):i instanceof Vector?_setStructVectorValue(t,i):Array.isArray(i)?_setStructArrayValue(t,i):_setStructObjectValue(t,i);e.type.children.forEach((t,i)=>r(n[i],e.children[i],t,i))},setUnion=(e,t,i)=>{e.type.mode===UnionMode.Dense?setDenseUnion(e,t,i):setSparseUnion(e,t,i)},setDenseUnion=(e,t,i)=>{const n=e.type.typeIdToChildIndex[e.typeIds[t]],r=e.children[n];instance$5.visit(r,e.valueOffsets[t],i)},setSparseUnion=(e,t,i)=>{const n=e.type.typeIdToChildIndex[e.typeIds[t]],r=e.children[n];instance$5.visit(r,t,i)},setDictionary=(e,t,i)=>{var n;null===(n=e.dictionary)||void 0===n||n.set(e.values[t],i)},setIntervalValue=(e,t,i)=>{e.type.unit===IntervalUnit.DAY_TIME?setIntervalDayTime(e,t,i):setIntervalYearMonth(e,t,i)},setIntervalDayTime=({values:e},t,i)=>{e.set(i.subarray(0,2),2*t)},setIntervalYearMonth=({values:e},t,i)=>{e[t]=12*i[0]+i[1]%12},setDurationSecond=({values:e},t,i)=>{e[t]=i},setDurationMillisecond=({values:e},t,i)=>{e[t]=i},setDurationMicrosecond=({values:e},t,i)=>{e[t]=i},setDurationNanosecond=({values:e},t,i)=>{e[t]=i},setDuration=(e,t,i)=>{switch(e.type.unit){case TimeUnit.SECOND:return setDurationSecond(e,t,i);case TimeUnit.MILLISECOND:return setDurationMillisecond(e,t,i);case TimeUnit.MICROSECOND:return setDurationMicrosecond(e,t,i);case TimeUnit.NANOSECOND:return setDurationNanosecond(e,t,i)}},setFixedSizeList=(e,t,i)=>{const{stride:n}=e,r=e.children[0],s=instance$5.getVisitFn(r);if(Array.isArray(i))for(let o=-1,a=t*n;++o<n;)s(r,a+o,i[o]);else for(let o=-1,a=t*n;++o<n;)s(r,a+o,i.get(o))};SetVisitor.prototype.visitBool=wrapSet(setBool),SetVisitor.prototype.visitInt=wrapSet(setInt),SetVisitor.prototype.visitInt8=wrapSet(setInt),SetVisitor.prototype.visitInt16=wrapSet(setInt),SetVisitor.prototype.visitInt32=wrapSet(setInt),SetVisitor.prototype.visitInt64=wrapSet(setInt),SetVisitor.prototype.visitUint8=wrapSet(setInt),SetVisitor.prototype.visitUint16=wrapSet(setInt),SetVisitor.prototype.visitUint32=wrapSet(setInt),SetVisitor.prototype.visitUint64=wrapSet(setInt),SetVisitor.prototype.visitFloat=wrapSet(setAnyFloat),SetVisitor.prototype.visitFloat16=wrapSet(setFloat16),SetVisitor.prototype.visitFloat32=wrapSet(setFloat),SetVisitor.prototype.visitFloat64=wrapSet(setFloat),SetVisitor.prototype.visitUtf8=wrapSet(setUtf8),SetVisitor.prototype.visitLargeUtf8=wrapSet(setUtf8),SetVisitor.prototype.visitBinary=wrapSet(setBinary),SetVisitor.prototype.visitLargeBinary=wrapSet(setBinary),SetVisitor.prototype.visitFixedSizeBinary=wrapSet(setFixedSizeBinary),SetVisitor.prototype.visitDate=wrapSet(setDate),SetVisitor.prototype.visitDateDay=wrapSet(setDateDay),SetVisitor.prototype.visitDateMillisecond=wrapSet(setDateMillisecond),SetVisitor.prototype.visitTimestamp=wrapSet(setTimestamp),SetVisitor.prototype.visitTimestampSecond=wrapSet(setTimestampSecond),SetVisitor.prototype.visitTimestampMillisecond=wrapSet(setTimestampMillisecond),SetVisitor.prototype.visitTimestampMicrosecond=wrapSet(setTimestampMicrosecond),SetVisitor.prototype.visitTimestampNanosecond=wrapSet(setTimestampNanosecond),SetVisitor.prototype.visitTime=wrapSet(setTime),SetVisitor.prototype.visitTimeSecond=wrapSet(setTimeSecond),SetVisitor.prototype.visitTimeMillisecond=wrapSet(setTimeMillisecond),SetVisitor.prototype.visitTimeMicrosecond=wrapSet(setTimeMicrosecond),SetVisitor.prototype.visitTimeNanosecond=wrapSet(setTimeNanosecond),SetVisitor.prototype.visitDecimal=wrapSet(setDecimal),SetVisitor.prototype.visitList=wrapSet(setList),SetVisitor.prototype.visitStruct=wrapSet(setStruct),SetVisitor.prototype.visitUnion=wrapSet(setUnion),SetVisitor.prototype.visitDenseUnion=wrapSet(setDenseUnion),SetVisitor.prototype.visitSparseUnion=wrapSet(setSparseUnion),SetVisitor.prototype.visitDictionary=wrapSet(setDictionary),SetVisitor.prototype.visitInterval=wrapSet(setIntervalValue),SetVisitor.prototype.visitIntervalDayTime=wrapSet(setIntervalDayTime),SetVisitor.prototype.visitIntervalYearMonth=wrapSet(setIntervalYearMonth),SetVisitor.prototype.visitDuration=wrapSet(setDuration),SetVisitor.prototype.visitDurationSecond=wrapSet(setDurationSecond),SetVisitor.prototype.visitDurationMillisecond=wrapSet(setDurationMillisecond),SetVisitor.prototype.visitDurationMicrosecond=wrapSet(setDurationMicrosecond),SetVisitor.prototype.visitDurationNanosecond=wrapSet(setDurationNanosecond),SetVisitor.prototype.visitFixedSizeList=wrapSet(setFixedSizeList),SetVisitor.prototype.visitMap=wrapSet(setMap);const instance$5=new SetVisitor,kParent=Symbol.for("parent"),kRowIndex=Symbol.for("rowIndex");class StructRow{constructor(e,t){return this[kParent]=e,this[kRowIndex]=t,new Proxy(this,new StructRowProxyHandler)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[kRowIndex],t=this[kParent],i=t.type.children,n={};for(let r=-1,s=i.length;++r<s;)n[i[r].name]=instance$4.visit(t.children[r],e);return n}toString(){return`{${[...this].map(([e,t])=>`${valueToString(e)}: ${valueToString(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new StructRowIterator(this[kParent],this[kRowIndex])}}class StructRowIterator{constructor(e,t){this.childIndex=0,this.children=e.children,this.rowIndex=t,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,instance$4.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(StructRow.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[kParent]:{writable:!0,enumerable:!1,configurable:!1,value:null},[kRowIndex]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class StructRowProxyHandler{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[kParent].type.children.map(e=>e.name)}has(e,t){return-1!==e[kParent].type.children.findIndex(e=>e.name===t)}getOwnPropertyDescriptor(e,t){if(-1!==e[kParent].type.children.findIndex(e=>e.name===t))return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const i=e[kParent].type.children.findIndex(e=>e.name===t);if(-1!==i){const n=instance$4.visit(e[kParent].children[i],e[kRowIndex]);return Reflect.set(e,t,n),n}}set(e,t,i){const n=e[kParent].type.children.findIndex(e=>e.name===t);return-1!==n?(instance$5.visit(e[kParent].children[n],e[kRowIndex],i),Reflect.set(e,t,i)):!(!Reflect.has(e,t)&&"symbol"!=typeof t)&&Reflect.set(e,t,i)}}class GetVisitor extends Visitor{}function wrapGet(e){return(t,i)=>t.getValid(i)?e(t,i):null}const epochDaysToMs=(e,t)=>864e5*e[t],getNull=(e,t)=>null,getVariableWidthBytes=(e,t,i)=>{if(i+1>=t.length)return null;const n=bigIntToNumber(t[i]),r=bigIntToNumber(t[i+1]);return e.subarray(n,r)},getBool$1=({offset:e,values:t},i)=>{const n=e+i;return!!(t[n>>3]&1<<n%8)},getDateDay=({values:e},t)=>epochDaysToMs(e,t),getDateMillisecond=({values:e},t)=>bigIntToNumber(e[t]),getNumeric=({stride:e,values:t},i)=>t[e*i],getFloat16=({stride:e,values:t},i)=>uint16ToFloat64(t[e*i]),getBigInts=({values:e},t)=>e[t],getFixedSizeBinary=({stride:e,values:t},i)=>t.subarray(e*i,e*(i+1)),getBinary=({values:e,valueOffsets:t},i)=>getVariableWidthBytes(e,t,i),getUtf8=({values:e,valueOffsets:t},i)=>{const n=getVariableWidthBytes(e,t,i);return null!==n?decodeUtf8(n):null},getInt=({values:e},t)=>e[t],getFloat=({type:e,values:t},i)=>e.precision!==Precision.HALF?t[i]:uint16ToFloat64(t[i]),getDate=(e,t)=>e.type.unit===DateUnit.DAY?getDateDay(e,t):getDateMillisecond(e,t),getTimestampSecond=({values:e},t)=>1e3*bigIntToNumber(e[t]),getTimestampMillisecond=({values:e},t)=>bigIntToNumber(e[t]),getTimestampMicrosecond=({values:e},t)=>divideBigInts(e[t],BigInt(1e3)),getTimestampNanosecond=({values:e},t)=>divideBigInts(e[t],BigInt(1e6)),getTimestamp=(e,t)=>{switch(e.type.unit){case TimeUnit.SECOND:return getTimestampSecond(e,t);case TimeUnit.MILLISECOND:return getTimestampMillisecond(e,t);case TimeUnit.MICROSECOND:return getTimestampMicrosecond(e,t);case TimeUnit.NANOSECOND:return getTimestampNanosecond(e,t)}},getTimeSecond=({values:e},t)=>e[t],getTimeMillisecond=({values:e},t)=>e[t],getTimeMicrosecond=({values:e},t)=>e[t],getTimeNanosecond=({values:e},t)=>e[t],getTime=(e,t)=>{switch(e.type.unit){case TimeUnit.SECOND:return getTimeSecond(e,t);case TimeUnit.MILLISECOND:return getTimeMillisecond(e,t);case TimeUnit.MICROSECOND:return getTimeMicrosecond(e,t);case TimeUnit.NANOSECOND:return getTimeNanosecond(e,t)}},getDecimal=({values:e,stride:t},i)=>BN.decimal(e.subarray(t*i,t*(i+1))),getList=(e,t)=>{const{valueOffsets:i,stride:n,children:r}=e,{[t*n]:s,[t*n+1]:o}=i,a=r[0].slice(s,o-s);return new Vector([a])},getMap=(e,t)=>{const{valueOffsets:i,children:n}=e,{[t]:r,[t+1]:s}=i,o=n[0];return new MapRow(o.slice(r,s-r))},getStruct=(e,t)=>new StructRow(e,t),getUnion=(e,t)=>e.type.mode===UnionMode.Dense?getDenseUnion(e,t):getSparseUnion(e,t),getDenseUnion=(e,t)=>{const i=e.type.typeIdToChildIndex[e.typeIds[t]],n=e.children[i];return instance$4.visit(n,e.valueOffsets[t])},getSparseUnion=(e,t)=>{const i=e.type.typeIdToChildIndex[e.typeIds[t]],n=e.children[i];return instance$4.visit(n,t)},getDictionary=(e,t)=>{var i;return null===(i=e.dictionary)||void 0===i?void 0:i.get(e.values[t])},getInterval=(e,t)=>e.type.unit===IntervalUnit.DAY_TIME?getIntervalDayTime(e,t):getIntervalYearMonth(e,t),getIntervalDayTime=({values:e},t)=>e.subarray(2*t,2*(t+1)),getIntervalYearMonth=({values:e},t)=>{const i=e[t],n=new Int32Array(2);return n[0]=Math.trunc(i/12),n[1]=Math.trunc(i%12),n},getDurationSecond=({values:e},t)=>e[t],getDurationMillisecond=({values:e},t)=>e[t],getDurationMicrosecond=({values:e},t)=>e[t],getDurationNanosecond=({values:e},t)=>e[t],getDuration=(e,t)=>{switch(e.type.unit){case TimeUnit.SECOND:return getDurationSecond(e,t);case TimeUnit.MILLISECOND:return getDurationMillisecond(e,t);case TimeUnit.MICROSECOND:return getDurationMicrosecond(e,t);case TimeUnit.NANOSECOND:return getDurationNanosecond(e,t)}},getFixedSizeList=(e,t)=>{const{stride:i,children:n}=e,r=n[0].slice(t*i,i);return new Vector([r])};GetVisitor.prototype.visitNull=wrapGet(getNull),GetVisitor.prototype.visitBool=wrapGet(getBool$1),GetVisitor.prototype.visitInt=wrapGet(getInt),GetVisitor.prototype.visitInt8=wrapGet(getNumeric),GetVisitor.prototype.visitInt16=wrapGet(getNumeric),GetVisitor.prototype.visitInt32=wrapGet(getNumeric),GetVisitor.prototype.visitInt64=wrapGet(getBigInts),GetVisitor.prototype.visitUint8=wrapGet(getNumeric),GetVisitor.prototype.visitUint16=wrapGet(getNumeric),GetVisitor.prototype.visitUint32=wrapGet(getNumeric),GetVisitor.prototype.visitUint64=wrapGet(getBigInts),GetVisitor.prototype.visitFloat=wrapGet(getFloat),GetVisitor.prototype.visitFloat16=wrapGet(getFloat16),GetVisitor.prototype.visitFloat32=wrapGet(getNumeric),GetVisitor.prototype.visitFloat64=wrapGet(getNumeric),GetVisitor.prototype.visitUtf8=wrapGet(getUtf8),GetVisitor.prototype.visitLargeUtf8=wrapGet(getUtf8),GetVisitor.prototype.visitBinary=wrapGet(getBinary),GetVisitor.prototype.visitLargeBinary=wrapGet(getBinary),GetVisitor.prototype.visitFixedSizeBinary=wrapGet(getFixedSizeBinary),GetVisitor.prototype.visitDate=wrapGet(getDate),GetVisitor.prototype.visitDateDay=wrapGet(getDateDay),GetVisitor.prototype.visitDateMillisecond=wrapGet(getDateMillisecond),GetVisitor.prototype.visitTimestamp=wrapGet(getTimestamp),GetVisitor.prototype.visitTimestampSecond=wrapGet(getTimestampSecond),GetVisitor.prototype.visitTimestampMillisecond=wrapGet(getTimestampMillisecond),GetVisitor.prototype.visitTimestampMicrosecond=wrapGet(getTimestampMicrosecond),GetVisitor.prototype.visitTimestampNanosecond=wrapGet(getTimestampNanosecond),GetVisitor.prototype.visitTime=wrapGet(getTime),GetVisitor.prototype.visitTimeSecond=wrapGet(getTimeSecond),GetVisitor.prototype.visitTimeMillisecond=wrapGet(getTimeMillisecond),GetVisitor.prototype.visitTimeMicrosecond=wrapGet(getTimeMicrosecond),GetVisitor.prototype.visitTimeNanosecond=wrapGet(getTimeNanosecond),GetVisitor.prototype.visitDecimal=wrapGet(getDecimal),GetVisitor.prototype.visitList=wrapGet(getList),GetVisitor.prototype.visitStruct=wrapGet(getStruct),GetVisitor.prototype.visitUnion=wrapGet(getUnion),GetVisitor.prototype.visitDenseUnion=wrapGet(getDenseUnion),GetVisitor.prototype.visitSparseUnion=wrapGet(getSparseUnion),GetVisitor.prototype.visitDictionary=wrapGet(getDictionary),GetVisitor.prototype.visitInterval=wrapGet(getInterval),GetVisitor.prototype.visitIntervalDayTime=wrapGet(getIntervalDayTime),GetVisitor.prototype.visitIntervalYearMonth=wrapGet(getIntervalYearMonth),GetVisitor.prototype.visitDuration=wrapGet(getDuration),GetVisitor.prototype.visitDurationSecond=wrapGet(getDurationSecond),GetVisitor.prototype.visitDurationMillisecond=wrapGet(getDurationMillisecond),GetVisitor.prototype.visitDurationMicrosecond=wrapGet(getDurationMicrosecond),GetVisitor.prototype.visitDurationNanosecond=wrapGet(getDurationNanosecond),GetVisitor.prototype.visitFixedSizeList=wrapGet(getFixedSizeList),GetVisitor.prototype.visitMap=wrapGet(getMap);const instance$4=new GetVisitor,kKeys=Symbol.for("keys"),kVals=Symbol.for("vals"),kKeysAsStrings=Symbol.for("kKeysAsStrings"),_kKeysAsStrings=Symbol.for("_kKeysAsStrings");class MapRow{constructor(e){return this[kKeys]=new Vector([e.children[0]]).memoize(),this[kVals]=e.children[1],new Proxy(this,new MapRowProxyHandler)}get[kKeysAsStrings](){return this[_kKeysAsStrings]||(this[_kKeysAsStrings]=Array.from(this[kKeys].toArray(),String))}[Symbol.iterator](){return new MapRowIterator(this[kKeys],this[kVals])}get size(){return this[kKeys].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[kKeys],t=this[kVals],i={};for(let n=-1,r=e.length;++n<r;)i[e.get(n)]=instance$4.visit(t,n);return i}toString(){return`{${[...this].map(([e,t])=>`${valueToString(e)}: ${valueToString(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class MapRowIterator{constructor(e,t){this.keys=e,this.vals=t,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),instance$4.visit(this.vals,e)]})}}class MapRowProxyHandler{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[kKeysAsStrings]}has(e,t){return e[kKeysAsStrings].includes(t)}getOwnPropertyDescriptor(e,t){if(-1!==e[kKeysAsStrings].indexOf(t))return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const i=e[kKeysAsStrings].indexOf(t);if(-1!==i){const n=instance$4.visit(Reflect.get(e,kVals),i);return Reflect.set(e,t,n),n}}set(e,t,i){const n=e[kKeysAsStrings].indexOf(t);return-1!==n?(instance$5.visit(Reflect.get(e,kVals),n,i),Reflect.set(e,t,i)):!!Reflect.has(e,t)&&Reflect.set(e,t,i)}}let tmp;function clampRange(e,t,i,n){const{length:r=0}=e;let s="number"!=typeof t?0:t,o="number"!=typeof i?r:i;return s<0&&(s=(s%r+r)%r),o<0&&(o=(o%r+r)%r),o<s&&(tmp=s,s=o,o=tmp),o>r&&(o=r),n?n(e,s,o):[s,o]}Object.defineProperties(MapRow.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[kKeys]:{writable:!0,enumerable:!1,configurable:!1,value:null},[kVals]:{writable:!0,enumerable:!1,configurable:!1,value:null},[_kKeysAsStrings]:{writable:!0,enumerable:!1,configurable:!1,value:null}});const wrapIndex=(e,t)=>e<0?t+e:e,isNaNFast=e=>e!=e;function createElementComparator(e){if("object"!==typeof e||null===e)return isNaNFast(e)?isNaNFast:t=>t===e;if(e instanceof Date){const t=e.valueOf();return e=>e instanceof Date&&e.valueOf()===t}return ArrayBuffer.isView(e)?t=>!!t&&compareArrayLike(e,t):e instanceof Map?createMapComparator(e):Array.isArray(e)?createArrayLikeComparator(e):e instanceof Vector?createVectorComparator(e):createObjectComparator(e,!0)}function createArrayLikeComparator(e){const t=[];for(let i=-1,n=e.length;++i<n;)t[i]=createElementComparator(e[i]);return createSubElementsComparator(t)}function createMapComparator(e){let t=-1;const i=[];for(const n of e.values())i[++t]=createElementComparator(n);return createSubElementsComparator(i)}function createVectorComparator(e){const t=[];for(let i=-1,n=e.length;++i<n;)t[i]=createElementComparator(e.get(i));return createSubElementsComparator(t)}function createObjectComparator(e,t=!1){const i=Object.keys(e);if(!t&&0===i.length)return()=>!1;const n=[];for(let r=-1,s=i.length;++r<s;)n[r]=createElementComparator(e[i[r]]);return createSubElementsComparator(n,i)}function createSubElementsComparator(e,t){return i=>{if(!i||"object"!=typeof i)return!1;switch(i.constructor){case Array:return compareArray$1(e,i);case Map:return compareObject(e,i,i.keys());case MapRow:case StructRow:case Object:case void 0:return compareObject(e,i,t||Object.keys(i))}return i instanceof Vector&&compareVector(e,i)}}function compareArray$1(e,t){const i=e.length;if(t.length!==i)return!1;for(let n=-1;++n<i;)if(!e[n](t[n]))return!1;return!0}function compareVector(e,t){const i=e.length;if(t.length!==i)return!1;for(let n=-1;++n<i;)if(!e[n](t.get(n)))return!1;return!0}function compareObject(e,t,i){const n=i[Symbol.iterator](),r=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),s=t instanceof Map?t.values():Object.values(t)[Symbol.iterator]();let o=0;const a=e.length;let l=s.next(),c=n.next(),h=r.next();for(;o<a&&!c.done&&!h.done&&!l.done&&(c.value===h.value&&e[o](l.value));++o,c=n.next(),h=r.next(),l=s.next());return!!(o===a&&c.done&&h.done&&l.done)||(n.return&&n.return(),r.return&&r.return(),s.return&&s.return(),!1)}function getBool(e,t,i,n){return!!(i&1<<n)}function getBit(e,t,i,n){return(i&1<<n)>>n}function truncateBitmap(e,t,i){const n=i.byteLength+7&-8;if(e>0||i.byteLength<n){const r=new Uint8Array(n);return r.set(e%8==0?i.subarray(e>>3):packBools(new BitIterator(i,e,t,null,getBool)).subarray(0,n)),r}return i}function packBools(e){const t=[];let i=0,n=0,r=0;for(const o of e)o&&(r|=1<<n),8===++n&&(t[i++]=r,r=n=0);(0===i||n>0)&&(t[i++]=r);const s=new Uint8Array(t.length+7&-8);return s.set(t),s}class BitIterator{constructor(e,t,i,n,r){this.bytes=e,this.length=i,this.context=n,this.get=r,this.bit=t%8,this.byteIndex=t>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(8===this.bit&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function popcnt_bit_range(e,t,i){if(i-t<=0)return 0;if(i-t<8){let n=0;for(const r of new BitIterator(e,t,i-t,e,getBit))n+=r;return n}const n=i>>3<<3,r=t+(t%8==0?0:8-t%8);return popcnt_bit_range(e,t,r)+popcnt_bit_range(e,n,i)+popcnt_array(e,r>>3,n-r>>3)}function popcnt_array(e,t,i){let n=0,r=Math.trunc(t);const s=new DataView(e.buffer,e.byteOffset,e.byteLength),o=void 0===i?e.byteLength:r+i;for(;o-r>=4;)n+=popcnt_uint32(s.getUint32(r)),r+=4;for(;o-r>=2;)n+=popcnt_uint32(s.getUint16(r)),r+=2;for(;o-r>=1;)n+=popcnt_uint32(s.getUint8(r)),r+=1;return n}function popcnt_uint32(e){let t=Math.trunc(e);return t-=t>>>1&1431655765,t=(858993459&t)+(t>>>2&858993459),16843009*(t+(t>>>4)&252645135)>>>24}const kUnknownNullCount=-1;class Data{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(0!==this._nullCount){const{type:e}=this;return DataType.isSparseUnion(e)||DataType.isDenseUnion(e)?this.children.some(e=>e.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:t,values:i,nullBitmap:n,typeIds:r}=this;return t&&(e+=t.byteLength),i&&(e+=i.byteLength),n&&(e+=n.byteLength),r&&(e+=r.byteLength),this.children.reduce((e,t)=>e+t.byteLength,e)}get nullCount(){if(DataType.isUnion(this.type))return this.children.reduce((e,t)=>e+t.nullCount,0);let e,t=this._nullCount;return t<=kUnknownNullCount&&(e=this.nullBitmap)&&(this._nullCount=t=0===e.length?0:this.length-popcnt_bit_range(e,this.offset,this.offset+this.length)),t}constructor(e,t,i,n,r,s=[],o){let a;this.type=e,this.children=s,this.dictionary=o,this.offset=Math.floor(Math.max(t||0,0)),this.length=Math.floor(Math.max(i||0,0)),this._nullCount=Math.floor(Math.max(n||0,-1)),r instanceof Data?(this.stride=r.stride,this.values=r.values,this.typeIds=r.typeIds,this.nullBitmap=r.nullBitmap,this.valueOffsets=r.valueOffsets):(this.stride=strideForType(e),r&&((a=r[0])&&(this.valueOffsets=a),(a=r[1])&&(this.values=a),(a=r[2])&&(this.nullBitmap=a),(a=r[3])&&(this.typeIds=a)))}getValid(e){const{type:t}=this;if(DataType.isUnion(t)){const i=t,n=this.children[i.typeIdToChildIndex[this.typeIds[e]]],r=i.mode===UnionMode.Dense?this.valueOffsets[e]:e;return n.getValid(r)}if(this.nullable&&this.nullCount>0){const t=this.offset+e;return!!(this.nullBitmap[t>>3]&1<<t%8)}return!0}setValid(e,t){let i;const{type:n}=this;if(DataType.isUnion(n)){const r=n,s=this.children[r.typeIdToChildIndex[this.typeIds[e]]],o=r.mode===UnionMode.Dense?this.valueOffsets[e]:e;i=s.getValid(o),s.setValid(o,t)}else{let{nullBitmap:n}=this;const{offset:r,length:s}=this,o=r+e,a=1<<o%8,l=o>>3;(!n||n.byteLength<=l)&&(n=new Uint8Array((r+s+63&-64)>>3).fill(255),this.nullCount>0?(n.set(truncateBitmap(r,s,this.nullBitmap),0),Object.assign(this,{nullBitmap:n})):Object.assign(this,{nullBitmap:n,_nullCount:0}));const c=n[l];i=0!==(c&a),n[l]=t?c|a:c&~a}return i!==!!t&&(this._nullCount=this.nullCount+(t?-1:1)),t}clone(e=this.type,t=this.offset,i=this.length,n=this._nullCount,r=this,s=this.children){return new Data(e,t,i,n,r,s,this.dictionary)}slice(e,t){const{stride:i,typeId:n,children:r}=this,s=+(0===this._nullCount)-1,o=16===n?i:1,a=this._sliceBuffers(e,t,i,n);return this.clone(this.type,this.offset+e,t,s,a,0===r.length||this.valueOffsets?r:this._sliceChildren(r,o*e,o*t))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===Type.Null)return this.clone(this.type,0,e,0);const{length:t,nullCount:i}=this,n=new Uint8Array((e+63&-64)>>3).fill(255,0,t>>3);n[t>>3]=(1<<t-(-8&t))-1,i>0&&n.set(truncateBitmap(this.offset,t,this.nullBitmap),0);const r=this.buffers;return r[BufferType.VALIDITY]=n,this.clone(this.type,0,e,i+(e-t),r)}_sliceBuffers(e,t,i,n){let r;const{buffers:s}=this;return(r=s[BufferType.TYPE])&&(s[BufferType.TYPE]=r.subarray(e,e+t)),(r=s[BufferType.OFFSET])&&(s[BufferType.OFFSET]=r.subarray(e,e+t+1))||(r=s[BufferType.DATA])&&(s[BufferType.DATA]=6===n?r:r.subarray(i*e,i*(e+t))),s}_sliceChildren(e,t,i){return e.map(e=>e.slice(t,i))}}Data.prototype.children=Object.freeze([]);class MakeDataVisitor extends Visitor{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{type:t,offset:i=0,length:n=0}=e;return new Data(t,i,n,n)}visitBool(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length>>3,nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitInt(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length,nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitFloat(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length,nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitUtf8(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.data),r=toUint8Array(e.nullBitmap),s=toInt32Array(e.valueOffsets),{length:o=s.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Data(t,i,o,a,[s,n,r])}visitLargeUtf8(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.data),r=toUint8Array(e.nullBitmap),s=toBigInt64Array(e.valueOffsets),{length:o=s.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Data(t,i,o,a,[s,n,r])}visitBinary(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.data),r=toUint8Array(e.nullBitmap),s=toInt32Array(e.valueOffsets),{length:o=s.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Data(t,i,o,a,[s,n,r])}visitLargeBinary(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.data),r=toUint8Array(e.nullBitmap),s=toBigInt64Array(e.valueOffsets),{length:o=s.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Data(t,i,o,a,[s,n,r])}visitFixedSizeBinary(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length/strideForType(t),nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitDate(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length/strideForType(t),nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitTimestamp(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length/strideForType(t),nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitTime(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length/strideForType(t),nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitDecimal(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length/strideForType(t),nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitList(e){const{type:t,offset:i=0,child:n}=e,r=toUint8Array(e.nullBitmap),s=toInt32Array(e.valueOffsets),{length:o=s.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Data(t,i,o,a,[s,void 0,r],[n])}visitStruct(e){const{type:t,offset:i=0,children:n=[]}=e,r=toUint8Array(e.nullBitmap),{length:s=n.reduce((e,{length:t})=>Math.max(e,t),0),nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,void 0,r],n)}visitUnion(e){const{type:t,offset:i=0,children:n=[]}=e,r=toArrayBufferView(t.ArrayType,e.typeIds),{length:s=r.length,nullCount:o=-1}=e;if(DataType.isSparseUnion(t))return new Data(t,i,s,o,[void 0,void 0,void 0,r],n);const a=toInt32Array(e.valueOffsets);return new Data(t,i,s,o,[a,void 0,void 0,r],n)}visitDictionary(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.indices.ArrayType,e.data),{dictionary:s=new Vector([(new MakeDataVisitor).visit({type:t.dictionary})])}=e,{length:o=r.length,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Data(t,i,o,a,[void 0,r,n],[],s)}visitInterval(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length/strideForType(t),nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitDuration(e){const{type:t,offset:i=0}=e,n=toUint8Array(e.nullBitmap),r=toArrayBufferView(t.ArrayType,e.data),{length:s=r.length,nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,r,n])}visitFixedSizeList(e){const{type:t,offset:i=0,child:n=(new MakeDataVisitor).visit({type:t.valueType})}=e,r=toUint8Array(e.nullBitmap),{length:s=n.length/strideForType(t),nullCount:o=(e.nullBitmap?-1:0)}=e;return new Data(t,i,s,o,[void 0,void 0,r],[n])}visitMap(e){const{type:t,offset:i=0,child:n=(new MakeDataVisitor).visit({type:t.childType})}=e,r=toUint8Array(e.nullBitmap),s=toInt32Array(e.valueOffsets),{length:o=s.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Data(t,i,o,a,[s,void 0,r],[n])}}const makeDataVisitor=new MakeDataVisitor;function makeData(e){return makeDataVisitor.visit(e)}class ChunkedIterator{constructor(e=0,t){this.numChunks=e,this.getChunkIterator=t,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function computeChunkNullable(e){return e.some(e=>e.nullable)}function computeChunkNullCounts(e){return e.reduce((e,t)=>e+t.nullCount,0)}function computeChunkOffsets(e){return e.reduce((e,t,i)=>(e[i+1]=e[i]+t.length,e),new Uint32Array(e.length+1))}function sliceChunks(e,t,i,n){const r=[];for(let s=-1,o=e.length;++s<o;){const o=e[s],a=t[s],{length:l}=o;if(a>=n)break;if(i>=a+l)continue;if(a>=i&&a+l<=n){r.push(o);continue}const c=Math.max(0,i-a),h=Math.min(n-a,l);r.push(o.slice(c,h-c))}return 0===r.length&&r.push(e[0].slice(0,0)),r}function binarySearch(e,t,i,n){let r=0,s=0,o=t.length-1;do{if(r>=o-1)return i<t[o]?n(e,r,i-t[r]):null;s=r+Math.trunc(.5*(o-r)),i<t[s]?o=s:r=s}while(r<o)}function isChunkedValid(e,t){return e.getValid(t)}function wrapChunkedCall1(e){function t(t,i,n){return e(t[i],n)}return function(e){return binarySearch(this.data,this._offsets,e,t)}}function wrapChunkedCall2(e){let t;function i(i,n,r){return e(i[n],r,t)}return function(e,n){const r=this.data;t=n;const s=binarySearch(r,this._offsets,e,i);return t=void 0,s}}function wrapChunkedIndexOf(e){let t;function i(i,n,r){let s=r,o=0,a=0;for(let l=n-1,c=i.length;++l<c;){const n=i[l];if(~(o=e(n,t,s)))return a+o;s=0,a+=n.length}return-1}return function(e,n){t=e;const r=this.data,s="number"!=typeof n?i(r,0,0):binarySearch(r,this._offsets,n,i);return t=void 0,s}}class IndexOfVisitor extends Visitor{}function nullIndexOf(e,t){return null===t&&e.length>0?0:-1}function indexOfNull(e,t){const{nullBitmap:i}=e;if(!i||e.nullCount<=0)return-1;let n=0;for(const r of new BitIterator(i,e.offset+(t||0),e.length,i,getBool)){if(!r)return n;++n}return-1}function indexOfValue(e,t,i){if(void 0===t)return-1;if(null===t)switch(e.typeId){case Type.Union:case Type.Dictionary:break;default:return indexOfNull(e,i)}const n=instance$4.getVisitFn(e),r=createElementComparator(t);for(let s=(i||0)-1,o=e.length;++s<o;)if(r(n(e,s)))return s;return-1}function indexOfUnion(e,t,i){const n=instance$4.getVisitFn(e),r=createElementComparator(t);for(let s=(i||0)-1,o=e.length;++s<o;)if(r(n(e,s)))return s;return-1}IndexOfVisitor.prototype.visitNull=nullIndexOf,IndexOfVisitor.prototype.visitBool=indexOfValue,IndexOfVisitor.prototype.visitInt=indexOfValue,IndexOfVisitor.prototype.visitInt8=indexOfValue,IndexOfVisitor.prototype.visitInt16=indexOfValue,IndexOfVisitor.prototype.visitInt32=indexOfValue,IndexOfVisitor.prototype.visitInt64=indexOfValue,IndexOfVisitor.prototype.visitUint8=indexOfValue,IndexOfVisitor.prototype.visitUint16=indexOfValue,IndexOfVisitor.prototype.visitUint32=indexOfValue,IndexOfVisitor.prototype.visitUint64=indexOfValue,IndexOfVisitor.prototype.visitFloat=indexOfValue,IndexOfVisitor.prototype.visitFloat16=indexOfValue,IndexOfVisitor.prototype.visitFloat32=indexOfValue,IndexOfVisitor.prototype.visitFloat64=indexOfValue,IndexOfVisitor.prototype.visitUtf8=indexOfValue,IndexOfVisitor.prototype.visitLargeUtf8=indexOfValue,IndexOfVisitor.prototype.visitBinary=indexOfValue,IndexOfVisitor.prototype.visitLargeBinary=indexOfValue,IndexOfVisitor.prototype.visitFixedSizeBinary=indexOfValue,IndexOfVisitor.prototype.visitDate=indexOfValue,IndexOfVisitor.prototype.visitDateDay=indexOfValue,IndexOfVisitor.prototype.visitDateMillisecond=indexOfValue,IndexOfVisitor.prototype.visitTimestamp=indexOfValue,IndexOfVisitor.prototype.visitTimestampSecond=indexOfValue,IndexOfVisitor.prototype.visitTimestampMillisecond=indexOfValue,IndexOfVisitor.prototype.visitTimestampMicrosecond=indexOfValue,IndexOfVisitor.prototype.visitTimestampNanosecond=indexOfValue,IndexOfVisitor.prototype.visitTime=indexOfValue,IndexOfVisitor.prototype.visitTimeSecond=indexOfValue,IndexOfVisitor.prototype.visitTimeMillisecond=indexOfValue,IndexOfVisitor.prototype.visitTimeMicrosecond=indexOfValue,IndexOfVisitor.prototype.visitTimeNanosecond=indexOfValue,IndexOfVisitor.prototype.visitDecimal=indexOfValue,IndexOfVisitor.prototype.visitList=indexOfValue,IndexOfVisitor.prototype.visitStruct=indexOfValue,IndexOfVisitor.prototype.visitUnion=indexOfValue,IndexOfVisitor.prototype.visitDenseUnion=indexOfUnion,IndexOfVisitor.prototype.visitSparseUnion=indexOfUnion,IndexOfVisitor.prototype.visitDictionary=indexOfValue,IndexOfVisitor.prototype.visitInterval=indexOfValue,IndexOfVisitor.prototype.visitIntervalDayTime=indexOfValue,IndexOfVisitor.prototype.visitIntervalYearMonth=indexOfValue,IndexOfVisitor.prototype.visitDuration=indexOfValue,IndexOfVisitor.prototype.visitDurationSecond=indexOfValue,IndexOfVisitor.prototype.visitDurationMillisecond=indexOfValue,IndexOfVisitor.prototype.visitDurationMicrosecond=indexOfValue,IndexOfVisitor.prototype.visitDurationNanosecond=indexOfValue,IndexOfVisitor.prototype.visitFixedSizeList=indexOfValue,IndexOfVisitor.prototype.visitMap=indexOfValue;const instance$3=new IndexOfVisitor;class IteratorVisitor extends Visitor{}function vectorIterator(e){const{type:t}=e;if(0===e.nullCount&&1===e.stride&&(DataType.isInt(t)&&64!==t.bitWidth||DataType.isTime(t)&&64!==t.bitWidth||DataType.isFloat(t)&&t.precision!==Precision.HALF))return new ChunkedIterator(e.data.length,t=>{const i=e.data[t];return i.values.subarray(0,i.length)[Symbol.iterator]()});let i=0;return new ChunkedIterator(e.data.length,t=>{const n=e.data[t].length,r=e.slice(i,i+n);return i+=n,new VectorIterator(r)})}class VectorIterator{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}IteratorVisitor.prototype.visitNull=vectorIterator,IteratorVisitor.prototype.visitBool=vectorIterator,IteratorVisitor.prototype.visitInt=vectorIterator,IteratorVisitor.prototype.visitInt8=vectorIterator,IteratorVisitor.prototype.visitInt16=vectorIterator,IteratorVisitor.prototype.visitInt32=vectorIterator,IteratorVisitor.prototype.visitInt64=vectorIterator,IteratorVisitor.prototype.visitUint8=vectorIterator,IteratorVisitor.prototype.visitUint16=vectorIterator,IteratorVisitor.prototype.visitUint32=vectorIterator,IteratorVisitor.prototype.visitUint64=vectorIterator,IteratorVisitor.prototype.visitFloat=vectorIterator,IteratorVisitor.prototype.visitFloat16=vectorIterator,IteratorVisitor.prototype.visitFloat32=vectorIterator,IteratorVisitor.prototype.visitFloat64=vectorIterator,IteratorVisitor.prototype.visitUtf8=vectorIterator,IteratorVisitor.prototype.visitLargeUtf8=vectorIterator,IteratorVisitor.prototype.visitBinary=vectorIterator,IteratorVisitor.prototype.visitLargeBinary=vectorIterator,IteratorVisitor.prototype.visitFixedSizeBinary=vectorIterator,IteratorVisitor.prototype.visitDate=vectorIterator,IteratorVisitor.prototype.visitDateDay=vectorIterator,IteratorVisitor.prototype.visitDateMillisecond=vectorIterator,IteratorVisitor.prototype.visitTimestamp=vectorIterator,IteratorVisitor.prototype.visitTimestampSecond=vectorIterator,IteratorVisitor.prototype.visitTimestampMillisecond=vectorIterator,IteratorVisitor.prototype.visitTimestampMicrosecond=vectorIterator,IteratorVisitor.prototype.visitTimestampNanosecond=vectorIterator,IteratorVisitor.prototype.visitTime=vectorIterator,IteratorVisitor.prototype.visitTimeSecond=vectorIterator,IteratorVisitor.prototype.visitTimeMillisecond=vectorIterator,IteratorVisitor.prototype.visitTimeMicrosecond=vectorIterator,IteratorVisitor.prototype.visitTimeNanosecond=vectorIterator,IteratorVisitor.prototype.visitDecimal=vectorIterator,IteratorVisitor.prototype.visitList=vectorIterator,IteratorVisitor.prototype.visitStruct=vectorIterator,IteratorVisitor.prototype.visitUnion=vectorIterator,IteratorVisitor.prototype.visitDenseUnion=vectorIterator,IteratorVisitor.prototype.visitSparseUnion=vectorIterator,IteratorVisitor.prototype.visitDictionary=vectorIterator,IteratorVisitor.prototype.visitInterval=vectorIterator,IteratorVisitor.prototype.visitIntervalDayTime=vectorIterator,IteratorVisitor.prototype.visitIntervalYearMonth=vectorIterator,IteratorVisitor.prototype.visitDuration=vectorIterator,IteratorVisitor.prototype.visitDurationSecond=vectorIterator,IteratorVisitor.prototype.visitDurationMillisecond=vectorIterator,IteratorVisitor.prototype.visitDurationMicrosecond=vectorIterator,IteratorVisitor.prototype.visitDurationNanosecond=vectorIterator,IteratorVisitor.prototype.visitFixedSizeList=vectorIterator,IteratorVisitor.prototype.visitMap=vectorIterator;const instance$2=new IteratorVisitor;var _a$3;const visitorsByTypeId={},vectorPrototypesByTypeId={};class Vector{constructor(e){var t,i,n;const r=e[0]instanceof Vector?e.flatMap(e=>e.data):e;if(0===r.length||r.some(e=>!(e instanceof Data)))throw new TypeError("Vector constructor expects an Array of Data instances.");const s=null===(t=r[0])||void 0===t?void 0:t.type;switch(r.length){case 0:this._offsets=[0];break;case 1:{const{get:e,set:t,indexOf:i}=visitorsByTypeId[s.typeId],n=r[0];this.isValid=e=>isChunkedValid(n,e),this.get=t=>e(n,t),this.set=(e,i)=>t(n,e,i),this.indexOf=e=>i(n,e),this._offsets=[0,n.length];break}default:Object.setPrototypeOf(this,vectorPrototypesByTypeId[s.typeId]),this._offsets=computeChunkOffsets(r)}this.data=r,this.type=s,this.stride=strideForType(s),this.numChildren=null!==(n=null===(i=s.children)||void 0===i?void 0:i.length)&&void 0!==n?n:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,t)=>e+t.byteLength,0)}get nullable(){return computeChunkNullable(this.data)}get nullCount(){return computeChunkNullCounts(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${Type[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}at(e){return this.get(wrapIndex(e,this.length))}set(e,t){}indexOf(e,t){return-1}includes(e,t){return this.indexOf(e,t)>-1}[Symbol.iterator](){return instance$2.visit(this)}concat(...e){return new Vector(this.data.concat(e.flatMap(e=>e.data).flat(Number.POSITIVE_INFINITY)))}slice(e,t){return new Vector(clampRange(this,e,t,({data:e,_offsets:t},i,n)=>sliceChunks(e,t,i,n)))}toJSON(){return[...this]}toArray(){const{type:e,data:t,length:i,stride:n,ArrayType:r}=this;switch(e.typeId){case Type.Int:case Type.Float:case Type.Decimal:case Type.Time:case Type.Timestamp:switch(t.length){case 0:return new r;case 1:return t[0].values.subarray(0,i*n);default:return t.reduce((e,{values:t,length:i})=>(e.array.set(t.subarray(0,i*n),e.offset),e.offset+=i*n,e),{array:new r(i*n),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var t;return this.getChildAt(null===(t=this.type.children)||void 0===t?void 0:t.findIndex(t=>t.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new Vector(this.data.map(({children:t})=>t[e])):null}get isMemoized(){return!!DataType.isDictionary(this.type)&&this.data[0].dictionary.isMemoized}memoize(){if(DataType.isDictionary(this.type)){const e=new MemoizedVector(this.data[0].dictionary),t=this.data.map(t=>{const i=t.clone();return i.dictionary=e,i});return new Vector(t)}return new MemoizedVector(this)}unmemoize(){if(DataType.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),t=this.data.map(t=>{const i=t.clone();return i.dictionary=e,i});return new Vector(t)}return this}}_a$3=Symbol.toStringTag,Vector[_a$3]=(e=>{e.type=DataType.prototype,e.data=[],e.length=0,e.stride=1,e.numChildren=0,e._offsets=new Uint32Array([0]),e[Symbol.isConcatSpreadable]=!0;const t=Object.keys(Type).map(e=>Type[e]).filter(e=>"number"==typeof e&&e!==Type.NONE);for(const i of t){const t=instance$4.getVisitFnByTypeId(i),n=instance$5.getVisitFnByTypeId(i),r=instance$3.getVisitFnByTypeId(i);visitorsByTypeId[i]={get:t,set:n,indexOf:r},vectorPrototypesByTypeId[i]=Object.create(e,{isValid:{value:wrapChunkedCall1(isChunkedValid)},get:{value:wrapChunkedCall1(instance$4.getVisitFnByTypeId(i))},set:{value:wrapChunkedCall2(instance$5.getVisitFnByTypeId(i))},indexOf:{value:wrapChunkedIndexOf(instance$3.getVisitFnByTypeId(i))}})}return"Vector"})(Vector.prototype);class MemoizedVector extends Vector{constructor(e){super(e.data);const t=this.get,i=this.set,n=this.slice,r=new Array(this.length);Object.defineProperty(this,"get",{value(e){const i=r[e];if(void 0!==i)return i;const n=t.call(this,e);return r[e]=n,n}}),Object.defineProperty(this,"set",{value(e,t){i.call(this,e,t),r[e]=t}}),Object.defineProperty(this,"slice",{value:(e,t)=>new MemoizedVector(n.call(this,e,t))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Vector(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class Block{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,t,i,n){return e.prep(8,24),e.writeInt64(BigInt(null!=n?n:0)),e.pad(4),e.writeInt32(i),e.writeInt64(BigInt(null!=t?t:0)),e.offset()}}class Footer{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFooter(e,t){return(t||new Footer).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,t){return e.setPosition(e.position()+SIZE_PREFIX_LENGTH),(t||new Footer).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):MetadataVersion.V1}schema(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new Schema$1).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}dictionaries(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new Block).__init(this.bb.__vector(this.bb_pos+i)+24*e,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,t){const i=this.bb.__offset(this.bb_pos,10);return i?(t||new Block).__init(this.bb.__vector(this.bb_pos+i)+24*e,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,12);return i?(t||new KeyValue).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*e),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,MetadataVersion.V1)}static addSchema(e,t){e.addFieldOffset(1,t,0)}static addDictionaries(e,t){e.addFieldOffset(2,t,0)}static startDictionariesVector(e,t){e.startVector(24,t,8)}static addRecordBatches(e,t){e.addFieldOffset(3,t,0)}static startRecordBatchesVector(e,t){e.startVector(24,t,8)}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,t){e.finish(t)}static finishSizePrefixedFooterBuffer(e,t){e.finish(t,void 0,!0)}}class Schema{constructor(e=[],t,i,n=MetadataVersion.V5){this.fields=e||[],this.metadata=t||new Map,i||(i=generateDictionaryMap(this.fields)),this.dictionaries=i,this.metadataVersion=n}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,t)=>`${t}: ${e}`).join(", ")} }>`}select(e){const t=new Set(e),i=this.fields.filter(e=>t.has(e.name));return new Schema(i,this.metadata)}selectAt(e){const t=e.map(e=>this.fields[e]).filter(Boolean);return new Schema(t,this.metadata)}assign(...e){const t=e[0]instanceof Schema?e[0]:Array.isArray(e[0])?new Schema(e[0]):new Schema(e),i=[...this.fields],n=mergeMaps(mergeMaps(new Map,this.metadata),t.metadata),r=t.fields.filter(e=>{const t=i.findIndex(t=>t.name===e.name);return!~t||(i[t]=e.clone({metadata:mergeMaps(mergeMaps(new Map,i[t].metadata),e.metadata)}))&&!1}),s=generateDictionaryMap(r,new Map);return new Schema([...i,...r],n,new Map([...this.dictionaries,...s]))}}Schema.prototype.fields=null,Schema.prototype.metadata=null,Schema.prototype.dictionaries=null;class Field{static new(...e){let[t,i,n,r]=e;return e[0]&&"object"==typeof e[0]&&(({name:t}=e[0]),void 0===i&&(i=e[0].type),void 0===n&&(n=e[0].nullable),void 0===r&&(r=e[0].metadata)),new Field(`${t}`,i,n,r)}constructor(e,t,i=!1,n){this.name=e,this.type=t,this.nullable=i,this.metadata=n||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[t,i,n,r]=e;return e[0]&&"object"==typeof e[0]?({name:t=this.name,type:i=this.type,nullable:n=this.nullable,metadata:r=this.metadata}=e[0]):[t=this.name,i=this.type,n=this.nullable,r=this.metadata]=e,Field.new(t,i,n,r)}}function mergeMaps(e,t){return new Map([...e||new Map,...t||new Map])}function generateDictionaryMap(e,t=new Map){for(let i=-1,n=e.length;++i<n;){const n=e[i].type;if(DataType.isDictionary(n))if(t.has(n.id)){if(t.get(n.id)!==n.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else t.set(n.id,n.dictionary);n.children&&n.children.length>0&&generateDictionaryMap(n.children,t)}return t}Field.prototype.type=null,Field.prototype.name=null,Field.prototype.nullable=null,Field.prototype.metadata=null;var Builder$1=Builder$2,ByteBuffer$1=ByteBuffer$2;class Footer_{static decode(e){e=new ByteBuffer$1(toUint8Array(e));const t=Footer.getRootAsFooter(e),i=Schema.decode(t.schema(),new Map,t.version());return new OffHeapFooter(i,t)}static encode(e){const t=new Builder$1,i=Schema.encode(t,e.schema);Footer.startRecordBatchesVector(t,e.numRecordBatches);for(const s of[...e.recordBatches()].slice().reverse())FileBlock.encode(t,s);const n=t.endVector();Footer.startDictionariesVector(t,e.numDictionaries);for(const s of[...e.dictionaryBatches()].slice().reverse())FileBlock.encode(t,s);const r=t.endVector();return Footer.startFooter(t),Footer.addSchema(t,i),Footer.addVersion(t,MetadataVersion.V5),Footer.addRecordBatches(t,n),Footer.addDictionaries(t,r),Footer.finishFooterBuffer(t,Footer.endFooter(t)),t.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,t=MetadataVersion.V5,i,n){this.schema=e,this.version=t,i&&(this._recordBatches=i),n&&(this._dictionaryBatches=n)}*recordBatches(){for(let e,t=-1,i=this.numRecordBatches;++t<i;)(e=this.getRecordBatch(t))&&(yield e)}*dictionaryBatches(){for(let e,t=-1,i=this.numDictionaries;++t<i;)(e=this.getDictionaryBatch(t))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}}class OffHeapFooter extends Footer_{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,t){super(e,t.version()),this._footer=t}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const t=this._footer.recordBatches(e);if(t)return FileBlock.decode(t)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const t=this._footer.dictionaries(e);if(t)return FileBlock.decode(t)}return null}}class FileBlock{static decode(e){return new FileBlock(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,t){const{metaDataLength:i}=t,n=BigInt(t.offset),r=BigInt(t.bodyLength);return Block.createBlock(e,n,i,r)}constructor(e,t,i){this.metaDataLength=e,this.offset=bigIntToNumber(i),this.bodyLength=bigIntToNumber(t)}}const ITERATOR_DONE=Object.freeze({done:!0,value:void 0});class ArrowJSON{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class ReadableInterop{tee(){return this._getDOMStream().tee()}pipe(e,t){return this._getNodeStream().pipe(e,t)}pipeTo(e,t){return this._getDOMStream().pipeTo(e,t)}pipeThrough(e,t){return this._getDOMStream().pipeThrough(e,t)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class AsyncQueue extends ReadableInterop{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return __awaiter(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(ITERATOR_DONE);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return streamAdapters.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return streamAdapters.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return __awaiter(this,void 0,void 0,function*(){return yield this.abort(e),ITERATOR_DONE})}return(e){return __awaiter(this,void 0,void 0,function*(){return yield this.close(),ITERATOR_DONE})}read(e){return __awaiter(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return __awaiter(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((e,t)=>{this.resolvers.push({resolve:e,reject:t})}):Promise.resolve(ITERATOR_DONE)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class AsyncByteQueue extends AsyncQueue{write(e){if((e=toUint8Array(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?decodeUtf8(this.toUint8Array(!0)):this.toUint8Array(!1).then(decodeUtf8)}toUint8Array(e=!1){return e?joinUint8Arrays(this._values)[0]:(()=>__awaiter(this,void 0,void 0,function*(){var e,t,i,n;const r=[];let s=0;try{for(var o,a=!0,l=__asyncValues(this);!(e=(o=yield l.next()).done);a=!0){n=o.value,a=!1;const e=n;r.push(e),s+=e.byteLength}}catch(c){t={error:c}}finally{try{a||e||!(i=l.return)||(yield i.call(l))}finally{if(t)throw t.error}}return joinUint8Arrays(r,s)[0]}))()}}class ByteStream{constructor(e){e&&(this.source=new ByteStreamSource(streamAdapters.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class AsyncByteStream{constructor(e){e instanceof AsyncByteStream?this.source=e.source:e instanceof AsyncByteQueue?this.source=new AsyncByteStreamSource(streamAdapters.fromAsyncIterable(e)):isReadableNodeStream(e)?this.source=new AsyncByteStreamSource(streamAdapters.fromNodeStream(e)):isReadableDOMStream(e)?this.source=new AsyncByteStreamSource(streamAdapters.fromDOMStream(e)):isFetchResponse(e)?this.source=new AsyncByteStreamSource(streamAdapters.fromDOMStream(e.body)):isIterable(e)?this.source=new AsyncByteStreamSource(streamAdapters.fromIterable(e)):(isPromise(e)||isAsyncIterable(e))&&(this.source=new AsyncByteStreamSource(streamAdapters.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class ByteStreamSource{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,t="read"){return this.source.next({cmd:t,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||ITERATOR_DONE)}return(e){return Object.create(this.source.return&&this.source.return(e)||ITERATOR_DONE)}}class AsyncByteStreamSource{constructor(e){this.source=e,this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}cancel(e){return __awaiter(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return __awaiter(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return __awaiter(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e){return __awaiter(this,arguments,void 0,function*(e,t="read"){return yield this.source.next({cmd:t,size:e})})}throw(e){return __awaiter(this,void 0,void 0,function*(){const t=this.source.throw&&(yield this.source.throw(e))||ITERATOR_DONE;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}return(e){return __awaiter(this,void 0,void 0,function*(){const t=this.source.return&&(yield this.source.return(e))||ITERATOR_DONE;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}}class RandomAccessFile extends ByteStream{constructor(e,t){super(),this.position=0,this.buffer=toUint8Array(e),this.size=void 0===t?this.buffer.byteLength:t}readInt32(e){const{buffer:t,byteOffset:i}=this.readAt(e,4);return new DataView(t,i).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:t,size:i,position:n}=this;return t&&n<i?("number"!=typeof e&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(i,n+Math.min(i-n,e)),t.subarray(n,this.position)):null}readAt(e,t){const i=this.buffer,n=Math.min(this.size,e+t);return i?i.subarray(e,n):new Uint8Array(t)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}}class AsyncRandomAccessFile extends AsyncByteStream{constructor(e,t){super(),this.position=0,this._handle=e,"number"==typeof t?this.size=t:this._pending=(()=>__awaiter(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending}))()}readInt32(e){return __awaiter(this,void 0,void 0,function*(){const{buffer:t,byteOffset:i}=yield this.readAt(e,4);return new DataView(t,i).getInt32(0,!0)})}seek(e){return __awaiter(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return __awaiter(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:t,size:i,position:n}=this;if(t&&n<i){"number"!=typeof e&&(e=Number.POSITIVE_INFINITY);let r=n,s=0,o=0;const a=Math.min(i,r+Math.min(i-r,e)),l=new Uint8Array(Math.max(0,(this.position=a)-r));for(;(r+=o)<a&&(s+=o)<l.byteLength;)({bytesRead:o}=yield t.read(l,s,l.byteLength-s,r));return l}return null})}readAt(e,t){return __awaiter(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:i,size:n}=this;if(i&&e+t<n){const r=Math.min(n,e+t),s=new Uint8Array(r-e);return(yield i.read(s,0,t,e)).buffer}return new Uint8Array(t)})}close(){return __awaiter(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return __awaiter(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return __awaiter(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}}const carryBit16=65536;function intAsHex(e){return e<0&&(e=4294967295+e+1),`0x${e.toString(16)}`}const kInt32DecimalDigits=8,kPowersOfTen=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class BaseInt64{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const t=new Uint32Array([this.buffer[1]>>>16,65535&this.buffer[1],this.buffer[0]>>>16,65535&this.buffer[0]]),i=new Uint32Array([e.buffer[1]>>>16,65535&e.buffer[1],e.buffer[0]>>>16,65535&e.buffer[0]]);let n=t[3]*i[3];this.buffer[0]=65535&n;let r=n>>>16;return n=t[2]*i[3],r+=n,n=t[3]*i[2]>>>0,r+=n,this.buffer[0]+=r<<16,this.buffer[1]=r>>>0<n?carryBit16:0,this.buffer[1]+=r>>>16,this.buffer[1]+=t[1]*i[3]+t[2]*i[2]+t[3]*i[1],this.buffer[1]+=t[0]*i[3]+t[1]*i[2]+t[2]*i[1]+t[3]*i[0]<<16,this}_plus(e){const t=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],t<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=t}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${intAsHex(this.buffer[1])} ${intAsHex(this.buffer[0])}`}}class Uint64 extends BaseInt64{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,t=new Uint32Array(2)){return Uint64.fromString("string"==typeof e?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return Uint64.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const i=e.length,n=new Uint64(t);for(let r=0;r<i;){const t=kInt32DecimalDigits<i-r?kInt32DecimalDigits:i-r,s=new Uint64(new Uint32Array([Number.parseInt(e.slice(r,r+t),10),0])),o=new Uint64(new Uint32Array([kPowersOfTen[t],0]));n.times(o),n.plus(s),r+=t}return n}static convertArray(e){const t=new Uint32Array(2*e.length);for(let i=-1,n=e.length;++i<n;)Uint64.from(e[i],new Uint32Array(t.buffer,t.byteOffset+2*i*4,2));return t}static multiply(e,t){return new Uint64(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new Uint64(new Uint32Array(e.buffer)).plus(t)}}class Int64 extends BaseInt64{negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],0==this.buffer[0]&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const t=this.buffer[1]|0,i=e.buffer[1]|0;return t<i||t===i&&this.buffer[0]<e.buffer[0]}static from(e,t=new Uint32Array(2)){return Int64.fromString("string"==typeof e?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return Int64.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const i=e.startsWith("-"),n=e.length,r=new Int64(t);for(let s=i?1:0;s<n;){const t=kInt32DecimalDigits<n-s?kInt32DecimalDigits:n-s,i=new Int64(new Uint32Array([Number.parseInt(e.slice(s,s+t),10),0])),o=new Int64(new Uint32Array([kPowersOfTen[t],0]));r.times(o),r.plus(i),s+=t}return i?r.negate():r}static convertArray(e){const t=new Uint32Array(2*e.length);for(let i=-1,n=e.length;++i<n;)Int64.from(e[i],new Uint32Array(t.buffer,t.byteOffset+2*i*4,2));return t}static multiply(e,t){return new Int64(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new Int64(new Uint32Array(e.buffer)).plus(t)}}class Int128{constructor(e){this.buffer=e}high(){return new Int64(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new Int64(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],0==this.buffer[0]&&++this.buffer[1],0==this.buffer[1]&&++this.buffer[2],0==this.buffer[2]&&++this.buffer[3],this}times(e){const t=new Uint64(new Uint32Array([this.buffer[3],0])),i=new Uint64(new Uint32Array([this.buffer[2],0])),n=new Uint64(new Uint32Array([this.buffer[1],0])),r=new Uint64(new Uint32Array([this.buffer[0],0])),s=new Uint64(new Uint32Array([e.buffer[3],0])),o=new Uint64(new Uint32Array([e.buffer[2],0])),a=new Uint64(new Uint32Array([e.buffer[1],0])),l=new Uint64(new Uint32Array([e.buffer[0],0]));let c=Uint64.multiply(r,l);this.buffer[0]=c.low();const h=new Uint64(new Uint32Array([c.high(),0]));c=Uint64.multiply(n,l),h.plus(c),c=Uint64.multiply(r,a),h.plus(c),this.buffer[1]=h.low(),this.buffer[3]=h.lessThan(c)?1:0,this.buffer[2]=h.high();return new Uint64(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(Uint64.multiply(i,l)).plus(Uint64.multiply(n,a)).plus(Uint64.multiply(r,o)),this.buffer[3]+=Uint64.multiply(t,l).plus(Uint64.multiply(i,a)).plus(Uint64.multiply(n,o)).plus(Uint64.multiply(r,s)).low(),this}plus(e){const t=new Uint32Array(4);return t[3]=this.buffer[3]+e.buffer[3]>>>0,t[2]=this.buffer[2]+e.buffer[2]>>>0,t[1]=this.buffer[1]+e.buffer[1]>>>0,t[0]=this.buffer[0]+e.buffer[0]>>>0,t[0]<this.buffer[0]>>>0&&++t[1],t[1]<this.buffer[1]>>>0&&++t[2],t[2]<this.buffer[2]>>>0&&++t[3],this.buffer[3]=t[3],this.buffer[2]=t[2],this.buffer[1]=t[1],this.buffer[0]=t[0],this}hex(){return`${intAsHex(this.buffer[3])} ${intAsHex(this.buffer[2])} ${intAsHex(this.buffer[1])} ${intAsHex(this.buffer[0])}`}static multiply(e,t){return new Int128(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new Int128(new Uint32Array(e.buffer)).plus(t)}static from(e,t=new Uint32Array(4)){return Int128.fromString("string"==typeof e?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(4)){return Int128.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(4)){const i=e.startsWith("-"),n=e.length,r=new Int128(t);for(let s=i?1:0;s<n;){const t=kInt32DecimalDigits<n-s?kInt32DecimalDigits:n-s,i=new Int128(new Uint32Array([Number.parseInt(e.slice(s,s+t),10),0,0,0])),o=new Int128(new Uint32Array([kPowersOfTen[t],0,0,0]));r.times(o),r.plus(i),s+=t}return i?r.negate():r}static convertArray(e){const t=new Uint32Array(4*e.length);for(let i=-1,n=e.length;++i<n;)Int128.from(e[i],new Uint32Array(t.buffer,t.byteOffset+16*i,4));return t}}class VectorLoader extends Visitor{constructor(e,t,i,n,r=MetadataVersion.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=t,this.buffers=i,this.dictionaries=n,this.metadataVersion=r}visit(e){return super.visit(e instanceof Field?e.type:e)}visitNull(e,{length:t}=this.nextFieldNode()){return makeData({type:e,length:t})}visitBool(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitInt(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFloat(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitUtf8(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeUtf8(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeBinary(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDate(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTimestamp(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTime(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDecimal(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitList(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),children:this.visitMany(e.children)})}visitUnion(e,{length:t,nullCount:i}=this.nextFieldNode()){return this.metadataVersion<MetadataVersion.V5&&this.readNullBitmap(e,i),e.mode===UnionMode.Sparse?this.visitSparseUnion(e,{length:t,nullCount:i}):this.visitDenseUnion(e,{length:t,nullCount:i})}visitDenseUnion(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDuration(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFixedSizeList(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),child:this.visit(e.children[0])})}visitMap(e,{length:t,nullCount:i}=this.nextFieldNode()){return makeData({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,t,i=this.nextBufferRange()){return t>0&&this.readData(e,i)||new Uint8Array(0)}readOffsets(e,t){return this.readData(e,t)}readTypeIds(e,t){return this.readData(e,t)}readData(e,{length:t,offset:i}=this.nextBufferRange()){return this.bytes.subarray(i,i+t)}readDictionary(e){return this.dictionaries.get(e.id)}}class JSONVectorLoader extends VectorLoader{constructor(e,t,i,n,r){super(new Uint8Array(0),t,i,n,r),this.sources=e}readNullBitmap(e,t,{offset:i}=this.nextBufferRange()){return t<=0?new Uint8Array(0):packBools(this.sources[i])}readOffsets(e,{offset:t}=this.nextBufferRange()){return toArrayBufferView(Uint8Array,toArrayBufferView(e.OffsetArrayType,this.sources[t]))}readTypeIds(e,{offset:t}=this.nextBufferRange()){return toArrayBufferView(Uint8Array,toArrayBufferView(e.ArrayType,this.sources[t]))}readData(e,{offset:t}=this.nextBufferRange()){const{sources:i}=this;return DataType.isTimestamp(e)||(DataType.isInt(e)||DataType.isTime(e))&&64===e.bitWidth||DataType.isDuration(e)||DataType.isDate(e)&&e.unit===DateUnit.MILLISECOND?toArrayBufferView(Uint8Array,Int64.convertArray(i[t])):DataType.isDecimal(e)?toArrayBufferView(Uint8Array,Int128.convertArray(i[t])):DataType.isBinary(e)||DataType.isLargeBinary(e)||DataType.isFixedSizeBinary(e)?binaryDataFromJSON(i[t]):DataType.isBool(e)?packBools(i[t]):DataType.isUtf8(e)||DataType.isLargeUtf8(e)?encodeUtf8(i[t].join("")):toArrayBufferView(Uint8Array,toArrayBufferView(e.ArrayType,i[t].map(e=>+e)))}}function binaryDataFromJSON(e){const t=e.join(""),i=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2)i[n>>1]=Number.parseInt(t.slice(n,n+2),16);return i}class TypeComparator extends Visitor{compareSchemas(e,t){return e===t||t instanceof e.constructor&&this.compareManyFields(e.fields,t.fields)}compareManyFields(e,t){return e===t||Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((e,i)=>this.compareFields(e,t[i]))}compareFields(e,t){return e===t||t instanceof e.constructor&&e.name===t.name&&e.nullable===t.nullable&&this.visit(e.type,t.type)}}function compareConstructor(e,t){return t instanceof e.constructor}function compareAny(e,t){return e===t||compareConstructor(e,t)}function compareInt(e,t){return e===t||compareConstructor(e,t)&&e.bitWidth===t.bitWidth&&e.isSigned===t.isSigned}function compareFloat(e,t){return e===t||compareConstructor(e,t)&&e.precision===t.precision}function compareFixedSizeBinary(e,t){return e===t||compareConstructor(e,t)&&e.byteWidth===t.byteWidth}function compareDate(e,t){return e===t||compareConstructor(e,t)&&e.unit===t.unit}function compareTimestamp(e,t){return e===t||compareConstructor(e,t)&&e.unit===t.unit&&e.timezone===t.timezone}function compareTime(e,t){return e===t||compareConstructor(e,t)&&e.unit===t.unit&&e.bitWidth===t.bitWidth}function compareList(e,t){return e===t||compareConstructor(e,t)&&e.children.length===t.children.length&&instance$1.compareManyFields(e.children,t.children)}function compareStruct(e,t){return e===t||compareConstructor(e,t)&&e.children.length===t.children.length&&instance$1.compareManyFields(e.children,t.children)}function compareUnion(e,t){return e===t||compareConstructor(e,t)&&e.mode===t.mode&&e.typeIds.every((e,i)=>e===t.typeIds[i])&&instance$1.compareManyFields(e.children,t.children)}function compareDictionary(e,t){return e===t||compareConstructor(e,t)&&e.id===t.id&&e.isOrdered===t.isOrdered&&instance$1.visit(e.indices,t.indices)&&instance$1.visit(e.dictionary,t.dictionary)}function compareInterval(e,t){return e===t||compareConstructor(e,t)&&e.unit===t.unit}function compareDuration(e,t){return e===t||compareConstructor(e,t)&&e.unit===t.unit}function compareFixedSizeList(e,t){return e===t||compareConstructor(e,t)&&e.listSize===t.listSize&&e.children.length===t.children.length&&instance$1.compareManyFields(e.children,t.children)}function compareMap(e,t){return e===t||compareConstructor(e,t)&&e.keysSorted===t.keysSorted&&e.children.length===t.children.length&&instance$1.compareManyFields(e.children,t.children)}TypeComparator.prototype.visitNull=compareAny,TypeComparator.prototype.visitBool=compareAny,TypeComparator.prototype.visitInt=compareInt,TypeComparator.prototype.visitInt8=compareInt,TypeComparator.prototype.visitInt16=compareInt,TypeComparator.prototype.visitInt32=compareInt,TypeComparator.prototype.visitInt64=compareInt,TypeComparator.prototype.visitUint8=compareInt,TypeComparator.prototype.visitUint16=compareInt,TypeComparator.prototype.visitUint32=compareInt,TypeComparator.prototype.visitUint64=compareInt,TypeComparator.prototype.visitFloat=compareFloat,TypeComparator.prototype.visitFloat16=compareFloat,TypeComparator.prototype.visitFloat32=compareFloat,TypeComparator.prototype.visitFloat64=compareFloat,TypeComparator.prototype.visitUtf8=compareAny,TypeComparator.prototype.visitLargeUtf8=compareAny,TypeComparator.prototype.visitBinary=compareAny,TypeComparator.prototype.visitLargeBinary=compareAny,TypeComparator.prototype.visitFixedSizeBinary=compareFixedSizeBinary,TypeComparator.prototype.visitDate=compareDate,TypeComparator.prototype.visitDateDay=compareDate,TypeComparator.prototype.visitDateMillisecond=compareDate,TypeComparator.prototype.visitTimestamp=compareTimestamp,TypeComparator.prototype.visitTimestampSecond=compareTimestamp,TypeComparator.prototype.visitTimestampMillisecond=compareTimestamp,TypeComparator.prototype.visitTimestampMicrosecond=compareTimestamp,TypeComparator.prototype.visitTimestampNanosecond=compareTimestamp,TypeComparator.prototype.visitTime=compareTime,TypeComparator.prototype.visitTimeSecond=compareTime,TypeComparator.prototype.visitTimeMillisecond=compareTime,TypeComparator.prototype.visitTimeMicrosecond=compareTime,TypeComparator.prototype.visitTimeNanosecond=compareTime,TypeComparator.prototype.visitDecimal=compareAny,TypeComparator.prototype.visitList=compareList,TypeComparator.prototype.visitStruct=compareStruct,TypeComparator.prototype.visitUnion=compareUnion,TypeComparator.prototype.visitDenseUnion=compareUnion,TypeComparator.prototype.visitSparseUnion=compareUnion,TypeComparator.prototype.visitDictionary=compareDictionary,TypeComparator.prototype.visitInterval=compareInterval,TypeComparator.prototype.visitIntervalDayTime=compareInterval,TypeComparator.prototype.visitIntervalYearMonth=compareInterval,TypeComparator.prototype.visitDuration=compareDuration,TypeComparator.prototype.visitDurationSecond=compareDuration,TypeComparator.prototype.visitDurationMillisecond=compareDuration,TypeComparator.prototype.visitDurationMicrosecond=compareDuration,TypeComparator.prototype.visitDurationNanosecond=compareDuration,TypeComparator.prototype.visitFixedSizeList=compareFixedSizeList,TypeComparator.prototype.visitMap=compareMap;const instance$1=new TypeComparator;function compareSchemas(e,t){return instance$1.compareSchemas(e,t)}function distributeVectorsIntoRecordBatches(e,t){return uniformlyDistributeChunksAcrossRecordBatches(e,t.map(e=>e.data.concat()))}function uniformlyDistributeChunksAcrossRecordBatches(e,t){const i=[...e.fields],n=[],r={numBatches:t.reduce((e,t)=>Math.max(e,t.length),0)};let s=0,o=0,a=-1;const l=t.length;let c,h=[];for(;r.numBatches-- >0;){for(o=Number.POSITIVE_INFINITY,a=-1;++a<l;)h[a]=c=t[a].shift(),o=Math.min(o,c?c.length:o);Number.isFinite(o)&&(h=distributeChildren(i,o,h,t,r),o>0&&(n[s++]=makeData({type:new Struct(i),length:o,nullCount:0,children:h.slice()})))}return[e=e.assign(i),n.map(t=>new RecordBatch$1(e,t))]}function distributeChildren(e,t,i,n,r){var s;const o=(t+63&-64)>>3;for(let a=-1,l=n.length;++a<l;){const l=i[a],c=null==l?void 0:l.length;if(c>=t)c===t?i[a]=l:(i[a]=l.slice(0,t),r.numBatches=Math.max(r.numBatches,n[a].unshift(l.slice(t,c-t))));else{const n=e[a];e[a]=n.clone({nullable:!0}),i[a]=null!==(s=null==l?void 0:l._changeLengthAndBackfillNullBitmap(t))&&void 0!==s?s:makeData({type:n.type,length:t,nullCount:t,nullBitmap:new Uint8Array(o)})}}return i}var _a$2,_a$1;class Table{constructor(...e){var t,i;if(0===e.length)return this.batches=[],this.schema=new Schema([]),this._offsets=[0],this;let n,r;e[0]instanceof Schema&&(n=e.shift()),e.at(-1)instanceof Uint32Array&&(r=e.pop());const s=e=>{if(e){if(e instanceof RecordBatch$1)return[e];if(e instanceof Table)return e.batches;if(e instanceof Data){if(e.type instanceof Struct)return[new RecordBatch$1(new Schema(e.type.children),e)]}else{if(Array.isArray(e))return e.flatMap(e=>s(e));if("function"==typeof e[Symbol.iterator])return[...e].flatMap(e=>s(e));if("object"==typeof e){const t=Object.keys(e),i=t.map(t=>new Vector([e[t]])),r=null!=n?n:new Schema(t.map((e,t)=>new Field(String(e),i[t].type,i[t].nullable))),[,s]=distributeVectorsIntoRecordBatches(r,i);return 0===s.length?[new RecordBatch$1(e)]:s}}}return[]},o=e.flatMap(e=>s(e));if(n=null!==(i=null!=n?n:null===(t=o[0])||void 0===t?void 0:t.schema)&&void 0!==i?i:new Schema([]),!(n instanceof Schema))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const a of o){if(!(a instanceof RecordBatch$1))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!compareSchemas(n,a.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=n,this.batches=o,this._offsets=null!=r?r:computeChunkOffsets(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,t)=>e+t.length,0)}get nullCount(){return-1===this._nullCount&&(this._nullCount=computeChunkNullCounts(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}at(e){return this.get(wrapIndex(e,this.numRows))}set(e,t){}indexOf(e,t){return-1}[Symbol.iterator](){return this.batches.length>0?instance$2.visit(new Vector(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[\n  ${this.toArray().join(",\n  ")}\n]`}concat(...e){const t=this.schema,i=this.data.concat(e.flatMap(({data:e})=>e));return new Table(t,i.map(e=>new RecordBatch$1(t,e)))}slice(e,t){const i=this.schema;[e,t]=clampRange({length:this.numRows},e,t);const n=sliceChunks(this.data,this._offsets,e,t);return new Table(i,n.map(e=>new RecordBatch$1(i,e)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(t=>t.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const t=this.data.map(t=>t.children[e]);if(0===t.length){const{type:i}=this.schema.fields[e],n=makeData({type:i,length:0,nullCount:0});t.push(n._changeLengthAndBackfillNullBitmap(this.numRows))}return new Vector(t)}return null}setChild(e,t){var i;return this.setChildAt(null===(i=this.schema.fields)||void 0===i?void 0:i.findIndex(t=>t.name===e),t)}setChildAt(e,t){let i=this.schema,n=[...this.batches];if(e>-1&&e<this.numCols){t||(t=new Vector([makeData({type:new Null,length:this.numRows})]));const r=i.fields.slice(),s=r[e].clone({type:t.type}),o=this.schema.fields.map((e,t)=>this.getChildAt(t));[r[e],o[e]]=[s,t],[i,n]=distributeVectorsIntoRecordBatches(i,o)}return new Table(i,n)}select(e){const t=this.schema.fields.reduce((e,t,i)=>e.set(t.name,i),new Map);return this.selectAt(e.map(e=>t.get(e)).filter(e=>e>-1))}selectAt(e){const t=this.schema.selectAt(e),i=this.batches.map(t=>t.selectAt(e));return new Table(t,i)}assign(e){const t=this.schema.fields,[i,n]=e.schema.fields.reduce((e,i,n)=>{const[r,s]=e,o=t.findIndex(e=>e.name===i.name);return~o?s[o]=n:r.push(n),e},[[],[]]),r=this.schema.assign(e.schema),s=[...t.map((e,t)=>[t,n[t]]).map(([t,i])=>void 0===i?this.getChildAt(t):e.getChildAt(i)),...i.map(t=>e.getChildAt(t))].filter(Boolean);return new Table(...distributeVectorsIntoRecordBatches(r,s))}}_a$2=Symbol.toStringTag,Table[_a$2]=(e=>(e.schema=null,e.batches=[],e._offsets=new Uint32Array([0]),e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,e.isValid=wrapChunkedCall1(isChunkedValid),e.get=wrapChunkedCall1(instance$4.getVisitFn(Type.Struct)),e.set=wrapChunkedCall2(instance$5.getVisitFn(Type.Struct)),e.indexOf=wrapChunkedIndexOf(instance$3.getVisitFn(Type.Struct)),"Table"))(Table.prototype);let RecordBatch$1=class e{constructor(...e){switch(e.length){case 2:if([this.schema]=e,!(this.schema instanceof Schema))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=makeData({nullCount:0,type:new Struct(this.schema.fields),children:this.schema.fields.map(e=>makeData({type:e.type,nullCount:0}))})]=e,!(this.data instanceof Data))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=ensureSameLengthData(this.schema,this.data.children);break;case 1:{const[t]=e,{fields:i,children:n,length:r}=Object.keys(t).reduce((e,i,n)=>(e.children[n]=t[i],e.length=Math.max(e.length,t[i].length),e.fields[n]=Field.new({name:i,type:t[i].type,nullable:!0}),e),{length:0,fields:new Array,children:new Array}),s=new Schema(i),o=makeData({type:new Struct(i),length:r,children:n,nullCount:0});[this.schema,this.data]=ensureSameLengthData(s,o.children,r);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=collectDictionaries(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return instance$4.visit(this.data,e)}at(e){return this.get(wrapIndex(e,this.numRows))}set(e,t){return instance$5.visit(this.data,e,t)}indexOf(e,t){return instance$3.visit(this.data,e,t)}[Symbol.iterator](){return instance$2.visit(new Vector([this.data]))}toArray(){return[...this]}concat(...e){return new Table(this.schema,[this,...e])}slice(t,i){const[n]=new Vector([this.data]).slice(t,i).data;return new e(this.schema,n)}getChild(e){var t;return this.getChildAt(null===(t=this.schema.fields)||void 0===t?void 0:t.findIndex(t=>t.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new Vector([this.data.children[e]]):null}setChild(e,t){var i;return this.setChildAt(null===(i=this.schema.fields)||void 0===i?void 0:i.findIndex(t=>t.name===e),t)}setChildAt(t,i){let n=this.schema,r=this.data;if(t>-1&&t<this.numCols){i||(i=new Vector([makeData({type:new Null,length:this.numRows})]));const e=n.fields.slice(),s=r.children.slice(),o=e[t].clone({type:i.type});[e[t],s[t]]=[o,i.data[0]],n=new Schema(e,new Map(this.schema.metadata)),r=makeData({type:new Struct(e),children:s})}return new e(n,r)}select(t){const i=this.schema.select(t),n=new Struct(i.fields),r=[];for(const e of t){const t=this.schema.fields.findIndex(t=>t.name===e);~t&&(r[t]=this.data.children[t])}return new e(i,makeData({type:n,length:this.numRows,children:r}))}selectAt(t){const i=this.schema.selectAt(t),n=t.map(e=>this.data.children[e]).filter(Boolean),r=makeData({type:new Struct(i.fields),length:this.numRows,children:n});return new e(i,r)}};function ensureSameLengthData(e,t,i=t.reduce((e,t)=>Math.max(e,t.length),0)){var n;const r=[...e.fields],s=[...t],o=(i+63&-64)>>3;for(const[a,l]of e.fields.entries()){const e=t[a];e&&e.length===i||(r[a]=l.clone({nullable:!0}),s[a]=null!==(n=null==e?void 0:e._changeLengthAndBackfillNullBitmap(i))&&void 0!==n?n:makeData({type:l.type,length:i,nullCount:i,nullBitmap:new Uint8Array(o)}))}return[e.assign(r),makeData({type:new Struct(r),length:i,children:s})]}function collectDictionaries(e,t,i=new Map){var n,r;if((null!==(n=null==e?void 0:e.length)&&void 0!==n?n:0)>0&&(null==e?void 0:e.length)===(null==t?void 0:t.length))for(let s=-1,o=e.length;++s<o;){const{type:n}=e[s],o=t[s];for(const e of[o,...(null===(r=null==o?void 0:o.dictionary)||void 0===r?void 0:r.data)||[]])collectDictionaries(n.children,null==e?void 0:e.children,i);if(DataType.isDictionary(n)){const{id:e}=n;if(i.has(e)){if(i.get(e)!==o.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else(null==o?void 0:o.dictionary)&&i.set(e,o.dictionary)}}return i}_a$1=Symbol.toStringTag,RecordBatch$1[_a$1]=(e=>(e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(RecordBatch$1.prototype);class _InternalEmptyPlaceholderRecordBatch extends RecordBatch$1{constructor(e){const t=e.fields.map(e=>makeData({type:e.type}));super(e,makeData({type:new Struct(e.fields),nullCount:0,children:t}))}}let Message$1=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMessage(t,i){return(i||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,i){return t.setPosition(t.position()+SIZE_PREFIX_LENGTH),(i||new e).__init(t.readInt32(t.position())+t.position(),t)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):MetadataVersion.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):MessageHeader.NONE}header(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__union(e,this.bb_pos+t):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,12);return i?(t||new KeyValue).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*e),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,MetadataVersion.V1)}static addHeaderType(e,t){e.addFieldInt8(1,t,MessageHeader.NONE)}static addHeader(e,t){e.addFieldOffset(2,t,0)}static addBodyLength(e,t){e.addFieldInt64(3,t,BigInt("0"))}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,t){e.finish(t)}static finishSizePrefixedMessageBuffer(e,t){e.finish(t,void 0,!0)}static createMessage(t,i,n,r,s,o){return e.startMessage(t),e.addVersion(t,i),e.addHeaderType(t,n),e.addHeader(t,r),e.addBodyLength(t,s),e.addCustomMetadata(t,o),e.endMessage(t)}};class TypeAssembler extends Visitor{visit(e,t){return null==e||null==t?void 0:super.visit(e,t)}visitNull(e,t){return Null$1.startNull(t),Null$1.endNull(t)}visitInt(e,t){return Int.startInt(t),Int.addBitWidth(t,e.bitWidth),Int.addIsSigned(t,e.isSigned),Int.endInt(t)}visitFloat(e,t){return FloatingPoint.startFloatingPoint(t),FloatingPoint.addPrecision(t,e.precision),FloatingPoint.endFloatingPoint(t)}visitBinary(e,t){return Binary$1.startBinary(t),Binary$1.endBinary(t)}visitLargeBinary(e,t){return LargeBinary$1.startLargeBinary(t),LargeBinary$1.endLargeBinary(t)}visitBool(e,t){return Bool$1.startBool(t),Bool$1.endBool(t)}visitUtf8(e,t){return Utf8$1.startUtf8(t),Utf8$1.endUtf8(t)}visitLargeUtf8(e,t){return LargeUtf8$1.startLargeUtf8(t),LargeUtf8$1.endLargeUtf8(t)}visitDecimal(e,t){return Decimal$1.startDecimal(t),Decimal$1.addScale(t,e.scale),Decimal$1.addPrecision(t,e.precision),Decimal$1.addBitWidth(t,e.bitWidth),Decimal$1.endDecimal(t)}visitDate(e,t){return Date$1.startDate(t),Date$1.addUnit(t,e.unit),Date$1.endDate(t)}visitTime(e,t){return Time.startTime(t),Time.addUnit(t,e.unit),Time.addBitWidth(t,e.bitWidth),Time.endTime(t)}visitTimestamp(e,t){const i=e.timezone&&t.createString(e.timezone)||void 0;return Timestamp.startTimestamp(t),Timestamp.addUnit(t,e.unit),void 0!==i&&Timestamp.addTimezone(t,i),Timestamp.endTimestamp(t)}visitInterval(e,t){return Interval.startInterval(t),Interval.addUnit(t,e.unit),Interval.endInterval(t)}visitDuration(e,t){return Duration$1.startDuration(t),Duration$1.addUnit(t,e.unit),Duration$1.endDuration(t)}visitList(e,t){return List$1.startList(t),List$1.endList(t)}visitStruct(e,t){return Struct_.startStruct_(t),Struct_.endStruct_(t)}visitUnion(e,t){Union.startTypeIdsVector(t,e.typeIds.length);const i=Union.createTypeIdsVector(t,e.typeIds);return Union.startUnion(t),Union.addMode(t,e.mode),Union.addTypeIds(t,i),Union.endUnion(t)}visitDictionary(e,t){const i=this.visit(e.indices,t);return DictionaryEncoding.startDictionaryEncoding(t),DictionaryEncoding.addId(t,BigInt(e.id)),DictionaryEncoding.addIsOrdered(t,e.isOrdered),void 0!==i&&DictionaryEncoding.addIndexType(t,i),DictionaryEncoding.endDictionaryEncoding(t)}visitFixedSizeBinary(e,t){return FixedSizeBinary$1.startFixedSizeBinary(t),FixedSizeBinary$1.addByteWidth(t,e.byteWidth),FixedSizeBinary$1.endFixedSizeBinary(t)}visitFixedSizeList(e,t){return FixedSizeList$1.startFixedSizeList(t),FixedSizeList$1.addListSize(t,e.listSize),FixedSizeList$1.endFixedSizeList(t)}visitMap(e,t){return Map$1.startMap(t),Map$1.addKeysSorted(t,e.keysSorted),Map$1.endMap(t)}}const instance=new TypeAssembler;function schemaFromJSON(e,t=new Map){return new Schema(schemaFieldsFromJSON(e,t),customMetadataFromJSON(e.metadata),t)}function recordBatchFromJSON(e){return new RecordBatch(e.count,fieldNodesFromJSON(e.columns),buffersFromJSON(e.columns))}function dictionaryBatchFromJSON(e){return new DictionaryBatch(recordBatchFromJSON(e.data),e.id,e.isDelta)}function schemaFieldsFromJSON(e,t){return(e.fields||[]).filter(Boolean).map(e=>Field.fromJSON(e,t))}function fieldChildrenFromJSON(e,t){return(e.children||[]).filter(Boolean).map(e=>Field.fromJSON(e,t))}function fieldNodesFromJSON(e){return(e||[]).reduce((e,t)=>[...e,new FieldNode(t.count,nullCountFromJSON(t.VALIDITY)),...fieldNodesFromJSON(t.children)],[])}function buffersFromJSON(e,t=[]){for(let i=-1,n=(e||[]).length;++i<n;){const n=e[i];n.VALIDITY&&t.push(new BufferRegion(t.length,n.VALIDITY.length)),n.TYPE_ID&&t.push(new BufferRegion(t.length,n.TYPE_ID.length)),n.OFFSET&&t.push(new BufferRegion(t.length,n.OFFSET.length)),n.DATA&&t.push(new BufferRegion(t.length,n.DATA.length)),t=buffersFromJSON(n.children,t)}return t}function nullCountFromJSON(e){return(e||[]).reduce((e,t)=>e+ +(0===t),0)}function fieldFromJSON(e,t){let i,n,r,s,o,a;return t&&(s=e.dictionary)?t.has(i=s.id)?(n=(n=s.indexType)?indexTypeFromJSON(n):new Int32,a=new Dictionary(t.get(i),n,i,s.isOrdered),r=new Field(e.name,a,e.nullable,customMetadataFromJSON(e.metadata))):(n=(n=s.indexType)?indexTypeFromJSON(n):new Int32,t.set(i,o=typeFromJSON(e,fieldChildrenFromJSON(e,t))),a=new Dictionary(o,n,i,s.isOrdered),r=new Field(e.name,a,e.nullable,customMetadataFromJSON(e.metadata))):(o=typeFromJSON(e,fieldChildrenFromJSON(e,t)),r=new Field(e.name,o,e.nullable,customMetadataFromJSON(e.metadata))),r||null}function customMetadataFromJSON(e=[]){return new Map(e.map(({key:e,value:t})=>[e,t]))}function indexTypeFromJSON(e){return new Int_(e.isSigned,e.bitWidth)}function typeFromJSON(e,t){const i=e.type.name;switch(i){case"NONE":case"null":return new Null;case"binary":return new Binary;case"largebinary":return new LargeBinary;case"utf8":return new Utf8;case"largeutf8":return new LargeUtf8;case"bool":return new Bool;case"list":return new List((t||[])[0]);case"struct":case"struct_":return new Struct(t||[])}switch(i){case"int":{const t=e.type;return new Int_(t.isSigned,t.bitWidth)}case"floatingpoint":{const t=e.type;return new Float(Precision[t.precision])}case"decimal":{const t=e.type;return new Decimal(t.scale,t.precision,t.bitWidth)}case"date":{const t=e.type;return new Date_(DateUnit[t.unit])}case"time":{const t=e.type;return new Time_(TimeUnit[t.unit],t.bitWidth)}case"timestamp":{const t=e.type;return new Timestamp_(TimeUnit[t.unit],t.timezone)}case"interval":{const t=e.type;return new Interval_(IntervalUnit[t.unit])}case"duration":{const t=e.type;return new Duration(TimeUnit[t.unit])}case"union":{const i=e.type,[n,...r]=(i.mode+"").toLowerCase(),s=n.toUpperCase()+r.join("");return new Union_(UnionMode[s],i.typeIds||[],t||[])}case"fixedsizebinary":{const t=e.type;return new FixedSizeBinary(t.byteWidth)}case"fixedsizelist":{const i=e.type;return new FixedSizeList(i.listSize,(t||[])[0])}case"map":{const i=e.type;return new Map_((t||[])[0],i.keysSorted)}}throw new Error(`Unrecognized type: "${i}"`)}var Builder=Builder$2,ByteBuffer=ByteBuffer$2;class Message{static fromJSON(e,t){const i=new Message(0,MetadataVersion.V5,t);return i._createHeader=messageHeaderFromJSON(e,t),i}static decode(e){e=new ByteBuffer(toUint8Array(e));const t=Message$1.getRootAsMessage(e),i=t.bodyLength(),n=t.version(),r=t.headerType(),s=new Message(i,n,r);return s._createHeader=decodeMessageHeader(t,r),s}static encode(e){const t=new Builder;let i=-1;return e.isSchema()?i=Schema.encode(t,e.header()):e.isRecordBatch()?i=RecordBatch.encode(t,e.header()):e.isDictionaryBatch()&&(i=DictionaryBatch.encode(t,e.header())),Message$1.startMessage(t),Message$1.addVersion(t,MetadataVersion.V5),Message$1.addHeader(t,i),Message$1.addHeaderType(t,e.headerType),Message$1.addBodyLength(t,BigInt(e.bodyLength)),Message$1.finishMessageBuffer(t,Message$1.endMessage(t)),t.asUint8Array()}static from(e,t=0){if(e instanceof Schema)return new Message(0,MetadataVersion.V5,MessageHeader.Schema,e);if(e instanceof RecordBatch)return new Message(t,MetadataVersion.V5,MessageHeader.RecordBatch,e);if(e instanceof DictionaryBatch)return new Message(t,MetadataVersion.V5,MessageHeader.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===MessageHeader.Schema}isRecordBatch(){return this.headerType===MessageHeader.RecordBatch}isDictionaryBatch(){return this.headerType===MessageHeader.DictionaryBatch}constructor(e,t,i,n){this._version=t,this._headerType=i,this.body=new Uint8Array(0),n&&(this._createHeader=()=>n),this._bodyLength=bigIntToNumber(e)}}class RecordBatch{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,t,i){this._nodes=t,this._buffers=i,this._length=bigIntToNumber(e)}}class DictionaryBatch{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,t,i=!1){this._data=e,this._isDelta=i,this._id=bigIntToNumber(t)}}class BufferRegion{constructor(e,t){this.offset=bigIntToNumber(e),this.length=bigIntToNumber(t)}}class FieldNode{constructor(e,t){this.length=bigIntToNumber(e),this.nullCount=bigIntToNumber(t)}}function messageHeaderFromJSON(e,t){return()=>{switch(t){case MessageHeader.Schema:return Schema.fromJSON(e);case MessageHeader.RecordBatch:return RecordBatch.fromJSON(e);case MessageHeader.DictionaryBatch:return DictionaryBatch.fromJSON(e)}throw new Error(`Unrecognized Message type: { name: ${MessageHeader[t]}, type: ${t} }`)}}function decodeMessageHeader(e,t){return()=>{switch(t){case MessageHeader.Schema:return Schema.decode(e.header(new Schema$1),new Map,e.version());case MessageHeader.RecordBatch:return RecordBatch.decode(e.header(new RecordBatch$2),e.version());case MessageHeader.DictionaryBatch:return DictionaryBatch.decode(e.header(new DictionaryBatch$1),e.version())}throw new Error(`Unrecognized Message type: { name: ${MessageHeader[t]}, type: ${t} }`)}}function decodeSchema(e,t=new Map,i=MetadataVersion.V5){const n=decodeSchemaFields(e,t);return new Schema(n,decodeCustomMetadata(e),t,i)}function decodeRecordBatch(e,t=MetadataVersion.V5){if(null!==e.compression())throw new Error("Record batch compression not implemented");return new RecordBatch(e.length(),decodeFieldNodes(e),decodeBuffers(e,t))}function decodeDictionaryBatch(e,t=MetadataVersion.V5){return new DictionaryBatch(RecordBatch.decode(e.data(),t),e.id(),e.isDelta())}function decodeBufferRegion(e){return new BufferRegion(e.offset(),e.length())}function decodeFieldNode(e){return new FieldNode(e.length(),e.nullCount())}function decodeFieldNodes(e){const t=[];for(let i,n=-1,r=-1,s=e.nodesLength();++n<s;)(i=e.nodes(n))&&(t[++r]=FieldNode.decode(i));return t}function decodeBuffers(e,t){const i=[];for(let n,r=-1,s=-1,o=e.buffersLength();++r<o;)(n=e.buffers(r))&&(t<MetadataVersion.V4&&(n.bb_pos+=8*(r+1)),i[++s]=BufferRegion.decode(n));return i}function decodeSchemaFields(e,t){const i=[];for(let n,r=-1,s=-1,o=e.fieldsLength();++r<o;)(n=e.fields(r))&&(i[++s]=Field.decode(n,t));return i}function decodeFieldChildren(e,t){const i=[];for(let n,r=-1,s=-1,o=e.childrenLength();++r<o;)(n=e.children(r))&&(i[++s]=Field.decode(n,t));return i}function decodeField(e,t){let i,n,r,s,o,a;return t&&(a=e.dictionary())?t.has(i=bigIntToNumber(a.id()))?(s=(s=a.indexType())?decodeIndexType(s):new Int32,o=new Dictionary(t.get(i),s,i,a.isOrdered()),n=new Field(e.name(),o,e.nullable(),decodeCustomMetadata(e))):(s=(s=a.indexType())?decodeIndexType(s):new Int32,t.set(i,r=decodeFieldType(e,decodeFieldChildren(e,t))),o=new Dictionary(r,s,i,a.isOrdered()),n=new Field(e.name(),o,e.nullable(),decodeCustomMetadata(e))):(r=decodeFieldType(e,decodeFieldChildren(e,t)),n=new Field(e.name(),r,e.nullable(),decodeCustomMetadata(e))),n||null}function decodeCustomMetadata(e){const t=new Map;if(e)for(let i,n,r=-1,s=Math.trunc(e.customMetadataLength());++r<s;)(i=e.customMetadata(r))&&null!=(n=i.key())&&t.set(n,i.value());return t}function decodeIndexType(e){return new Int_(e.isSigned(),e.bitWidth())}function decodeFieldType(e,t){const i=e.typeType();switch(i){case Type$1.NONE:case Type$1.Null:return new Null;case Type$1.Binary:return new Binary;case Type$1.LargeBinary:return new LargeBinary;case Type$1.Utf8:return new Utf8;case Type$1.LargeUtf8:return new LargeUtf8;case Type$1.Bool:return new Bool;case Type$1.List:return new List((t||[])[0]);case Type$1.Struct_:return new Struct(t||[])}switch(i){case Type$1.Int:{const t=e.type(new Int);return new Int_(t.isSigned(),t.bitWidth())}case Type$1.FloatingPoint:{const t=e.type(new FloatingPoint);return new Float(t.precision())}case Type$1.Decimal:{const t=e.type(new Decimal$1);return new Decimal(t.scale(),t.precision(),t.bitWidth())}case Type$1.Date:{const t=e.type(new Date$1);return new Date_(t.unit())}case Type$1.Time:{const t=e.type(new Time);return new Time_(t.unit(),t.bitWidth())}case Type$1.Timestamp:{const t=e.type(new Timestamp);return new Timestamp_(t.unit(),t.timezone())}case Type$1.Interval:{const t=e.type(new Interval);return new Interval_(t.unit())}case Type$1.Duration:{const t=e.type(new Duration$1);return new Duration(t.unit())}case Type$1.Union:{const i=e.type(new Union);return new Union_(i.mode(),i.typeIdsArray()||[],t||[])}case Type$1.FixedSizeBinary:{const t=e.type(new FixedSizeBinary$1);return new FixedSizeBinary(t.byteWidth())}case Type$1.FixedSizeList:{const i=e.type(new FixedSizeList$1);return new FixedSizeList(i.listSize(),(t||[])[0])}case Type$1.Map:{const i=e.type(new Map$1);return new Map_((t||[])[0],i.keysSorted())}}throw new Error(`Unrecognized type: "${Type$1[i]}" (${i})`)}function encodeSchema(e,t){const i=t.fields.map(t=>Field.encode(e,t));Schema$1.startFieldsVector(e,i.length);const n=Schema$1.createFieldsVector(e,i),r=t.metadata&&t.metadata.size>0?Schema$1.createCustomMetadataVector(e,[...t.metadata].map(([t,i])=>{const n=e.createString(`${t}`),r=e.createString(`${i}`);return KeyValue.startKeyValue(e),KeyValue.addKey(e,n),KeyValue.addValue(e,r),KeyValue.endKeyValue(e)})):-1;return Schema$1.startSchema(e),Schema$1.addFields(e,n),Schema$1.addEndianness(e,platformIsLittleEndian?Endianness.Little:Endianness.Big),-1!==r&&Schema$1.addCustomMetadata(e,r),Schema$1.endSchema(e)}function encodeField(e,t){let i=-1,n=-1,r=-1;const s=t.type;let o=t.typeId;DataType.isDictionary(s)?(o=s.dictionary.typeId,r=instance.visit(s,e),n=instance.visit(s.dictionary,e)):n=instance.visit(s,e);const a=(s.children||[]).map(t=>Field.encode(e,t)),l=Field$1.createChildrenVector(e,a),c=t.metadata&&t.metadata.size>0?Field$1.createCustomMetadataVector(e,[...t.metadata].map(([t,i])=>{const n=e.createString(`${t}`),r=e.createString(`${i}`);return KeyValue.startKeyValue(e),KeyValue.addKey(e,n),KeyValue.addValue(e,r),KeyValue.endKeyValue(e)})):-1;return t.name&&(i=e.createString(t.name)),Field$1.startField(e),Field$1.addType(e,n),Field$1.addTypeType(e,o),Field$1.addChildren(e,l),Field$1.addNullable(e,!!t.nullable),-1!==i&&Field$1.addName(e,i),-1!==r&&Field$1.addDictionary(e,r),-1!==c&&Field$1.addCustomMetadata(e,c),Field$1.endField(e)}function encodeRecordBatch(e,t){const i=t.nodes||[],n=t.buffers||[];RecordBatch$2.startNodesVector(e,i.length);for(const o of i.slice().reverse())FieldNode.encode(e,o);const r=e.endVector();RecordBatch$2.startBuffersVector(e,n.length);for(const o of n.slice().reverse())BufferRegion.encode(e,o);const s=e.endVector();return RecordBatch$2.startRecordBatch(e),RecordBatch$2.addLength(e,BigInt(t.length)),RecordBatch$2.addNodes(e,r),RecordBatch$2.addBuffers(e,s),RecordBatch$2.endRecordBatch(e)}function encodeDictionaryBatch(e,t){const i=RecordBatch.encode(e,t.data);return DictionaryBatch$1.startDictionaryBatch(e),DictionaryBatch$1.addId(e,BigInt(t.id)),DictionaryBatch$1.addIsDelta(e,t.isDelta),DictionaryBatch$1.addData(e,i),DictionaryBatch$1.endDictionaryBatch(e)}function encodeFieldNode(e,t){return FieldNode$1.createFieldNode(e,BigInt(t.length),BigInt(t.nullCount))}function encodeBufferRegion(e,t){return Buffer.createBuffer(e,BigInt(t.offset),BigInt(t.length))}Field.encode=encodeField,Field.decode=decodeField,Field.fromJSON=fieldFromJSON,Schema.encode=encodeSchema,Schema.decode=decodeSchema,Schema.fromJSON=schemaFromJSON,RecordBatch.encode=encodeRecordBatch,RecordBatch.decode=decodeRecordBatch,RecordBatch.fromJSON=recordBatchFromJSON,DictionaryBatch.encode=encodeDictionaryBatch,DictionaryBatch.decode=decodeDictionaryBatch,DictionaryBatch.fromJSON=dictionaryBatchFromJSON,FieldNode.encode=encodeFieldNode,FieldNode.decode=decodeFieldNode,BufferRegion.encode=encodeBufferRegion,BufferRegion.decode=decodeBufferRegion;const platformIsLittleEndian=(()=>{const e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]})(),invalidMessageType=e=>`Expected ${MessageHeader[e]} Message in stream, but was null or length 0.`,nullMessage=e=>`Header pointer of flatbuffer-encoded ${MessageHeader[e]} Message is null or length 0.`,invalidMessageMetadata=(e,t)=>`Expected to read ${e} metadata bytes, but only read ${t}.`,invalidMessageBodyLength=(e,t)=>`Expected to read ${e} bytes for message body, but only read ${t}.`;class MessageReader{constructor(e){this.source=e instanceof ByteStream?e:new ByteStream(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||-1===e.value&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?ITERATOR_DONE:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let t;if((t=this.next()).done)return null;if(null!=e&&t.value.headerType!==e)throw new Error(invalidMessageType(e));return t.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const t=toUint8Array(this.source.read(e));if(t.byteLength<e)throw new Error(invalidMessageBodyLength(e,t.byteLength));return t.byteOffset%8==0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()}readSchema(e=!1){const t=MessageHeader.Schema,i=this.readMessage(t),n=null==i?void 0:i.header();if(e&&!n)throw new Error(nullMessage(t));return n}readMetadataLength(){const e=this.source.read(PADDING),t=e&&new ByteBuffer$2(e),i=(null==t?void 0:t.readInt32(0))||0;return{done:0===i,value:i}}readMetadata(e){const t=this.source.read(e);if(!t)return ITERATOR_DONE;if(t.byteLength<e)throw new Error(invalidMessageMetadata(e,t.byteLength));return{done:!1,value:Message.decode(t)}}}class AsyncMessageReader{constructor(e,t){this.source=e instanceof AsyncByteStream?e:isFileHandle(e)?new AsyncRandomAccessFile(e,t):new AsyncByteStream(e)}[Symbol.asyncIterator](){return this}next(){return __awaiter(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||-1===e.value&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?ITERATOR_DONE:e})}throw(e){return __awaiter(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return __awaiter(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return __awaiter(this,void 0,void 0,function*(){let t;if((t=yield this.next()).done)return null;if(null!=e&&t.value.headerType!==e)throw new Error(invalidMessageType(e));return t.value})}readMessageBody(e){return __awaiter(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const t=toUint8Array(yield this.source.read(e));if(t.byteLength<e)throw new Error(invalidMessageBodyLength(e,t.byteLength));return t.byteOffset%8==0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()})}readSchema(){return __awaiter(this,arguments,void 0,function*(e=!1){const t=MessageHeader.Schema,i=yield this.readMessage(t),n=null==i?void 0:i.header();if(e&&!n)throw new Error(nullMessage(t));return n})}readMetadataLength(){return __awaiter(this,void 0,void 0,function*(){const e=yield this.source.read(PADDING),t=e&&new ByteBuffer$2(e),i=(null==t?void 0:t.readInt32(0))||0;return{done:0===i,value:i}})}readMetadata(e){return __awaiter(this,void 0,void 0,function*(){const t=yield this.source.read(e);if(!t)return ITERATOR_DONE;if(t.byteLength<e)throw new Error(invalidMessageMetadata(e,t.byteLength));return{done:!1,value:Message.decode(t)}})}}class JSONMessageReader extends MessageReader{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof ArrowJSON?e:new ArrowJSON(e)}next(){const{_json:e}=this;if(!this._schema){this._schema=!0;return{done:!1,value:Message.fromJSON(e.schema,MessageHeader.Schema)}}if(this._dictionaryIndex<e.dictionaries.length){const t=e.dictionaries[this._dictionaryIndex++];this._body=t.data.columns;return{done:!1,value:Message.fromJSON(t,MessageHeader.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const t=e.batches[this._batchIndex++];this._body=t.columns;return{done:!1,value:Message.fromJSON(t,MessageHeader.RecordBatch)}}return this._body=[],ITERATOR_DONE}readMessageBody(e){return function e(t){return(t||[]).reduce((t,i)=>[...t,...i.VALIDITY&&[i.VALIDITY]||[],...i.TYPE_ID&&[i.TYPE_ID]||[],...i.OFFSET&&[i.OFFSET]||[],...i.DATA&&[i.DATA]||[],...e(i.children)],[])}(this._body)}readMessage(e){let t;if((t=this.next()).done)return null;if(null!=e&&t.value.headerType!==e)throw new Error(invalidMessageType(e));return t.value}readSchema(){const e=MessageHeader.Schema,t=this.readMessage(e),i=null==t?void 0:t.header();if(!t||!i)throw new Error(nullMessage(e));return i}}const PADDING=4,MAGIC_STR="ARROW1",MAGIC=new Uint8Array(MAGIC_STR.length);for(let e=0;e<MAGIC_STR.length;e+=1)MAGIC[e]=MAGIC_STR.codePointAt(e);function checkForMagicArrowString(e,t=0){for(let i=-1,n=MAGIC.length;++i<n;)if(MAGIC[i]!==e[t+i])return!1;return!0}const magicLength=MAGIC.length,magicAndPadding=magicLength+PADDING,magicX2AndPadding=2*magicLength+PADDING;class RecordBatchReader extends ReadableInterop{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const t=this._impl.open(e);return isPromise(t)?t.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return streamAdapters.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return streamAdapters.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof RecordBatchReader?e:isArrowJSON(e)?fromArrowJSON(e):isFileHandle(e)?fromFileHandle(e):isPromise(e)?(()=>__awaiter(this,void 0,void 0,function*(){return yield RecordBatchReader.from(yield e)}))():isFetchResponse(e)||isReadableDOMStream(e)||isReadableNodeStream(e)||isAsyncIterable(e)?fromAsyncByteStream(new AsyncByteStream(e)):fromByteStream(new ByteStream(e))}static readAll(e){return e instanceof RecordBatchReader?e.isSync()?readAllSync(e):readAllAsync(e):isArrowJSON(e)||ArrayBuffer.isView(e)||isIterable(e)||isIteratorResult(e)?readAllSync(e):readAllAsync(e)}}class RecordBatchStreamReader extends RecordBatchReader{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return __asyncGenerator(this,arguments,function*(){yield __await(yield*__asyncDelegator(__asyncValues(this[Symbol.iterator]())))})}}class AsyncRecordBatchStreamReader extends RecordBatchReader{constructor(e){super(e),this._impl=e}readAll(){return __awaiter(this,void 0,void 0,function*(){var e,t,i,n;const r=new Array;try{for(var s,o=!0,a=__asyncValues(this);!(e=(s=yield a.next()).done);o=!0){n=s.value,o=!1;const e=n;r.push(e)}}catch(l){t={error:l}}finally{try{o||e||!(i=a.return)||(yield i.call(a))}finally{if(t)throw t.error}}return r})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class RecordBatchFileReader extends RecordBatchStreamReader{constructor(e){super(e),this._impl=e}}class AsyncRecordBatchFileReader extends AsyncRecordBatchStreamReader{constructor(e){super(e),this._impl=e}}class RecordBatchReaderImpl{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,t){const i=this._loadVectors(e,t,this.schema.fields),n=makeData({type:new Struct(this.schema.fields),length:e.length,children:i});return new RecordBatch$1(this.schema,n)}_loadDictionaryBatch(e,t){const{id:i,isDelta:n}=e,{dictionaries:r,schema:s}=this,o=r.get(i),a=s.dictionaries.get(i),l=this._loadVectors(e.data,t,[a]);return(o&&n?o.concat(new Vector(l)):new Vector(l)).memoize()}_loadVectors(e,t,i){return new VectorLoader(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}}class RecordBatchStreamReaderImpl extends RecordBatchReaderImpl{constructor(e,t){super(t),this._reader=isArrowJSON(e)?new JSONMessageReader(this._handle=e):new MessageReader(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=shouldAutoDestroy(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):ITERATOR_DONE}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):ITERATOR_DONE}next(){if(this.closed)return ITERATOR_DONE;let e;const{_reader:t}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else{if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),n=t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,n)}}if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),n=t.readMessageBody(e.bodyLength),r=this._loadDictionaryBatch(i,n);this.dictionaries.set(i.id,r)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new _InternalEmptyPlaceholderRecordBatch(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}}class AsyncRecordBatchStreamReaderImpl extends RecordBatchReaderImpl{constructor(e,t){super(t),this._reader=new AsyncMessageReader(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return __awaiter(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return __awaiter(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=shouldAutoDestroy(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return __awaiter(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):ITERATOR_DONE})}return(e){return __awaiter(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):ITERATOR_DONE})}next(){return __awaiter(this,void 0,void 0,function*(){if(this.closed)return ITERATOR_DONE;let e;const{_reader:t}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else{if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),n=yield t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,n)}}if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),n=yield t.readMessageBody(e.bodyLength),r=this._loadDictionaryBatch(i,n);this.dictionaries.set(i.id,r)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new _InternalEmptyPlaceholderRecordBatch(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return __awaiter(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}}class RecordBatchFileReaderImpl extends RecordBatchStreamReaderImpl{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,t){super(e instanceof RandomAccessFile?e:new RandomAccessFile(e),t)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const e of this._footer.dictionaryBatches())e&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var t;if(this.closed)return null;this._footer||this.open();const i=null===(t=this._footer)||void 0===t?void 0:t.getRecordBatch(e);if(i&&this._handle.seek(i.offset)){const e=this._reader.readMessage(MessageHeader.RecordBatch);if(null==e?void 0:e.isRecordBatch()){const t=e.header(),i=this._reader.readMessageBody(e.bodyLength);return this._loadRecordBatch(t,i)}}return null}_readDictionaryBatch(e){var t;const i=null===(t=this._footer)||void 0===t?void 0:t.getDictionaryBatch(e);if(i&&this._handle.seek(i.offset)){const e=this._reader.readMessage(MessageHeader.DictionaryBatch);if(null==e?void 0:e.isDictionaryBatch()){const t=e.header(),i=this._reader.readMessageBody(e.bodyLength),n=this._loadDictionaryBatch(t,i);this.dictionaries.set(t.id,n)}}}_readFooter(){const{_handle:e}=this,t=e.size-magicAndPadding,i=e.readInt32(t),n=e.readAt(t-i,i);return Footer_.decode(n)}_readNextMessageAndValidate(e){var t;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const i=null===(t=this._footer)||void 0===t?void 0:t.getRecordBatch(this._recordBatchIndex);if(i&&this._handle.seek(i.offset))return this._reader.readMessage(e)}return null}}class AsyncRecordBatchFileReaderImpl extends AsyncRecordBatchStreamReaderImpl{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...t){const i="number"!=typeof t[0]?t.shift():void 0,n=t[0]instanceof Map?t.shift():void 0;super(e instanceof AsyncRandomAccessFile?e:new AsyncRandomAccessFile(e,i),n)}isFile(){return!0}isAsync(){return!0}open(e){const t=Object.create(null,{open:{get:()=>super.open}});return __awaiter(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const e of this._footer.dictionaryBatches())e&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield t.open.call(this,e)})}readRecordBatch(e){return __awaiter(this,void 0,void 0,function*(){var t;if(this.closed)return null;this._footer||(yield this.open());const i=null===(t=this._footer)||void 0===t?void 0:t.getRecordBatch(e);if(i&&(yield this._handle.seek(i.offset))){const e=yield this._reader.readMessage(MessageHeader.RecordBatch);if(null==e?void 0:e.isRecordBatch()){const t=e.header(),i=yield this._reader.readMessageBody(e.bodyLength);return this._loadRecordBatch(t,i)}}return null})}_readDictionaryBatch(e){return __awaiter(this,void 0,void 0,function*(){var t;const i=null===(t=this._footer)||void 0===t?void 0:t.getDictionaryBatch(e);if(i&&(yield this._handle.seek(i.offset))){const e=yield this._reader.readMessage(MessageHeader.DictionaryBatch);if(null==e?void 0:e.isDictionaryBatch()){const t=e.header(),i=yield this._reader.readMessageBody(e.bodyLength),n=this._loadDictionaryBatch(t,i);this.dictionaries.set(t.id,n)}}})}_readFooter(){return __awaiter(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const t=e.size-magicAndPadding,i=yield e.readInt32(t),n=yield e.readAt(t-i,i);return Footer_.decode(n)})}_readNextMessageAndValidate(e){return __awaiter(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const t=this._footer.getRecordBatch(this._recordBatchIndex);if(t&&(yield this._handle.seek(t.offset)))return yield this._reader.readMessage(e)}return null})}}class RecordBatchJSONReaderImpl extends RecordBatchStreamReaderImpl{constructor(e,t){super(e,t)}_loadVectors(e,t,i){return new JSONVectorLoader(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}}function shouldAutoDestroy(e,t){return t&&"boolean"==typeof t.autoDestroy?t.autoDestroy:e.autoDestroy}function*readAllSync(e){const t=RecordBatchReader.from(e);try{if(!t.open({autoDestroy:!1}).closed)do{yield t}while(!t.reset().open().closed)}finally{t.cancel()}}function readAllAsync(e){return __asyncGenerator(this,arguments,function*(){const t=yield __await(RecordBatchReader.from(e));try{if(!(yield __await(t.open({autoDestroy:!1}))).closed)do{yield yield __await(t)}while(!(yield __await(t.reset().open())).closed)}finally{yield __await(t.cancel())}})}function fromArrowJSON(e){return new RecordBatchStreamReader(new RecordBatchJSONReaderImpl(e))}function fromByteStream(e){const t=e.peek(magicLength+7&-8);return t&&t.byteLength>=4?checkForMagicArrowString(t)?new RecordBatchFileReader(new RecordBatchFileReaderImpl(e.read())):new RecordBatchStreamReader(new RecordBatchStreamReaderImpl(e)):new RecordBatchStreamReader(new RecordBatchStreamReaderImpl(function*(){}()))}function fromAsyncByteStream(e){return __awaiter(this,void 0,void 0,function*(){const t=yield e.peek(magicLength+7&-8);return t&&t.byteLength>=4?checkForMagicArrowString(t)?new RecordBatchFileReader(new RecordBatchFileReaderImpl(yield e.read())):new AsyncRecordBatchStreamReader(new AsyncRecordBatchStreamReaderImpl(e)):new AsyncRecordBatchStreamReader(new AsyncRecordBatchStreamReaderImpl(function(){return __asyncGenerator(this,arguments,function*(){})}()))})}function fromFileHandle(e){return __awaiter(this,void 0,void 0,function*(){const{size:t}=yield e.stat(),i=new AsyncRandomAccessFile(e,t);return t>=magicX2AndPadding&&checkForMagicArrowString(yield i.readAt(0,magicLength+7&-8))?new AsyncRecordBatchFileReader(new AsyncRecordBatchFileReaderImpl(i)):new AsyncRecordBatchStreamReader(new AsyncRecordBatchStreamReaderImpl(i))})}class VectorAssembler extends Visitor{static assemble(...e){const t=e=>e.flatMap(e=>Array.isArray(e)?t(e):e instanceof RecordBatch$1?e.data.children:e.data),i=new VectorAssembler;return i.visitMany(t(e)),i}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(e){if(e instanceof Vector)return this.visitMany(e.data),this;const{type:t}=e;if(!DataType.isDictionary(t)){const{length:i}=e;if(i>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(DataType.isUnion(t))this.nodes.push(new FieldNode(i,0));else{const{nullCount:n}=e;DataType.isNull(t)||addBuffer.call(this,n<=0?new Uint8Array(0):truncateBitmap(e.offset,i,e.nullBitmap)),this.nodes.push(new FieldNode(i,n))}}return super.visit(e)}visitNull(e){return this}visitDictionary(e){return this.visit(e.clone(e.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function addBuffer(e){const t=e.byteLength+7&-8;return this.buffers.push(e),this.bufferRegions.push(new BufferRegion(this._byteLength,t)),this._byteLength+=t,this}function assembleUnion(e){var t;const{type:i,length:n,typeIds:r,valueOffsets:s}=e;if(addBuffer.call(this,r),i.mode===UnionMode.Sparse)return assembleNestedVector.call(this,e);if(i.mode===UnionMode.Dense){if(e.offset<=0)return addBuffer.call(this,s),assembleNestedVector.call(this,e);{const o=new Int32Array(n),a=Object.create(null),l=Object.create(null);for(let e,i,c=-1;++c<n;)void 0!==(e=r[c])&&(void 0===(i=a[e])&&(i=a[e]=s[c]),o[c]=s[c]-i,l[e]=(null!==(t=l[e])&&void 0!==t?t:0)+1);addBuffer.call(this,o),this.visitMany(e.children.map((e,t)=>{const r=i.typeIds[t],s=a[r],o=l[r];return e.slice(s,Math.min(n,o))}))}}return this}function assembleBoolVector(e){let t;return e.nullCount>=e.length?addBuffer.call(this,new Uint8Array(0)):(t=e.values)instanceof Uint8Array?addBuffer.call(this,truncateBitmap(e.offset,e.length,t)):addBuffer.call(this,packBools(e.values))}function assembleFlatVector(e){return addBuffer.call(this,e.values.subarray(0,e.length*e.stride))}function assembleFlatListVector(e){const{length:t,values:i,valueOffsets:n}=e,r=bigIntToNumber(n[0]),s=bigIntToNumber(n[t]),o=Math.min(s-r,i.byteLength-r);return addBuffer.call(this,rebaseValueOffsets(-r,t+1,n)),addBuffer.call(this,i.subarray(r,r+o)),this}function assembleListVector(e){const{length:t,valueOffsets:i}=e;if(i){const{0:n,[t]:r}=i;return addBuffer.call(this,rebaseValueOffsets(-n,t+1,i)),this.visit(e.children[0].slice(n,r-n))}return this.visit(e.children[0])}function assembleNestedVector(e){return this.visitMany(e.type.children.map((t,i)=>e.children[i]).filter(Boolean))[0]}VectorAssembler.prototype.visitBool=assembleBoolVector,VectorAssembler.prototype.visitInt=assembleFlatVector,VectorAssembler.prototype.visitFloat=assembleFlatVector,VectorAssembler.prototype.visitUtf8=assembleFlatListVector,VectorAssembler.prototype.visitLargeUtf8=assembleFlatListVector,VectorAssembler.prototype.visitBinary=assembleFlatListVector,VectorAssembler.prototype.visitLargeBinary=assembleFlatListVector,VectorAssembler.prototype.visitFixedSizeBinary=assembleFlatVector,VectorAssembler.prototype.visitDate=assembleFlatVector,VectorAssembler.prototype.visitTimestamp=assembleFlatVector,VectorAssembler.prototype.visitTime=assembleFlatVector,VectorAssembler.prototype.visitDecimal=assembleFlatVector,VectorAssembler.prototype.visitList=assembleListVector,VectorAssembler.prototype.visitStruct=assembleNestedVector,VectorAssembler.prototype.visitUnion=assembleUnion,VectorAssembler.prototype.visitInterval=assembleFlatVector,VectorAssembler.prototype.visitDuration=assembleFlatVector,VectorAssembler.prototype.visitFixedSizeList=assembleListVector,VectorAssembler.prototype.visitMap=assembleListVector;class RecordBatchWriter extends ReadableInterop{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}constructor(e){super(),this._position=0,this._started=!1,this._sink=new AsyncByteQueue,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,isObject(e)||(e={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy="boolean"!=typeof e.autoDestroy||e.autoDestroy,this._writeLegacyIpcFormat="boolean"==typeof e.writeLegacyIpcFormat&&e.writeLegacyIpcFormat}toString(e=!1){return this._sink.toString(e)}toUint8Array(e=!1){return this._sink.toUint8Array(e)}writeAll(e){return isPromise(e)?e.then(e=>this.writeAll(e)):isAsyncIterable(e)?writeAllAsync(this,e):writeAll(this,e)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(e){return this._sink.toDOMStream(e)}toNodeStream(e){return this._sink.toNodeStream(e)}close(){return this.reset()._sink.close()}abort(e){return this.reset()._sink.abort(e)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(e=this._sink,t=null){return e===this._sink||e instanceof AsyncByteQueue?this._sink=e:(this._sink=new AsyncByteQueue,e&&isWritableDOMStream(e)?this.toDOMStream({type:"bytes"}).pipeTo(e):e&&isWritableNodeStream(e)&&this.toNodeStream({objectMode:!1}).pipe(e)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,t&&compareSchemas(t,this._schema)||(null==t?(this._position=0,this._schema=null):(this._started=!0,this._schema=t,this._writeSchema(t))),this}write(e){let t=null;if(!this._sink)throw new Error("RecordBatchWriter is closed");if(null==e)return this.finish()&&void 0;if(e instanceof Table&&!(t=e.schema))return this.finish()&&void 0;if(e instanceof RecordBatch$1&&!(t=e.schema))return this.finish()&&void 0;if(t&&!compareSchemas(t,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,t)}e instanceof RecordBatch$1?e instanceof _InternalEmptyPlaceholderRecordBatch||this._writeRecordBatch(e):e instanceof Table?this.writeAll(e.batches):isIterable(e)&&this.writeAll(e)}_writeMessage(e,t=8){const i=t-1,n=Message.encode(e),r=n.byteLength,s=this._writeLegacyIpcFormat?4:8,o=r+s+i&~i,a=o-r-s;return e.headerType===MessageHeader.RecordBatch?this._recordBatchBlocks.push(new FileBlock(o,e.bodyLength,this._position)):e.headerType===MessageHeader.DictionaryBatch&&this._dictionaryBlocks.push(new FileBlock(o,e.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(o-s)),r>0&&this._write(n),this._writePadding(a)}_write(e){if(this._started){const t=toUint8Array(e);t&&t.byteLength>0&&(this._sink.write(t),this._position+=t.byteLength)}return this}_writeSchema(e){return this._writeMessage(Message.from(e))}_writeFooter(e){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(MAGIC)}_writePadding(e){return e>0?this._write(new Uint8Array(e)):this}_writeRecordBatch(e){const{byteLength:t,nodes:i,bufferRegions:n,buffers:r}=VectorAssembler.assemble(e),s=new RecordBatch(e.numRows,i,n),o=Message.from(s,t);return this._writeDictionaries(e)._writeMessage(o)._writeBodyBuffers(r)}_writeDictionaryBatch(e,t,i=!1){const{byteLength:n,nodes:r,bufferRegions:s,buffers:o}=VectorAssembler.assemble(new Vector([e])),a=new RecordBatch(e.length,r,s),l=new DictionaryBatch(a,t,i),c=Message.from(l,n);return this._writeMessage(c)._writeBodyBuffers(o)}_writeBodyBuffers(e){let t,i,n;for(let r=-1,s=e.length;++r<s;)(t=e[r])&&(i=t.byteLength)>0&&(this._write(t),(n=(i+7&-8)-i)>0&&this._writePadding(n));return this}_writeDictionaries(e){var t,i;for(const[n,r]of e.dictionaries){const e=null!==(t=null==r?void 0:r.data)&&void 0!==t?t:[],s=this._seenDictionaries.get(n),o=null!==(i=this._dictionaryDeltaOffsets.get(n))&&void 0!==i?i:0;if(s&&s.data[0]===e[0]){if(o<e.length)for(const t of e.slice(o))this._writeDictionaryBatch(t,n,!0)}else for(const[t,i]of e.entries())this._writeDictionaryBatch(i,n,t>0);this._seenDictionaries.set(n,r),this._dictionaryDeltaOffsets.set(n,e.length)}return this}}class RecordBatchStreamWriter extends RecordBatchWriter{static writeAll(e,t){const i=new RecordBatchStreamWriter(t);return isPromise(e)?e.then(e=>i.writeAll(e)):isAsyncIterable(e)?writeAllAsync(i,e):writeAll(i,e)}}class RecordBatchFileWriter extends RecordBatchWriter{static writeAll(e){const t=new RecordBatchFileWriter;return isPromise(e)?e.then(e=>t.writeAll(e)):isAsyncIterable(e)?writeAllAsync(t,e):writeAll(t,e)}constructor(){super(),this._autoDestroy=!0}_writeSchema(e){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(e,t,i=!1){if(!i&&this._seenDictionaries.has(t))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(e,t,i)}_writeFooter(e){const t=Footer_.encode(new Footer_(e,MetadataVersion.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(e)._write(t)._write(Int32Array.of(t.byteLength))._writeMagic()}}function writeAll(e,t){let i=t;t instanceof Table&&(i=t.batches,e.reset(void 0,t.schema));for(const n of i)e.write(n);return e.finish()}function writeAllAsync(e,t){return __awaiter(this,void 0,void 0,function*(){var i,n,r,s,o,a,l;try{for(i=!0,n=__asyncValues(t);!(s=(r=yield n.next()).done);i=!0){l=r.value,i=!1;const t=l;e.write(t)}}catch(c){o={error:c}}finally{try{i||s||!(a=n.return)||(yield a.call(n))}finally{if(o)throw o.error}}return e.finish()})}function tableToIPC(e,t="stream"){return("stream"===t?RecordBatchStreamWriter:RecordBatchFileWriter).writeAll(e).toUint8Array(!0)}var q=Object.create,h=Object.defineProperty,Y=Object.getOwnPropertyDescriptor,j=Object.getOwnPropertyNames,K=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty,z=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),J=(e,t,i,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of j(t))!V.call(e,r)&&r!==i&&h(e,r,{get:()=>t[r],enumerable:!(n=Y(t,r))||n.enumerable});return e},X=(e,t,i)=>(i=null!=e?q(K(e)):{},J(e&&e.__esModule?i:h(i,"default",{value:e,enumerable:!0}),e)),H=z((e,t)=>{t.exports=Worker}),$=(o=$||{},o[o.UNDEFINED=0]="UNDEFINED",o[o.AUTOMATIC=1]="AUTOMATIC",o[o.READ_ONLY=2]="READ_ONLY",o[o.READ_WRITE=3]="READ_WRITE",o),o,Z=(n=Z||{},n[n.IDENTIFIER=0]="IDENTIFIER",n[n.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",n[n.STRING_CONSTANT=2]="STRING_CONSTANT",n[n.OPERATOR=3]="OPERATOR",n[n.KEYWORD=4]="KEYWORD",n[n.COMMENT=5]="COMMENT",n),n,ee=(a=ee||{},a[a.NONE=0]="NONE",a[a.DEBUG=1]="DEBUG",a[a.INFO=2]="INFO",a[a.WARNING=3]="WARNING",a[a.ERROR=4]="ERROR",a),re=(e=>(e[e.NONE=0]="NONE",e[e.CONNECT=1]="CONNECT",e[e.DISCONNECT=2]="DISCONNECT",e[e.OPEN=3]="OPEN",e[e.QUERY=4]="QUERY",e[e.INSTANTIATE=5]="INSTANTIATE",e))(re||{}),te=(e=>(e[e.NONE=0]="NONE",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR",e[e.START=3]="START",e[e.RUN=4]="RUN",e[e.CAPTURE=5]="CAPTURE",e))(te||{}),se=(e=>(e[e.NONE=0]="NONE",e[e.WEB_WORKER=1]="WEB_WORKER",e[e.NODE_WORKER=2]="NODE_WORKER",e[e.BINDINGS=3]="BINDINGS",e[e.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",e))(se||{}),P=class{constructor(e=2){this.level=e}log(e){e.level>=this.level&&console.log(e)}},a,ne=(t2=ne||{},t2[t2.SUCCESS=0]="SUCCESS",t2[t2.MAX_ARROW_ERROR=255]="MAX_ARROW_ERROR",t2[t2.DUCKDB_WASM_RETRY=256]="DUCKDB_WASM_RETRY",t2),t2,E=class{constructor(e,t){this._bindings=e,this._conn=t}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(e){return e(this._bindings,this._conn)}async query(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let t=await this._bindings.runQuery(this._conn,e),i=RecordBatchReader.from(t);return console.assert(i.isSync(),"Reader is not sync"),console.assert(i.isFile(),"Reader is not file"),new Table(i)}async send(e,t=!1){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let i=await this._bindings.startPendingQuery(this._conn,e,t);for(;null==i;)i=await this._bindings.pollPendingQuery(this._conn);let n=new p(this._bindings,this._conn,i),r=await RecordBatchReader.from(n);return console.assert(r.isAsync()),console.assert(r.isStream()),r}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(e){return await this._bindings.getTableNames(this._conn,e)}async prepare(e){let t=await this._bindings.createPrepared(this._conn,e);return new I(this._bindings,this._conn,t)}async insertArrowTable(e,t){let i=tableToIPC(e,"stream");await this.insertArrowFromIPCStream(i,t)}async insertArrowFromIPCStream(e,t){await this._bindings.insertArrowFromIPCStream(this._conn,e,t)}async insertCSVFromPath(e,t){await this._bindings.insertCSVFromPath(this._conn,e,t)}async insertJSONFromPath(e,t){await this._bindings.insertJSONFromPath(this._conn,e,t)}},p=class{constructor(e,t,i){this.db=e,this.conn=t,this.header=i,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let e=null;for(null!=this._inFlight&&(e=await this._inFlight,this._inFlight=null);null==e;)e=await this.db.fetchQueryResults(this.conn);return this._depleted=0==e.length,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:e}}[Symbol.asyncIterator](){return this}},I=class{constructor(e,t,i){this.bindings=e,this.connectionId=t,this.statementId=i}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...e){let t=await this.bindings.runPrepared(this.connectionId,this.statementId,e),i=RecordBatchReader.from(t);return console.assert(i.isSync()),console.assert(i.isFile()),new Table(i)}async send(...e){let t=await this.bindings.sendPrepared(this.connectionId,this.statementId,e),i=new p(this.bindings,this.connectionId,t),n=await RecordBatchReader.from(i);return console.assert(n.isAsync()),console.assert(n.isStream()),n}},D=(c=D||{},c.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",c.CLOSE_PREPARED="CLOSE_PREPARED",c.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",c.REGISTER_OPFS_FILE_NAME="REGISTER_OPFS_FILE_NAME",c.CONNECT="CONNECT",c.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",c.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",c.CREATE_PREPARED="CREATE_PREPARED",c.DISCONNECT="DISCONNECT",c.DROP_FILE="DROP_FILE",c.DROP_FILES="DROP_FILES",c.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",c.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",c.FLUSH_FILES="FLUSH_FILES",c.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",c.GET_TABLE_NAMES="GET_TABLE_NAMES",c.GET_VERSION="GET_VERSION",c.GLOB_FILE_INFOS="GLOB_FILE_INFOS",c.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",c.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",c.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",c.INSTANTIATE="INSTANTIATE",c.OPEN="OPEN",c.PING="PING",c.POLL_PENDING_QUERY="POLL_PENDING_QUERY",c.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",c.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",c.REGISTER_FILE_URL="REGISTER_FILE_URL",c.RESET="RESET",c.RUN_PREPARED="RUN_PREPARED",c.RUN_QUERY="RUN_QUERY",c.SEND_PREPARED="SEND_PREPARED",c.START_PENDING_QUERY="START_PENDING_QUERY",c.TOKENIZE="TOKENIZE",c),L=(l=L||{},l.CONNECTION_INFO="CONNECTION_INFO",l.ERROR="ERROR",l.FEATURE_FLAGS="FEATURE_FLAGS",l.FILE_BUFFER="FILE_BUFFER",l.FILE_INFOS="FILE_INFOS",l.FILE_SIZE="FILE_SIZE",l.FILE_STATISTICS="FILE_STATISTICS",l.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",l.LOG="LOG",l.PROGRESS_UPDATE="PROGRESS_UPDATE",l.OK="OK",l.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",l.QUERY_PLAN="QUERY_PLAN",l.QUERY_RESULT="QUERY_RESULT",l.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",l.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",l.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",l.REGISTERED_FILE="REGISTERED_FILE",l.SCRIPT_TOKENS="SCRIPT_TOKENS",l.SUCCESS="SUCCESS",l.TABLE_NAMES="TABLE_NAMES",l.VERSION_STRING="VERSION_STRING",l),i$1=class{constructor(e,t){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=e,this.data=t,this.promise=new Promise((e,t)=>{this.promiseResolver=e,this.promiseRejecter=t})}},l,c;function _(e){switch(e.typeId){case Type.Binary:return{sqlType:"binary"};case Type.Bool:return{sqlType:"bool"};case Type.Date:return{sqlType:"date"};case Type.DateDay:return{sqlType:"date32[d]"};case Type.DateMillisecond:return{sqlType:"date64[ms]"};case Type.Decimal:{let t=e;return{sqlType:"decimal",precision:t.precision,scale:t.scale}}case Type.Float:return{sqlType:"float"};case Type.Float16:return{sqlType:"float16"};case Type.Float32:return{sqlType:"float32"};case Type.Float64:return{sqlType:"float64"};case Type.Int:return{sqlType:"int32"};case Type.Int16:return{sqlType:"int16"};case Type.Int32:return{sqlType:"int32"};case Type.Int64:return{sqlType:"int64"};case Type.Uint16:return{sqlType:"uint16"};case Type.Uint32:return{sqlType:"uint32"};case Type.Uint64:return{sqlType:"uint64"};case Type.Uint8:return{sqlType:"uint8"};case Type.IntervalDayTime:return{sqlType:"interval[dt]"};case Type.IntervalYearMonth:return{sqlType:"interval[m]"};case Type.List:return{sqlType:"list",valueType:_(e.valueType)};case Type.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:e.byteWidth};case Type.Null:return{sqlType:"null"};case Type.Utf8:return{sqlType:"utf8"};case Type.Struct:return{sqlType:"struct",fields:e.children.map(e=>R(e.name,e.type))};case Type.Map:{let t=e;return{sqlType:"map",keyType:_(t.keyType),valueType:_(t.valueType)}}case Type.Time:return{sqlType:"time[s]"};case Type.TimeMicrosecond:return{sqlType:"time[us]"};case Type.TimeMillisecond:return{sqlType:"time[ms]"};case Type.TimeNanosecond:return{sqlType:"time[ns]"};case Type.TimeSecond:return{sqlType:"time[s]"};case Type.Timestamp:return{sqlType:"timestamp",timezone:e.timezone||void 0};case Type.TimestampSecond:return{sqlType:"timestamp[s]",timezone:e.timezone||void 0};case Type.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:e.timezone||void 0};case Type.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:e.timezone||void 0};case Type.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:e.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(e.toString()))}function R(e,t){let i=_(t);return i.name=e,i}var oe=new TextEncoder,O=class{constructor(e,t=null){this._onInstantiationProgress=[],this._onExecutionProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=e,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),null!=t&&this.attach(t)}get logger(){return this._logger}attach(e){this._worker=e,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((e,t)=>{this._workerShutdownResolver=e})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(e,t=[]){if(!this._worker)return void console.error("cannot send a message since the worker is not set!");let i=this._nextMessageId++;return this._pendingRequests.set(i,e),this._worker.postMessage({messageId:i,type:e.type,data:e.data},t),await e.promise}onMessage(e){var t;let i=e.data;switch(i.type){case"PROGRESS_UPDATE":for(let e of this._onExecutionProgress)e(i.data);return;case"LOG":return void this._logger.log(i.data);case"INSTANTIATE_PROGRESS":for(let e of this._onInstantiationProgress)e(i.data);return}let n=this._pendingRequests.get(i.requestId);if(n){if(this._pendingRequests.delete(i.requestId),"ERROR"==i.type){let e=new Error(i.data.message);return e.name=i.data.name,null!=(t=Object.getOwnPropertyDescriptor(e,"stack"))&&t.writable&&(e.stack=i.data.stack),void n.promiseRejecter(e)}switch(n.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"REGISTER_OPFS_FILE_NAME":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if("OK"==i.type)return void n.promiseResolver(i.data);break;case"INSTANTIATE":if(this._onInstantiationProgress=[],"OK"==i.type)return void n.promiseResolver(i.data);break;case"GLOB_FILE_INFOS":if("FILE_INFOS"==i.type)return void n.promiseResolver(i.data);break;case"GET_VERSION":if("VERSION_STRING"==i.type)return void n.promiseResolver(i.data);break;case"GET_FEATURE_FLAGS":if("FEATURE_FLAGS"==i.type)return void n.promiseResolver(i.data);break;case"GET_TABLE_NAMES":if("TABLE_NAMES"==i.type)return void n.promiseResolver(i.data);break;case"TOKENIZE":if("SCRIPT_TOKENS"==i.type)return void n.promiseResolver(i.data);break;case"COPY_FILE_TO_BUFFER":if("FILE_BUFFER"==i.type)return void n.promiseResolver(i.data);break;case"EXPORT_FILE_STATISTICS":if("FILE_STATISTICS"==i.type)return void n.promiseResolver(i.data);break;case"CONNECT":if("CONNECTION_INFO"==i.type)return void n.promiseResolver(i.data);break;case"RUN_PREPARED":case"RUN_QUERY":if("QUERY_RESULT"==i.type)return void n.promiseResolver(i.data);break;case"SEND_PREPARED":if("QUERY_RESULT_HEADER"==i.type)return void n.promiseResolver(i.data);break;case"START_PENDING_QUERY":case"POLL_PENDING_QUERY":if("QUERY_RESULT_HEADER_OR_NULL"==i.type)return void n.promiseResolver(i.data);break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],"SUCCESS"==i.type)return void n.promiseResolver(i.data);break;case"FETCH_QUERY_RESULTS":if("QUERY_RESULT_CHUNK"==i.type)return void n.promiseResolver(i.data);break;case"CREATE_PREPARED":if("PREPARED_STATEMENT_ID"==i.type)return void n.promiseResolver(i.data)}n.promiseRejecter(new Error("unexpected response type: ".concat(i.type.toString())))}else console.warn("unassociated response: [".concat(i.requestId,", ").concat(i.type.toString(),"]"))}onError(e){console.error(e),console.error("error in duckdb worker: ".concat(e.message)),this._pendingRequests.clear()}onClose(){this._workerShutdownResolver(null),0==this._pendingRequests.size?this._pendingRequests.clear():console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"))}async reset(){let e=new i$1("RESET",null);return await this.postTask(e)}async ping(){let e=new i$1("PING",null);await this.postTask(e)}async dropFile(e){let t=new i$1("DROP_FILE",e);return await this.postTask(t)}async dropFiles(){let e=new i$1("DROP_FILES",null);return await this.postTask(e)}async flushFiles(){let e=new i$1("FLUSH_FILES",null);return await this.postTask(e)}async instantiate(e,t=null,i=e=>{}){this._onInstantiationProgress.push(i);let n=new i$1("INSTANTIATE",[e,t]);return await this.postTask(n)}async getVersion(){let e=new i$1("GET_VERSION",null);return await this.postTask(e)}async getFeatureFlags(){let e=new i$1("GET_FEATURE_FLAGS",null);return await this.postTask(e)}async open(e){let t=new i$1("OPEN",e);await this.postTask(t)}async tokenize(e){let t=new i$1("TOKENIZE",e);return await this.postTask(t)}async connectInternal(){let e=new i$1("CONNECT",null);return await this.postTask(e)}async connect(){let e=await this.connectInternal();return new E(this,e)}async disconnect(e){let t=new i$1("DISCONNECT",e);await this.postTask(t)}async runQuery(e,t){let i=new i$1("RUN_QUERY",[e,t]);return await this.postTask(i)}async startPendingQuery(e,t,i=!1){let n=new i$1("START_PENDING_QUERY",[e,t,i]);return await this.postTask(n)}async pollPendingQuery(e){let t=new i$1("POLL_PENDING_QUERY",e);return await this.postTask(t)}async cancelPendingQuery(e){let t=new i$1("CANCEL_PENDING_QUERY",e);return await this.postTask(t)}async fetchQueryResults(e){let t=new i$1("FETCH_QUERY_RESULTS",e);return await this.postTask(t)}async getTableNames(e,t){let i=new i$1("GET_TABLE_NAMES",[e,t]);return await this.postTask(i)}async createPrepared(e,t){let i=new i$1("CREATE_PREPARED",[e,t]);return await this.postTask(i)}async closePrepared(e,t){let i=new i$1("CLOSE_PREPARED",[e,t]);await this.postTask(i)}async runPrepared(e,t,i){let n=new i$1("RUN_PREPARED",[e,t,i]);return await this.postTask(n)}async sendPrepared(e,t,i){let n=new i$1("SEND_PREPARED",[e,t,i]);return await this.postTask(n)}async globFiles(e){let t=new i$1("GLOB_FILE_INFOS",e);return await this.postTask(t)}async registerFileText(e,t){let i=oe.encode(t);await this.registerFileBuffer(e,i)}async registerFileURL(e,t,i,n){void 0===t&&(t=e);let r=new i$1("REGISTER_FILE_URL",[e,t,i,n]);await this.postTask(r)}async registerEmptyFileBuffer(e){}async registerFileBuffer(e,t){let i=new i$1("REGISTER_FILE_BUFFER",[e,t]);await this.postTask(i,[t.buffer])}async registerFileHandle(e,t,i,n){let r=new i$1("REGISTER_FILE_HANDLE",[e,t,i,n]);await this.postTask(r,[])}async registerOPFSFileName(e){let t=new i$1("REGISTER_OPFS_FILE_NAME",[e]);await this.postTask(t,[])}async collectFileStatistics(e,t){let i=new i$1("COLLECT_FILE_STATISTICS",[e,t]);await this.postTask(i,[])}async exportFileStatistics(e){let t=new i$1("EXPORT_FILE_STATISTICS",e);return await this.postTask(t,[])}async copyFileToBuffer(e){let t=new i$1("COPY_FILE_TO_BUFFER",e);return await this.postTask(t)}async copyFileToPath(e,t){let i=new i$1("COPY_FILE_TO_PATH",[e,t]);await this.postTask(i)}async insertArrowFromIPCStream(e,t,i){if(0==t.length)return;let n=new i$1("INSERT_ARROW_FROM_IPC_STREAM",[e,t,i]);await this.postTask(n,[t.buffer])}async insertCSVFromPath(e,t,i){if(void 0!==i.columns){let e=[];for(let t in i.columns){let n=i.columns[t];e.push(R(t,n))}i.columnsFlat=e,delete i.columns}let n=new i$1("IMPORT_CSV_FROM_PATH",[e,t,i]);await this.postTask(n)}async insertJSONFromPath(e,t,i){if(void 0!==i.columns){let e=[];for(let t in i.columns){let n=i.columns[t];e.push(R(t,n))}i.columnsFlat=e,delete i.columns}let n=new i$1("IMPORT_JSON_FROM_PATH",[e,t,i]);await this.postTask(n)}};function ae(){let e=new TextDecoder;return t=>(typeof SharedArrayBuffer<"u"&&t.buffer instanceof SharedArrayBuffer&&(t=new Uint8Array(t)),e.decode(t))}ae();var F=(e=>(e[e.BUFFER=0]="BUFFER",e[e.NODE_FS=1]="NODE_FS",e[e.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",e[e.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",e[e.HTTP=4]="HTTP",e[e.S3=5]="S3",e))(F||{}),m={version:"1.30.0"},b=m.version.split(".");b[0],b[1],b[2],X(H());const DB_NAME="fossiq-file-handles",STORE_NAME="file-handles",DB_VERSION=1;function openDB(){return new Promise((e,t)=>{const i=indexedDB.open(DB_NAME,DB_VERSION);i.onerror=()=>t(i.error),i.onsuccess=()=>e(i.result),i.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(STORE_NAME)||t.createObjectStore(STORE_NAME,{keyPath:"tableName"})}})}async function storeFileHandle(e,t){const i=await openDB();return new Promise((n,r)=>{const s=i.transaction(STORE_NAME,"readwrite"),o=s.objectStore(STORE_NAME).put({tableName:e,handle:t});o.onerror=()=>r(o.error),o.onsuccess=()=>n(),s.oncomplete=()=>i.close()})}async function getStoredFileHandles(){const e=await openDB();return new Promise((t,i)=>{const n=e.transaction(STORE_NAME,"readonly"),r=n.objectStore(STORE_NAME).getAll();r.onerror=()=>i(r.error),r.onsuccess=()=>t(r.result),n.oncomplete=()=>e.close()})}async function removeFileHandle(e){const t=await openDB();return new Promise((i,n)=>{const r=t.transaction(STORE_NAME,"readwrite"),s=r.objectStore(STORE_NAME).delete(e);s.onerror=()=>n(s.error),s.onsuccess=()=>i(),r.oncomplete=()=>t.close()})}const SchemaContext=createContext();function SchemaProvider(e){const[t,i]=createSignal([]),[n,r]=createSignal(!0),[s,o]=createSignal(null),[a,l]=createSignal(null),[c,h]=createSignal([]);onMount(async()=>{try{const e=new P,t=new Worker("/duckdb-browser-eh.worker.js"),i=new O(e,t);await i.instantiate("/duckdb-eh.wasm");const n=await i.connect();o(i),l(n),await(async(e,t)=>{try{const n=await getStoredFileHandles(),r=[];for(const{tableName:s,handle:o}of n)try{if("granted"===await o.queryPermission({mode:"read"})){const i=await o.getFile();await u(e,t,i,s,o)}else r.push({tableName:s,handle:o})}catch(i){console.warn(`Failed to check permission for ${s}:`,i),await removeFileHandle(s)}h(r)}catch(i){console.error("Failed to restore stored files:",i)}})(i,n),r(!1),console.log("DuckDB initialized")}catch(e){console.error("Failed to initialize DuckDB",e),r(!1)}});const u=async(e,t,n,r,s)=>{await e.registerFileHandle(n.name,n,F.BROWSER_FILEREADER,!0),await t.insertCSVFromPath(n.name,{name:r,schema:"main",header:!0,detect:!0});const o=(await t.query(`DESCRIBE ${r}`)).toArray().map(e=>({name:e.column_name,type:e.column_type})),a=(await t.query(`SELECT COUNT(*) as count FROM ${r}`)).toArray()[0].count,l={name:r,columns:o,rowCount:"bigint"==typeof a?Number(a):a};i(e=>[...e,l]),s&&await storeFileHandle(r,s)};return createComponent(SchemaContext.Provider,{value:{tables:t,addTable:async(e,t)=>{const i=s(),n=a();if(i&&n){r(!0);try{const r=e.name.replace(/\.[^/.]+$/,"").replace(/\W/g,"_");await u(i,n,e,r,t)}catch(o){console.error("Error adding table:",o)}finally{r(!1)}}},removeTable:async e=>{const t=a();if(t){r(!0);try{await t.query(`DROP TABLE IF EXISTS ${e}`),await removeFileHandle(e),i(t=>t.filter(t=>t.name!==e))}catch(n){console.error("Error removing table:",n)}finally{r(!1)}}},loading:n,db:s,conn:a,pendingRestoreCount:()=>c().length,restorePendingFiles:async()=>{const e=s(),t=a();if(!e||!t)return;const i=c();if(0===i.length)return;r(!0);const n=[];for(const{tableName:r,handle:s}of i)try{if("granted"===await s.requestPermission({mode:"read"})){const i=await s.getFile();await u(e,t,i,r,s)}else await removeFileHandle(r)}catch(o){console.warn(`Failed to restore file ${r}:`,o),"NotAllowedError"===o.name?n.push({tableName:r,handle:s}):await removeFileHandle(r)}h(n),r(!1)}},get children(){return e.children}})}function useSchema(){const e=useContext(SchemaContext);if(!e)throw new Error("useSchema must be used within a SchemaProvider");return e}var _tmpl$$4=template("<span>Add Data"),_tmpl$2$2=template("<button class=restore-btn>Restore <!> file"),_tmpl$3$1=template('<div class=empty-state><p>No data loaded</p><small>Click "Add Data" to load a CSV file'),_tmpl$4$1=template('<aside class=sidebar role=navigation aria-label="Sources panel"><button title="Add data source"aria-label="Add data source"class=add-source-btn></button><div class=tables-list>'),_tmpl$5$1=template("<span>Loading..."),_tmpl$6$1=template("<div class=table-item><div class=table-header><span class=table-name></span><span class=row-count>(<!>)</span><button class=remove-table-btn></button></div><div class=columns-list>"),_tmpl$7=template("<div class=column-item><span class=tree-glyph></span><span class=column-name></span><span class=column-type>");const Sidebar=e=>{const{tables:t,addTable:i,removeTable:n,loading:r,pendingRestoreCount:s,restorePendingFiles:o}=useSchema(),a=async()=>{try{const[e]=await window.showOpenFilePicker({types:[{description:"CSV Files",accept:{"text/csv":[".csv"]}}],multiple:!1}),t=await e.getFile();await i(t,e)}catch(e){const t=e;if("AbortError"!==t.name){console.error("Error selecting file:",t);const e=document.createElement("input");e.type="file",e.accept=".csv",e.onchange=async e=>{const t=e.target.files;t&&t.length>0&&await i(t[0])},e.click()}}};return l=_tmpl$4$1(),c=l.firstChild,h=c.nextSibling,c.$$click=a,insert$1(c,createComponent(Show,{get when(){return!r()},get fallback(){return _tmpl$5$1()},get children(){return[createComponent(Icon,{name:"plus-circle",size:20}),_tmpl$$4()]}})),insert$1(l,createComponent(Show,{get when(){return s()>0},get children(){var e=_tmpl$2$2(),t=e.firstChild.nextSibling;return t.nextSibling,addEventListener(e,"click",o),insert$1(e,s,t),insert$1(e,()=>s()>1?"s":"",null),createRenderEffect(()=>e.disabled=r()),e}}),h),insert$1(h,createComponent(Show,{get when(){return 0===t().length},get children(){return _tmpl$3$1()}}),null),insert$1(h,createComponent(For,{get each(){return t()},children:e=>(()=>{var t=_tmpl$6$1(),i=t.firstChild,s=i.firstChild,o=s.nextSibling,a=o.firstChild.nextSibling;a.nextSibling;var l=o.nextSibling,c=i.nextSibling;return insert$1(i,createComponent(Icon,{name:"table",size:16,class:"type-icon"}),s),insert$1(s,()=>e.name),insert$1(o,()=>e.rowCount,a),l.$$click=()=>n(e.name),insert$1(l,createComponent(Icon,{name:"x-circle",size:16})),insert$1(c,createComponent(For,{get each(){return e.columns},children:(t,i)=>{const n=i()===e.columns.length-1;return r=_tmpl$7(),s=r.firstChild,o=s.nextSibling,a=o.nextSibling,insert$1(s,n?"‚îî‚îÄ":"‚îú‚îÄ"),insert$1(r,createComponent(Icon,{name:"column",size:12,class:"column-icon"}),o),insert$1(o,()=>t.name),insert$1(a,()=>t.type),createRenderEffect(()=>setAttribute(r,"title",`${t.name} (${t.type})`)),r;var r,s,o,a}})),createRenderEffect(t=>{var i=e.name,n=`Remove ${e.name}`,o=r();return i!==t.e&&setAttribute(s,"title",t.e=i),n!==t.t&&setAttribute(l,"title",t.t=n),o!==t.a&&(l.disabled=t.a=o),t},{e:void 0,t:void 0,a:void 0}),t})()}),null),createRenderEffect(()=>c.disabled=r()),l;var l,c,h};delegateEvents(["click"]);const THEME_STORAGE_KEY="fossiq-theme";function useTheme(){const[e,t]=createSignal("light");onMount(()=>{const e=localStorage.getItem(THEME_STORAGE_KEY);e?(t(e),i(e)):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?(t("dark"),i("dark")):(t("light"),i("light"))}),createEffect(()=>{i(e())});const i=e=>{document.documentElement.classList.remove("theme-light","theme-dark"),document.documentElement.classList.add(`theme-${e}`),document.documentElement.setAttribute("data-theme",e)};return{theme:e,toggleTheme:()=>{const n="light"===e()?"dark":"light";t(n),localStorage.setItem(THEME_STORAGE_KEY,n),i(n)}}}var _tmpl$$3=template("<div class=container><div class=content>");const Layout=e=>{const{theme:t,toggleTheme:i}=useTheme(),n=()=>{console.log("Add source clicked")};return r=_tmpl$$3(),s=r.firstChild,insert$1(r,createComponent(Header,{onThemeToggle:i}),s),insert$1(s,()=>e.children,null),insert$1(s,createComponent(Sidebar,{onAddSource:n}),null),createRenderEffect(()=>setAttribute(r,"data-theme",t())),r;var r,s};let rangeFrom=[],rangeTo=[];function isExtendingChar(e){if(e<768)return!1;for(let t=0,i=rangeFrom.length;;){let n=t+i>>1;if(e<rangeFrom[n])i=n;else{if(!(e>=rangeTo[n]))return!0;t=n+1}if(t==i)return!1}}function isRegionalIndicator(e){return e>=127462&&e<=127487}(()=>{let e="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let t=0,i=0;t<e.length;t++)(t%2?rangeTo:rangeFrom).push(i+=e[t])})();const ZWJ=8205;function findClusterBreak$1(e,t,i=!0,n=!0){return(i?nextClusterBreak:prevClusterBreak)(e,t,n)}function nextClusterBreak(e,t,i){if(t==e.length)return t;t&&surrogateLow$1(e.charCodeAt(t))&&surrogateHigh$1(e.charCodeAt(t-1))&&t--;let n=codePointAt$1(e,t);for(t+=codePointSize$1(n);t<e.length;){let r=codePointAt$1(e,t);if(n==ZWJ||r==ZWJ||i&&isExtendingChar(r))t+=codePointSize$1(r),n=r;else{if(!isRegionalIndicator(r))break;{let i=0,n=t-2;for(;n>=0&&isRegionalIndicator(codePointAt$1(e,n));)i++,n-=2;if(i%2==0)break;t+=2}}}return t}function prevClusterBreak(e,t,i){for(;t>0;){let n=nextClusterBreak(e,t-2,i);if(n<t)return n;t--}return 0}function codePointAt$1(e,t){let i=e.charCodeAt(t);if(!surrogateHigh$1(i)||t+1==e.length)return i;let n=e.charCodeAt(t+1);return surrogateLow$1(n)?n-56320+(i-55296<<10)+65536:i}function surrogateLow$1(e){return e>=56320&&e<57344}function surrogateHigh$1(e){return e>=55296&&e<56320}function codePointSize$1(e){return e<65536?1:2}class Text{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){[e,t]=clip(this,e,t);let n=[];return this.decompose(0,e,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(t,this.length,n,1),TextNode.from(n,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=clip(this,e,t);let i=[];return this.decompose(e,t,i,0),TextNode.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),n=new RawTextCursor(this),r=new RawTextCursor(e);for(let s=t,o=t;;){if(n.next(s),r.next(s),s=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(o+=n.value.length,n.done||o>=i)return!0}}iter(e=1){return new RawTextCursor(this,e)}iterRange(e,t=this.length){return new PartialTextCursor(this,e,t)}iterLines(e,t){let i;if(null==e)i=this.iter();else{null==t&&(t=this.lines+1);let n=this.line(e).from;i=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new LineCursor(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(0==e.length)throw new RangeError("A document must have at least one line");return 1!=e.length||e[0]?e.length<=32?new TextLeaf(e):TextNode.from(TextLeaf.split(e,[])):Text.empty}}class TextLeaf extends Text{constructor(e,t=textLength(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,n){for(let r=0;;r++){let s=this.text[r],o=n+s.length;if((t?i:o)>=e)return new Line(n,o,i,s);n=o+1,i++}}decompose(e,t,i,n){let r=e<=0&&t>=this.length?this:new TextLeaf(sliceText(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(1&n){let e=i.pop(),t=appendText(r.text,e.text.slice(),0,r.length);if(t.length<=32)i.push(new TextLeaf(t,e.length+r.length));else{let e=t.length>>1;i.push(new TextLeaf(t.slice(0,e)),new TextLeaf(t.slice(e)))}}else i.push(r)}replace(e,t,i){if(!(i instanceof TextLeaf))return super.replace(e,t,i);[e,t]=clip(this,e,t);let n=appendText(this.text,appendText(i.text,sliceText(this.text,0,e)),t),r=this.length+i.length-(t-e);return n.length<=32?new TextLeaf(n,r):TextNode.from(TextLeaf.split(n,[]),r)}sliceString(e,t=this.length,i="\n"){[e,t]=clip(this,e,t);let n="";for(let r=0,s=0;r<=t&&s<this.text.length;s++){let o=this.text[s],a=r+o.length;r>e&&s&&(n+=i),e<a&&t>r&&(n+=o.slice(Math.max(0,e-r),t-r)),r=a+1}return n}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],n=-1;for(let r of e)i.push(r),n+=r.length+1,32==i.length&&(t.push(new TextLeaf(i,n)),i=[],n=-1);return n>-1&&t.push(new TextLeaf(i,n)),t}}class TextNode extends Text{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,n){for(let r=0;;r++){let s=this.children[r],o=n+s.length,a=i+s.lines-1;if((t?a:o)>=e)return s.lineInner(e,t,i,n);n=o+1,i=a+1}}decompose(e,t,i,n){for(let r=0,s=0;s<=t&&r<this.children.length;r++){let o=this.children[r],a=s+o.length;if(e<=a&&t>=s){let r=n&((s<=e?1:0)|(a>=t?2:0));s>=e&&a<=t&&!r?i.push(o):o.decompose(e-s,t-s,i,r)}s=a+1}}replace(e,t,i){if([e,t]=clip(this,e,t),i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],o=r+s.length;if(e>=r&&t<=o){let a=s.replace(e-r,t-r,i),l=this.lines-s.lines+a.lines;if(a.lines<l>>4&&a.lines>l>>6){let r=this.children.slice();return r[n]=a,new TextNode(r,this.length-(t-e)+i.length)}return super.replace(r,o,a)}r=o+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i="\n"){[e,t]=clip(this,e,t);let n="";for(let r=0,s=0;r<this.children.length&&s<=t;r++){let o=this.children[r],a=s+o.length;s>e&&r&&(n+=i),e<a&&t>s&&(n+=o.sliceString(e-s,t-s,i)),s=a+1}return n}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof TextNode))return 0;let i=0,[n,r,s,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=t,r+=t){if(n==s||r==o)return i;let a=this.children[n],l=e.children[r];if(a!=l)return i+a.scanIdentical(l,t);i+=a.length+1}}static from(e,t=e.reduce((e,t)=>e+t.length+1,-1)){let i=0;for(let d of e)i+=d.lines;if(i<32){let i=[];for(let t of e)t.flatten(i);return new TextLeaf(i,t)}let n=Math.max(32,i>>5),r=n<<1,s=n>>1,o=[],a=0,l=-1,c=[];function h(e){let t;if(e.lines>r&&e instanceof TextNode)for(let i of e.children)h(i);else e.lines>s&&(a>s||!a)?(u(),o.push(e)):e instanceof TextLeaf&&a&&(t=c[c.length-1])instanceof TextLeaf&&e.lines+t.lines<=32?(a+=e.lines,l+=e.length+1,c[c.length-1]=new TextLeaf(t.text.concat(e.text),t.length+1+e.length)):(a+e.lines>n&&u(),a+=e.lines,l+=e.length+1,c.push(e))}function u(){0!=a&&(o.push(1==c.length?c[0]:TextNode.from(c,l)),l=-1,a=c.length=0)}for(let d of e)h(d);return u(),1==o.length?o[0]:new TextNode(o,t)}}function textLength(e){let t=-1;for(let i of e)t+=i.length+1;return t}function appendText(e,t,i=0,n=1e9){for(let r=0,s=0,o=!0;s<e.length&&r<=n;s++){let a=e[s],l=r+a.length;l>=i&&(l>n&&(a=a.slice(0,n-r)),r<i&&(a=a.slice(i-r)),o?(t[t.length-1]+=a,o=!1):t.push(a)),r=l+1}return t}function sliceText(e,t,i){return appendText(e,[""],t,i)}Text.empty=new TextLeaf([""],0);class RawTextCursor{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof TextLeaf?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],s=r>>1,o=n instanceof TextLeaf?n.text.length:n.children.length;if(s==(t>0?o:0)){if(0==i)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&r)==(t>0?0:1)){if(this.offsets[i]+=t,0==e)return this.lineBreak=!0,this.value="\n",this;e--}else if(n instanceof TextLeaf){let r=n.text[s+(t<0?-1:0)];if(this.offsets[i]+=t,r.length>Math.max(0,e))return this.value=0==e?r:t>0?r.slice(e):r.slice(0,r.length-e),this;e-=r.length}else{let r=n.children[s+(t<0?-1:0)];e>r.length?(e-=r.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(r),this.offsets.push(t>0?1:(r instanceof TextLeaf?r.text.length:r.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class PartialTextCursor{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new RawTextCursor(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*t,this.value=n.length<=i?n:t<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class LineCursor{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:n}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(e,t,i,n){this.from=e,this.to=t,this.number=i,this.text=n}get length(){return this.to-this.from}}function clip(e,t,i){return[t=Math.max(0,Math.min(e.length,t)),Math.max(t,Math.min(e.length,i))]}function findClusterBreak(e,t,i=!0,n=!0){return findClusterBreak$1(e,t,i,n)}function surrogateLow(e){return e>=56320&&e<57344}function surrogateHigh(e){return e>=55296&&e<56320}function codePointAt(e,t){let i=e.charCodeAt(t);if(!surrogateHigh(i)||t+1==e.length)return i;let n=e.charCodeAt(t+1);return surrogateLow(n)?n-56320+(i-55296<<10)+65536:i}function fromCodePoint(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function codePointSize(e){return e<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(e){return e[e.Simple=0]="Simple",e[e.TrackDel=1]="TrackDel",e[e.TrackBefore=2]="TrackBefore",e[e.TrackAfter=3]="TrackAfter",e}(MapMode||(MapMode={}));class ChangeDesc{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,n=0;t<this.sections.length;){let r=this.sections[t++],s=this.sections[t++];s<0?(e(i,n,r),n+=r):n+=s,i+=r}}iterChangedRanges(e,t=!1){iterChanges(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];n<0?e.push(i,n):e.push(n,i)}return new ChangeDesc(e)}composeDesc(e){return this.empty?e:e.empty?this:composeSets(this,e)}mapDesc(e,t=!1){return e.empty?this:mapSet(this,e,t)}mapPos(e,t=-1,i=MapMode.Simple){let n=0,r=0;for(let s=0;s<this.sections.length;){let o=this.sections[s++],a=this.sections[s++],l=n+o;if(a<0){if(l>e)return r+(e-n);r+=o}else{if(i!=MapMode.Simple&&l>=e&&(i==MapMode.TrackDel&&n<e&&l>e||i==MapMode.TrackBefore&&n<e||i==MapMode.TrackAfter&&l>e))return null;if(l>e||l==e&&t<0&&!o)return e==n||t<0?r:r+a;r+=a}n=l}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return r}touchesRange(e,t=e){for(let i=0,n=0;i<this.sections.length&&n<=t;){let r=n+this.sections[i++];if(this.sections[i++]>=0&&n<=t&&r>=e)return!(n<e&&r>t)||"cover";n=r}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+i+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(e=>"number"!=typeof e))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(e)}static create(e){return new ChangeDesc(e)}}class ChangeSet extends ChangeDesc{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,(t,i,n,r,s)=>e=e.replace(n,n+(i-t),s),!1),e}mapDesc(e,t=!1){return mapSet(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let n=0,r=0;n<t.length;n+=2){let s=t[n],o=t[n+1];if(o>=0){t[n]=o,t[n+1]=s;let a=n>>1;for(;i.length<a;)i.push(Text.empty);i.push(s?e.slice(r,r+s):Text.empty)}r+=s}return new ChangeSet(t,i)}compose(e){return this.empty?e:e.empty?this:composeSets(this,e,!0)}map(e,t=!1){return e.empty?this:mapSet(this,e,t,!0)}iterChanges(e,t=!1){iterChanges(this,e,t)}get desc(){return ChangeDesc.create(this.sections)}filter(e){let t=[],i=[],n=[],r=new SectionIter(this);e:for(let s=0,o=0;;){let a=s==e.length?1e9:e[s++];for(;o<a||o==a&&0==r.len;){if(r.done)break e;let e=Math.min(r.len,a-o);addSection(n,e,-1);let s=-1==r.ins?-1:0==r.off?r.ins:0;addSection(t,e,s),s>0&&addInsert(i,t,r.text),r.forward(e),o+=e}let l=e[s++];for(;o<l;){if(r.done)break e;let e=Math.min(r.len,l-o);addSection(t,e,-1),addSection(n,e,-1==r.ins?-1:0==r.off?r.ins:0),r.forward(e),o+=e}}return{changes:new ChangeSet(t,i),filtered:ChangeDesc.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],n=this.sections[t+1];n<0?e.push(i):0==n?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let n=[],r=[],s=0,o=null;function a(e=!1){if(!e&&!n.length)return;s<t&&addSection(n,t-s,-1);let i=new ChangeSet(n,r);o=o?o.compose(i.map(o)):i,n=[],r=[],s=0}return function e(l){if(Array.isArray(l))for(let t of l)e(t);else if(l instanceof ChangeSet){if(l.length!=t)throw new RangeError(`Mismatched change set length (got ${l.length}, expected ${t})`);a(),o=o?o.compose(l.map(o)):l}else{let{from:e,to:o=e,insert:c}=l;if(e>o||e<0||o>t)throw new RangeError(`Invalid change range ${e} to ${o} (in doc of length ${t})`);let h=c?"string"==typeof c?Text.of(c.split(i||DefaultSplit)):c:Text.empty,u=h.length;if(e==o&&0==u)return;e<s&&a(),e>s&&addSection(n,e-s,-1),addSection(n,o-e,u),addInsert(r,n,h),s=o}}(e),a(!o),o}static empty(e){return new ChangeSet(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let n=0;n<e.length;n++){let r=e[n];if("number"==typeof r)t.push(r,-1);else{if(!Array.isArray(r)||"number"!=typeof r[0]||r.some((e,t)=>t&&"string"!=typeof e))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==r.length)t.push(r[0],0);else{for(;i.length<n;)i.push(Text.empty);i[n]=Text.of(r.slice(1)),t.push(r[0],i[n].length)}}}return new ChangeSet(t,i)}static createSet(e,t){return new ChangeSet(e,t)}}function addSection(e,t,i,n=!1){if(0==t&&i<=0)return;let r=e.length-2;r>=0&&i<=0&&i==e[r+1]?e[r]+=t:r>=0&&0==t&&0==e[r]?e[r+1]+=i:n?(e[r]+=t,e[r+1]+=i):e.push(t,i)}function addInsert(e,t,i){if(0==i.length)return;let n=t.length-2>>1;if(n<e.length)e[e.length-1]=e[e.length-1].append(i);else{for(;e.length<n;)e.push(Text.empty);e.push(i)}}function iterChanges(e,t,i){let n=e.inserted;for(let r=0,s=0,o=0;o<e.sections.length;){let a=e.sections[o++],l=e.sections[o++];if(l<0)r+=a,s+=a;else{let c=r,h=s,u=Text.empty;for(;c+=a,h+=l,l&&n&&(u=u.append(n[o-2>>1])),!(i||o==e.sections.length||e.sections[o+1]<0);)a=e.sections[o++],l=e.sections[o++];t(r,c,s,h,u),r=c,s=h}}}function mapSet(e,t,i,n=!1){let r=[],s=n?[]:null,o=new SectionIter(e),a=new SectionIter(t);for(let l=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(-1==o.ins&&-1==a.ins){let e=Math.min(o.len,a.len);addSection(r,e,-1),o.forward(e),a.forward(e)}else if(a.ins>=0&&(o.ins<0||l==o.i||0==o.off&&(a.len<o.len||a.len==o.len&&!i))){let e=a.len;for(addSection(r,a.ins,-1);e;){let t=Math.min(o.len,e);o.ins>=0&&l<o.i&&o.len<=t&&(addSection(r,0,o.ins),s&&addInsert(s,r,o.text),l=o.i),o.forward(t),e-=t}a.next()}else{if(!(o.ins>=0)){if(o.done&&a.done)return s?ChangeSet.createSet(r,s):ChangeDesc.create(r);throw new Error("Mismatched change set lengths")}{let e=0,t=o.len;for(;t;)if(-1==a.ins){let i=Math.min(t,a.len);e+=i,t-=i,a.forward(i)}else{if(!(0==a.ins&&a.len<t))break;t-=a.len,a.next()}addSection(r,e,l<o.i?o.ins:0),s&&l<o.i&&addInsert(s,r,o.text),l=o.i,o.forward(o.len-t)}}}}function composeSets(e,t,i=!1){let n=[],r=i?[]:null,s=new SectionIter(e),o=new SectionIter(t);for(let a=!1;;){if(s.done&&o.done)return r?ChangeSet.createSet(n,r):ChangeDesc.create(n);if(0==s.ins)addSection(n,s.len,0,a),s.next();else if(0!=o.len||o.done){if(s.done||o.done)throw new Error("Mismatched change set lengths");{let e=Math.min(s.len2,o.len),t=n.length;if(-1==s.ins){let t=-1==o.ins?-1:o.off?0:o.ins;addSection(n,e,t,a),r&&t&&addInsert(r,n,o.text)}else-1==o.ins?(addSection(n,s.off?0:s.len,e,a),r&&addInsert(r,n,s.textBit(e))):(addSection(n,s.off?0:s.len,o.off?0:o.ins,a),r&&!o.off&&addInsert(r,n,o.text));a=(s.ins>e||o.ins>=0&&o.len>e)&&(a||n.length>t),s.forward2(e),o.forward(e)}}else addSection(n,0,o.ins,a),r&&addInsert(r,n,o.text),o.next()}}class SectionIter{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?Text.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?Text.empty:t[i].slice(this.off,null==e?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){-1==this.ins?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class SelectionRange{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return 32&this.flags?this.to:this.from}get head(){return 32&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 8&this.flags?-1:16&this.flags?1:0}get bidiLevel(){let e=7&this.flags;return 7==e?null:e}get goalColumn(){let e=this.flags>>6;return 16777215==e?void 0:e}map(e,t=-1){let i,n;return this.empty?i=n=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new SelectionRange(i,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return EditorSelection.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return EditorSelection.range(this.anchor,i)}eq(e,t=!1){return!(this.anchor!=e.anchor||this.head!=e.head||t&&this.empty&&this.assoc!=e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||"number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)}static create(e,t,i){return new SelectionRange(e,t,i)}}class EditorSelection{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:EditorSelection.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new EditorSelection([this.main],0)}addRange(e,t=!0){return EditorSelection.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,EditorSelection.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||"number"!=typeof e.main||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(e.ranges.map(e=>SelectionRange.fromJSON(e)),e.main)}static single(e,t=e){return new EditorSelection([EditorSelection.range(e,t)],0)}static create(e,t=0){if(0==e.length)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<e.length;n++){let r=e[n];if(r.empty?r.from<=i:r.from<i)return EditorSelection.normalized(e.slice(),t);i=r.to}return new EditorSelection(e,t)}static cursor(e,t=0,i,n){return SelectionRange.create(e,e,(0==t?0:t<0?8:16)|(null==i?7:Math.min(6,i))|(null!=n?n:16777215)<<6)}static range(e,t,i,n){let r=(null!=i?i:16777215)<<6|(null==n?7:Math.min(6,n));return t<e?SelectionRange.create(t,e,48|r):SelectionRange.create(e,t,(t>e?8:0)|r)}static normalized(e,t=0){let i=e[t];e.sort((e,t)=>e.from-t.from),t=e.indexOf(i);for(let n=1;n<e.length;n++){let i=e[n],r=e[n-1];if(i.empty?i.from<=r.to:i.from<r.to){let s=r.from,o=Math.max(i.to,r.to);n<=t&&t--,e.splice(--n,2,i.anchor>i.head?EditorSelection.range(o,s):EditorSelection.range(s,o))}}return new EditorSelection(e,t)}}function checkSelection(e,t){for(let i of e.ranges)if(i.to>t)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(e,t,i,n,r){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=n,this.id=nextID++,this.default=e([]),this.extensions="function"==typeof r?r(this):r}get reader(){return this}static define(e={}){return new Facet(e.combine||(e=>e),e.compareInput||((e,t)=>e===t),e.compare||(e.combine?(e,t)=>e===t:sameArray$1),!!e.static,e.enables)}of(e){return new FacetProvider([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,t)}from(e,t){return t||(t=e=>e),this.compute([e],i=>t(i.field(e)))}}function sameArray$1(e,t){return e==t||e.length==t.length&&e.every((e,i)=>e===t[i])}class FacetProvider{constructor(e,t,i,n){this.dependencies=e,this.facet=t,this.type=i,this.value=n,this.id=nextID++}dynamicSlot(e){var t;let i=this.value,n=this.facet.compareInput,r=this.id,s=e[r]>>1,o=2==this.type,a=!1,l=!1,c=[];for(let h of this.dependencies)"doc"==h?a=!0:"selection"==h?l=!0:1&(null!==(t=e[h.id])&&void 0!==t?t:1)||c.push(e[h.id]);return{create:e=>(e.values[s]=i(e),1),update(e,t){if(a&&t.docChanged||l&&(t.docChanged||t.selection)||ensureAll(e,c)){let t=i(e);if(o?!compareArray(t,e.values[s],n):!n(t,e.values[s]))return e.values[s]=t,1}return 0},reconfigure:(e,t)=>{let a,l=t.config.address[r];if(null!=l){let r=getAddr(t,l);if(this.dependencies.every(i=>i instanceof Facet?t.facet(i)===e.facet(i):!(i instanceof StateField)||t.field(i,!1)==e.field(i,!1))||(o?compareArray(a=i(e),r,n):n(a=i(e),r)))return e.values[s]=r,0}else a=i(e);return e.values[s]=a,1}}}}function compareArray(e,t,i){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1;return!0}function ensureAll(e,t){let i=!1;for(let n of t)1&ensureAddr(e,n)&&(i=!0);return i}function dynamicFacetSlot(e,t,i){let n=i.map(t=>e[t.id]),r=i.map(e=>e.type),s=n.filter(e=>!(1&e)),o=e[t.id]>>1;function a(e){let i=[];for(let t=0;t<n.length;t++){let s=getAddr(e,n[t]);if(2==r[t])for(let e of s)i.push(e);else i.push(s)}return t.combine(i)}return{create(e){for(let t of n)ensureAddr(e,t);return e.values[o]=a(e),1},update(e,i){if(!ensureAll(e,s))return 0;let n=a(e);return t.compare(n,e.values[o])?0:(e.values[o]=n,1)},reconfigure(e,r){let s=ensureAll(e,n),l=r.config.facets[t.id],c=r.facet(t);if(l&&!s&&sameArray$1(i,l))return e.values[o]=c,0;let h=a(e);return t.compare(h,c)?(e.values[o]=c,0):(e.values[o]=h,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(e,t,i,n,r){this.id=e,this.createF=t,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(e){let t=new StateField(nextID++,e.create,e.update,e.compare||((e,t)=>e===t),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(initField).find(e=>e.field==this);return((null==t?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:e=>(e.values[t]=this.create(e),1),update:(e,i)=>{let n=e.values[t],r=this.updateF(n,i);return this.compareF(n,r)?0:(e.values[t]=r,1)},reconfigure:(e,i)=>{let n,r=e.facet(initField),s=i.facet(initField);return(n=r.find(e=>e.field==this))&&n!=s.find(e=>e.field==this)?(e.values[t]=n.create(e),1):null!=i.config.address[this.id]?(e.values[t]=i.field(this),0):(e.values[t]=this.create(e),1)}}}init(e){return[this,initField.of({field:this,create:e})]}get extension(){return this}}const Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(e){return t=>new PrecExtension(t,e)}const Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),default:prec(Prec_.default),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};class PrecExtension{constructor(e,t){this.inner=e,this.prec=t}}class Compartment{of(e){return new CompartmentInstance(this,e)}reconfigure(e){return Compartment.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class CompartmentInstance{constructor(e,t){this.compartment=e,this.inner=t}}class Configuration{constructor(e,t,i,n,r,s){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=s,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return null==t?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let n=[],r=Object.create(null),s=new Map;for(let u of flatten(e,t,s))u instanceof StateField?n.push(u):(r[u.facet.id]||(r[u.facet.id]=[])).push(u);let o=Object.create(null),a=[],l=[];for(let u of n)o[u.id]=l.length<<1,l.push(e=>u.slot(e));let c=null==i?void 0:i.config.facets;for(let u in r){let e=r[u],t=e[0].facet,n=c&&c[u]||[];if(e.every(e=>0==e.type))if(o[t.id]=a.length<<1|1,sameArray$1(n,e))a.push(i.facet(t));else{let n=t.combine(e.map(e=>e.value));a.push(i&&t.compare(n,i.facet(t))?i.facet(t):n)}else{for(let t of e)0==t.type?(o[t.id]=a.length<<1|1,a.push(t.value)):(o[t.id]=l.length<<1,l.push(e=>t.dynamicSlot(e)));o[t.id]=l.length<<1,l.push(i=>dynamicFacetSlot(i,t,e))}}let h=l.map(e=>e(o));return new Configuration(e,s,h,o,a,r)}}function flatten(e,t,i){let n=[[],[],[],[],[]],r=new Map;return function e(s,o){let a=r.get(s);if(null!=a){if(a<=o)return;let e=n[a].indexOf(s);e>-1&&n[a].splice(e,1),s instanceof CompartmentInstance&&i.delete(s.compartment)}if(r.set(s,o),Array.isArray(s))for(let t of s)e(t,o);else if(s instanceof CompartmentInstance){if(i.has(s.compartment))throw new RangeError("Duplicate use of compartment in extensions");let n=t.get(s.compartment)||s.inner;i.set(s.compartment,n),e(n,o)}else if(s instanceof PrecExtension)e(s.inner,s.prec);else if(s instanceof StateField)n[o].push(s),s.provides&&e(s.provides,o);else if(s instanceof FacetProvider)n[o].push(s),s.facet.extensions&&e(s.facet.extensions,Prec_.default);else{let t=s.extension;if(!t)throw new Error(`Unrecognized extension value in extension set (${s}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);e(t,o)}}(e,Prec_.default),n.reduce((e,t)=>e.concat(t))}function ensureAddr(e,t){if(1&t)return 2;let i=t>>1,n=e.status[i];if(4==n)throw new Error("Cyclic dependency between fields and/or facets");if(2&n)return n;e.status[i]=4;let r=e.computeSlot(e,e.config.dynamicSlots[i]);return e.status[i]=2|r}function getAddr(e,t){return 1&t?e.config.staticValues[t>>1]:e.values[t>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:e=>e.some(e=>e),static:!0}),lineSeparator=Facet.define({combine:e=>e.length?e[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:e=>!!e.length&&e[0]});class Annotation{constructor(e,t){this.type=e,this.value=t}static define(){return new AnnotationType}}class AnnotationType{of(e){return new Annotation(this,e)}}class StateEffectType{constructor(e){this.map=e}of(e){return new StateEffect(this,e)}}class StateEffect{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return void 0===t?void 0:t==this.value?this:new StateEffect(this.type,t)}is(e){return this.type==e}static define(e={}){return new StateEffectType(e.map||(e=>e))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let n of e){let e=n.map(t);e&&i.push(e)}return i}}StateEffect.reconfigure=StateEffect.define(),StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(e,t,i,n,r,s){this.startState=e,this.changes=t,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=s,this._doc=null,this._state=null,i&&checkSelection(i,t.newLength),r.some(e=>e.type==Transaction.time)||(this.annotations=r.concat(Transaction.time.of(Date.now())))}static create(e,t,i,n,r,s){return new Transaction(e,t,i,n,r,s)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Transaction.userEvent);return!(!t||!(t==e||t.length>e.length&&t.slice(0,e.length)==e&&"."==t[e.length]))}}function joinRanges(e,t){let i=[];for(let n=0,r=0;;){let s,o;if(n<e.length&&(r==t.length||t[r]>=e[n]))s=e[n++],o=e[n++];else{if(!(r<t.length))return i;s=t[r++],o=t[r++]}!i.length||i[i.length-1]<s?i.push(s,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function mergeTransaction(e,t,i){var n;let r,s,o;return i?(r=t.changes,s=ChangeSet.empty(t.changes.length),o=e.changes.compose(t.changes)):(r=t.changes.map(e.changes),s=e.changes.mapDesc(t.changes,!0),o=e.changes.compose(r)),{changes:o,selection:t.selection?t.selection.map(s):null===(n=e.selection)||void 0===n?void 0:n.map(r),effects:StateEffect.mapEffects(e.effects,r).concat(StateEffect.mapEffects(t.effects,s)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function resolveTransactionInner(e,t,i){let n=t.selection,r=asArray$1(t.annotations);return t.userEvent&&(r=r.concat(Transaction.userEvent.of(t.userEvent))),{changes:t.changes instanceof ChangeSet?t.changes:ChangeSet.of(t.changes||[],i,e.facet(lineSeparator)),selection:n&&(n instanceof EditorSelection?n:EditorSelection.single(n.anchor,n.head)),effects:asArray$1(t.effects),annotations:r,scrollIntoView:!!t.scrollIntoView}}function resolveTransaction(e,t,i){let n=resolveTransactionInner(e,t.length?t[0]:{},e.doc.length);t.length&&!1===t[0].filter&&(i=!1);for(let s=1;s<t.length;s++){!1===t[s].filter&&(i=!1);let r=!!t[s].sequential;n=mergeTransaction(n,resolveTransactionInner(e,t[s],r?n.changes.newLength:e.doc.length),r)}let r=Transaction.create(e,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return extendTransaction(i?filterTransaction(r):r)}function filterTransaction(e){let t=e.startState,i=!0;for(let r of t.facet(changeFilter)){let t=r(e);if(!1===t){i=!1;break}Array.isArray(t)&&(i=!0===i?t:joinRanges(i,t))}if(!0!==i){let n,r;if(!1===i)r=e.changes.invertedDesc,n=ChangeSet.empty(t.doc.length);else{let t=e.changes.filter(i);n=t.changes,r=t.filtered.mapDesc(t.changes).invertedDesc}e=Transaction.create(t,n,e.selection&&e.selection.map(r),StateEffect.mapEffects(e.effects,r),e.annotations,e.scrollIntoView)}let n=t.facet(transactionFilter);for(let r=n.length-1;r>=0;r--){let i=n[r](e);e=i instanceof Transaction?i:Array.isArray(i)&&1==i.length&&i[0]instanceof Transaction?i[0]:resolveTransaction(t,asArray$1(i),!1)}return e}function extendTransaction(e){let t=e.startState,i=t.facet(transactionExtender),n=e;for(let r=i.length-1;r>=0;r--){let s=i[r](e);s&&Object.keys(s).length&&(n=mergeTransaction(n,resolveTransactionInner(t,s,e.changes.newLength),!0))}return n==e?e:Transaction.create(t,e.changes,e.selection,n.effects,n.annotations,n.scrollIntoView)}Transaction.time=Annotation.define(),Transaction.userEvent=Annotation.define(),Transaction.addToHistory=Annotation.define(),Transaction.remote=Annotation.define();const none$2=[];function asArray$1(e){return null==e?none$2:Array.isArray(e)?e:[e]}var CharCategory=function(e){return e[e.Word=0]="Word",e[e.Space=1]="Space",e[e.Other=2]="Other",e}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(_2){}function hasWordChar(e){if(wordChar)return wordChar.test(e);for(let t=0;t<e.length;t++){let i=e[t];if(/\w/.test(i)||i>"¬Ä"&&(i.toUpperCase()!=i.toLowerCase()||nonASCIISingleCaseWordChar.test(i)))return!0}return!1}function makeCategorizer(e){return t=>{if(!/\S/.test(t))return CharCategory.Space;if(hasWordChar(t))return CharCategory.Word;for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(e,t,i,n,r,s){this.config=e,this.doc=t,this.selection=i,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=r,s&&(s._state=this);for(let o=0;o<this.config.dynamicSlots.length;o++)ensureAddr(this,o<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(null!=i)return ensureAddr(this,i),getAddr(this,i);if(t)throw new RangeError("Field is not present in this state")}update(...e){return resolveTransaction(this,e,!0)}applyTransaction(e){let t,i=this.config,{base:n,compartments:r}=i;for(let o of e.effects)o.is(Compartment.reconfigure)?(i&&(r=new Map,i.compartments.forEach((e,t)=>r.set(t,e)),i=null),r.set(o.value.compartment,o.value.extension)):o.is(StateEffect.reconfigure)?(i=null,n=o.value):o.is(StateEffect.appendConfig)&&(i=null,n=asArray$1(n).concat(o.value));if(i)t=e.startState.values.slice();else{i=Configuration.resolve(n,r,this),t=new EditorState(i,this.doc,this.selection,i.dynamicSlots.map(()=>null),(e,t)=>t.reconfigure(e,this),null).values}let s=e.startState.facet(allowMultipleSelections)?e.newSelection:e.newSelection.asSingle();new EditorState(i,e.newDoc,s,t,(t,i)=>i.update(t,e),e)}replaceSelection(e){return"string"==typeof e&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:EditorSelection.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),n=this.changes(i.changes),r=[i.range],s=asArray$1(i.effects);for(let o=1;o<t.ranges.length;o++){let i=e(t.ranges[o]),a=this.changes(i.changes),l=a.map(n);for(let e=0;e<o;e++)r[e]=r[e].map(l);let c=n.mapDesc(a,!0);r.push(i.range.map(c)),n=n.compose(l),s=StateEffect.mapEffects(s,l).concat(StateEffect.mapEffects(asArray$1(i.effects),c))}return{changes:n,selection:EditorSelection.create(r,t.mainIndex),effects:s}}changes(e=[]){return e instanceof ChangeSet?e:ChangeSet.of(e,this.doc.length,this.facet(EditorState.lineSeparator))}toText(e){return Text.of(e.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return null==t?e.default:(ensureAddr(this,t),getAddr(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let n=e[i];n instanceof StateField&&null!=this.config.address[n.id]&&(t[i]=n.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||"string"!=typeof e.doc)throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let r in i)if(Object.prototype.hasOwnProperty.call(e,r)){let t=i[r],s=e[r];n.push(t.init(e=>t.spec.fromJSON(s,e)))}return EditorState.create({doc:e.doc,selection:EditorSelection.fromJSON(e.selection),extensions:t.extensions?n.concat([t.extensions]):n})}static create(e={}){let t=Configuration.resolve(e.extensions||[],new Map),i=e.doc instanceof Text?e.doc:Text.of((e.doc||"").split(t.staticFacet(EditorState.lineSeparator)||DefaultSplit)),n=e.selection?e.selection instanceof EditorSelection?e.selection:EditorSelection.single(e.selection.anchor,e.selection.head):EditorSelection.single(0);return checkSelection(n,i.length),t.staticFacet(allowMultipleSelections)||(n=n.asSingle()),new EditorState(t,i,n,t.dynamicSlots.map(()=>null),(e,t)=>t.create(e),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||"\n"}get readOnly(){return this.facet(readOnly)}phrase(e,...t){for(let i of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(i,e)){e=i[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(e,i)=>{if("$"==i)return"$";let n=+(i||1);return!n||n>t.length?e:t[n-1]})),e}languageDataAt(e,t,i=-1){let n=[];for(let r of this.facet(languageData))for(let s of r(this,t,i))Object.prototype.hasOwnProperty.call(s,e)&&n.push(s[e]);return n}charCategorizer(e){return makeCategorizer(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:n}=this.doc.lineAt(e),r=this.charCategorizer(e),s=e-i,o=e-i;for(;s>0;){let e=findClusterBreak(t,s,!1);if(r(t.slice(e,s))!=CharCategory.Word)break;s=e}for(;o<n;){let e=findClusterBreak(t,o);if(r(t.slice(o,e))!=CharCategory.Word)break;o=e}return s==o?null:EditorSelection.range(s+i,o+i)}}function combineConfig(e,t,i={}){let n={};for(let r of e)for(let e of Object.keys(r)){let t=r[e],s=n[e];if(void 0===s)n[e]=t;else if(s===t||void 0===t);else{if(!Object.hasOwnProperty.call(i,e))throw new Error("Config merge conflict for field "+e);n[e]=i[e](s,t)}}for(let r in t)void 0===n[r]&&(n[r]=t[r]);return n}EditorState.allowMultipleSelections=allowMultipleSelections,EditorState.tabSize=Facet.define({combine:e=>e.length?e[0]:4}),EditorState.lineSeparator=lineSeparator,EditorState.readOnly=readOnly,EditorState.phrases=Facet.define({compare(e,t){let i=Object.keys(e),n=Object.keys(t);return i.length==n.length&&i.every(i=>e[i]==t[i])}}),EditorState.languageData=languageData,EditorState.changeFilter=changeFilter,EditorState.transactionFilter=transactionFilter,EditorState.transactionExtender=transactionExtender,Compartment.reconfigure=StateEffect.define();class RangeValue{eq(e){return this==e}range(e,t=e){return Range$1.create(e,t,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0,RangeValue.prototype.point=!1,RangeValue.prototype.mapMode=MapMode.TrackDel;let Range$1=class e{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(t,i,n){return new e(t,i,n)}};function cmpRange(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}class Chunk{constructor(e,t,i,n){this.from=e,this.to=t,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,n=0){let r=i?this.to:this.from;for(let s=n,o=r.length;;){if(s==o)return s;let n=s+o>>1,a=r[n]-e||(i?this.value[n].endSide:this.value[n].startSide)-t;if(n==s)return a>=0?s:o;a>=0?o=n:s=n+1}}between(e,t,i,n){for(let r=this.findIndex(t,-1e9,!0),s=this.findIndex(i,1e9,!1,r);r<s;r++)if(!1===n(this.from[r]+e,this.to[r]+e,this.value[r]))return!1}map(e,t){let i=[],n=[],r=[],s=-1,o=-1;for(let a=0;a<this.value.length;a++){let l,c,h=this.value[a],u=this.from[a]+e,d=this.to[a]+e;if(u==d){let e=t.mapPos(u,h.startSide,h.mapMode);if(null==e)continue;if(l=c=e,h.startSide!=h.endSide&&(c=t.mapPos(u,h.endSide),c<l))continue}else if(l=t.mapPos(u,h.startSide),c=t.mapPos(d,h.endSide),l>c||l==c&&h.startSide>0&&h.endSide<=0)continue;(c-l||h.endSide-h.startSide)<0||(s<0&&(s=l),h.point&&(o=Math.max(o,c-l)),i.push(h),n.push(l-s),r.push(c-s))}return{mapped:i.length?new Chunk(n,r,i,o):null,pos:s}}}class RangeSet{constructor(e,t,i,n){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=n}static create(e,t,i,n){return new RangeSet(e,t,i,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=e,s=e.filter;if(0==t.length&&!s)return this;if(i&&(t=t.slice().sort(cmpRange)),this.isEmpty)return t.length?RangeSet.of(t):this;let o=new LayerCursor(this,null,-1).goto(0),a=0,l=[],c=new RangeSetBuilder;for(;o.value||a<t.length;)if(a<t.length&&(o.from-t[a].from||o.startSide-t[a].value.startSide)>=0){let e=t[a++];c.addInner(e.from,e.to,e.value)||l.push(e)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(o.chunkIndex)<t[a].from)&&(!s||n>this.chunkEnd(o.chunkIndex)||r<this.chunkPos[o.chunkIndex])&&c.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!s||n>o.to||r<o.from||s(o.from,o.to,o.value))&&(c.addInner(o.from,o.to,o.value)||l.push(Range$1.create(o.from,o.to,o.value))),o.next());return c.finishInner(this.nextLayer.isEmpty&&!l.length?RangeSet.empty:this.nextLayer.update({add:l,filter:s,filterFrom:n,filterTo:r}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],n=-1;for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],o=this.chunk[s],a=e.touchesRange(r,r+o.length);if(!1===a)n=Math.max(n,o.maxPoint),t.push(o),i.push(e.mapPos(r));else if(!0===a){let{mapped:s,pos:a}=o.map(r,e);s&&(n=Math.max(n,s.maxPoint),t.push(s),i.push(a))}}let r=this.nextLayer.map(e);return 0==t.length?r:new RangeSet(i,t,r||RangeSet.empty,n)}between(e,t,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],s=this.chunk[n];if(t>=r&&e<=r+s.length&&!1===s.between(r,e-r,t-r,i))return}this.nextLayer.between(e,t,i)}}iter(e=0){return HeapCursor.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return HeapCursor.from(e).goto(t)}static compare(e,t,i,n,r=-1){let s=e.filter(e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=r),o=t.filter(e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=r),a=findSharedChunks(s,o,i),l=new SpanCursor(s,a,r),c=new SpanCursor(o,a,r);i.iterGaps((e,t,i)=>compare(l,e,c,t,i,n)),i.empty&&0==i.length&&compare(l,0,c,0,0,n)}static eq(e,t,i=0,n){null==n&&(n=999999999);let r=e.filter(e=>!e.isEmpty&&t.indexOf(e)<0),s=t.filter(t=>!t.isEmpty&&e.indexOf(t)<0);if(r.length!=s.length)return!1;if(!r.length)return!0;let o=findSharedChunks(r,s),a=new SpanCursor(r,o,0).goto(i),l=new SpanCursor(s,o,0).goto(i);for(;;){if(a.to!=l.to||!sameValues(a.active,l.active)||a.point&&(!l.point||!a.point.eq(l.point)))return!1;if(a.to>n)return!0;a.next(),l.next()}}static spans(e,t,i,n,r=-1){let s=new SpanCursor(e,null,r).goto(t),o=t,a=s.openStart;for(;;){let e=Math.min(s.to,i);if(s.point){let i=s.activeForPoint(s.to),r=s.pointFrom<t?i.length+1:s.point.startSide<0?i.length:Math.min(i.length,a);n.point(o,e,s.point,i,r,s.pointRank),a=Math.min(s.openEnd(e),i.length)}else e>o&&(n.span(o,e,s.active,a),a=s.openEnd(e));if(s.to>i)return a+(s.point&&s.to>i?1:0);o=s.to,s.next()}}static of(e,t=!1){let i=new RangeSetBuilder;for(let n of e instanceof Range$1?[e]:t?lazySort(e):e)i.add(n.from,n.to,n.value);return i.finish()}static join(e){if(!e.length)return RangeSet.empty;let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)for(let n=e[i];n!=RangeSet.empty;n=n.nextLayer)t=new RangeSet(n.chunkPos,n.chunk,t,Math.max(n.maxPoint,t.maxPoint));return t}}function lazySort(e){if(e.length>1)for(let t=e[0],i=1;i<e.length;i++){let n=e[i];if(cmpRange(t,n)>0)return e.slice().sort(cmpRange);t=n}return e}RangeSet.empty=new RangeSet([],[],null,-1),RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{finishChunk(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(e,t,i)}addInner(e,t,i){let n=e-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(n<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return e;let t=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function findSharedChunks(e,t,i){let n=new Map;for(let s of e)for(let e=0;e<s.chunk.length;e++)s.chunk[e].maxPoint<=0&&n.set(s.chunk[e],s.chunkPos[e]);let r=new Set;for(let s of t)for(let e=0;e<s.chunk.length;e++){let t=n.get(s.chunk[e]);null==t||(i?i.mapPos(t):t)!=s.chunkPos[e]||(null==i?void 0:i.touchesRange(t,t+s.chunk[e].length))||r.add(s.chunk[e])}return r}class LayerCursor{constructor(e,t,i,n=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let t=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(t)||this.layer.chunkEnd(this.chunkIndex)<e||t.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class HeapCursor{constructor(e){this.heap=e}static from(e,t=null,i=-1){let n=[];for(let r=0;r<e.length;r++)for(let s=e[r];!s.isEmpty;s=s.nextLayer)s.maxPoint>=i&&n.push(new LayerCursor(s,t,i,r));return 1==n.length?n[0]:new HeapCursor(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)heapBubble(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)heapBubble(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),heapBubble(this.heap,0)}}}function heapBubble(e,t){for(let i=e[t];;){let n=1+(t<<1);if(n>=e.length)break;let r=e[n];if(n+1<e.length&&r.compare(e[n+1])>=0&&(r=e[n+1],n++),i.compare(r)<0)break;e[n]=i,e[t]=r,t=n}}class SpanCursor{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){remove(this.active,e),remove(this.activeTo,e),remove(this.activeRank,e),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:n,rank:r}=this.cursor;for(;t<this.activeRank.length&&(r-this.activeRank[t]||n-this.activeTo[t])>0;)t++;insert(this.active,t,i),insert(this.activeTo,t,n),insert(this.activeRank,t,r),e&&insert(e,t,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&remove(i,n)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let e=this.cursor.value;if(e.point){if(!(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=e,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=e.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){this.openStart=0;for(let t=i.length-1;t>=0&&i[t]<e;t--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function compare(e,t,i,n,r,s){e.goto(t),i.goto(n);let o=n+r,a=n,l=n-t;for(;;){let t=e.to+l-i.to,n=t||e.endSide-i.endSide,r=n<0?e.to+l:i.to,c=Math.min(r,o);if(e.point||i.point?e.point&&i.point&&(e.point==i.point||e.point.eq(i.point))&&sameValues(e.activeForPoint(e.to),i.activeForPoint(i.to))||s.comparePoint(a,c,e.point,i.point):c>a&&!sameValues(e.active,i.active)&&s.compareRange(a,c,e.active,i.active),r>o)break;(t||e.openEnd!=i.openEnd)&&s.boundChange&&s.boundChange(r),a=r,n<=0&&e.next(),n>=0&&i.next()}}function sameValues(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i]&&!e[i].eq(t[i]))return!1;return!0}function remove(e,t){for(let i=t,n=e.length-1;i<n;i++)e[i]=e[i+1];e.pop()}function insert(e,t,i){for(let n=e.length-1;n>=t;n--)e[n+1]=e[n];e[t]=i}function findMinIndex(e,t){let i=-1,n=1e9;for(let r=0;r<t.length;r++)(t[r]-n||e[r].endSide-e[i].endSide)<0&&(i=r,n=t[r]);return i}function countColumn(e,t,i=e.length){let n=0;for(let r=0;r<i&&r<e.length;)9==e.charCodeAt(r)?(n+=t-n%t,r++):(n++,r=findClusterBreak(e,r));return n}function findColumn(e,t,i,n){for(let r=0,s=0;;){if(s>=t)return r;if(r==e.length)break;s+=9==e.charCodeAt(r)?i-s%i:1,r=findClusterBreak(e,r)}return!0===n?-1:e.length}const C$1="Õº",COUNT="undefined"==typeof Symbol?"__"+C$1:Symbol.for(C$1),SET="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),top="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class StyleModule{constructor(e,t){this.rules=[];let{finish:i}=t||{};function n(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function r(e,t,s,o){let a=[],l=/^@(\w+)\b/.exec(e[0]),c=l&&"keyframes"==l[1];if(l&&null==t)return s.push(e[0]+";");for(let i in t){let o=t[i];if(/&/.test(i))r(i.split(/,\s*/).map(t=>e.map(e=>t.replace(/&/,e))).reduce((e,t)=>e.concat(t)),o,s);else if(o&&"object"==typeof o){if(!l)throw new RangeError("The value of a property ("+i+") should be a primitive value.");r(n(i),o,a,c)}else null!=o&&a.push(i.replace(/_.*/,"").replace(/[A-Z]/g,e=>"-"+e.toLowerCase())+": "+o+";")}(a.length||c)&&s.push((!i||l||o?e:e.map(i)).join(", ")+" {"+a.join(" ")+"}")}for(let s in e)r(n(s),e[s],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let e=top[COUNT]||1;return top[COUNT]=e+1,C$1+e.toString(36)}static mount(e,t,i){let n=e[SET],r=i&&i.nonce;n?r&&n.setNonce(r):n=new StyleSet(e,r),n.mount(Array.isArray(t)?t:[t],e)}}let adoptedSet=new Map;class StyleSet{constructor(e,t){let i=e.ownerDocument||e,n=i.defaultView;if(!e.head&&e.adoptedStyleSheets&&n.CSSStyleSheet){let t=adoptedSet.get(i);if(t)return e[SET]=t;this.sheet=new n.CSSStyleSheet,adoptedSet.set(i,this)}else this.styleTag=i.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[SET]=this}mount(e,t){let i=this.sheet,n=0,r=0;for(let s=0;s<e.length;s++){let t=e[s],o=this.modules.indexOf(t);if(o<r&&o>-1&&(this.modules.splice(o,1),r--,o=-1),-1==o){if(this.modules.splice(r++,0,t),i)for(let e=0;e<t.rules.length;e++)i.insertRule(t.rules[e],n++)}else{for(;r<o;)n+=this.modules[r++].rules.length;n+=t.rules.length,r++}}if(i)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let e="";for(let t=0;t<this.modules.length;t++)e+=this.modules[t].getRules()+"\n";this.styleTag.textContent=e;let i=t.head||t;this.styleTag.parentNode!=i&&i.insertBefore(this.styleTag,i.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}for(var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ie$1="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(var i=1;i<=24;i++)base[i+111]="F"+i;for(var i=65;i<=90;i++)base[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function keyName(e){var t=!(mac&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||ie$1&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?shift:base)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}function crelt(){var e=arguments[0];"string"==typeof e&&(e=document.createElement(e));var t=1,i=arguments[1];if(i&&"object"==typeof i&&null==i.nodeType&&!Array.isArray(i)){for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var r=i[n];"string"==typeof r?e.setAttribute(n,r):null!=r&&(e[n]=r)}t++}for(;t<arguments.length;t++)add(e,arguments[t]);return e}function add(e,t){if("string"==typeof t)e.appendChild(document.createTextNode(t));else if(null==t);else if(null!=t.nodeType)e.appendChild(t);else{if(!Array.isArray(t))throw new RangeError("Unsupported child node: "+t);for(var i=0;i<t.length;i++)add(e,t[i])}}let nav="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},doc="undefined"!=typeof document?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie:ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko:gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios:ios,android:/Android\b/.test(nav.userAgent),webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,safari:safari,safari_version:safari?+(/\bVersion\/(\d+(\.\d+)?)/.exec(nav.userAgent)||[0,0])[1]:0,tabSize:null!=doc.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};function getSelection(e){let t;return t=11==e.nodeType?e.getSelection?e:e.ownerDocument:e,t.getSelection()}function contains(e,t){return!!t&&(e==t||e.contains(1!=t.nodeType?t.parentNode:t))}function hasSelection(e,t){if(!t.anchorNode)return!1;try{return contains(e,t.anchorNode)}catch(_2){return!1}}function clientRectsFor(e){return 3==e.nodeType?textRange(e,0,e.nodeValue.length).getClientRects():1==e.nodeType?e.getClientRects():[]}function isEquivalentPosition(e,t,i,n){return!!i&&(scanFor(e,t,i,n,-1)||scanFor(e,t,i,n,1))}function domIndex(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t}function isBlockElement(e){return 1==e.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}function scanFor(e,t,i,n,r){for(;;){if(e==i&&t==n)return!0;if(t==(r<0?0:maxOffset(e))){if("DIV"==e.nodeName)return!1;let i=e.parentNode;if(!i||1!=i.nodeType)return!1;t=domIndex(e)+(r<0?0:1),e=i}else{if(1!=e.nodeType)return!1;if(1==(e=e.childNodes[t+(r<0?-1:0)]).nodeType&&"false"==e.contentEditable)return!1;t=r<0?maxOffset(e):0}}}function maxOffset(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function flattenRect(e,t){let i=t?e.left:e.right;return{left:i,right:i,top:e.top,bottom:e.bottom}}function windowRect(e){let t=e.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}function getScale(e,t){let i=t.width/e.offsetWidth,n=t.height/e.offsetHeight;return(i>.995&&i<1.005||!isFinite(i)||Math.abs(t.width-e.offsetWidth)<1)&&(i=1),(n>.995&&n<1.005||!isFinite(n)||Math.abs(t.height-e.offsetHeight)<1)&&(n=1),{scaleX:i,scaleY:n}}function scrollRectIntoView(e,t,i,n,r,s,o,a){let l=e.ownerDocument,c=l.defaultView||window;for(let h=e,u=!1;h&&!u;)if(1==h.nodeType){let e,d=h==l.body,p=1,f=1;if(d)e=windowRect(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(h).position)&&(u=!0),h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.assignedSlot||h.parentNode;continue}let t=h.getBoundingClientRect();({scaleX:p,scaleY:f}=getScale(h,t)),e={left:t.left,right:t.left+h.clientWidth*p,top:t.top,bottom:t.top+h.clientHeight*f}}let m=0,g=0;if("nearest"==r)t.top<e.top?(g=t.top-(e.top+o),i>0&&t.bottom>e.bottom+g&&(g=t.bottom-e.bottom+o)):t.bottom>e.bottom&&(g=t.bottom-e.bottom+o,i<0&&t.top-g<e.top&&(g=t.top-(e.top+o)));else{let n=t.bottom-t.top,s=e.bottom-e.top;g=("center"==r&&n<=s?t.top+n/2-s/2:"start"==r||"center"==r&&i<0?t.top-o:t.bottom-s+o)-e.top}if("nearest"==n)t.left<e.left?(m=t.left-(e.left+s),i>0&&t.right>e.right+m&&(m=t.right-e.right+s)):t.right>e.right&&(m=t.right-e.right+s,i<0&&t.left<e.left+m&&(m=t.left-(e.left+s)));else{m=("center"==n?t.left+(t.right-t.left)/2-(e.right-e.left)/2:"start"==n==a?t.left-s:t.right-(e.right-e.left)+s)-e.left}if(m||g)if(d)c.scrollBy(m,g);else{let e=0,i=0;if(g){let e=h.scrollTop;h.scrollTop+=g/f,i=(h.scrollTop-e)*f}if(m){let t=h.scrollLeft;h.scrollLeft+=m/p,e=(h.scrollLeft-t)*p}t={left:t.left-e,top:t.top-i,right:t.right-e,bottom:t.bottom-i},e&&Math.abs(e-m)<1&&(n="nearest"),i&&Math.abs(i-g)<1&&(r="nearest")}if(d)break;(t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right)&&(t={left:Math.max(t.left,e.left),right:Math.min(t.right,e.right),top:Math.max(t.top,e.top),bottom:Math.min(t.bottom,e.bottom)}),h=h.assignedSlot||h.parentNode}else{if(11!=h.nodeType)break;h=h.host}}function scrollableParents(e){let t,i,n=e.ownerDocument;for(let r=e.parentNode;r&&!(r==n.body||t&&i);)if(1==r.nodeType)!i&&r.scrollHeight>r.clientHeight&&(i=r),!t&&r.scrollWidth>r.clientWidth&&(t=r),r=r.assignedSlot||r.parentNode;else{if(11!=r.nodeType)break;r=r.host}return{x:t,y:i}}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?maxOffset(t):0),i,Math.min(e.focusOffset,i?maxOffset(i):0))}set(e,t,i,n){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=n}}let preventScrollSupported=null,scratchRange;function focusPreventScroll(e){if(e.setActive)return e.setActive();if(preventScrollSupported)return e.focus(preventScrollSupported);let t=[];for(let i=e;i&&(t.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(e.focus(null==preventScrollSupported?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],r=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}function textRange(e,t,i=t){let n=scratchRange||(scratchRange=document.createRange());return n.setEnd(e,i),n.setStart(e,t),n}function dispatchKey(e,t,i,n){let r={key:t,code:t,keyCode:i,which:i,cancelable:!0};n&&({altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey,metaKey:r.metaKey}=n);let s=new KeyboardEvent("keydown",r);s.synthetic=!0,e.dispatchEvent(s);let o=new KeyboardEvent("keyup",r);return o.synthetic=!0,e.dispatchEvent(o),s.defaultPrevented||o.defaultPrevented}function getRoot(e){for(;e;){if(e&&(9==e.nodeType||11==e.nodeType&&e.host))return e;e=e.assignedSlot||e.parentNode}return null}function clearAttributes(e){for(;e.attributes.length;)e.removeAttributeNode(e.attributes[0])}function atElementStart(e,t){let i=t.focusNode,n=t.focusOffset;if(!i||t.anchorNode!=i||t.anchorOffset!=n)return!1;for(n=Math.min(n,maxOffset(i));;)if(n){if(1!=i.nodeType)return!1;let e=i.childNodes[n-1];"false"==e.contentEditable?n--:(i=e,n=maxOffset(i))}else{if(i==e)return!0;n=domIndex(i),i=i.parentNode}}function isScrolledToBottom(e){return e.scrollTop>Math.max(1,e.scrollHeight-e.clientHeight-4)}function textNodeBefore(e,t){for(let i=e,n=t;;){if(3==i.nodeType&&n>0)return{node:i,offset:n};if(1==i.nodeType&&n>0){if("false"==i.contentEditable)return null;i=i.childNodes[n-1],n=maxOffset(i)}else{if(!i.parentNode||isBlockElement(i))return null;n=domIndex(i),i=i.parentNode}}}function textNodeAfter(e,t){for(let i=e,n=t;;){if(3==i.nodeType&&n<i.nodeValue.length)return{node:i,offset:n};if(1==i.nodeType&&n<i.childNodes.length){if("false"==i.contentEditable)return null;i=i.childNodes[n],n=0}else{if(!i.parentNode||isBlockElement(i))return null;n=domIndex(i)+1,i=i.parentNode}}}browser.safari&&browser.safari_version>=26&&(preventScrollSupported=!1);class DOMPos{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new DOMPos(e.parentNode,domIndex(e),t)}static after(e,t){return new DOMPos(e.parentNode,domIndex(e)+1,t)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(2&this.flags){let i,n=this.dom,r=null;for(let s of this.children){if(7&s.flags){if(!s.dom&&(i=r?r.nextSibling:n.firstChild)){let e=ContentView.get(i);(!e||!e.parent&&e.canReuseDOM(s))&&s.reuseDOM(i)}s.sync(e,t),s.flags&=-8}if(i=r?r.nextSibling:n.firstChild,t&&!t.written&&t.node==n&&i!=s.dom&&(t.written=!0),s.dom.parentNode==n)for(;i&&i!=s.dom;)i=rm$1(i);else n.insertBefore(s.dom,i);r=s.dom}for(i=r?r.nextSibling:n.firstChild,i&&t&&t.node==n&&(t.written=!0);i;)i=rm$1(i)}else if(1&this.flags)for(let i of this.children)7&i.flags&&(i.sync(e,t),i.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let n=0==maxOffset(e)?0:0==t?-1:1;for(;;){let t=e.parentNode;if(t==this.dom)break;0==n&&t.firstChild!=t.lastChild&&(n=e==t.firstChild?-1:1),e=t}i=n<0?e:e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!ContentView.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let e=this.children[n];if(e.dom==i)return r;r+=e.length+e.breakAfter}}domBoundsAround(e,t,i=0){let n=-1,r=-1,s=-1,o=-1;for(let a=0,l=i,c=i;a<this.children.length;a++){let i=this.children[a],h=l+i.length;if(l<e&&h>t)return i.domBoundsAround(e,t,l);if(h>=e&&-1==n&&(n=a,r=l),l>t&&i.dom.parentNode==this.dom){s=a,o=c;break}c=h,l=h+i.breakAfter}return{from:r,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:s<this.children.length&&s>=0?this.children[s].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),1&t.flags)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,7&this.flags&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=noChildren){this.markDirty();for(let n=e;n<t;n++){let e=this.children[n];e.parent==this&&i.indexOf(e)<0&&e.destroy()}i.length<250?this.children.splice(e,t-e,...i):this.children=[].concat(this.children.slice(0,e),i,this.children.slice(t));for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ChildCursor(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==e?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,i,n,r,s){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!(8&(this.flags|e.flags))}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}function rm$1(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}ContentView.prototype.breakAfter=0;class ChildCursor{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function replaceRange(e,t,i,n,r,s,o,a,l){let{children:c}=e,h=c.length?c[t]:null,u=s.length?s[s.length-1]:null,d=u?u.breakAfter:o;if(!(t==n&&h&&!o&&!d&&s.length<2&&h.merge(i,r,s.length?u:null,0==i,a,l))){if(n<c.length){let e=c[n];e&&(r<e.length||e.breakAfter&&(null==u?void 0:u.breakAfter))?(t==n&&(e=e.split(r),r=0),!d&&u&&e.merge(0,r,u,!0,0,l)?s[s.length-1]=e:((r||e.children.length&&!e.children[0].length)&&e.merge(0,r,null,!1,0,l),s.push(e))):(null==e?void 0:e.breakAfter)&&(u?u.breakAfter=1:o=1),n++}for(h&&(h.breakAfter=o,i>0&&(!o&&s.length&&h.merge(i,h.length,s[0],!1,a,0)?h.breakAfter=s.shift().breakAfter:(i<h.length||h.children.length&&0==h.children[h.children.length-1].length)&&h.merge(i,h.length,null,!1,a,0),t++));t<n&&s.length;)if(c[n-1].become(s[s.length-1]))n--,s.pop(),l=s.length?0:a;else{if(!c[t].become(s[0]))break;t++,s.shift(),a=s.length?0:l}!s.length&&t&&n<c.length&&!c[t-1].breakAfter&&c[n].merge(0,0,c[t-1],!1,a,l)&&t--,(t<n||s.length)&&e.replaceChildren(t,n,s)}}function mergeChildrenInto(e,t,i,n,r,s){let o=e.childCursor(),{i:a,off:l}=o.findPos(i,1),{i:c,off:h}=o.findPos(t,-1),u=t-i;for(let d of n)u+=d.length;e.length+=u,replaceRange(e,c,h,a,l,n,0,r,s)}const MaxJoinLen=256;class TextView extends ContentView{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){3==e.nodeType&&this.createDOM(e)}merge(e,t,i){return!(8&this.flags||i&&(!(i instanceof TextView)||this.length-(t-e)+i.length>MaxJoinLen||8&i.flags))&&(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new TextView(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=8&this.flags,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new DOMPos(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return textCoords(this.dom,e,t)}}class MarkView extends ContentView{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let n of t)n.setParent(this)}setAttrs(e){if(clearAttributes(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!(8&(this.flags|e.flags))}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?4&this.flags&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,i,n,r,s){return(!i||!(!(i instanceof MarkView&&i.mark.eq(this.mark))||e&&r<=0||t<this.length&&s<=0))&&(mergeChildrenInto(this,e,t,i?i.children.slice():[],r-1,s-1),this.markDirty(),!0)}split(e){let t=[],i=0,n=-1,r=0;for(let o of this.children){let s=i+o.length;s>e&&t.push(i<e?o.split(e-i):o),n<0&&i>=e&&(n=r),i=s,r++}let s=this.length-e;return this.length=e,n>-1&&(this.children.length=n,this.markDirty()),new MarkView(this.mark,t,s)}domAtPos(e){return inlineDOMAtPos(this,e)}coordsAt(e,t){return coordsInChildren(this,e,t)}}function textCoords(e,t,i){let n=e.nodeValue.length;t>n&&(t=n);let r=t,s=t,o=0;0==t&&i<0||t==n&&i>=0?browser.chrome||browser.gecko||(t?(r--,o=1):s<n&&(s++,o=-1)):i<0?r--:s<n&&s++;let a=textRange(e,r,s).getClientRects();if(!a.length)return null;let l=a[(o?o<0:i>=0)?0:a.length-1];return browser.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(a,e=>e.width)||l),o?flattenRect(l,o<0):l||null}class WidgetView extends ContentView{static create(e,t,i){return new WidgetView(e,t,i)}constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}split(e){let t=WidgetView.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,i,n,r,s){return!(i&&(!(i instanceof WidgetView&&this.widget.compare(i.widget))||e>0&&r<=0||t<this.length&&s<=0))&&(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e instanceof WidgetView&&e.side==this.side&&this.widget.constructor==e.widget.constructor&&(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(0==this.length)return Text.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,i=t&&t.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):Text.empty}domAtPos(e){return(this.length?0==e:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);if(i)return i;let n=this.dom.getClientRects(),r=null;if(!n.length)return null;let s=this.side?this.side<0:e>0;for(let o=s?n.length-1:0;r=n[o],!(e>0?0==o:o==n.length-1||r.top<r.bottom);o+=s?-1:1);return flattenRect(r,!s)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class WidgetBufferView extends ContentView{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof WidgetBufferView&&e.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Text.empty}get isHidden(){return!0}}function inlineDOMAtPos(e,t){let i=e.dom,{children:n}=e,r=0;for(let s=0;r<n.length;r++){let e=n[r],o=s+e.length;if(!(o==s&&e.getSide()<=0)){if(t>s&&t<o&&e.dom.parentNode==i)return e.domAtPos(t-s);if(t<=s)break;s=o}}for(let s=r;s>0;s--){let e=n[s-1];if(e.dom.parentNode==i)return e.domAtPos(e.length)}for(let s=r;s<n.length;s++){let e=n[s];if(e.dom.parentNode==i)return e.domAtPos(0)}return new DOMPos(i,0)}function joinInlineInto(e,t,i){let n,{children:r}=e;i>0&&t instanceof MarkView&&r.length&&(n=r[r.length-1])instanceof MarkView&&n.mark.eq(t.mark)?joinInlineInto(n,t.children[0],i-1):(r.push(t),t.setParent(e)),e.length+=t.length}function coordsInChildren(e,t,i){let n=null,r=-1,s=null,o=-1;!function e(t,a){for(let l=0,c=0;l<t.children.length&&c<=a;l++){let h=t.children[l],u=c+h.length;u>=a&&(h.children.length?e(h,a-c):(!s||s.isHidden&&(i>0||onSameLine(s,h)))&&(u>a||c==u&&h.getSide()>0)?(s=h,o=a-c):(c<a||c==u&&h.getSide()<0&&!h.isHidden)&&(n=h,r=a-c)),c=u}}(e,t);let a=(i<0?n:s)||n||s;return a?a.coordsAt(Math.max(0,a==n?r:o),i):fallbackRect(e)}function fallbackRect(e){let t=e.dom.lastChild;if(!t)return e.dom.getBoundingClientRect();let i=clientRectsFor(t);return i[i.length-1]||null}function onSameLine(e,t){let i=e.coordsAt(0,1),n=t.coordsAt(0,1);return i&&n&&n.top<i.bottom}function combineAttrs(e,t){for(let i in e)"class"==i&&t.class?t.class+=" "+e.class:"style"==i&&t.style?t.style+=";"+e.style:t[i]=e[i];return t}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;const noAttrs$1=Object.create(null);function attrsEq(e,t,i){if(e==t)return!0;e||(e=noAttrs$1),t||(t=noAttrs$1);let n=Object.keys(e),r=Object.keys(t);if(n.length-(i&&n.indexOf(i)>-1?1:0)!=r.length-(i&&r.indexOf(i)>-1?1:0))return!1;for(let s of n)if(s!=i&&(-1==r.indexOf(s)||e[s]!==t[s]))return!1;return!0}function updateAttrs(e,t,i){let n=!1;if(t)for(let r in t)i&&r in i||(n=!0,"style"==r?e.style.cssText="":e.removeAttribute(r));if(i)for(let r in i)t&&t[r]==i[r]||(n=!0,"style"==r?e.style.cssText=i[r]:e.setAttribute(r,i[r]));return n}function getAttrs(e){let t=Object.create(null);for(let i=0;i<e.attributes.length;i++){let n=e.attributes[i];t[n.name]=n.value}return t}class WidgetType{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var BlockType=function(e){return e[e.Text=0]="Text",e[e.WidgetBefore=1]="WidgetBefore",e[e.WidgetAfter=2]="WidgetAfter",e[e.WidgetRange=3]="WidgetRange",e}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(e,t,i,n){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(e){return new MarkDecoration(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new PointDecoration(e,t,t,i,e.widget||null,!1)}static replace(e){let t,i,n=!!e.block;if(e.isBlockGap)t=-5e8,i=4e8;else{let{start:r,end:s}=getInclusive(e,n);t=(r?n?-3e8:-1:5e8)-1,i=1+(s?n?2e8:1:-6e8)}return new PointDecoration(e,t,i,n,e.widget||null,!0)}static line(e){return new LineDecoration(e)}static set(e,t=!1){return RangeSet.of(e,t)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}Decoration.none=RangeSet.empty;class MarkDecoration extends Decoration{constructor(e){let{start:t,end:i}=getInclusive(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,i;return this==e||e instanceof MarkDecoration&&this.tagName==e.tagName&&(this.class||(null===(t=this.attrs)||void 0===t?void 0:t.class))==(e.class||(null===(i=e.attrs)||void 0===i?void 0:i.class))&&attrsEq(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof LineDecoration&&this.spec.class==e.spec.class&&attrsEq(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}LineDecoration.prototype.mapMode=MapMode.TrackBefore,LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(e,t,i,n,r,s){super(t,i,r,e),this.block=n,this.isReplace=s,this.mapMode=n?t<=0?MapMode.TrackBefore:MapMode.TrackAfter:MapMode.TrackDel}get type(){return this.startSide!=this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof PointDecoration&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}function getInclusive(e,t=!1){let{inclusiveStart:i,inclusiveEnd:n}=e;return null==i&&(i=e.inclusive),null==n&&(n=e.inclusive),{start:null!=i?i:t,end:null!=n?n:t}}function widgetsEq(e,t){return e==t||!!(e&&t&&e.compare(t))}function addRange(e,t,i,n=0){let r=i.length-1;r>=0&&i[r]+n>=e?i[r]=Math.max(i[r],t):i.push(e,t)}PointDecoration.prototype.point=!0;class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,n,r,s){if(i){if(!(i instanceof LineView))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),mergeChildrenInto(this,e,t,i?i.children.slice():[],r,s),!0}split(e){let t=new LineView;if(t.breakAfter=this.breakAfter,0==this.length)return t;let{i:i,off:n}=this.childPos(e);n&&(t.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)t.append(this.children[r],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){attrsEq(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){joinInlineInto(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=combineAttrs(t,this.attrs||{})),i&&(this.attrs=combineAttrs({class:i},this.attrs||{}))}domAtPos(e){return inlineDOMAtPos(this,e)}reuseDOM(e){"DIV"==e.nodeName&&(this.setDOM(e),this.flags|=6)}sync(e,t){var i;this.dom?4&this.flags&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let n=this.dom.lastChild;for(;n&&ContentView.get(n)instanceof MarkView;)n=n.lastChild;if(!(n&&this.length&&("BR"==n.nodeName||0!=(null===(i=ContentView.get(n))||void 0===i?void 0:i.isEditable)||browser.ios&&this.children.some(e=>e instanceof TextView)))){let e=document.createElement("BR");e.cmIgnore=!0,this.dom.appendChild(e)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let e,t=0;for(let i of this.children){if(!(i instanceof TextView)||/[^ -~]/.test(i.text))return null;let n=clientRectsFor(i.dom);if(1!=n.length)return null;t+=n[0].width,e=n[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(e,t){let i=coordsInChildren(this,e,t);if(!this.children.length&&i&&this.parent){let{heightOracle:e}=this.parent.view.viewState,t=i.bottom-i.top;if(Math.abs(t-e.lineHeight)<2&&e.textHeight<t){let n=(t-e.textHeight)/2;return{top:i.top+n,bottom:i.bottom-n,left:i.left,right:i.left}}}return i}become(e){return e instanceof LineView&&0==this.children.length&&0==e.children.length&&attrsEq(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let i=0,n=0;i<e.children.length;i++){let r=e.children[i],s=n+r.length;if(s>=t){if(r instanceof LineView)return r;if(s>t)break}n=s+r.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(e,t,i){super(),this.widget=e,this.length=t,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,n,r,s){return!(i&&(!(i instanceof BlockWidgetView&&this.widget.compare(i.widget))||e>0&&r<=0||t<this.length&&s<=0))&&(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return 0==e?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new BlockWidgetView(this.widget,t,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return noChildren}sync(e){this.dom&&this.widget.updateDOM(this.dom,e)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}domBoundsAround(){return null}become(e){return e instanceof BlockWidgetView&&e.widget.constructor==this.widget.constructor&&(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);return i||(this.widget instanceof BlockGapWidget?null:flattenRect(this.dom.getBoundingClientRect(),this.length?0==e:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:i}=this.deco;return t!=i&&(e<0?t<0:i>0)}}class BlockGapWidget extends WidgetType{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class ContentBuilder{constructor(e,t,i,n){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof BlockWidgetView&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||e&&this.content.length&&this.content[this.content.length-1]instanceof BlockWidgetView||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:t,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}this.text=t,this.textOff=0}let n=Math.min(this.text.length-this.textOff,e),r=Math.min(n,512);this.flushBuffer(t.slice(t.length-i)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=n<=r?0:t.length}}span(e,t,i,n){this.buildText(t-e,i,n),this.pos=t,this.openStart<0&&(this.openStart=n)}point(e,t,i,n,r,s){if(this.disallowBlockEffectsFor[s]&&i instanceof PointDecoration){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=t-e;if(i instanceof PointDecoration)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(i.widget||NullWidget.block,o,i));else{let s=WidgetView.create(i.widget||NullWidget.inline,o,o?0:i.startSide),a=this.atCursorPos&&!s.isEditable&&r<=n.length&&(e<t||i.startSide>0),l=!s.isEditable&&(e<t||r>n.length||i.startSide<=0),c=this.getLine();2!=this.pendingBuffer||a||s.isEditable||(this.pendingBuffer=0),this.flushBuffer(n),a&&(c.append(wrapMarks(new WidgetBufferView(1),n),r),r=n.length+Math.max(0,r-n.length)),c.append(wrapMarks(s,n),r),this.atCursorPos=l,this.pendingBuffer=l?e<t||r>n.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=n.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=r)}static build(e,t,i,n,r){let s=new ContentBuilder(e,t,i,r);return s.openEnd=RangeSet.spans(n,t,i,s),s.openStart<0&&(s.openStart=s.openEnd),s.finish(s.openEnd),s}}function wrapMarks(e,t){for(let i of t)e=new MarkView(i,[e],e.length);return e}class NullWidget extends WidgetType{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}NullWidget.inline=new NullWidget("span"),NullWidget.block=new NullWidget("div");var Direction=function(e){return e[e.LTR=0]="LTR",e[e.RTL=1]="RTL",e}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(e){let t=[];for(let i=0;i<e.length;i++)t.push(1<<+e[i]);return t}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let e of["()","[]","{}"]){let t=e.charCodeAt(0),i=e.charCodeAt(1);Brackets[t]=i,Brackets[i]=-t}function charType(e){return e<=247?LowTypes[e]:1424<=e&&e<=1524?2:1536<=e&&e<=1785?ArabicTypes[e-1536]:1774<=e&&e<=2220?4:8192<=e&&e<=8204?256:64336<=e&&e<=65023?4:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{get dir(){return this.level%2?RTL:LTR}constructor(e,t,i){this.from=e,this.to=t,this.level=i}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,i,n){let r=-1;for(let s=0;s<e.length;s++){let o=e[s];if(o.from<=t&&o.to>=t){if(o.level==i)return s;(r<0||(0!=n?n<0?o.from<t:o.to>t:e[r].level>o.level))&&(r=s)}}if(r<0)throw new RangeError("Index out of range");return r}}function isolatesEq(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let n=e[i],r=t[i];if(n.from!=r.from||n.to!=r.to||n.direction!=r.direction||!isolatesEq(n.inner,r.inner))return!1}return!0}const types=[];function computeCharTypes(e,t,i,n,r){for(let s=0;s<=n.length;s++){let o=s?n[s-1].to:t,a=s<n.length?n[s].from:i,l=s?256:r;for(let t=o,i=l,n=l;t<a;t++){let r=charType(e.charCodeAt(t));512==r?r=i:8==r&&4==n&&(r=16),types[t]=4==r?2:r,7&r&&(n=r),i=r}for(let e=o,t=l,n=l;e<a;e++){let r=types[e];if(128==r)e<a-1&&t==types[e+1]&&24&t?r=types[e]=t:types[e]=256;else if(64==r){let r=e+1;for(;r<a&&64==types[r];)r++;let s=e&&8==t||r<i&&8==types[r]?1==n?1:8:256;for(let t=e;t<r;t++)types[t]=s;e=r-1}else 8==r&&1==n&&(types[e]=1);t=r,7&r&&(n=r)}}}function processBracketPairs(e,t,i,n,r){let s=1==r?2:1;for(let o=0,a=0,l=0;o<=n.length;o++){let c=o?n[o-1].to:t,h=o<n.length?n[o].from:i;for(let t,i,n,o=c;o<h;o++)if(i=Brackets[t=e.charCodeAt(o)])if(i<0){for(let e=a-3;e>=0;e-=3)if(BracketStack[e+1]==-i){let t=BracketStack[e+2],i=2&t?r:4&t?1&t?s:r:0;i&&(types[o]=types[BracketStack[e]]=i),a=e;break}}else{if(189==BracketStack.length)break;BracketStack[a++]=o,BracketStack[a++]=t,BracketStack[a++]=l}else if(2==(n=types[o])||1==n){let e=n==r;l=e?0:1;for(let t=a-3;t>=0;t-=3){let i=BracketStack[t+2];if(2&i)break;if(e)BracketStack[t+2]|=2;else{if(4&i)break;BracketStack[t+2]|=4}}}}}function processNeutrals(e,t,i,n){for(let r=0,s=n;r<=i.length;r++){let o=r?i[r-1].to:e,a=r<i.length?i[r].from:t;for(let l=o;l<a;){let o=types[l];if(256==o){let o=l+1;for(;;)if(o==a){if(r==i.length)break;o=i[r++].to,a=r<i.length?i[r].from:t}else{if(256!=types[o])break;o++}let c=1==s,h=c==(1==(o<t?types[o]:n))?c?1:2:n;for(let t=o,n=r,s=n?i[n-1].to:e;t>l;)t==s&&(t=i[--n].from,s=n?i[n-1].to:e),types[--t]=h;l=o}else s=o,l++}}}function emitSpans(e,t,i,n,r,s,o){let a=n%2?2:1;if(n%2==r%2)for(let l=t,c=0;l<i;){let t=!0,h=!1;if(c==s.length||l<s[c].from){let e=types[l];e!=a&&(t=!1,h=16==e)}let u=t||1!=a?null:[],d=t?n:n+1,p=l;e:for(;;)if(c<s.length&&p==s[c].from){if(h)break e;let f=s[c];if(!t)for(let e=f.to,t=c+1;;){if(e==i)break e;if(!(t<s.length&&s[t].from==e)){if(types[e]==a)break e;break}e=s[t++].to}if(c++,u)u.push(f);else{f.from>l&&o.push(new BidiSpan(l,f.from,d)),computeSectionOrder(e,f.direction==LTR!=!(d%2)?n+1:n,r,f.inner,f.from,f.to,o),l=f.to}p=f.to}else{if(p==i||(t?types[p]!=a:types[p]==a))break;p++}u?emitSpans(e,l,p,n+1,r,u,o):l<p&&o.push(new BidiSpan(l,p,d)),l=p}else for(let l=i,c=s.length;l>t;){let i=!0,h=!1;if(!c||l>s[c-1].to){let e=types[l-1];e!=a&&(i=!1,h=16==e)}let u=i||1!=a?null:[],d=i?n:n+1,p=l;e:for(;;)if(c&&p==s[c-1].to){if(h)break e;let f=s[--c];if(!i)for(let e=f.from,i=c;;){if(e==t)break e;if(!i||s[i-1].to!=e){if(types[e-1]==a)break e;break}e=s[--i].from}if(u)u.push(f);else{f.to<l&&o.push(new BidiSpan(f.to,l,d)),computeSectionOrder(e,f.direction==LTR!=!(d%2)?n+1:n,r,f.inner,f.from,f.to,o),l=f.from}p=f.from}else{if(p==t||(i?types[p-1]!=a:types[p-1]==a))break;p--}u?emitSpans(e,p,l,n+1,r,u,o):p<l&&o.push(new BidiSpan(p,l,d)),l=p}}function computeSectionOrder(e,t,i,n,r,s,o){let a=t%2?2:1;computeCharTypes(e,r,s,n,a),processBracketPairs(e,r,s,n,a),processNeutrals(r,s,n,a),emitSpans(e,r,s,t,i,n,o)}function computeOrder(e,t,i){if(!e)return[new BidiSpan(0,0,t==RTL?1:0)];if(t==LTR&&!i.length&&!BidiRE.test(e))return trivialOrder(e.length);if(i.length)for(;e.length>types.length;)types[types.length]=256;let n=[],r=t==LTR?0:1;return computeSectionOrder(e,r,r,i,0,e.length,n),n}function trivialOrder(e){return[new BidiSpan(0,e,0)]}let movedOver="";function moveVisually(e,t,i,n,r){var s;let o=n.head-e.from,a=BidiSpan.find(t,o,null!==(s=n.bidiLevel)&&void 0!==s?s:-1,n.assoc),l=t[a],c=l.side(r,i);if(o==c){let e=a+=r?1:-1;if(e<0||e>=t.length)return null;l=t[a=e],o=l.side(!r,i),c=l.side(r,i)}let h=findClusterBreak(e.text,o,l.forward(r,i));(h<l.from||h>l.to)&&(h=c),movedOver=e.text.slice(Math.min(o,h),Math.max(o,h));let u=a==(r?t.length-1:0)?null:t[a+(r?1:-1)];return u&&h==c&&u.level+(r?0:1)<l.level?EditorSelection.cursor(u.side(!r,i)+e.from,u.forward(r,i)?1:-1,u.level):EditorSelection.cursor(h+e.from,l.forward(r,i)?-1:1,l.level)}function autoDirection(e,t,i){for(let n=t;n<i;n++){let t=charType(e.charCodeAt(n));if(1==t)return LTR;if(2==t||4==t)return RTL}return LTR}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler$1=Facet.define(),focusChangeEffect=Facet.define(),clipboardInputFilter=Facet.define(),clipboardOutputFilter=Facet.define(),perLineTextDirection=Facet.define({combine:e=>e.some(e=>e)}),nativeSelectionHidden=Facet.define({combine:e=>e.some(e=>e)}),scrollHandler=Facet.define();class ScrollTarget{constructor(e,t="nearest",i="nearest",n=5,r=5,s=!1){this.range=e,this.y=t,this.x=i,this.yMargin=n,this.xMargin=r,this.isSnapshot=s}map(e){return e.empty?this:new ScrollTarget(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new ScrollTarget(EditorSelection.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const scrollIntoView$1=StateEffect.define({map:(e,t)=>e.map(t)}),setEditContextFormatting=StateEffect.define();function logException(e,t,i){let n=e.facet(exceptionSink);n.length?n[0](t):window.onerror&&window.onerror(String(t),i,void 0,void 0,t)||(i?console.error(i+":",t):console.error(t))}const editable=Facet.define({combine:e=>!e.length||e[0]});let nextPluginID=0;const viewPlugin=Facet.define({combine:e=>e.filter((t,i)=>{for(let n=0;n<i;n++)if(e[n].plugin==t.plugin)return!1;return!0})});class ViewPlugin{constructor(e,t,i,n,r){this.id=e,this.create=t,this.domEventHandlers=i,this.domEventObservers=n,this.baseExtensions=r(this),this.extension=this.baseExtensions.concat(viewPlugin.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(viewPlugin.of({plugin:this,arg:e}))}static define(e,t){const{eventHandlers:i,eventObservers:n,provide:r,decorations:s}=t||{};return new ViewPlugin(nextPluginID++,e,i,n,e=>{let t=[];return s&&t.push(decorations.of(t=>{let i=t.plugin(e);return i?s(i):Decoration.none})),r&&t.push(r(e)),t})}static fromClass(e,t){return ViewPlugin.define((t,i)=>new e(t,i),t)}}class PluginInstance{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(t){if(logException(e.state,t,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(_2){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){logException(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(null===(t=this.value)||void 0===t?void 0:t.destroy)try{this.value.destroy()}catch(i){logException(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),outerDecorations=Facet.define(),atomicRanges=Facet.define(),bidiIsolatedRanges=Facet.define();function getIsolatedRanges(e,t){let i=e.state.facet(bidiIsolatedRanges);if(!i.length)return i;let n=i.map(t=>t instanceof Function?t(e):t),r=[];return RangeSet.spans(n,t.from,t.to,{point(){},span(e,i,n,s){let o=e-t.from,a=i-t.from,l=r;for(let r=n.length-1;r>=0;r--,s--){let e,i=n[r].spec.bidiIsolate;if(null==i&&(i=autoDirection(t.text,o,a)),s>0&&l.length&&(e=l[l.length-1]).to==o&&e.direction==i)e.to=a,l=e.inner;else{let e={from:o,to:a,direction:i,inner:[]};l.push(e),l=e.inner}}}}),r}const scrollMargins=Facet.define();function getScrollMargins(e){let t=0,i=0,n=0,r=0;for(let s of e.state.facet(scrollMargins)){let o=s(e);o&&(null!=o.left&&(t=Math.max(t,o.left)),null!=o.right&&(i=Math.max(i,o.right)),null!=o.top&&(n=Math.max(n,o.top)),null!=o.bottom&&(r=Math.max(r,o.bottom)))}return{left:t,right:i,top:n,bottom:r}}const styleModule=Facet.define();class ChangedRange{constructor(e,t,i,n){this.fromA=e,this.toA=t,this.fromB=i,this.toB=n}join(e){return new ChangedRange(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let n=e[t-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(0==t.length)return e;let i=[];for(let n=0,r=0,s=0,o=0;;n++){let a=n==e.length?null:e[n],l=s-o,c=a?a.fromB:1e9;for(;r<t.length&&t[r]<c;){let e=t[r],n=t[r+1],s=Math.max(o,e),a=Math.min(c,n);if(s<=a&&new ChangedRange(s+l,a+l,s,a).addToSet(i),n>c)break;r+=2}if(!a)return i;new ChangedRange(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),s=a.toA,o=a.toB}}}class ViewUpdate{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let r of i)this.changes=this.changes.compose(r.changes);let n=[];this.changes.iterChangedRanges((e,t,i,r)=>n.push(new ChangedRange(e,t,i,r))),this.changedRanges=n}static create(e,t,i){return new ViewUpdate(e,t,i)}get viewportChanged(){return(4&this.flags)>0}get viewportMoved(){return(8&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(18&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return 0==this.flags&&0==this.transactions.length}}class DocView extends ContentView{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Decoration.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:e,toA:t})=>t<this.minWidthFrom||e>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let n=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&((null===(t=this.domChanged)||void 0===t?void 0:t.newSel)?n=this.domChanged.newSel.head:touchesComposition(e.changes,this.hasComposition)||e.selectionSet||(n=e.state.selection.main.head));let r=n>-1?findCompositionRange(this.view,e.changes,n):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:t,to:n}=this.hasComposition;i=new ChangedRange(t,n,e.changes.mapPos(t,-1),e.changes.mapPos(n,1)).addToSet(i.slice())}this.hasComposition=r?{from:r.range.fromB,to:r.range.toB}:null,(browser.ie||browser.chrome)&&!r&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let s=findChangedDeco(this.decorations,this.updateDeco(),e.changes);return i=ChangedRange.extendWithRanges(i,s),!!(7&this.flags||0!=i.length)&&(this.updateInner(i,e.startState.doc.length,r),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,i);let{observer:n}=this.view;n.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let e=browser.chrome||browser.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,e),this.flags&=-8,e&&(e.written||n.selectionRange.focusNode!=e.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(e=>e.flags&=-9);let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof BlockWidgetView&&s.widget instanceof BlockGapWidget&&r.push(s.dom);n.updateGaps(r)}updateChildren(e,t,i){let n=i?i.range.addToSet(e.slice()):e,r=this.childCursor(t);for(let s=n.length-1;;s--){let e=s>=0?n[s]:null;if(!e)break;let t,o,a,l,{fromA:c,toA:h,fromB:u,toB:d}=e;if(i&&i.range.fromB<d&&i.range.toB>u){let e=ContentBuilder.build(this.view.state.doc,u,i.range.fromB,this.decorations,this.dynamicDecorationMap),n=ContentBuilder.build(this.view.state.doc,i.range.toB,d,this.decorations,this.dynamicDecorationMap);o=e.breakAtStart,a=e.openStart,l=n.openEnd;let r=this.compositionView(i);n.breakAtStart?r.breakAfter=1:n.content.length&&r.merge(r.length,r.length,n.content[0],!1,n.openStart,0)&&(r.breakAfter=n.content[0].breakAfter,n.content.shift()),e.content.length&&r.merge(0,0,e.content[e.content.length-1],!0,0,e.openEnd)&&e.content.pop(),t=e.content.concat(r).concat(n.content)}else({content:t,breakAtStart:o,openStart:a,openEnd:l}=ContentBuilder.build(this.view.state.doc,u,d,this.decorations,this.dynamicDecorationMap));let{i:p,off:f}=r.findPos(h,1),{i:m,off:g}=r.findPos(c,-1);replaceRange(this,m,g,p,f,t,o,a,l)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let e of t.effects)e.is(setEditContextFormatting)&&(this.editContextFormatting=e.value)}compositionView(e){let t=new TextView(e.text.nodeValue);t.flags|=8;for(let{deco:n}of e.marks)t=new MarkView(n,[t],t.length);let i=new LineView;return i.append(t,0),i}fixCompositionDOM(e){let t=(e,t)=>{t.flags|=8|(t.children.some(e=>7&e.flags)?1:0),this.markedForComposition.add(t);let i=ContentView.get(e);i&&i!=t&&(i.dom=null),t.setDOM(e)},i=this.childPos(e.range.fromB,1),n=this.children[i.i];t(e.line,n);for(let r=e.marks.length-1;r>=-1;r--)i=n.childPos(i.off,1),n=n.children[i.i],t(r>=0?e.marks[r].node:e.text,n)}updateSelection(e=!1,t=!1){!e&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange();let i=this.view.root.activeElement,n=i==this.dom,r=!n&&!(this.view.state.facet(editable)||this.dom.tabIndex>-1)&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(n||t||r))return;let s=this.forceSelection;this.forceSelection=!1;let o=this.view.state.selection.main,a=this.moveToLine(this.domAtPos(o.anchor)),l=o.empty?a:this.moveToLine(this.domAtPos(o.head));if(browser.gecko&&o.empty&&!this.hasComposition&&betweenUneditable(a)){let e=document.createTextNode("");this.view.observer.ignore(()=>a.node.insertBefore(e,a.node.childNodes[a.offset]||null)),a=l=new DOMPos(e,0),s=!0}let c=this.view.observer.selectionRange;!s&&c.focusNode&&(isEquivalentPosition(a.node,a.offset,c.anchorNode,c.anchorOffset)&&isEquivalentPosition(l.node,l.offset,c.focusNode,c.focusOffset)||this.suppressWidgetCursorChange(c,o))||(this.view.observer.ignore(()=>{browser.android&&browser.chrome&&this.dom.contains(c.focusNode)&&inUneditable(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let e=getSelection(this.view.root);if(e)if(o.empty){if(browser.gecko){let e=nextToUneditable(a.node,a.offset);if(e&&3!=e){let t=(1==e?textNodeBefore:textNodeAfter)(a.node,a.offset);t&&(a=new DOMPos(t.node,t.offset))}}e.collapse(a.node,a.offset),null!=o.bidiLevel&&void 0!==e.caretBidiLevel&&(e.caretBidiLevel=o.bidiLevel)}else if(e.extend){e.collapse(a.node,a.offset);try{e.extend(l.node,l.offset)}catch(_2){}}else{let t=document.createRange();o.anchor>o.head&&([a,l]=[l,a]),t.setEnd(l.node,l.offset),t.setStart(a.node,a.offset),e.removeAllRanges(),e.addRange(t)}else;r&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(a,l)),this.impreciseAnchor=a.precise?null:new DOMPos(c.anchorNode,c.anchorOffset),this.impreciseHead=l.precise?null:new DOMPos(c.focusNode,c.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&isEquivalentPosition(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,i=getSelection(e.root),{anchorNode:n,anchorOffset:r}=e.observer.selectionRange;if(!(i&&t.empty&&t.assoc&&i.modify))return;let s=LineView.find(this,t.head);if(!s)return;let o=s.posAtStart;if(t.head==o||t.head==o+s.length)return;let a=this.coordsAt(t.head,-1),l=this.coordsAt(t.head,1);if(!a||!l||a.bottom>l.top)return;let c=this.domAtPos(t.head+t.assoc);i.collapse(c.node,c.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let h=e.observer.selectionRange;e.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=t.from&&i.collapse(n,r)}moveToLine(e){let t,i=this.dom;if(e.node!=i)return e;for(let n=e.offset;!t&&n<i.childNodes.length;n++){let e=ContentView.get(i.childNodes[n]);e instanceof LineView&&(t=e.domAtPos(0))}for(let n=e.offset-1;!t&&n>=0;n--){let e=ContentView.get(i.childNodes[n]);e instanceof LineView&&(t=e.domAtPos(e.length))}return t?new DOMPos(t.node,t.offset,!0):e}nearest(e){for(let t=e;t;){let e=ContentView.get(t);if(e&&e.rootView==this)return e;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let e=this.children[t];if(i<e.length||e instanceof LineView)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){let i=null,n=0;for(let r=this.length,s=this.children.length-1;s>=0;s--){let o=this.children[s],a=r-o.breakAfter,l=a-o.length;if(a<e)break;if(l<=e&&(l<e||o.covers(-1))&&(a>e||o.covers(1))&&(!i||o instanceof LineView&&!(i instanceof LineView&&t>=0)))i=o,n=l;else if(i&&l==e&&a==e&&o instanceof BlockWidgetView&&Math.abs(t)<2){if(o.deco.startSide<0)break;s&&(i=null)}r=l}return i?i.coordsAt(e-n,t):null}coordsForChar(e){let{i:t,off:i}=this.childPos(e,1),n=this.children[t];if(!(n instanceof LineView))return null;for(;n.children.length;){let{i:e,off:t}=n.childPos(i,1);for(;;e++){if(e==n.children.length)return null;if((n=n.children[e]).length)break}i=t}if(!(n instanceof TextView))return null;let r=findClusterBreak(n.text,i);if(r==i)return null;let s=textRange(n.dom,i,r).getClientRects();for(let o=0;o<s.length;o++){let e=s[o];if(o==s.length-1||e.top<e.bottom&&e.left<e.right)return e}return null}measureVisibleLineHeights(e){let t=[],{from:i,to:n}=e,r=this.view.contentDOM.clientWidth,s=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,a=this.view.textDirection==Direction.LTR;for(let l=0,c=0;c<this.children.length;c++){let e=this.children[c],h=l+e.length;if(h>n)break;if(l>=i){let i=e.dom.getBoundingClientRect();if(t.push(i.height),s){let t=e.dom.lastChild,n=t?clientRectsFor(t):[];if(n.length){let e=n[n.length-1],t=a?e.right-i.left:i.right-e.left;t>o&&(o=t,this.minWidth=r,this.minWidthFrom=l,this.minWidthTo=h)}}}l=h+e.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return"rtl"==getComputedStyle(this.children[t].dom).direction?Direction.RTL:Direction.LTR}measureTextSize(){for(let r of this.children)if(r instanceof LineView){let e=r.measureTextSize();if(e)return e}let e,t,i,n=document.createElement("div");return n.className="cm-line",n.style.width="99999px",n.style.position="absolute",n.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(n);let r=clientRectsFor(n.firstChild)[0];e=n.getBoundingClientRect().height,t=r?r.width/27:7,i=r?r.height:e,n.remove()}),{lineHeight:e,charWidth:t,textHeight:i}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new ChildCursor(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,n=0;;n++){let r=n==t.viewports.length?null:t.viewports[n],s=r?r.from-1:this.length;if(s>i){let n=(t.lineBlockAt(s).bottom-t.lineBlockAt(i).top)/this.view.scaleY;e.push(Decoration.replace({widget:new BlockGapWidget(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,s))}if(!r)break;i=r.to+1}return Decoration.set(e)}updateDeco(){let e=1,t=this.view.state.facet(decorations).map(t=>(this.dynamicDecorationMap[e++]="function"==typeof t)?t(this.view):t),i=!1,n=this.view.state.facet(outerDecorations).map((e,t)=>{let n="function"==typeof e;return n&&(i=!0),n?e(this.view):e});for(n.length&&(this.dynamicDecorationMap[e++]=i,t.push(RangeSet.join(n))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let t=this.view.viewState.lineBlockAt(e.range.head);return this.view.scrollDOM.scrollTop=t.top-e.yMargin,void(this.view.scrollDOM.scrollLeft=e.xMargin)}for(let c of this.view.state.facet(scrollHandler))try{if(c(this.view,e.range,e))return!0}catch(l){logException(this.view.state,l,"scroll handler")}let t,{range:i}=e,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(t=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,t.left),top:Math.min(n.top,t.top),right:Math.max(n.right,t.right),bottom:Math.max(n.bottom,t.bottom)});let r=getScrollMargins(this.view),s={left:n.left-r.left,top:n.top-r.top,right:n.right+r.right,bottom:n.bottom+r.bottom},{offsetWidth:o,offsetHeight:a}=this.view.scrollDOM;scrollRectIntoView(this.view.scrollDOM,s,i.head<i.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,o),-o),Math.max(Math.min(e.yMargin,a),-a),this.view.textDirection==Direction.LTR)}lineHasWidget(e){let{i:t}=this.childCursor().findPos(e);if(t==this.children.length)return!1;let i=e=>e instanceof WidgetView||e.children.some(i);return i(this.children[t])}}function betweenUneditable(e){return 1==e.node.nodeType&&e.node.firstChild&&(0==e.offset||"false"==e.node.childNodes[e.offset-1].contentEditable)&&(e.offset==e.node.childNodes.length||"false"==e.node.childNodes[e.offset].contentEditable)}function findCompositionNode(e,t){let i=e.observer.selectionRange;if(!i.focusNode)return null;let n=textNodeBefore(i.focusNode,i.focusOffset),r=textNodeAfter(i.focusNode,i.focusOffset),s=n||r;if(r&&n&&r.node!=n.node){let t=ContentView.get(r.node);if(!t||t instanceof TextView&&t.text!=r.node.nodeValue)s=r;else if(e.docView.lastCompositionAfterCursor){let e=ContentView.get(n.node);!e||e instanceof TextView&&e.text!=n.node.nodeValue||(s=r)}}if(e.docView.lastCompositionAfterCursor=s!=n,!s)return null;let o=t-s.offset;return{from:o,to:o+s.node.nodeValue.length,node:s.node}}function findCompositionRange(e,t,i){let n=findCompositionNode(e,i);if(!n)return null;let{node:r,from:s,to:o}=n,a=r.nodeValue;if(/[\n\r]/.test(a))return null;if(e.state.doc.sliceString(n.from,n.to)!=a)return null;let l=t.invertedDesc,c=new ChangedRange(l.mapPos(s),l.mapPos(o),s,o),h=[];for(let u=r.parentNode;;u=u.parentNode){let t=ContentView.get(u);if(t instanceof MarkView)h.push({node:u,deco:t.mark});else{if(t instanceof LineView||"DIV"==u.nodeName&&u.parentNode==e.contentDOM)return{range:c,text:r,marks:h,line:u};if(u==e.contentDOM)return null;h.push({node:u,deco:new MarkDecoration({inclusive:!0,attributes:getAttrs(u),tagName:u.tagName.toLowerCase()})})}}}function nextToUneditable(e,t){return 1!=e.nodeType?0:(t&&"false"==e.childNodes[t-1].contentEditable?1:0)|(t<e.childNodes.length&&"false"==e.childNodes[t].contentEditable?2:0)}let DecorationComparator$1=class{constructor(){this.changes=[]}compareRange(e,t){addRange(e,t,this.changes)}comparePoint(e,t){addRange(e,t,this.changes)}boundChange(e){addRange(e,e,this.changes)}};function findChangedDeco(e,t,i){let n=new DecorationComparator$1;return RangeSet.compare(e,t,i,n),n.changes}function inUneditable(e,t){for(let i=e;i&&i!=t;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}function touchesComposition(e,t){let i=!1;return t&&e.iterChangedRanges((e,n)=>{e<t.to&&n>t.from&&(i=!0)}),i}function groupAt(e,t,i=1){let n=e.charCategorizer(t),r=e.doc.lineAt(t),s=t-r.from;if(0==r.length)return EditorSelection.cursor(t);0==s?i=1:s==r.length&&(i=-1);let o=s,a=s;i<0?o=findClusterBreak(r.text,s,!1):a=findClusterBreak(r.text,s);let l=n(r.text.slice(o,a));for(;o>0;){let e=findClusterBreak(r.text,o,!1);if(n(r.text.slice(e,o))!=l)break;o=e}for(;a<r.length;){let e=findClusterBreak(r.text,a);if(n(r.text.slice(a,e))!=l)break;a=e}return EditorSelection.range(o+r.from,a+r.from)}function getdx(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function getdy(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function yOverlap(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function upTop(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function upBot(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function domPosAtCoords(e,t,i){let n,r,s,o,a,l,c,h,u=!1;for(let p=e.firstChild;p;p=p.nextSibling){let e=clientRectsFor(p);for(let d=0;d<e.length;d++){let f=e[d];r&&yOverlap(r,f)&&(f=upTop(upBot(f,r.bottom),r.top));let m=getdx(t,f),g=getdy(i,f);if(0==m&&0==g)return 3==p.nodeType?domPosInText(p,t,i):domPosAtCoords(p,t,i);(!n||o>g||o==g&&s>m)&&(n=p,r=f,s=m,o=g,u=!m||(t<f.left?d>0:d<e.length-1)),0==m?i>f.bottom&&(!c||c.bottom<f.bottom)?(a=p,c=f):i<f.top&&(!h||h.top>f.top)&&(l=p,h=f):c&&yOverlap(c,f)?c=upBot(c,f.bottom):h&&yOverlap(h,f)&&(h=upTop(h,f.top))}}if(c&&c.bottom>=i?(n=a,r=c):h&&h.top<=i&&(n=l,r=h),!n)return{node:e,offset:0};let d=Math.max(r.left,Math.min(r.right,t));return 3==n.nodeType?domPosInText(n,d,i):u&&"false"!=n.contentEditable?domPosAtCoords(n,d,i):{node:e,offset:Array.prototype.indexOf.call(e.childNodes,n)+(t>=(r.left+r.right)/2?1:0)}}function domPosInText(e,t,i){let n=e.nodeValue.length,r=-1,s=1e9,o=0;for(let a=0;a<n;a++){let n=textRange(e,a,a+1).getClientRects();for(let l=0;l<n.length;l++){let c=n[l];if(c.top==c.bottom)continue;o||(o=t-c.left);let h=(c.top>i?c.top-i:i-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&h<s){let i=t>=(c.left+c.right)/2,n=i;if(browser.chrome||browser.gecko){let t=textRange(e,a).getBoundingClientRect();Math.abs(t.left-c.right)<.1&&(n=!i)}if(h<=0)return{node:e,offset:a+(n?1:0)};r=a+(n?1:0),s=h}}}return{node:e,offset:r>-1?r:o>0?e.nodeValue.length:0}}function posAtCoords(e,t,i,n=-1){var r,s;let o,a=e.contentDOM.getBoundingClientRect(),l=a.top+e.viewState.paddingTop,{docHeight:c}=e.viewState,{x:h,y:u}=t,d=u-l;if(d<0)return 0;if(d>c)return e.state.doc.length;for(let w=e.viewState.heightOracle.textHeight/2,S=!1;o=e.elementAtHeight(d),o.type!=BlockType.Text;)for(;d=n>0?o.bottom+w:o.top-w,!(d>=0&&d<=c);){if(S)return i?null:0;S=!0,n=-n}u=l+d;let p=o.from;if(p<e.viewport.from)return 0==e.viewport.from?0:i?null:posAtCoordsImprecise(e,a,o,h,u);if(p>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:i?null:posAtCoordsImprecise(e,a,o,h,u);let f=e.dom.ownerDocument,m=e.root.elementFromPoint?e.root:f,g=m.elementFromPoint(h,u);g&&!e.contentDOM.contains(g)&&(g=null),g||(h=Math.max(a.left+1,Math.min(a.right-1,h)),g=m.elementFromPoint(h,u),g&&!e.contentDOM.contains(g)&&(g=null));let y,_=-1;if(g&&0!=(null===(r=e.docView.nearest(g))||void 0===r?void 0:r.isEditable)){if(f.caretPositionFromPoint){let e=f.caretPositionFromPoint(h,u);e&&({offsetNode:y,offset:_}=e)}else if(f.caretRangeFromPoint){let e=f.caretRangeFromPoint(h,u);e&&({startContainer:y,startOffset:_}=e)}y&&(!e.contentDOM.contains(y)||browser.safari&&isSuspiciousSafariCaretResult(y,_,h)||browser.chrome&&isSuspiciousChromeCaretResult(y,_,h))&&(y=void 0),y&&(_=Math.min(maxOffset(y),_))}if(!y||!e.docView.dom.contains(y)){let t=LineView.find(e.docView,p);if(!t)return d>o.top+o.height/2?o.to:o.from;({node:y,offset:_}=domPosAtCoords(t.dom,h,u))}let b=e.docView.nearest(y);if(!b)return null;if(b.isWidget&&1==(null===(s=b.dom)||void 0===s?void 0:s.nodeType)){let e=b.dom.getBoundingClientRect();return t.y<e.top||t.y<=e.bottom&&t.x<=(e.left+e.right)/2?b.posAtStart:b.posAtEnd}return b.localPosFromDOM(y,_)+b.posAtStart}function posAtCoordsImprecise(e,t,i,n,r){let s=Math.round((n-t.left)*e.defaultCharacterWidth);if(e.lineWrapping&&i.height>1.5*e.defaultLineHeight){let t=e.viewState.heightOracle.textHeight;s+=Math.floor((r-i.top-.5*(e.defaultLineHeight-t))/t)*e.viewState.heightOracle.lineLength}let o=e.state.sliceDoc(i.from,i.to);return i.from+findColumn(o,s,e.state.tabSize)}function isEndOfLineBefore(e,t,i){let n,r=e;if(3!=e.nodeType||t!=(n=e.nodeValue.length))return!1;for(;;){let e=r.nextSibling;if(e){if("BR"==e.nodeName)break;return!1}{let e=r.parentNode;if(!e||"DIV"==e.nodeName)break;r=e}}return textRange(e,n-1,n).getBoundingClientRect().right>i}function isSuspiciousSafariCaretResult(e,t,i){return isEndOfLineBefore(e,t,i)}function isSuspiciousChromeCaretResult(e,t,i){if(0!=t)return isEndOfLineBefore(e,t,i);for(let n=e;;){let e=n.parentNode;if(!e||1!=e.nodeType||e.firstChild!=n)return!1;if(e.classList.contains("cm-line"))break;n=e}return i-(1==e.nodeType?e.getBoundingClientRect():textRange(e,0,Math.max(e.nodeValue.length,1)).getBoundingClientRect()).left>5}function blockAt(e,t,i){let n=e.lineBlockAt(t);if(Array.isArray(n.type)){let e;for(let r of n.type){if(r.from>t)break;if(!(r.to<t)){if(r.from<t&&r.to>t)return r;e&&(r.type!=BlockType.Text||e.type==r.type&&!(i<0?r.from<t:r.to>t))||(e=r)}}return e||n}return n}function moveToLineBoundary(e,t,i,n){let r=blockAt(e,t.head,t.assoc||-1),s=n&&r.type==BlockType.Text&&(e.lineWrapping||r.widgetLineBreaks)?e.coordsAtPos(t.assoc<0&&t.head>r.from?t.head-1:t.head):null;if(s){let t=e.dom.getBoundingClientRect(),n=e.textDirectionAt(r.from),o=e.posAtCoords({x:i==(n==Direction.LTR)?t.right-1:t.left+1,y:(s.top+s.bottom)/2});if(null!=o)return EditorSelection.cursor(o,i?-1:1)}return EditorSelection.cursor(i?r.to:r.from,i?-1:1)}function moveByChar(e,t,i,n){let r=e.state.doc.lineAt(t.head),s=e.bidiSpans(r),o=e.textDirectionAt(r.from);for(let a=t,l=null;;){let t=moveVisually(r,s,o,a,i),c=movedOver;if(!t){if(r.number==(i?e.state.doc.lines:1))return a;c="\n",r=e.state.doc.line(r.number+(i?1:-1)),s=e.bidiSpans(r),t=e.visualLineSide(r,!i)}if(l){if(!l(c))return a}else{if(!n)return t;l=n(c)}a=t}}function byGroup(e,t,i){let n=e.state.charCategorizer(t),r=n(i);return e=>{let t=n(e);return r==CharCategory.Space&&(r=t),r==t}}function moveVertically(e,t,i,n){let r=t.head,s=i?1:-1;if(r==(i?e.state.doc.length:0))return EditorSelection.cursor(r,t.assoc);let o,a=t.goalColumn,l=e.contentDOM.getBoundingClientRect(),c=e.coordsAtPos(r,t.assoc||-1),h=e.documentTop;if(c)null==a&&(a=c.left-l.left),o=s<0?c.top:c.bottom;else{let t=e.viewState.lineBlockAt(r);null==a&&(a=Math.min(l.right-l.left,e.defaultCharacterWidth*(r-t.from))),o=(s<0?t.top:t.bottom)+h}let u=l.left+a,d=null!=n?n:e.viewState.heightOracle.textHeight>>1;for(let p=0;;p+=10){let t=o+(d+p)*s,i=posAtCoords(e,{x:u,y:t},!1,s);if(t<l.top||t>l.bottom||(s<0?i<r:i>r)){let n=e.docView.coordsForChar(i),r=!n||t<n.top?-1:1;return EditorSelection.cursor(i,r,void 0,a)}}}function skipAtomicRanges(e,t,i){for(;;){let n=0;for(let r of e)r.between(t-1,t+1,(e,r,s)=>{if(t>e&&t<r){let s=n||i||(t-e<r-t?-1:1);t=s<0?e:r,n=s}});if(!n)return t}}function skipAtomsForSelection(e,t){let i=null;for(let n=0;n<t.ranges.length;n++){let r=t.ranges[n],s=null;if(r.empty){let t=skipAtomicRanges(e,r.from,0);t!=r.from&&(s=EditorSelection.cursor(t,-1))}else{let t=skipAtomicRanges(e,r.from,-1),i=skipAtomicRanges(e,r.to,1);t==r.from&&i==r.to||(s=EditorSelection.range(r.from==r.anchor?t:i,r.from==r.head?t:i))}s&&(i||(i=t.ranges.slice()),i[n]=s)}return i?EditorSelection.create(i,t.mainIndex):t}function skipAtoms(e,t,i){let n=skipAtomicRanges(e.state.facet(atomicRanges).map(t=>t(e)),i.from,t.head>i.from?-1:1);return n==i.from?i:EditorSelection.cursor(n,n<i.from?1:-1)}const LineBreakPlaceholder="Ôøø";class DOMReader{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(EditorState.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=LineBreakPlaceholder}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let n=e;;){this.findPointBefore(i,n);let e=this.text.length;this.readNode(n);let r=n.nextSibling;if(r==t)break;let s=ContentView.get(n),o=ContentView.get(r);(s&&o?s.breakAfter:(s?s.breakAfter:isBlockElement(n))||isBlockElement(r)&&("BR"!=n.nodeName||n.cmIgnore)&&this.text.length>e)&&!isEmptyToEnd(r,t)&&this.lineBreak(),n=r}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r,s=-1,o=1;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(r=n.exec(t))&&(s=r.index,o=r[0].length),this.append(t.slice(i,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let t of this.points)t.node==e&&t.pos>this.text.length&&(t.pos-=o-1);i=s+o}}readNode(e){if(e.cmIgnore)return;let t=ContentView.get(e),i=t&&t.overrideDOMText;if(null!=i){this.findPointInside(e,i.length);for(let e=i.iter();!e.next().done;)e.lineBreak?this.lineBreak():this.append(e.value)}else 3==e.nodeType?this.readTextNode(e):"BR"==e.nodeName?e.nextSibling&&this.lineBreak():1==e.nodeType&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(3==e.nodeType?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+(isAtEnd(e,i.node,i.offset)?t:0))}}function isAtEnd(e,t,i){for(;;){if(!t||i<maxOffset(t))return!1;if(t==e)return!0;i=domIndex(t)+1,t=t.parentNode}}function isEmptyToEnd(e,t){let i;for(;e!=t&&e;e=e.nextSibling){let t=ContentView.get(e);if(!(null==t?void 0:t.isWidget)&&!e.cmIgnore)return!1;t&&(i||(i=[])).push(t)}if(i)for(let n of i){let e=n.overrideDOMText;if(null==e?void 0:e.length)return!1}return!0}class DOMPoint{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class DOMChange{constructor(e,t,i,n){this.typeOver=n,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:r,impreciseAnchor:s}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,i,0))){let t=r||s?[]:selectionPoints(e),i=new DOMReader(t,e.state);i.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=i.text,this.newSel=selectionFromPoints(t,this.bounds.from)}else{let t=e.observer.selectionRange,i=r&&r.node==t.focusNode&&r.offset==t.focusOffset||!contains(e.contentDOM,t.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(t.focusNode,t.focusOffset),n=s&&s.node==t.anchorNode&&s.offset==t.anchorOffset||!contains(e.contentDOM,t.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(t.anchorNode,t.anchorOffset),o=e.viewport;if((browser.ios||browser.chrome)&&e.state.selection.main.empty&&i!=n&&(o.from>0||o.to<e.state.doc.length)){let t=Math.min(i,n),r=Math.max(i,n),s=o.from-t,a=o.to-r;0!=s&&1!=s&&0!=t||0!=a&&-1!=a&&r!=e.state.doc.length||(i=0,n=e.state.doc.length)}e.inputState.composing>-1&&e.state.selection.ranges.length>1?this.newSel=e.state.selection.replaceRange(EditorSelection.range(n,i)):this.newSel=EditorSelection.single(n,i)}}}function applyDOMChange(e,t){let i,{newSel:n}=t,r=e.state.selection.main,s=e.inputState.lastKeyTime>Date.now()-100?e.inputState.lastKeyCode:-1;if(t.bounds){let{from:n,to:o}=t.bounds,a=r.from,l=null;(8===s||browser.android&&t.text.length<o-n)&&(a=r.to,l="end");let c=findDiff(e.state.doc.sliceString(n,o,LineBreakPlaceholder),t.text,a-n,l);c&&(browser.chrome&&13==s&&c.toB==c.from+2&&t.text.slice(c.from,c.toB)==LineBreakPlaceholder+LineBreakPlaceholder&&c.toB--,i={from:n+c.from,to:n+c.toA,insert:Text.of(t.text.slice(c.from,c.toB).split(LineBreakPlaceholder))})}else n&&(!e.hasFocus&&e.state.facet(editable)||n.main.eq(r))&&(n=null);if(!i&&!n)return!1;if(!i&&t.typeOver&&!r.empty&&n&&n.main.empty?i={from:r.from,to:r.to,insert:e.state.doc.slice(r.from,r.to)}:(browser.mac||browser.android)&&i&&i.from==i.to&&i.from==r.head-1&&/^\. ?$/.test(i.insert.toString())&&"off"==e.contentDOM.getAttribute("autocorrect")?(n&&2==i.insert.length&&(n=EditorSelection.single(n.main.anchor-1,n.main.head-1)),i={from:i.from,to:i.to,insert:Text.of([i.insert.toString().replace("."," ")])}):i&&i.from>=r.from&&i.to<=r.to&&(i.from!=r.from||i.to!=r.to)&&r.to-r.from-(i.to-i.from)<=4?i={from:r.from,to:r.to,insert:e.state.doc.slice(r.from,i.from).append(i.insert).append(e.state.doc.slice(i.to,r.to))}:e.state.doc.lineAt(r.from).to<r.to&&e.docView.lineHasWidget(r.to)&&e.inputState.insertingTextAt>Date.now()-50?i={from:r.from,to:r.to,insert:e.state.toText(e.inputState.insertingText)}:browser.chrome&&i&&i.from==i.to&&i.from==r.head&&"\n "==i.insert.toString()&&e.lineWrapping&&(n&&(n=EditorSelection.single(n.main.anchor-1,n.main.head-1)),i={from:r.from,to:r.to,insert:Text.of([" "])}),i)return applyDOMChangeInner(e,i,n,s);if(n&&!n.main.eq(r)){let t=!1,i="select";return e.inputState.lastSelectionTime>Date.now()-50&&("select"==e.inputState.lastSelectionOrigin&&(t=!0),i=e.inputState.lastSelectionOrigin,"select.pointer"==i&&(n=skipAtomsForSelection(e.state.facet(atomicRanges).map(t=>t(e)),n))),e.dispatch({selection:n,scrollIntoView:t,userEvent:i}),!0}return!1}function applyDOMChangeInner(e,t,i,n=-1){if(browser.ios&&e.inputState.flushIOSKey(t))return!0;let r=e.state.selection.main;if(browser.android&&(t.to==r.to&&(t.from==r.from||t.from==r.from-1&&" "==e.state.sliceDoc(t.from,r.from))&&1==t.insert.length&&2==t.insert.lines&&dispatchKey(e.contentDOM,"Enter",13)||(t.from==r.from-1&&t.to==r.to&&0==t.insert.length||8==n&&t.insert.length<t.to-t.from&&t.to>r.head)&&dispatchKey(e.contentDOM,"Backspace",8)||t.from==r.from&&t.to==r.to+1&&0==t.insert.length&&dispatchKey(e.contentDOM,"Delete",46)))return!0;let s,o=t.insert.toString();e.inputState.composing>=0&&e.inputState.composing++;let a=()=>s||(s=applyDefaultInsert(e,t,i));return e.state.facet(inputHandler$1).some(i=>i(e,t.from,t.to,o,a))||e.dispatch(a()),!0}function applyDefaultInsert(e,t,i){let n,r=e.state,s=r.selection.main,o=-1;if(t.from==t.to&&t.from<s.from||t.from>s.to){let i=t.from<s.from?-1:1,n=i<0?s.from:s.to,a=skipAtomicRanges(r.facet(atomicRanges).map(t=>t(e)),n,i);t.from==a&&(o=a)}if(o>-1)n={changes:t,selection:EditorSelection.cursor(t.from+t.insert.length,-1)};else if(t.from>=s.from&&t.to<=s.to&&t.to-t.from>=(s.to-s.from)/3&&(!i||i.main.empty&&i.main.from==t.from+t.insert.length)&&e.inputState.composing<0){let i=s.from<t.from?r.sliceDoc(s.from,t.from):"",o=s.to>t.to?r.sliceDoc(t.to,s.to):"";n=r.replaceSelection(e.state.toText(i+t.insert.sliceString(0,void 0,e.state.lineBreak)+o))}else{let o=r.changes(t),a=i&&i.main.to<=o.newLength?i.main:void 0;if(r.selection.ranges.length>1&&(e.inputState.composing>=0||e.inputState.compositionPendingChange)&&t.to<=s.to+10&&t.to>=s.to-10){let l,c=e.state.sliceDoc(t.from,t.to),h=i&&findCompositionNode(e,i.main.head);if(h){let e=t.insert.length-(t.to-t.from);l={from:h.from,to:h.to-e}}else l=e.state.doc.lineAt(s.head);let u=s.to-t.to;n=r.changeByRange(i=>{if(i.from==s.from&&i.to==s.to)return{changes:o,range:a||i.map(o)};let n=i.to-u,h=n-c.length;if(e.state.sliceDoc(h,n)!=c||n>=l.from&&h<=l.to)return{range:i};let d=r.changes({from:h,to:n,insert:t.insert}),p=i.to-s.to;return{changes:d,range:a?EditorSelection.range(Math.max(0,a.anchor+p),Math.max(0,a.head+p)):i.map(d)}})}else n={changes:o,selection:a&&r.selection.replaceRange(a)}}let a="input.type";return(e.composing||e.inputState.compositionPendingChange&&e.inputState.compositionEndedAt>Date.now()-50)&&(e.inputState.compositionPendingChange=!1,a+=".compose",e.inputState.compositionFirstChange&&(a+=".start",e.inputState.compositionFirstChange=!1)),r.update(n,{userEvent:a,scrollIntoView:!0})}function findDiff(e,t,i,n){let r=Math.min(e.length,t.length),s=0;for(;s<r&&e.charCodeAt(s)==t.charCodeAt(s);)s++;if(s==r&&e.length==t.length)return null;let o=e.length,a=t.length;for(;o>0&&a>0&&e.charCodeAt(o-1)==t.charCodeAt(a-1);)o--,a--;if("end"==n){i-=o+Math.max(0,s-Math.min(o,a))-s}if(o<s&&e.length<t.length){s-=i<=s&&i>=o?s-i:0,a=s+(a-o),o=s}else if(a<s){s-=i<=s&&i>=a?s-i:0,o=s+(o-a),a=s}return{from:s,toA:o,toB:a}}function selectionPoints(e){let t=[];if(e.root.activeElement!=e.contentDOM)return t;let{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:s}=e.observer.selectionRange;return i&&(t.push(new DOMPoint(i,n)),r==i&&s==n||t.push(new DOMPoint(r,s))),t}function selectionFromPoints(e,t){if(0==e.length)return null;let i=e[0].pos,n=2==e.length?e[1].pos:i;return i>-1&&n>-1?EditorSelection.single(i+t,n+t):null}class InputState{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.insertingText="",this.insertingTextAt=0,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,browser.safari&&e.contentDOM.addEventListener("input",()=>null),browser.gecko&&firefoxCopyCutHack(e.contentDOM.ownerDocument)}handleEvent(e){eventBelongsToEditor(this.view,e)&&!this.ignoreDuringComposition(e)&&("keydown"==e.type&&this.keydown(e)||(0!=this.view.updateState?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e)))}runHandlers(e,t){let i=this.handlers[e];if(i){for(let e of i.observers)e(this.view,t);for(let e of i.handlers){if(t.defaultPrevented)break;if(e(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=computeHandlers(e),i=this.handlers,n=this.view.contentDOM;for(let r in t)if("scroll"!=r){let e=!t[r].handlers.length,s=i[r];s&&e!=!s.handlers.length&&(n.removeEventListener(r,this.handleEvent),s=null),s||n.addEventListener(r,this.handleEvent,{passive:e})}for(let r in i)"scroll"==r||t[r]||n.removeEventListener(r,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),9==e.keyCode&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&27!=e.keyCode&&modifierCodes.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),browser.android&&browser.chrome&&!e.synthetic&&(13==e.keyCode||8==e.keyCode))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return!browser.ios||e.synthetic||e.altKey||e.metaKey||!((t=PendingKeys.find(t=>t.keyCode==e.keyCode))&&!e.ctrlKey||EmacsyPendingKeys.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(229!=e.keyCode&&this.view.observer.forceFlush(),!1):(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0)}flushIOSKey(e){let t=this.pendingIOSKey;return!!t&&(!("Enter"==t.key&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString()))&&(this.pendingIOSKey=void 0,dispatchKey(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0)))}ignoreDuringComposition(e){return!(!/^key/.test(e.type)||e.synthetic)&&(this.composing>0||!!(browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100)&&(this.compositionPendingKey=!1,!0))}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function bindHandler(e,t){return(i,n)=>{try{return t.call(e,n,i)}catch(r){logException(i.state,r)}}}function computeHandlers(e){let t=Object.create(null);function i(e){return t[e]||(t[e]={observers:[],handlers:[]})}for(let n of e){let e=n.spec,t=e&&e.plugin.domEventHandlers,r=e&&e.plugin.domEventObservers;if(t)for(let s in t){let e=t[s];e&&i(s).handlers.push(bindHandler(n.value,e))}if(r)for(let s in r){let e=r[s];e&&i(s).observers.push(bindHandler(n.value,e))}}for(let n in handlers)i(n).handlers.push(handlers[n]);for(let n in observers)i(n).observers.push(observers[n]);return t}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225],dragScrollMargin=6;function dragScrollSpeed(e){return.7*Math.max(0,e)+8}function dist(e,t){return Math.max(Math.abs(e.clientX-t.clientX),Math.abs(e.clientY-t.clientY))}class MouseSelection{constructor(e,t,i,n){this.view=e,this.startEvent=t,this.style=i,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=scrollableParents(e.contentDOM),this.atoms=e.state.facet(atomicRanges).map(t=>t(e));let r=e.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(e,t),this.dragging=!(!isInPrimarySelection(e,t)||1!=getClickType(t))&&null}start(e){!1===this.dragging&&this.select(e)}move(e){if(0==e.buttons)return this.destroy();if(this.dragging||null==this.dragging&&dist(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,i=0,n=0,r=0,s=this.view.win.innerWidth,o=this.view.win.innerHeight;this.scrollParents.x&&({left:n,right:s}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:r,bottom:o}=this.scrollParents.y.getBoundingClientRect());let a=getScrollMargins(this.view);e.clientX-a.left<=n+dragScrollMargin?t=-dragScrollSpeed(n-e.clientX):e.clientX+a.right>=s-dragScrollMargin&&(t=dragScrollSpeed(e.clientX-s)),e.clientY-a.top<=r+dragScrollMargin?i=-dragScrollSpeed(r-e.clientY):e.clientY+a.bottom>=o-dragScrollMargin&&(i=dragScrollSpeed(e.clientY-o)),this.setScrollSpeed(t,i)}up(e){null==this.dragging&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),!1===this.dragging&&this.select(this.lastEvent)}select(e){let{view:t}=this,i=skipAtomsForSelection(this.atoms,this.style.get(e,this.extend,this.multiple));!this.mustSelect&&i.eq(t.state.selection,!1===this.dragging)||this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(e=>e.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function addsSelectionRange(e,t){let i=e.state.facet(clickAddsSelectionRange);return i.length?i[0](t):browser.mac?t.metaKey:t.ctrlKey}function dragMovesSelection(e,t){let i=e.state.facet(dragMovesSelection$1);return i.length?i[0](t):browser.mac?!t.altKey:!t.ctrlKey}function isInPrimarySelection(e,t){let{main:i}=e.state.selection;if(i.empty)return!1;let n=getSelection(e.root);if(!n||0==n.rangeCount)return!0;let r=n.getRangeAt(0).getClientRects();for(let s=0;s<r.length;s++){let e=r[s];if(e.left<=t.clientX&&e.right>=t.clientX&&e.top<=t.clientY&&e.bottom>=t.clientY)return!0}return!1}function eventBelongsToEditor(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let i,n=t.target;n!=e.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=ContentView.get(n))&&i.ignoreEvent(t))return!1;return!0}const handlers=Object.create(null),observers=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(e){let t=e.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout(()=>{e.focus(),i.remove(),doPaste(e,i.value)},50)}function textFilter(e,t,i){for(let n of e.facet(t))i=n(i,e);return i}function doPaste(e,t){t=textFilter(e.state,clipboardInputFilter,t);let i,{state:n}=e,r=1,s=n.toText(t),o=s.lines==n.selection.ranges.length;if(null!=lastLinewiseCopy&&n.selection.ranges.every(e=>e.empty)&&lastLinewiseCopy==s.toString()){let e=-1;i=n.changeByRange(i=>{let a=n.doc.lineAt(i.from);if(a.from==e)return{range:i};e=a.from;let l=n.toText((o?s.line(r++).text:t)+n.lineBreak);return{changes:{from:a.from,insert:l},range:EditorSelection.cursor(i.from+l.length)}})}else i=o?n.changeByRange(e=>{let t=s.line(r++);return{changes:{from:e.from,to:e.to,insert:t.text},range:EditorSelection.cursor(e.from+t.length)}}):n.replaceSelection(s);e.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}function rangeForClick(e,t,i,n){if(1==n)return EditorSelection.cursor(t,i);if(2==n)return groupAt(e.state,t,i);{let i=LineView.find(e.docView,t),n=e.state.doc.lineAt(i?i.posAtEnd:t),r=i?i.posAtStart:n.from,s=i?i.posAtEnd:n.to;return s<e.state.doc.length&&s==n.to&&s++,EditorSelection.range(r,s)}}observers.scroll=e=>{e.inputState.lastScrollTop=e.scrollDOM.scrollTop,e.inputState.lastScrollLeft=e.scrollDOM.scrollLeft},handlers.keydown=(e,t)=>(e.inputState.setSelectionOrigin("select"),27==t.keyCode&&0!=e.inputState.tabFocusMode&&(e.inputState.tabFocusMode=Date.now()+2e3),!1),observers.touchstart=(e,t)=>{e.inputState.lastTouchTime=Date.now(),e.inputState.setSelectionOrigin("select.pointer")},observers.touchmove=e=>{e.inputState.setSelectionOrigin("select.pointer")},handlers.mousedown=(e,t)=>{if(e.observer.flush(),e.inputState.lastTouchTime>Date.now()-2e3)return!1;let i=null;for(let n of e.state.facet(mouseSelectionStyle))if(i=n(e,t),i)break;if(i||0!=t.button||(i=basicMouseSelection(e,t)),i){let n=!e.hasFocus;e.inputState.startMouseSelection(new MouseSelection(e,t,i,n)),n&&e.observer.ignore(()=>{focusPreventScroll(e.contentDOM);let t=e.root.activeElement;t&&!t.contains(e.contentDOM)&&t.blur()});let r=e.inputState.mouseSelection;if(r)return r.start(t),!1===r.dragging}else e.inputState.setSelectionOrigin("select.pointer");return!1};let inside=(e,t,i)=>t>=i.top&&t<=i.bottom&&e>=i.left&&e<=i.right;function findPositionSide(e,t,i,n){let r=LineView.find(e.docView,t);if(!r)return 1;let s=t-r.posAtStart;if(0==s)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&inside(i,n,o))return-1;let a=r.coordsAt(s,1);return a&&inside(i,n,a)?1:o&&o.bottom>=n?-1:1}function queryPos(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:i,bias:findPositionSide(e,i,t.clientX,t.clientY)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(e){if(!BadMouseDetail)return e.detail;let t=lastMouseDown,i=lastMouseDownTime;return lastMouseDown=e,lastMouseDownTime=Date.now(),lastMouseDownCount=!t||i>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(e,t){let i=queryPos(e,t),n=getClickType(t),r=e.state.selection;return{update(e){e.docChanged&&(i.pos=e.changes.mapPos(i.pos),r=r.map(e.changes))},get(t,s,o){let a,l=queryPos(e,t),c=rangeForClick(e,l.pos,l.bias,n);if(i.pos!=l.pos&&!s){let t=rangeForClick(e,i.pos,i.bias,n),r=Math.min(t.from,c.from),s=Math.max(t.to,c.to);c=r<c.from?EditorSelection.range(r,s):EditorSelection.range(s,r)}return s?r.replaceRange(r.main.extend(c.from,c.to)):o&&1==n&&r.ranges.length>1&&(a=removeRangeAround(r,l.pos))?a:o?r.addRange(c):EditorSelection.create([c])}}}function removeRangeAround(e,t){for(let i=0;i<e.ranges.length;i++){let{from:n,to:r}=e.ranges[i];if(n<=t&&r>=t)return EditorSelection.create(e.ranges.slice(0,i).concat(e.ranges.slice(i+1)),e.mainIndex==i?0:e.mainIndex-(e.mainIndex>i?1:0))}return null}function dropText(e,t,i,n){if(!(i=textFilter(e.state,clipboardInputFilter,i)))return;let r=e.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:s}=e.inputState,o=n&&s&&dragMovesSelection(e,t)?{from:s.from,to:s.to}:null,a={from:r,insert:i},l=e.state.changes(o?[o,a]:a);e.focus(),e.dispatch({changes:l,selection:{anchor:l.mapPos(r,-1),head:l.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"}),e.inputState.draggedContent=null}function captureCopy(e,t){let i=e.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=t,n.focus(),n.selectionEnd=t.length,n.selectionStart=0,setTimeout(()=>{n.remove(),e.focus()},50)}function copiedRange(e){let t=[],i=[],n=!1;for(let r of e.selection.ranges)r.empty||(t.push(e.sliceDoc(r.from,r.to)),i.push(r));if(!t.length){let r=-1;for(let{from:n}of e.selection.ranges){let s=e.doc.lineAt(n);s.number>r&&(t.push(s.text),i.push({from:s.from,to:Math.min(e.doc.length,s.to+1)})),r=s.number}n=!0}return{text:textFilter(e,clipboardOutputFilter,t.join(e.lineBreak)),ranges:i,linewise:n}}handlers.dragstart=(e,t)=>{let{selection:{main:i}}=e.state;if(t.target.draggable){let n=e.docView.nearest(t.target);if(n&&n.isWidget){let e=n.posAtStart,t=e+n.length;(e>=i.to||t<=i.from)&&(i=EditorSelection.range(e,t))}}let{inputState:n}=e;return n.mouseSelection&&(n.mouseSelection.dragging=!0),n.draggedContent=i,t.dataTransfer&&(t.dataTransfer.setData("Text",textFilter(e.state,clipboardOutputFilter,e.state.sliceDoc(i.from,i.to))),t.dataTransfer.effectAllowed="copyMove"),!1},handlers.dragend=e=>(e.inputState.draggedContent=null,!1),handlers.drop=(e,t)=>{if(!t.dataTransfer)return!1;if(e.state.readOnly)return!0;let i=t.dataTransfer.files;if(i&&i.length){let n=Array(i.length),r=0,s=()=>{++r==i.length&&dropText(e,t,n.filter(e=>null!=e).join(e.state.lineBreak),!1)};for(let e=0;e<i.length;e++){let t=new FileReader;t.onerror=s,t.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(t.result)||(n[e]=t.result),s()},t.readAsText(i[e])}return!0}{let i=t.dataTransfer.getData("Text");if(i)return dropText(e,t,i,!0),!0}return!1},handlers.paste=(e,t)=>{if(e.state.readOnly)return!0;e.observer.flush();let i=brokenClipboardAPI?null:t.clipboardData;return i?(doPaste(e,i.getData("text/plain")||i.getData("text/uri-list")),!0):(capturePaste(e),!1)};let lastLinewiseCopy=null;handlers.copy=handlers.cut=(e,t)=>{let{text:i,ranges:n,linewise:r}=copiedRange(e.state);if(!i&&!r)return!1;lastLinewiseCopy=r?i:null,"cut"!=t.type||e.state.readOnly||e.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let s=brokenClipboardAPI?null:t.clipboardData;return s?(s.clearData(),s.setData("text/plain",i),!0):(captureCopy(e,i),!1)};const isFocusChange=Annotation.define();function focusChangeTransaction(e,t){let i=[];for(let n of e.facet(focusChangeEffect)){let r=n(e,t);r&&i.push(r)}return i.length?e.update({effects:i,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(e){setTimeout(()=>{let t=e.hasFocus;if(t!=e.inputState.notifiedFocused){let i=focusChangeTransaction(e.state,t);i?e.dispatch(i):e.update([])}},10)}observers.focus=e=>{e.inputState.lastFocusTime=Date.now(),e.scrollDOM.scrollTop||!e.inputState.lastScrollTop&&!e.inputState.lastScrollLeft||(e.scrollDOM.scrollTop=e.inputState.lastScrollTop,e.scrollDOM.scrollLeft=e.inputState.lastScrollLeft),updateForFocusChange(e)},observers.blur=e=>{e.observer.clearSelectionRange(),updateForFocusChange(e)},observers.compositionstart=observers.compositionupdate=e=>{e.observer.editContext||(null==e.inputState.compositionFirstChange&&(e.inputState.compositionFirstChange=!0),e.inputState.composing<0&&(e.inputState.composing=0))},observers.compositionend=e=>{e.observer.editContext||(e.inputState.composing=-1,e.inputState.compositionEndedAt=Date.now(),e.inputState.compositionPendingKey=!0,e.inputState.compositionPendingChange=e.observer.pendingRecords().length>0,e.inputState.compositionFirstChange=null,browser.chrome&&browser.android?e.observer.flushSoon():e.inputState.compositionPendingChange?Promise.resolve().then(()=>e.observer.flush()):setTimeout(()=>{e.inputState.composing<0&&e.docView.hasComposition&&e.update([])},50))},observers.contextmenu=e=>{e.inputState.lastContextMenu=Date.now()},handlers.beforeinput=(e,t)=>{var i,n;if("insertText"!=t.inputType&&"insertCompositionText"!=t.inputType||(e.inputState.insertingText=t.data,e.inputState.insertingTextAt=Date.now()),"insertReplacementText"==t.inputType&&e.observer.editContext){let n=null===(i=t.dataTransfer)||void 0===i?void 0:i.getData("text/plain"),r=t.getTargetRanges();if(n&&r.length){let t=r[0],i=e.posAtDOM(t.startContainer,t.startOffset),s=e.posAtDOM(t.endContainer,t.endOffset);return applyDOMChangeInner(e,{from:i,to:s,insert:e.state.toText(n)},null),!0}}let r;if(browser.chrome&&browser.android&&(r=PendingKeys.find(e=>e.inputType==t.inputType))&&(e.observer.delayAndroidKey(r.key,r.keyCode),"Backspace"==r.key||"Delete"==r.key)){let t=(null===(n=window.visualViewport)||void 0===n?void 0:n.height)||0;setTimeout(()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>t+10&&e.hasFocus&&(e.contentDOM.blur(),e.focus())},100)}return browser.ios&&"deleteContentForward"==t.inputType&&e.observer.flushSoon(),browser.safari&&"insertText"==t.inputType&&e.inputState.composing>=0&&setTimeout(()=>observers.compositionend(e,t),20),!1};const appliedFirefoxHack=new Set;function firefoxCopyCutHack(e){appliedFirefoxHack.has(e)||(appliedFirefoxHack.add(e),e.addEventListener("copy",()=>{}),e.addEventListener("cut",()=>{}))}const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];let heightChangeFlag=!1;function clearHeightChangeFlag(){heightChangeFlag=!1}class HeightOracle{constructor(e){this.lineWrapping=e,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return wrappingWhiteSpace.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let n=e[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(t=!0,this.heightSamples[Math.floor(10*n)]=!0)}return t}refresh(e,t,i,n,r,s){let o=wrappingWhiteSpace.indexOf(e)>-1,a=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=t,this.charWidth=i,this.textHeight=n,this.lineLength=r,a){this.heightSamples={};for(let e=0;e<s.length;e++){let t=s[e];t<0?e++:this.heightSamples[Math.floor(10*t)]=!0}}return a}}class MeasuredHeights{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(e,t,i,n,r){this.from=e,this.length=t,this.top=i,this.height=n,this._content=r}get type(){return"number"==typeof this._content?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof PointDecoration?this._content.widget:null}get widgetLineBreaks(){return"number"==typeof this._content?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new BlockInfo(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var QueryType$1=function(e){return e[e.ByPos=0]="ByPos",e[e.ByHeight=1]="ByHeight",e[e.ByPosNoHeight=2]="ByPosNoHeight",e}(QueryType$1||(QueryType$1={}));const Epsilon=.001;class HeightMap{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(e){this.flags=(e?2:0)|-3&this.flags}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Epsilon&&(heightChangeFlag=!0),this.height=e)}replace(e,t,i){return HeightMap.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,n){let r=this,s=i.doc;for(let o=n.length-1;o>=0;o--){let{fromA:a,toA:l,fromB:c,toB:h}=n[o],u=r.lineAt(a,QueryType$1.ByPosNoHeight,i.setDoc(t),0,0),d=u.to>=l?u:r.lineAt(l,QueryType$1.ByPosNoHeight,i,0,0);for(h+=d.to-l,l=d.to;o>0&&u.from<=n[o-1].toA;)a=n[o-1].fromA,c=n[o-1].fromB,o--,a<u.from&&(u=r.lineAt(a,QueryType$1.ByPosNoHeight,i,0,0));c+=u.from-a,a=u.from;let p=NodeBuilder.build(i.setDoc(s),e,c,h);r=replace(r,r.replace(a,l,p))}return r.updateHeight(i,0)}static empty(){return new HeightMapText(0,0)}static of(e){if(1==e.length)return e[0];let t=0,i=e.length,n=0,r=0;for(;;)if(t==i)if(n>2*r){let r=e[t-1];r.break?e.splice(--t,1,r.left,null,r.right):e.splice(--t,1,r.left,r.right),i+=1+r.break,n-=r.size}else{if(!(r>2*n))break;{let t=e[i];t.break?e.splice(i,1,t.left,null,t.right):e.splice(i,1,t.left,t.right),i+=2+t.break,r-=t.size}}else if(n<r){let i=e[t++];i&&(n+=i.size)}else{let t=e[--i];t&&(r+=t.size)}let s=0;return null==e[t-1]?(s=1,t--):null==e[t]&&(s=1,i++),new HeightMapBranch(HeightMap.of(e.slice(0,t)),s,HeightMap.of(e.slice(i)))}}function replace(e,t){return e==t?e:(e.constructor!=t.constructor&&(heightChangeFlag=!0),t)}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(e,t,i){super(e,t),this.deco=i}blockAt(e,t,i,n){return new BlockInfo(n,this.length,i,this.height,this.deco||0)}lineAt(e,t,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(e,t,i,n,r,s){e<=r+this.length&&t>=r&&s(this.blockAt(0,i,n,r))}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more&&this.setHeight(n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,i,n){return new BlockInfo(n,this.length,i,this.height,this.breaks)}replace(e,t,i){let n=i[0];return 1==i.length&&(n instanceof HeightMapText||n instanceof HeightMapGap&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof HeightMapGap?n=new HeightMapText(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):HeightMap.of(i)}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more?this.setHeight(n.heights[n.index++]):(i||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(e){super(e,0)}heightMetrics(e,t){let i,n=e.doc.lineAt(t).number,r=e.doc.lineAt(t+this.length).number,s=r-n+1,o=0;if(e.lineWrapping){let t=Math.min(this.height,e.lineHeight*s);i=t/s,this.length>s+1&&(o=(this.height-t)/(this.length-s-1))}else i=this.height/s;return{firstLine:n,lastLine:r,perLine:i,perChar:o}}blockAt(e,t,i,n){let{firstLine:r,lastLine:s,perLine:o,perChar:a}=this.heightMetrics(t,n);if(t.lineWrapping){let r=n+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length)),s=t.doc.lineAt(r),l=o+s.length*a,c=Math.max(i,e-l/2);return new BlockInfo(s.from,s.length,c,l,0)}{let n=Math.max(0,Math.min(s-r,Math.floor((e-i)/o))),{from:a,length:l}=t.doc.line(r+n);return new BlockInfo(a,l,i+o*n,o,0)}}lineAt(e,t,i,n,r){if(t==QueryType$1.ByHeight)return this.blockAt(e,i,n,r);if(t==QueryType$1.ByPosNoHeight){let{from:t,to:n}=i.doc.lineAt(e);return new BlockInfo(t,n-t,0,0,0)}let{firstLine:s,perLine:o,perChar:a}=this.heightMetrics(i,r),l=i.doc.lineAt(e),c=o+l.length*a,h=l.number-s,u=n+o*h+a*(l.from-r-h);return new BlockInfo(l.from,l.length,Math.max(n,Math.min(u,n+this.height-c)),c,0)}forEachLine(e,t,i,n,r,s){e=Math.max(e,r),t=Math.min(t,r+this.length);let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(i,r);for(let c=e,h=n;c<=t;){let t=i.doc.lineAt(c);if(c==e){let i=t.number-o;h+=a*i+l*(e-r-i)}let n=a+l*t.length;s(new BlockInfo(t.from,t.length,h,n,0)),h+=n,c=t.to+1}}replace(e,t,i){let n=this.length-t;if(n>0){let e=i[i.length-1];e instanceof HeightMapGap?i[i.length-1]=new HeightMapGap(e.length+n):i.push(null,new HeightMapGap(n-1))}if(e>0){let t=i[0];t instanceof HeightMapGap?i[0]=new HeightMapGap(e+t.length):i.unshift(new HeightMapGap(e-1),null)}return HeightMap.of(i)}decomposeLeft(e,t){t.push(new HeightMapGap(e-1),null)}decomposeRight(e,t){t.push(null,new HeightMapGap(this.length-e-1))}updateHeight(e,t=0,i=!1,n){let r=t+this.length;if(n&&n.from<=t+this.length&&n.more){let i=[],s=Math.max(t,n.from),o=-1;for(n.from>t&&i.push(new HeightMapGap(n.from-t-1).updateHeight(e,t));s<=r&&n.more;){let t=e.doc.lineAt(s).length;i.length&&i.push(null);let r=n.heights[n.index++];-1==o?o=r:Math.abs(r-o)>=Epsilon&&(o=-2);let a=new HeightMapText(t,r);a.outdated=!1,i.push(a),s+=t+1}s<=r&&i.push(null,new HeightMapGap(r-s).updateHeight(e,s));let a=HeightMap.of(i);return(o<0||Math.abs(a.height-this.height)>=Epsilon||Math.abs(o-this.heightMetrics(e,t).perLine)>=Epsilon)&&(heightChangeFlag=!0),replace(this,a)}return(i||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return 1&this.flags}blockAt(e,t,i,n){let r=i+this.left.height;return e<r?this.left.blockAt(e,t,i,n):this.right.blockAt(e,t,r,n+this.left.length+this.break)}lineAt(e,t,i,n,r){let s=n+this.left.height,o=r+this.left.length+this.break,a=t==QueryType$1.ByHeight?e<s:e<o,l=a?this.left.lineAt(e,t,i,n,r):this.right.lineAt(e,t,i,s,o);if(this.break||(a?l.to<o:l.from>o))return l;let c=t==QueryType$1.ByPosNoHeight?QueryType$1.ByPosNoHeight:QueryType$1.ByPos;return a?l.join(this.right.lineAt(o,c,i,s,o)):this.left.lineAt(o,c,i,n,r).join(l)}forEachLine(e,t,i,n,r,s){let o=n+this.left.height,a=r+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,n,r,s),t>=a&&this.right.forEachLine(e,t,i,o,a,s);else{let l=this.lineAt(a,QueryType$1.ByPos,i,n,r);e<l.from&&this.left.forEachLine(e,l.from-1,i,n,r,s),l.to>=e&&l.from<=t&&s(l),t>l.to&&this.right.forEachLine(l.to+1,t,i,o,a,s)}}replace(e,t,i){let n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,i));let r=[];e>0&&this.decomposeLeft(e,r);let s=r.length;for(let o of i)r.push(o);if(e>0&&mergeGaps(r,s-1),t<this.length){let e=r.length;this.decomposeRight(t,r),mergeGaps(r,e)}return HeightMap.of(r)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,n=i+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<n&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?HeightMap.of(this.break?[e,null,t]:[e,t]):(this.left=replace(this.left,e),this.right=replace(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,n){let{left:r,right:s}=this,o=t+r.length+this.break,a=null;return n&&n.from<=t+r.length&&n.more?a=r=r.updateHeight(e,t,i,n):r.updateHeight(e,t,i),n&&n.from<=o+s.length&&n.more?a=s=s.updateHeight(e,o,i,n):s.updateHeight(e,o,i),a?this.balanced(r,s):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(e,t){let i,n;null==e[t]&&(i=e[t-1])instanceof HeightMapGap&&(n=e[t+1])instanceof HeightMapGap&&e.splice(t-1,3,new HeightMapGap(i.length+1+n.length))}const relevantWidgetHeight=5;class NodeBuilder{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let e=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof HeightMapText?i.length+=e-this.pos:(e>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(e-this.pos,-1)),this.writtenTo=e,t>e&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0,r=i.widget?i.widget.lineBreaks:0;n<0&&(n=this.oracle.lineHeight);let s=t-e;i.block?this.addBlock(new HeightMapBlock(s,n,i)):(s||r||n>=relevantWidgetHeight)&&this.addLineDeco(n,r,s)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new HeightMapText(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new HeightMapGap(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;let t=new HeightMapText(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,i){let n=this.ensureLine();n.length+=i,n.collapsed+=i,n.widgetHeight=Math.max(n.widgetHeight,e),n.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||t instanceof HeightMapText||this.isCovered?(this.writtenTo<this.pos||null==t)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new HeightMapText(0,-1));let i=e;for(let n of this.nodes)n instanceof HeightMapText&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(e,t,i,n){let r=new NodeBuilder(i,e);return RangeSet.spans(t,i,n,r,0),r.finish(i)}}function heightRelevantDecoChanges(e,t,i){let n=new DecorationComparator;return RangeSet.compare(e,t,i,n,0),n.changes}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,n){(e<t||i&&i.heightRelevant||n&&n.heightRelevant)&&addRange(e,t,this.changes,5)}}function visiblePixelRange(e,t){let i=e.getBoundingClientRect(),n=e.ownerDocument,r=n.defaultView||window,s=Math.max(0,i.left),o=Math.min(r.innerWidth,i.right),a=Math.max(0,i.top),l=Math.min(r.innerHeight,i.bottom);for(let c=e.parentNode;c&&c!=n.body;)if(1==c.nodeType){let t=c,i=window.getComputedStyle(t);if((t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)&&"visible"!=i.overflow){let i=t.getBoundingClientRect();s=Math.max(s,i.left),o=Math.min(o,i.right),a=Math.max(a,i.top),l=Math.min(c==e.parentNode?r.innerHeight:l,i.bottom)}c="absolute"==i.position||"fixed"==i.position?t.offsetParent:t.parentNode}else{if(11!=c.nodeType)break;c=c.host}return{left:s-i.left,right:Math.max(s,o)-i.left,top:a-(i.top+t),bottom:Math.max(a,l)-(i.top+t)}}function inWindow(e){let t=e.getBoundingClientRect(),i=e.ownerDocument.defaultView||window;return t.left<i.innerWidth&&t.right>0&&t.top<i.innerHeight&&t.bottom>0}function fullPixelRange(e,t){let i=e.getBoundingClientRect();return{left:0,right:i.right-i.left,top:t,bottom:i.bottom-(i.top+t)}}class LineGap{constructor(e,t,i,n){this.from=e,this.to=t,this.size=i,this.displaySize=n}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let n=e[i],r=t[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(e,t){return Decoration.replace({widget:new LineGapWidget(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(contentAttributes).some(e=>"function"!=typeof e&&"cm-lineWrapping"==e.class);this.heightOracle=new HeightOracle(t),this.stateDeco=e.facet(decorations).filter(e=>"function"!=typeof e),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map(e=>e.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let n=i?t.head:t.anchor;if(!e.some(({from:e,to:t})=>n>=e&&n<=t)){let{from:t,to:i}=this.lineBlockAt(n);e.push(new Viewport(t,i))}}return this.viewports=e.sort((e,t)=>e.from-t.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(scaleBlock(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter(e=>"function"!=typeof e);let n=e.changedRanges,r=ChangedRange.extendWithRanges(n,heightRelevantDecoChanges(i,this.stateDeco,e?e.changes:ChangeSet.empty(this.state.doc.length))),s=this.heightMap.height,o=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);clearHeightChangeFlag(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),r),(this.heightMap.height!=s||heightChangeFlag)&&(e.flags|=2),o?(this.scrollAnchorPos=e.changes.mapPos(o.from,-1),this.scrollAnchorHeight=o.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=s);let a=r.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let l=a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,e.flags|=this.updateForViewport(),(l||!e.changes.empty||2&e.flags)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection="rtl"==i.direction?Direction.RTL:Direction.LTR;let s=this.heightOracle.mustRefreshForWrapping(r),o=t.getBoundingClientRect(),a=s||this.mustMeasureContent||this.contentDOMHeight!=o.height;this.contentDOMHeight=o.height,this.mustMeasureContent=!1;let l=0,c=0;if(o.width&&o.height){let{scaleX:e,scaleY:i}=getScale(t,o);(e>.005&&Math.abs(this.scaleX-e)>.005||i>.005&&Math.abs(this.scaleY-i)>.005)&&(this.scaleX=e,this.scaleY=i,l|=16,s=a=!0)}let h=(parseInt(i.paddingTop)||0)*this.scaleY,u=(parseInt(i.paddingBottom)||0)*this.scaleY;this.paddingTop==h&&this.paddingBottom==u||(this.paddingTop=h,this.paddingBottom=u,l|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,l|=16);let d=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=d&&(this.scrollAnchorHeight=-1,this.scrollTop=d),this.scrolledToBottom=isScrolledToBottom(e.scrollDOM);let p=(this.printing?fullPixelRange:visiblePixelRange)(t,this.paddingTop),f=p.top-this.pixelViewport.top,m=p.bottom-this.pixelViewport.bottom;this.pixelViewport=p;let g=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(g!=this.inView&&(this.inView=g,g&&(a=!0)),!this.inView&&!this.scrollTarget&&!inWindow(e.dom))return 0;let y=o.width;if(this.contentDOMWidth==y&&this.editorHeight==e.scrollDOM.clientHeight||(this.contentDOMWidth=o.width,this.editorHeight=e.scrollDOM.clientHeight,l|=16),a){let t=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(t)&&(s=!0),s||n.lineWrapping&&Math.abs(y-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:o,textHeight:a}=e.docView.measureTextSize();s=i>0&&n.refresh(r,i,o,a,Math.max(5,y/o),t),s&&(e.docView.minWidth=0,l|=16)}f>0&&m>0?c=Math.max(f,m):f<0&&m<0&&(c=Math.min(f,m)),clearHeightChangeFlag();for(let i of this.viewports){let r=i.from==this.viewport.from?t:e.docView.measureVisibleLineHeights(i);this.heightMap=(s?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(n,0,s,new MeasuredHeights(i.from,r))}heightChangeFlag&&(l|=2)}let _=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return _&&(2&l&&(l|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),l|=this.updateForViewport()),(2&l||_)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(s?[]:this.lineGaps,e)),l|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),l}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,r=this.heightOracle,{visibleTop:s,visibleBottom:o}=this,a=new Viewport(n.lineAt(s-1e3*i,QueryType$1.ByHeight,r,0,0).from,n.lineAt(o+1e3*(1-i),QueryType$1.ByHeight,r,0,0).to);if(t){let{head:e}=t.range;if(e<a.from||e>a.to){let i,s=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(e,QueryType$1.ByPos,r,0,0);i="center"==t.y?(o.top+o.bottom)/2-s/2:"start"==t.y||"nearest"==t.y&&e<a.from?o.top:o.bottom-s,a=new Viewport(n.lineAt(i-500,QueryType$1.ByHeight,r,0,0).from,n.lineAt(i+s+500,QueryType$1.ByHeight,r,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(i,QueryType$1.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(n,QueryType$1.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),{bottom:r}=this.heightMap.lineAt(t,QueryType$1.ByPos,this.heightOracle,0,0),{visibleTop:s,visibleBottom:o}=this;return(0==e||n<=s-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||r>=o+Math.max(10,Math.min(i,250)))&&n>s-2e3&&r<o+2e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let n of e)t.touchesRange(n.from,n.to)||i.push(new LineGap(t.mapPos(n.from),t.mapPos(n.to),n.size,n.displaySize));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,n=i?1e4:2e3,r=n>>1,s=n<<1;if(this.defaultTextDirection!=Direction.LTR&&!i)return[];let o=[],a=(n,s,l,c)=>{if(s-n<r)return;let h=this.state.selection.main,u=[h.from];h.empty||u.push(h.to);for(let e of u)if(e>n&&e<s)return a(n,e-10,l,c),void a(e+10,s,l,c);let d=find(e,e=>e.from>=l.from&&e.to<=l.to&&Math.abs(e.from-n)<r&&Math.abs(e.to-s)<r&&!u.some(t=>e.from<t&&e.to>t));if(!d){if(s<l.to&&t&&i&&t.visibleRanges.some(e=>e.from<=s&&e.to>=s)){let e=t.moveToLineBoundary(EditorSelection.cursor(s),!1,!0).head;e>n&&(s=e)}let e=this.gapSize(l,n,s,c);d=new LineGap(n,s,e,i||e<2e6?e:2e6)}o.push(d)},l=t=>{if(t.length<s||t.type!=BlockType.Text)return;let r=lineStructure(t.from,t.to,this.stateDeco);if(r.total<s)return;let o,l,c=this.scrollTarget?this.scrollTarget.range.head:null;if(i){let e,i,s=n/this.heightOracle.lineLength*this.heightOracle.lineHeight;if(null!=c){let n=findFraction(r,c),o=((this.visibleBottom-this.visibleTop)/2+s)/t.height;e=n-o,i=n+o}else e=(this.visibleTop-t.top-s)/t.height,i=(this.visibleBottom-t.top+s)/t.height;o=findPosition(r,e),l=findPosition(r,i)}else{let i=r.total*this.heightOracle.charWidth,s=n*this.heightOracle.charWidth,a=0;if(i>2e6)for(let n of e)n.from>=t.from&&n.from<t.to&&n.size!=n.displaySize&&n.from*this.heightOracle.charWidth+a<this.pixelViewport.left&&(a=n.size-n.displaySize);let h,u,d=this.pixelViewport.left+a,p=this.pixelViewport.right+a;if(null!=c){let e=findFraction(r,c),t=((p-d)/2+s)/i;h=e-t,u=e+t}else h=(d-s)/i,u=(p+s)/i;o=findPosition(r,h),l=findPosition(r,u)}o>t.from&&a(t.from,o,t,r),l<t.to&&a(l,t.to,t,r)};for(let c of this.viewportLines)Array.isArray(c.type)?c.type.forEach(l):l(c);return o}gapSize(e,t,i,n){let r=findFraction(n,i)-findFraction(n,t);return this.heightOracle.lineWrapping?e.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(e){LineGap.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Decoration.set(e.map(e=>e.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let i=[];RangeSet.spans(t,this.viewport.from,this.viewport.to,{span(e,t){i.push({from:e,to:t})},point(){}},20);let n=0;if(i.length!=this.visibleRanges.length)n=12;else for(let r=0;r<i.length&&!(8&n);r++){let t=this.visibleRanges[r],s=i[r];t.from==s.from&&t.to==s.to||(n|=4,e&&e.mapPos(t.from,-1)==s.from&&e.mapPos(t.to,1)==s.to||(n|=8))}return this.visibleRanges=i,n}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||scaleBlock(this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e),QueryType$1.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(e,t){this.from=e,this.to=t}}function lineStructure(e,t,i){let n=[],r=e,s=0;return RangeSet.spans(i,e,t,{span(){},point(e,t){e>r&&(n.push({from:r,to:e}),s+=e-r),r=t}},20),r<t&&(n.push({from:r,to:t}),s+=t-r),{total:s,ranges:n}}function findPosition({total:e,ranges:t},i){if(i<=0)return t[0].from;if(i>=1)return t[t.length-1].to;let n=Math.floor(e*i);for(let r=0;;r++){let{from:e,to:i}=t[r],s=i-e;if(n<=s)return e+n;n-=s}}function findFraction(e,t){let i=0;for(let{from:n,to:r}of e.ranges){if(t<=r){i+=t-n;break}i+=r-n}return i/e.total}function find(e,t){for(let i of e)if(t(i))return i}const IdScaler={toDOM:e=>e,fromDOM:e=>e,scale:1,eq(e){return e==this}};class BigScaler{constructor(e,t,i){let n=0,r=0,s=0;this.viewports=i.map(({from:i,to:r})=>{let s=t.lineAt(i,QueryType$1.ByPos,e,0,0).top,o=t.lineAt(r,QueryType$1.ByPos,e,0,0).bottom;return n+=o-s,{from:i,to:r,top:s,bottom:o,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(t.height-n);for(let o of this.viewports)o.domTop=s+(o.top-r)*this.scale,s=o.domBottom=o.domTop+(o.bottom-o.top),r=o.bottom}toDOM(e){for(let t=0,i=0,n=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.top)return n+(e-i)*this.scale;if(e<=r.bottom)return r.domTop+(e-r.top);i=r.bottom,n=r.domBottom}}fromDOM(e){for(let t=0,i=0,n=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.domTop)return i+(e-n)/this.scale;if(e<=r.domBottom)return r.top+(e-r.domTop);i=r.bottom,n=r.domBottom}}eq(e){return e instanceof BigScaler&&(this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,i)=>t.from==e.viewports[i].from&&t.to==e.viewports[i].to))}}function scaleBlock(e,t){if(1==t.scale)return e;let i=t.toDOM(e.top),n=t.toDOM(e.bottom);return new BlockInfo(e.from,e.length,i,n-i,Array.isArray(e._content)?e._content.map(e=>scaleBlock(e,t)):e._content)}const theme=Facet.define({combine:e=>e.join(" ")}),darkTheme=Facet.define({combine:e=>e.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(e,t,i){return new StyleModule(t,{finish:t=>/&/.test(t)?t.replace(/&\w*/,t=>{if("&"==t)return e;if(!i||!i[t])throw new RangeError(`Unsupported selector: ${t}`);return i[t]}):e+" "+t})}const baseTheme$1$3=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:'url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>\')',backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs),observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let e of t)this.queue.push(e);(browser.ie&&browser.ie_version<=11||browser.ios&&e.composing)&&t.some(e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length)?this.flushSoon():this.flush()}),!window.EditContext||!browser.android||!1===e.constructor.EDIT_CONTEXT||browser.chrome&&browser.chrome_version<126||(this.editContext=new EditContextManager(e),e.state.facet(editable)&&(e.contentDOM.editContext=this.editContext.editContext)),useCharData&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),"function"==typeof ResizeObserver&&(this.resizeScroll=new ResizeObserver(()=>{var e;(null===(e=this.view.docView)||void 0===e?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver(e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){("change"!=e.type&&e.type||e.matches)&&(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,n=this.selectionRange;if(i.state.facet(editable)?i.root.activeElement!=this.dom:!hasSelection(this.dom,n))return;let r=n.anchorNode&&i.docView.nearest(n.anchorNode);r&&r.ignoreEvent(e)?t||(this.selectionChanged=!1):(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!i.state.selection.main.empty&&n.focusNode&&isEquivalentPosition(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=getSelection(e.root);if(!t)return!1;let i=browser.safari&&11==e.root.nodeType&&e.root.activeElement==this.dom&&safariSelectionRangeHack(this.view,t)||t;if(!i||this.selectionRange.eq(i))return!1;let n=hasSelection(this.dom,i);return n&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),n&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(1==i.nodeType)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);for(let e of this.scrollTargets=t)e.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let e=()=>{let e=this.delayedAndroidKey;if(e){this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=e.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&e.force&&dispatchKey(this.dom,e.key,e.keyCode)}};this.flushingAndroidKey=this.view.win.requestAnimationFrame(e)}this.delayedAndroidKey&&"Enter"!=e||(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(null===(i=this.delayedAndroidKey)||void 0===i?void 0:i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,n=!1;for(let r of e){let e=this.readMutation(r);e&&(e.typeOver&&(n=!0),-1==t?({from:t,to:i}=e):(t=Math.min(e.from,t),i=Math.max(e.to,i)))}return{from:t,to:i,typeOver:n}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),n=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(e<0&&!n)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let r=new DOMChange(this.view,e,t,i);return this.view.docView.domChanged={newSel:r.newSel?r.newSel.main:null},r}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let i=this.view.state,n=applyDOMChange(this.view,t);return this.view.state==i&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),n}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty("attributes"==e.type),"attributes"==e.type&&(t.flags|=4),"childList"==e.type){let i=findChild(t,e.previousSibling||e.target.previousSibling,-1),n=findChild(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:!1}}return"characterData"==e.type?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(editable)!=e.state.facet(editable)&&(e.view.contentDOM.editContext=e.state.facet(editable)?this.editContext.editContext:null))}destroy(){var e,t,i;this.stop(),null===(e=this.intersection)||void 0===e||e.disconnect(),null===(t=this.gapIntersection)||void 0===t||t.disconnect(),null===(i=this.resizeScroll)||void 0===i||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function findChild(e,t,i){for(;t;){let n=ContentView.get(t);if(n&&n.parent==e)return n;let r=t.parentNode;t=r!=e.dom?r:i>0?t.nextSibling:t.previousSibling}return null}function buildSelectionRangeFromRange(e,t){let i=t.startContainer,n=t.startOffset,r=t.endContainer,s=t.endOffset,o=e.docView.domAtPos(e.state.selection.main.anchor);return isEquivalentPosition(o.node,o.offset,r,s)&&([i,n,r,s]=[r,s,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:s}}function safariSelectionRangeHack(e,t){if(t.getComposedRanges){let i=t.getComposedRanges(e.root)[0];if(i)return buildSelectionRangeFromRange(e,i)}let i=null;function n(e){e.preventDefault(),e.stopImmediatePropagation(),i=e.getTargetRanges()[0]}return e.contentDOM.addEventListener("beforeinput",n,!0),e.dom.ownerDocument.execCommand("indent"),e.contentDOM.removeEventListener("beforeinput",n,!0),i?buildSelectionRangeFromRange(e,i):null}class EditContextManager{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=i=>{let n=e.state.selection.main,{anchor:r,head:s}=n,o=this.toEditorPos(i.updateRangeStart),a=this.toEditorPos(i.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:i.updateRangeStart,editorBase:o,drifted:!1});let l=a-o>i.text.length;o==this.from&&r<this.from?o=r:a==this.to&&r>this.to&&(a=r);let c=findDiff(e.state.sliceDoc(o,a),i.text,(l?n.from:n.to)-o,l?"end":null);if(!c){let t=EditorSelection.single(this.toEditorPos(i.selectionStart),this.toEditorPos(i.selectionEnd));return void(t.main.eq(n)||e.dispatch({selection:t,userEvent:"select"}))}let h={from:c.from+o,to:c.toA+o,insert:Text.of(i.text.slice(c.from,c.toB).split("\n"))};if((browser.mac||browser.android)&&h.from==s-1&&/^\. ?$/.test(i.text)&&"off"==e.contentDOM.getAttribute("autocorrect")&&(h={from:o,to:a,insert:Text.of([i.text.replace("."," ")])}),this.pendingContextChange=h,!e.state.readOnly){let t=this.to-this.from+(h.to-h.from+h.insert.length);applyDOMChangeInner(e,h,EditorSelection.single(this.toEditorPos(i.selectionStart,t),this.toEditorPos(i.selectionEnd,t)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),h.from<h.to&&!h.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(t.text.slice(Math.max(0,i.updateRangeStart-1),Math.min(t.text.length,i.updateRangeStart+1)))&&this.handlers.compositionend(i)},this.handlers.characterboundsupdate=i=>{let n=[],r=null;for(let t=this.toEditorPos(i.rangeStart),s=this.toEditorPos(i.rangeEnd);t<s;t++){let i=e.coordsForChar(t);r=i&&new DOMRect(i.left,i.top,i.right-i.left,i.bottom-i.top)||r||new DOMRect,n.push(r)}t.updateCharacterBounds(i.rangeStart,n)},this.handlers.textformatupdate=t=>{let i=[];for(let e of t.getTextFormats()){let t=e.underlineStyle,n=e.underlineThickness;if(!/none/i.test(t)&&!/none/i.test(n)){let r=this.toEditorPos(e.rangeStart),s=this.toEditorPos(e.rangeEnd);if(r<s){let e=`text-decoration: underline ${/^[a-z]/.test(t)?t+" ":"Dashed"==t?"dashed ":"Squiggle"==t?"wavy ":""}${/thin/i.test(n)?1:2}px`;i.push(Decoration.mark({attributes:{style:e}}).range(r,s))}}}e.dispatch({effects:setEditContextFormatting.of(Decoration.set(i))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:t}=this.composing;this.composing=null,t&&this.reset(e.state)}};for(let i in this.handlers)t.addEventListener(i,this.handlers[i]);this.measureReq={read:e=>{this.editContext.updateControlBounds(e.contentDOM.getBoundingClientRect());let t=getSelection(e.root);t&&t.rangeCount&&this.editContext.updateSelectionBounds(t.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,i=!1,n=this.pendingContextChange;return e.changes.iterChanges((r,s,o,a,l)=>{if(i)return;let c=l.length-(s-r);if(n&&s>=n.to){if(n.from==r&&n.to==s&&n.insert.eq(l))return n=this.pendingContextChange=null,t+=c,void(this.to+=c);n=null,this.revertPending(e.state)}if(r+=t,(s+=t)<=this.from)this.from+=c,this.to+=c;else if(r<this.to){if(r<this.from||s>this.to||this.to-this.from+l.length>3e4)return void(i=!0);this.editContext.updateText(this.toContextPos(r),this.toContextPos(s),l.toString()),this.to+=c}t+=c}),n&&!i&&this.revertPending(e.state),!i}update(e){let t=this.pendingContextChange,i=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(i.from,i.to)&&e.transactions.some(e=>!e.isUserEvent("input.type")&&e.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):this.applyEdits(e)&&this.rangeIsValid(e.state)?(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state):(this.pendingContextChange=null,this.reset(e.state)),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),n=this.toContextPos(t.head);this.editContext.selectionStart==i&&this.editContext.selectionEnd==n||this.editContext.updateSelection(i,n)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>3e4)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let i=this.composing;return i&&i.drifted?i.editorBase+(e-i.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class EditorView{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:i}=e;this.dispatchTransactions=e.dispatchTransactions||i&&(e=>e.forEach(e=>i(e,this)))||(e=>this.update(e)),this.dispatch=this.dispatch.bind(this),this._root=e.root||getRoot(e.parent)||document,this.viewState=new ViewState(e.state||EditorState.create(e)),e.scrollTo&&e.scrollTo.is(scrollIntoView$1)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(viewPlugin).map(e=>new PluginInstance(e));for(let n of this.plugins)n.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),(null===(t=document.fonts)||void 0===t?void 0:t.ready)&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let t=1==e.length&&e[0]instanceof Transaction?e:1==e.length&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t,i=!1,n=!1,r=this.state;for(let d of e){if(d.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=d.state}if(this.destroyed)return void(this.viewState.state=r);let s=this.hasFocus,o=0,a=null;e.some(e=>e.annotation(isFocusChange))?(this.inputState.notifiedFocused=s,o=1):s!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=s,a=focusChangeTransaction(r,s),a||(o=1));let l=this.observer.delayedAndroidKey,c=null;if(l?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(r.doc)||!this.state.selection.eq(r.selection))&&(c=null)):this.observer.clear(),r.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(r);t=ViewUpdate.create(this,r,e),t.flags|=o;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let t of e){if(h&&(h=h.map(t.changes)),t.scrollIntoView){let{main:e}=t.state.selection;h=new ScrollTarget(e.empty?e:EditorSelection.cursor(e.head,e.head>e.anchor?-1:1))}for(let e of t.effects)e.is(scrollIntoView$1)&&(h=e.value.clip(this.state))}this.viewState.update(t,h),this.bidiCache=CachedOrder.update(this.bidiCache,t.changes),t.empty||(this.updatePlugins(t),this.inputState.update(t)),i=this.docView.update(t),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some(e=>e.isUserEvent("select.pointer")))}finally{this.updateState=0}if(t.startState.facet(theme)!=t.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(i||n||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),i&&this.docViewUpdate(),!t.empty)for(let d of this.state.facet(updateListener))try{d(t)}catch(u){logException(this.state,u,"update listener")}(a||c)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),c&&!applyDOMChange(this,c)&&l.force&&dispatchKey(this.contentDOM,l.key,l.keyCode)})}setState(e){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=e);this.updateState=2;let t=this.hasFocus;try{for(let e of this.plugins)e.destroy(this);this.viewState=new ViewState(e),this.plugins=e.facet(viewPlugin).map(e=>new PluginInstance(e)),this.pluginMap.clear();for(let e of this.plugins)e.update(this);this.docView.destroy(),this.docView=new DocView(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(viewPlugin),i=e.state.facet(viewPlugin);if(t!=i){let n=[];for(let r of i){let i=t.indexOf(r);if(i<0)n.push(new PluginInstance(r));else{let t=this.plugins[i];t.mustUpdate=e,n.push(t)}}for(let t of this.plugins)t.mustUpdate!=e&&t.destroy(this);this.plugins=n,this.pluginMap.clear()}else for(let n of this.plugins)n.mustUpdate=e;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this);t!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let t of this.plugins){let i=t.value;if(i&&i.docViewUpdate)try{i.docViewUpdate(this)}catch(e){logException(this.state,e,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey)return this.measureScheduled=-1,void this.requestMeasure();this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,n=i.scrollTop*this.scaleY,{scrollAnchorPos:r,scrollAnchorHeight:s}=this.viewState;Math.abs(n-this.viewState.scrollTop)>1&&(s=-1),this.viewState.scrollAnchorHeight=-1;try{for(let e=0;;e++){if(s<0)if(isScrolledToBottom(i))r=-1,s=this.viewState.heightMap.height;else{let e=this.viewState.scrollAnchorAt(n);r=e.from,s=e.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(e>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let l=[];4&a||([this.measureRequests,l]=[l,this.measureRequests]);let c=l.map(e=>{try{return e.read(this)}catch(t){return logException(this.state,t),BadMeasure}}),h=ViewUpdate.create(this,this.state,[]),u=!1;h.flags|=a,t?t.flags|=a:t=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),u=this.docView.update(h),u&&this.docViewUpdate());for(let e=0;e<l.length;e++)if(c[e]!=BadMeasure)try{let t=l[e];t.write&&t.write(c[e],this)}catch(o){logException(this.state,o)}if(u&&this.docView.updateSelection(!0),!h.viewportChanged&&0==this.measureRequests.length){if(this.viewState.editorHeight){if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,s=-1;continue}{let e=(r<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(r).top)-s;if(e>1||e<-1){n+=e,i.scrollTop=n/this.scaleY,s=-1;continue}}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let a of this.state.facet(updateListener))a(t)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let e=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,t);let i=this.observer.ignore(()=>{let i=updateAttrs(this.contentDOM,this.contentAttrs,t),n=updateAttrs(this.dom,this.editorAttrs,e);return i||n});return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let e of i.effects)if(e.is(EditorView.announce)){t&&(this.announceDOM.textContent=""),t=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=e.value}}mountStyles(){this.styleModules=this.state.facet(styleModule);let e=this.state.facet(EditorView.cspNonce);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1$3).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(null!=e.key)for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key)return void(this.measureRequests[t]=e);this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(void 0===t||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find(t=>t.plugin==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return skipAtoms(this,e,moveByChar(this,e,t,i))}moveByGroup(e,t){return skipAtoms(this,e,moveByChar(this,e,t,t=>byGroup(this,e.head,t)))}visualLineSide(e,t){let i=this.bidiSpans(e),n=this.textDirectionAt(e.from),r=i[t?i.length-1:0];return EditorSelection.cursor(r.side(t,n)+e.from,r.forward(!t,n)?1:-1)}moveToLineBoundary(e,t,i=!0){return moveToLineBoundary(this,e,t,i)}moveVertically(e,t,i){return skipAtoms(this,e,moveVertically(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),posAtCoords(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(e),r=this.bidiSpans(n);return flattenRect(i,r[BidiSpan.find(r,e-n.from,-1,t)].dir==Direction.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(perLineTextDirection)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>MaxBidiLine)return trivialOrder(e.length);let t,i=this.textDirectionAt(e.from);for(let r of this.bidiCache)if(r.from==e.from&&r.dir==i&&(r.fresh||isolatesEq(r.isolates,t=getIsolatedRanges(this,e))))return r.order;t||(t=getIsolatedRanges(this,e));let n=computeOrder(e.text,i,t);return this.bidiCache.push(new CachedOrder(e.from,e.to,i,t,!0,n)),n}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||browser.safari&&(null===(e=this.inputState)||void 0===e?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((9==e.nodeType?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return scrollIntoView$1.of(new ScrollTarget("number"==typeof e?EditorSelection.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,i=this.viewState.scrollAnchorAt(e);return scrollIntoView$1.of(new ScrollTarget(EditorSelection.cursor(i.from),"start","start",i.top-e,t,!0))}setTabFocusMode(e){null==e?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:"boolean"==typeof e?this.inputState.tabFocusMode=e?0:-1:0!=this.inputState.tabFocusMode&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return ViewPlugin.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return ViewPlugin.define(()=>({}),{eventObservers:e})}static theme(e,t){let i=StyleModule.newName(),n=[theme.of(i),styleModule.of(buildTheme(`.${i}`,e))];return t&&t.dark&&n.push(darkTheme.of(!0)),n}static baseTheme(e){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,e,lightDarkIDs)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),n=i&&ContentView.get(i)||ContentView.get(e);return(null===(t=null==n?void 0:n.rootView)||void 0===t?void 0:t.view)||null}}EditorView.styleModule=styleModule,EditorView.inputHandler=inputHandler$1,EditorView.clipboardInputFilter=clipboardInputFilter,EditorView.clipboardOutputFilter=clipboardOutputFilter,EditorView.scrollHandler=scrollHandler,EditorView.focusChangeEffect=focusChangeEffect,EditorView.perLineTextDirection=perLineTextDirection,EditorView.exceptionSink=exceptionSink,EditorView.updateListener=updateListener,EditorView.editable=editable,EditorView.mouseSelectionStyle=mouseSelectionStyle,EditorView.dragMovesSelection=dragMovesSelection$1,EditorView.clickAddsSelectionRange=clickAddsSelectionRange,EditorView.decorations=decorations,EditorView.outerDecorations=outerDecorations,EditorView.atomicRanges=atomicRanges,EditorView.bidiIsolatedRanges=bidiIsolatedRanges,EditorView.scrollMargins=scrollMargins,EditorView.darkTheme=darkTheme,EditorView.cspNonce=Facet.define({combine:e=>e.length?e[0]:""}),EditorView.contentAttributes=contentAttributes,EditorView.editorAttributes=editorAttributes,EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"}),EditorView.announce=StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(e,t,i,n,r,s){this.from=e,this.to=t,this.dir=i,this.isolates=n,this.fresh=r,this.order=s}static update(e,t){if(t.empty&&!e.some(e=>e.fresh))return e;let i=[],n=e.length?e[e.length-1].dir:Direction.LTR;for(let r=Math.max(0,e.length-10);r<e.length;r++){let s=e[r];s.dir!=n||t.touchesRange(s.from,s.to)||i.push(new CachedOrder(t.mapPos(s.from,1),t.mapPos(s.to,-1),s.dir,s.isolates,!1,s.order))}return i}}function attrsFromFacet(e,t,i){for(let n=e.state.facet(t),r=n.length-1;r>=0;r--){let t=n[r],s="function"==typeof t?t(e):t;s&&combineAttrs(s,i)}return i}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(e,t){const i=e.split(/-(?!$)/);let n,r,s,o,a=i[i.length-1];"Space"==a&&(a=" ");for(let l=0;l<i.length-1;++l){const e=i[l];if(/^(cmd|meta|m)$/i.test(e))o=!0;else if(/^a(lt)?$/i.test(e))n=!0;else if(/^(c|ctrl|control)$/i.test(e))r=!0;else if(/^s(hift)?$/i.test(e))s=!0;else{if(!/^mod$/i.test(e))throw new Error("Unrecognized modifier name: "+e);"mac"==t?o=!0:r=!0}}return n&&(a="Alt-"+a),r&&(a="Ctrl-"+a),o&&(a="Meta-"+a),s&&(a="Shift-"+a),a}function modifiers(e,t,i){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==i&&t.shiftKey&&(e="Shift-"+e),e}const handleKeyEvents=Prec.default(EditorView.domEventHandlers({keydown:(e,t)=>runHandlers(getKeymap(t.state),e,t,"editor")})),keymap=Facet.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(e){let t=e.facet(keymap),i=Keymaps.get(t);return i||Keymaps.set(t,i=buildKeymap(t.reduce((e,t)=>e.concat(t),[]))),i}function runScopeHandlers(e,t,i){return runHandlers(getKeymap(e.state),t,e,i)}let storedPrefix=null;const PrefixTimeout=4e3;function buildKeymap(e,t=currentPlatform){let i=Object.create(null),n=Object.create(null),r=(e,t)=>{let i=n[e];if(null==i)n[e]=t;else if(i!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")},s=(e,n,s,o,a)=>{var l,c;let h=i[e]||(i[e]=Object.create(null)),u=n.split(/ (?!$)/).map(e=>normalizeKeyName(e,t));for(let t=1;t<u.length;t++){let i=u.slice(0,t).join(" ");r(i,!0),h[i]||(h[i]={preventDefault:!0,stopPropagation:!1,run:[t=>{let n=storedPrefix={view:t,prefix:i,scope:e};return setTimeout(()=>{storedPrefix==n&&(storedPrefix=null)},PrefixTimeout),!0}]})}let d=u.join(" ");r(d,!1);let p=h[d]||(h[d]={preventDefault:!1,stopPropagation:!1,run:(null===(c=null===(l=h._any)||void 0===l?void 0:l.run)||void 0===c?void 0:c.slice())||[]});s&&p.run.push(s),o&&(p.preventDefault=!0),a&&(p.stopPropagation=!0)};for(let o of e){let e=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let t of e){let e=i[t]||(i[t]=Object.create(null));e._any||(e._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:n}=o;for(let t in e)e[t].run.push(e=>n(e,currentKeyEvent))}let n=o[t]||o.key;if(n)for(let t of e)s(t,n,o.run,o.preventDefault,o.stopPropagation),o.shift&&s(t,"Shift-"+n,o.shift,o.preventDefault,o.stopPropagation)}return i}let currentKeyEvent=null;function runHandlers(e,t,i,n){currentKeyEvent=t;let r=keyName(t),s=codePointSize(codePointAt(r,0))==r.length&&" "!=r,o="",a=!1,l=!1,c=!1;storedPrefix&&storedPrefix.view==i&&storedPrefix.scope==n&&(o=storedPrefix.prefix+" ",modifierCodes.indexOf(t.keyCode)<0&&(l=!0,storedPrefix=null));let h,u,d=new Set,p=e=>{if(e){for(let t of e.run)if(!d.has(t)&&(d.add(t),t(i)))return e.stopPropagation&&(c=!0),!0;e.preventDefault&&(e.stopPropagation&&(c=!0),l=!0)}return!1},f=e[n];return f&&(p(f[o+modifiers(r,t,!s)])?a=!0:!s||!(t.altKey||t.metaKey||t.ctrlKey)||browser.windows&&t.ctrlKey&&t.altKey||browser.mac&&t.altKey&&!t.ctrlKey&&!t.metaKey||!(h=base[t.keyCode])||h==r?s&&t.shiftKey&&p(f[o+modifiers(r,t,!0)])&&(a=!0):(p(f[o+modifiers(h,t,!0)])||t.shiftKey&&(u=shift[t.keyCode])!=r&&u!=h&&p(f[o+modifiers(u,t,!1)]))&&(a=!0),!a&&p(f._any)&&(a=!0)),l&&(a=!0),a&&c&&t.stopPropagation(),currentKeyEvent=null,a}class RectangleMarker{constructor(e,t,i,n,r){this.className=e,this.left=t,this.top=i,this.width=n,this.height=r}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className==this.className&&(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",null!=this.width&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,i){if(i.empty){let n=e.coordsAtPos(i.head,i.assoc||1);if(!n)return[];let r=getBase(e);return[new RectangleMarker(t,n.left-r.left,n.top-r.top,null,n.bottom-n.top)]}return rectanglesForRange(e,t,i)}}function getBase(e){let t=e.scrollDOM.getBoundingClientRect();return{left:(e.textDirection==Direction.LTR?t.left:t.right-e.scrollDOM.clientWidth*e.scaleX)-e.scrollDOM.scrollLeft*e.scaleX,top:t.top-e.scrollDOM.scrollTop*e.scaleY}}function wrappedLine(e,t,i,n){let r=e.coordsAtPos(t,2*i);if(!r)return n;let s=e.dom.getBoundingClientRect(),o=(r.top+r.bottom)/2,a=e.posAtCoords({x:s.left+1,y:o}),l=e.posAtCoords({x:s.right-1,y:o});return null==a||null==l?n:{from:Math.max(n.from,Math.min(a,l)),to:Math.min(n.to,Math.max(a,l))}}function rectanglesForRange(e,t,i){if(i.to<=e.viewport.from||i.from>=e.viewport.to)return[];let n=Math.max(i.from,e.viewport.from),r=Math.min(i.to,e.viewport.to),s=e.textDirection==Direction.LTR,o=e.contentDOM,a=o.getBoundingClientRect(),l=getBase(e),c=o.querySelector(".cm-line"),h=c&&window.getComputedStyle(c),u=a.left+(h?parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)):0),d=a.right-(h?parseInt(h.paddingRight):0),p=blockAt(e,n,1),f=blockAt(e,r,-1),m=p.type==BlockType.Text?p:null,g=f.type==BlockType.Text?f:null;if(m&&(e.lineWrapping||p.widgetLineBreaks)&&(m=wrappedLine(e,n,1,m)),g&&(e.lineWrapping||f.widgetLineBreaks)&&(g=wrappedLine(e,r,-1,g)),m&&g&&m.from==g.from&&m.to==g.to)return _(b(i.from,i.to,m));{let t=m?b(i.from,null,m):w(p,!1),n=g?b(null,i.to,g):w(f,!0),r=[];return(m||p).to<(g||f).from-(m&&g?1:0)||p.widgetLineBreaks>1&&t.bottom+e.defaultLineHeight/2<n.top?r.push(y(u,t.bottom,d,n.top)):t.bottom<n.top&&e.elementAtHeight((t.bottom+n.top)/2).type==BlockType.Text&&(t.bottom=n.top=(t.bottom+n.top)/2),_(t).concat(r).concat(_(n))}function y(e,i,n,r){return new RectangleMarker(t,e-l.left,i-l.top,n-e,r-i)}function _({top:e,bottom:t,horizontal:i}){let n=[];for(let r=0;r<i.length;r+=2)n.push(y(i[r],e,i[r+1],t));return n}function b(t,i,n){let r=1e9,o=-1e9,a=[];function l(t,i,l,c,h){let p=e.coordsAtPos(t,t==n.to?-2:2),f=e.coordsAtPos(l,l==n.from?2:-2);p&&f&&(r=Math.min(p.top,f.top,r),o=Math.max(p.bottom,f.bottom,o),h==Direction.LTR?a.push(s&&i?u:p.left,s&&c?d:f.right):a.push(!s&&c?u:f.left,!s&&i?d:p.right))}let c=null!=t?t:n.from,h=null!=i?i:n.to;for(let s of e.visibleRanges)if(s.to>c&&s.from<h)for(let n=Math.max(s.from,c),r=Math.min(s.to,h);;){let s=e.state.doc.lineAt(n);for(let o of e.bidiSpans(s)){let e=o.from+s.from,a=o.to+s.from;if(e>=r)break;a>n&&l(Math.max(e,n),null==t&&e<=c,Math.min(a,r),null==i&&a>=h,o.dir)}if(n=s.to+1,n>=r)break}return 0==a.length&&l(c,null==t,h,null==i,e.textDirection),{top:r,bottom:o,horizontal:a}}function w(e,t){let i=a.top+(t?e.top:e.bottom);return{top:i,bottom:i,horizontal:[]}}}function sameMarker(e,t){return e.constructor==t.constructor&&e.eq(t)}class LayerView{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(layerOrder)!=e.state.facet(layerOrder)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){!1!==this.layer.updateOnDocViewUpdate&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,i=e.facet(layerOrder);for(;t<i.length&&i[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;e==this.scaleX&&t==this.scaleY||(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some((e,t)=>!sameMarker(e,this.drawn[t]))){let t=this.dom.firstChild,i=0;for(let n of e)n.update&&t&&n.constructor&&this.drawn[i].constructor&&n.update(t,this.drawn[i])?(t=t.nextSibling,i++):this.dom.insertBefore(n.draw(),t);for(;t;){let e=t.nextSibling;t.remove(),t=e}this.drawn=e,browser.safari&&browser.safari_version>=26&&(this.dom.style.display=this.dom.firstChild?"":"none")}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const layerOrder=Facet.define();function layer(e){return[ViewPlugin.define(t=>new LayerView(t,e)),layerOrder.of(e)]}const selectionConfig=Facet.define({combine:e=>combineConfig(e,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})});function drawSelection(e={}){return[selectionConfig.of(e),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(!0)]}function configChanged(e){return e.startState.facet(selectionConfig)!=e.state.facet(selectionConfig)}const cursorLayer=layer({above:!0,markers(e){let{state:t}=e,i=t.facet(selectionConfig),n=[];for(let r of t.selection.ranges){let s=r==t.selection.main;if(r.empty||i.drawRangeCursor){let t=s?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",i=r.empty?r:EditorSelection.cursor(r.head,r.head>r.anchor?-1:1);for(let r of RectangleMarker.forRange(e,t,i))n.push(r)}}return n},update(e,t){e.transactions.some(e=>e.selection)&&(t.style.animationName="cm-blink"==t.style.animationName?"cm-blink2":"cm-blink");let i=configChanged(e);return i&&setBlinkRate(e.state,t),e.docChanged||e.selectionSet||i},mount(e,t){setBlinkRate(t.state,e)},class:"cm-cursorLayer"});function setBlinkRate(e,t){t.style.animationDuration=e.facet(selectionConfig).cursorBlinkRate+"ms"}const selectionLayer=layer({above:!1,markers:e=>e.state.selection.ranges.map(t=>t.empty?[]:RectangleMarker.forRange(e,"cm-selectionBackground",t)).reduce((e,t)=>e.concat(t)),update:(e,t)=>e.docChanged||e.selectionSet||e.viewportChanged||configChanged(e),class:"cm-selectionLayer"}),hideNativeSelection=Prec.highest(EditorView.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}})),setDropCursorPos=StateEffect.define({map:(e,t)=>null==e?null:t.mapPos(e)}),dropCursorPos=StateField.define({create:()=>null,update:(e,t)=>(null!=e&&(e=t.changes.mapPos(e)),t.effects.reduce((e,t)=>t.is(setDropCursorPos)?t.value:e,e))}),drawDropCursor=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(e){var t;let i=e.state.field(dropCursorPos);null==i?null!=this.cursor&&(null===(t=this.cursor)||void 0===t||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(e.startState.field(dropCursorPos)!=i||e.docChanged||e.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:e}=this,t=e.state.field(dropCursorPos),i=null!=t&&e.coordsAtPos(t);if(!i)return null;let n=e.scrollDOM.getBoundingClientRect();return{left:i.left-n.left+e.scrollDOM.scrollLeft*e.scaleX,top:i.top-n.top+e.scrollDOM.scrollTop*e.scaleY,height:i.bottom-i.top}}drawCursor(e){if(this.cursor){let{scaleX:t,scaleY:i}=this.view;e?(this.cursor.style.left=e.left/t+"px",this.cursor.style.top=e.top/i+"px",this.cursor.style.height=e.height/i+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(e){this.view.state.field(dropCursorPos)!=e&&this.view.dispatch({effects:setDropCursorPos.of(e)})}},{eventObservers:{dragover(e){this.setDropPos(this.view.posAtCoords({x:e.clientX,y:e.clientY}))},dragleave(e){e.target!=this.view.contentDOM&&this.view.contentDOM.contains(e.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function dropCursor(){return[dropCursorPos,drawDropCursor]}function iterMatches(e,t,i,n,r){t.lastIndex=0;for(let s,o=e.iterRange(i,n),a=i;!o.next().done;a+=o.value.length)if(!o.lineBreak)for(;s=t.exec(o.value);)r(a+s.index,s)}function matchRanges(e,t){let i=e.visibleRanges;if(1==i.length&&i[0].from==e.viewport.from&&i[0].to==e.viewport.to)return i;let n=[];for(let{from:r,to:s}of i)r=Math.max(e.state.doc.lineAt(r).from,r-t),s=Math.min(e.state.doc.lineAt(s).to,s+t),n.length&&n[n.length-1].to>=r?n[n.length-1].to=s:n.push({from:r,to:s});return n}class MatchDecorator{constructor(e){const{regexp:t,decoration:i,decorate:n,boundary:r,maxLength:s=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,n)this.addMatch=(e,t,i,r)=>n(r,i,i+e[0].length,e,t);else if("function"==typeof i)this.addMatch=(e,t,n,r)=>{let s=i(e,t,n);s&&r(n,n+e[0].length,s)};else{if(!i)throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.addMatch=(e,t,n,r)=>r(n,n+e[0].length,i)}this.boundary=r,this.maxLength=s}createDeco(e){let t=new RangeSetBuilder,i=t.add.bind(t);for(let{from:n,to:r}of matchRanges(e,this.maxLength))iterMatches(e.state.doc,this.regexp,n,r,(t,n)=>this.addMatch(n,e,t,i));return t.finish()}updateDeco(e,t){let i=1e9,n=-1;return e.docChanged&&e.changes.iterChanges((t,r,s,o)=>{o>=e.view.viewport.from&&s<=e.view.viewport.to&&(i=Math.min(s,i),n=Math.max(o,n))}),e.viewportMoved||n-i>1e3?this.createDeco(e.view):n>-1?this.updateRange(e.view,t.map(e.changes),i,n):t}updateRange(e,t,i,n){for(let r of e.visibleRanges){let s=Math.max(r.from,i),o=Math.min(r.to,n);if(o>=s){let i=e.state.doc.lineAt(s),n=i.to<o?e.state.doc.lineAt(o):i,a=Math.max(r.from,i.from),l=Math.min(r.to,n.to);if(this.boundary){for(;s>i.from;s--)if(this.boundary.test(i.text[s-1-i.from])){a=s;break}for(;o<n.to;o++)if(this.boundary.test(n.text[o-n.from])){l=o;break}}let c,h=[],u=(e,t,i)=>h.push(i.range(e,t));if(i==n)for(this.regexp.lastIndex=a-i.from;(c=this.regexp.exec(i.text))&&c.index<l-i.from;)this.addMatch(c,e,c.index+i.from,u);else iterMatches(e.state.doc,this.regexp,a,l,(t,i)=>this.addMatch(i,e,t,u));t=t.update({filterFrom:a,filterTo:l,filter:(e,t)=>e<a||t>l,add:h})}}return t}}const UnicodeRegexpSupport=null!=/x/.unicode?"gu":"g",Specials=new RegExp("[\0-\b\n--¬ü¬≠ÿú‚Äã‚Äé‚Äè\u2028\u2029‚Ä≠‚ÄÆ‚Å¶‚Åß‚Å©\ufeffÔøπ-Ôøº]",UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;function supportsTabSize(){var e;if(null==_supportsTabSize&&"undefined"!=typeof document&&document.body){let t=document.body.style;_supportsTabSize=null!=(null!==(e=t.tabSize)&&void 0!==e?e:t.MozTabSize)}return _supportsTabSize||!1}const specialCharConfig=Facet.define({combine(e){let t=combineConfig(e,{render:null,specialChars:Specials,addSpecialChars:null});return(t.replaceTabs=!supportsTabSize())&&(t.specialChars=new RegExp("\t|"+t.specialChars.source,UnicodeRegexpSupport)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,UnicodeRegexpSupport)),t}});function highlightSpecialChars(e={}){return[specialCharConfig.of(e),specialCharPlugin()]}let _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.decorations=Decoration.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(e.state.facet(specialCharConfig)),this.decorations=this.decorator.createDeco(e)}makeDecorator(e){return new MatchDecorator({regexp:e.specialChars,decoration:(t,i,n)=>{let{doc:r}=i.state,s=codePointAt(t[0],0);if(9==s){let e=r.lineAt(n),t=i.state.tabSize,s=countColumn(e.text,t,n-e.from);return Decoration.replace({widget:new TabWidget((t-s%t)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[s]||(this.decorationCache[s]=Decoration.replace({widget:new SpecialCharWidget(e,s)}))},boundary:e.replaceTabs?void 0:/[^]/})}update(e){let t=e.state.facet(specialCharConfig);e.startState.facet(specialCharConfig)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(e.view)):this.decorations=this.decorator.updateDeco(e,this.decorations)}},{decorations:e=>e.decorations}))}const DefaultPlaceholder="‚Ä¢";function placeholder$1(e){return e>=32?DefaultPlaceholder:10==e?"‚ê§":String.fromCharCode(9216+e)}class SpecialCharWidget extends WidgetType{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=placeholder$1(this.code),i=e.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16)),n=this.options.render&&this.options.render(this.code,i,t);if(n)return n;let r=document.createElement("span");return r.textContent=t,r.title=i,r.setAttribute("aria-label",i),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="\t",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function highlightActiveLine(){return activeLineHighlighter}const lineDeco=Decoration.line({class:"cm-activeLine"}),activeLineHighlighter=ViewPlugin.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.docChanged||e.selectionSet)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=-1,i=[];for(let n of e.state.selection.ranges){let r=e.lineBlockAt(n.head);r.from>t&&(i.push(lineDeco.range(r.from)),t=r.from)}return Decoration.set(i)}},{decorations:e=>e.decorations}),MaxOff=2e3;function rectangleFor(e,t,i){let n=Math.min(t.line,i.line),r=Math.max(t.line,i.line),s=[];if(t.off>MaxOff||i.off>MaxOff||t.col<0||i.col<0){let o=Math.min(t.off,i.off),a=Math.max(t.off,i.off);for(let t=n;t<=r;t++){let i=e.doc.line(t);i.length<=a&&s.push(EditorSelection.range(i.from+o,i.to+a))}}else{let o=Math.min(t.col,i.col),a=Math.max(t.col,i.col);for(let t=n;t<=r;t++){let i=e.doc.line(t),n=findColumn(i.text,o,e.tabSize,!0);if(n<0)s.push(EditorSelection.cursor(i.to));else{let t=findColumn(i.text,a,e.tabSize);s.push(EditorSelection.range(i.from+n,i.from+t))}}}return s}function absoluteColumn(e,t){let i=e.coordsAtPos(e.viewport.from);return i?Math.round(Math.abs((i.left-t)/e.defaultCharacterWidth)):-1}function getPos(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1),n=e.state.doc.lineAt(i),r=i-n.from,s=r>MaxOff?-1:r==n.length?absoluteColumn(e,t.clientX):countColumn(n.text,e.state.tabSize,i-n.from);return{line:n.number,col:s,off:r}}function rectangleSelectionStyle(e,t){let i=getPos(e,t),n=e.state.selection;return i?{update(e){if(e.docChanged){let t=e.changes.mapPos(e.startState.doc.line(i.line).from),r=e.state.doc.lineAt(t);i={line:r.number,col:i.col,off:Math.min(i.off,r.length)},n=n.map(e.changes)}},get(t,r,s){let o=getPos(e,t);if(!o)return n;let a=rectangleFor(e.state,i,o);return a.length?s?EditorSelection.create(a.concat(n.ranges)):EditorSelection.create(a):n}}:null}function rectangularSelection(e){return EditorView.mouseSelectionStyle.of((e,t)=>{return(i=t).altKey&&0==i.button?rectangleSelectionStyle(e,t):null;var i})}const keys={Alt:[18,e=>!!e.altKey],Control:[17,e=>!!e.ctrlKey],Shift:[16,e=>!!e.shiftKey],Meta:[91,e=>!!e.metaKey]},showCrosshair={style:"cursor: crosshair"};function crosshairCursor(e={}){let[t,i]=keys[e.key||"Alt"],n=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.isDown=!1}set(e){this.isDown!=e&&(this.isDown=e,this.view.update([]))}},{eventObservers:{keydown(e){this.set(e.keyCode==t||i(e))},keyup(e){e.keyCode!=t&&i(e)||this.set(!1)},mousemove(e){this.set(i(e))}}});return[n,EditorView.contentAttributes.of(e=>{var t;return(null===(t=e.plugin(n))||void 0===t?void 0:t.isDown)?showCrosshair:null})]}const Outside="-10000px";class TooltipViewManager{constructor(e,t,i,n){this.facet=t,this.createTooltipView=i,this.removeTooltipView=n,this.input=e.state.facet(t),this.tooltips=this.input.filter(e=>e);let r=null;this.tooltipViews=this.tooltips.map(e=>r=i(e,r))}update(e,t){var i;let n=e.state.facet(this.facet),r=n.filter(e=>e);if(n===this.input){for(let t of this.tooltipViews)t.update&&t.update(e);return!1}let s=[],o=t?[]:null;for(let a=0;a<r.length;a++){let i=r[a],n=-1;if(i){for(let e=0;e<this.tooltips.length;e++){let t=this.tooltips[e];t&&t.create==i.create&&(n=e)}if(n<0)s[a]=this.createTooltipView(i,a?s[a-1]:null),o&&(o[a]=!!i.above);else{let i=s[a]=this.tooltipViews[n];o&&(o[a]=t[n]),i.update&&i.update(e)}}}for(let a of this.tooltipViews)s.indexOf(a)<0&&(this.removeTooltipView(a),null===(i=a.destroy)||void 0===i||i.call(a));return t&&(o.forEach((e,i)=>t[i]=e),t.length=o.length),this.input=n,this.tooltips=r,this.tooltipViews=s,!0}}function windowSpace(e){let t=e.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:t.clientHeight,right:t.clientWidth}}const tooltipConfig=Facet.define({combine:e=>{var t,i,n;return{position:browser.ios?"absolute":(null===(t=e.find(e=>e.position))||void 0===t?void 0:t.position)||"fixed",parent:(null===(i=e.find(e=>e.parent))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(n=e.find(e=>e.tooltipSpace))||void 0===n?void 0:n.tooltipSpace)||windowSpace}}}),knownHeight=new WeakMap,tooltipPlugin=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let t=e.state.facet(tooltipConfig);this.position=t.position,this.parent=t.parent,this.classes=e.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver="function"==typeof ResizeObserver?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new TooltipViewManager(e,showTooltip,(e,t)=>this.createTooltip(e,t),e=>{this.resizeObserver&&this.resizeObserver.unobserve(e.dom),e.dom.remove()}),this.above=this.manager.tooltips.map(e=>!!e.above),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver(e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),e.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let e of this.manager.tooltipViews)this.intersectionObserver.observe(e.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(e){e.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(e,this.above);t&&this.observeIntersection();let i=t||e.geometryChanged,n=e.state.facet(tooltipConfig);if(n.position!=this.position&&!this.madeAbsolute){this.position=n.position;for(let e of this.manager.tooltipViews)e.dom.style.position=this.position;i=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let e of this.manager.tooltipViews)this.container.appendChild(e.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(e,t){let i=e.create(this.view),n=t?t.dom:null;if(i.dom.classList.add("cm-tooltip"),e.arrow&&!i.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",i.dom.appendChild(e)}return i.dom.style.position=this.position,i.dom.style.top=Outside,i.dom.style.left="0px",this.container.insertBefore(i.dom,n),i.mount&&i.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(i.dom),i}destroy(){var e,t,i;this.view.win.removeEventListener("resize",this.measureSoon);for(let n of this.manager.tooltipViews)n.dom.remove(),null===(e=n.destroy)||void 0===e||e.call(n);this.parent&&this.container.remove(),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),null===(i=this.intersectionObserver)||void 0===i||i.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let e=1,t=1,i=!1;if("fixed"==this.position&&this.manager.tooltipViews.length){let{dom:e}=this.manager.tooltipViews[0];if(browser.safari){let t=e.getBoundingClientRect();i=Math.abs(t.top+1e4)>1||Math.abs(t.left)>1}else i=!!e.offsetParent&&e.offsetParent!=this.container.ownerDocument.body}if(i||"absolute"==this.position)if(this.parent){let i=this.parent.getBoundingClientRect();i.width&&i.height&&(e=i.width/this.parent.offsetWidth,t=i.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:t}=this.view.viewState);let n=this.view.scrollDOM.getBoundingClientRect(),r=getScrollMargins(this.view);return{visible:{left:n.left+r.left,top:n.top+r.top,right:n.right-r.right,bottom:n.bottom-r.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((e,t)=>{let i=this.manager.tooltipViews[t];return i.getCoords?i.getCoords(e.pos):this.view.coordsAtPos(e.pos)}),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view),scaleX:e,scaleY:t,makeAbsolute:i}}writeMeasure(e){var t;if(e.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let e of this.manager.tooltipViews)e.dom.style.position="absolute"}let{visible:i,space:n,scaleX:r,scaleY:s}=e,o=[];for(let a=0;a<this.manager.tooltips.length;a++){let l=this.manager.tooltips[a],c=this.manager.tooltipViews[a],{dom:h}=c,u=e.pos[a],d=e.size[a];if(!u||!1!==l.clip&&(u.bottom<=Math.max(i.top,n.top)||u.top>=Math.min(i.bottom,n.bottom)||u.right<Math.max(i.left,n.left)-.1||u.left>Math.min(i.right,n.right)+.1)){h.style.top=Outside;continue}let p=l.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,f=p?7:0,m=d.right-d.left,g=null!==(t=knownHeight.get(c))&&void 0!==t?t:d.bottom-d.top,y=c.offset||noOffset,_=this.view.textDirection==Direction.LTR,b=d.width>n.right-n.left?_?n.left:n.right-d.width:_?Math.max(n.left,Math.min(u.left-(p?14:0)+y.x,n.right-m)):Math.min(Math.max(n.left,u.left-m+(p?14:0)-y.x),n.right-m),w=this.above[a];!l.strictSide&&(w?u.top-g-f-y.y<n.top:u.bottom+g+f+y.y>n.bottom)&&w==n.bottom-u.bottom>u.top-n.top&&(w=this.above[a]=!w);let S=(w?u.top-n.top:n.bottom-u.bottom)-f;if(S<g&&!1!==c.resize){if(S<this.view.defaultLineHeight){h.style.top=Outside;continue}knownHeight.set(c,g),h.style.height=(g=S)/s+"px"}else h.style.height&&(h.style.height="");let v=w?u.top-g-f-y.y:u.bottom+f+y.y,T=b+m;if(!0!==c.overlap)for(let e of o)e.left<T&&e.right>b&&e.top<v+g&&e.bottom>v&&(v=w?e.top-g-2-f:e.bottom+f+2);if("absolute"==this.position?(h.style.top=(v-e.parent.top)/s+"px",setLeftStyle(h,(b-e.parent.left)/r)):(h.style.top=v/s+"px",setLeftStyle(h,b/r)),p){let e=u.left+(_?y.x:-y.x)-(b+14-7);p.style.left=e/r+"px"}!0!==c.overlap&&o.push({left:b,top:v,right:T,bottom:v+g}),h.classList.toggle("cm-tooltip-above",w),h.classList.toggle("cm-tooltip-below",!w),c.positioned&&c.positioned(e.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let e of this.manager.tooltipViews)e.dom.style.top=Outside}},{eventObservers:{scroll(){this.maybeMeasure()}}});function setLeftStyle(e,t){let i=parseInt(e.style.left,10);(isNaN(i)||Math.abs(t-i)>1)&&(e.style.left=t+"px")}const baseTheme$4=EditorView.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),noOffset={x:0,y:0},showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$4]}),showHoverTooltip=Facet.define({combine:e=>e.reduce((e,t)=>e.concat(t),[])});class HoverTooltipHost{static create(e){return new HoverTooltipHost(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new TooltipViewManager(e,showHoverTooltip,(e,t)=>this.createHostedView(e,t),e=>e.dom.remove())}createHostedView(e,t){let i=e.create(this.view);return i.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(i.dom,t?t.dom.nextSibling:this.dom.firstChild),this.mounted&&i.mount&&i.mount(this.view),i}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(e){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let t of this.manager.tooltipViews)null===(e=t.destroy)||void 0===e||e.call(t)}passProp(e){let t;for(let i of this.manager.tooltipViews){let n=i[e];if(void 0!==n)if(void 0===t)t=n;else if(t!==n)return}return t}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const showHoverTooltipHost=showTooltip.compute([showHoverTooltip],e=>{let t=e.facet(showHoverTooltip);return 0===t.length?null:{pos:Math.min(...t.map(e=>e.pos)),end:Math.max(...t.map(e=>{var t;return null!==(t=e.end)&&void 0!==t?t:e.pos})),create:HoverTooltipHost.create,above:t[0].above,arrow:t.some(e=>e.arrow)}});class HoverPlugin{constructor(e,t,i,n,r){this.view=e,this.source=t,this.field=i,this.setHover=n,this.hoverTime=r,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:t}=this,i=e.docView.nearest(t.target);if(!i)return;let n,r=1;if(i instanceof WidgetView)n=i.posAtStart;else{if(n=e.posAtCoords(t),null==n)return;let i=e.coordsAtPos(n);if(!i||t.y<i.top||t.y>i.bottom||t.x<i.left-e.defaultCharacterWidth||t.x>i.right+e.defaultCharacterWidth)return;let s=e.bidiSpans(e.state.doc.lineAt(n)).find(e=>e.from<=n&&e.to>=n),o=s&&s.dir==Direction.RTL?-1:1;r=t.x<i.left?-o:o}let s=this.source(e,n,r);if(null==s?void 0:s.then){let t=this.pending={pos:n};s.then(i=>{this.pending==t&&(this.pending=null,!i||Array.isArray(i)&&!i.length||e.dispatch({effects:this.setHover.of(Array.isArray(i)?i:[i])}))},t=>logException(e.state,t,"hover tooltip"))}else!s||Array.isArray(s)&&!s.length||e.dispatch({effects:this.setHover.of(Array.isArray(s)?s:[s])})}get tooltip(){let e=this.view.plugin(tooltipPlugin),t=e?e.manager.tooltips.findIndex(e=>e.create==HoverTooltipHost.create):-1;return t>-1?e.manager.tooltipViews[t]:null}mousemove(e){var t,i;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:n,tooltip:r}=this;if(n.length&&r&&!isInTooltip(r.dom,e)||this.pending){let{pos:r}=n[0]||this.pending,s=null!==(i=null===(t=n[0])||void 0===t?void 0:t.end)&&void 0!==i?i:r;(r==s?this.view.posAtCoords(this.lastMove)==r:isOverRange(this.view,r,s,e.clientX,e.clientY))||(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:t}=this;if(t.length){let{tooltip:t}=this;t&&t.dom.contains(e.relatedTarget)?this.watchTooltipLeave(t.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(e){let t=i=>{e.removeEventListener("mouseleave",t),this.active.length&&!this.view.dom.contains(i.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};e.addEventListener("mouseleave",t)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const tooltipMargin=4;function isInTooltip(e,t){let i,{left:n,right:r,top:s,bottom:o}=e.getBoundingClientRect();if(i=e.querySelector(".cm-tooltip-arrow")){let e=i.getBoundingClientRect();s=Math.min(e.top,s),o=Math.max(e.bottom,o)}return t.clientX>=n-tooltipMargin&&t.clientX<=r+tooltipMargin&&t.clientY>=s-tooltipMargin&&t.clientY<=o+tooltipMargin}function isOverRange(e,t,i,n,r,s){let o=e.scrollDOM.getBoundingClientRect(),a=e.documentTop+e.documentPadding.top+e.contentHeight;if(o.left>n||o.right<n||o.top>r||Math.min(o.bottom,a)<r)return!1;let l=e.posAtCoords({x:n,y:r},!1);return l>=t&&l<=i}function hoverTooltip(e,t={}){let i=StateEffect.define(),n=StateField.define({create:()=>[],update(e,n){if(e.length&&(t.hideOnChange&&(n.docChanged||n.selection)?e=[]:t.hideOn&&(e=e.filter(e=>!t.hideOn(n,e))),n.docChanged)){let t=[];for(let i of e){let e=n.changes.mapPos(i.pos,-1,MapMode.TrackDel);if(null!=e){let r=Object.assign(Object.create(null),i);r.pos=e,null!=r.end&&(r.end=n.changes.mapPos(r.end)),t.push(r)}}e=t}for(let t of n.effects)t.is(i)&&(e=t.value),t.is(closeHoverTooltipEffect)&&(e=[]);return e},provide:e=>showHoverTooltip.from(e)});return{active:n,extension:[n,ViewPlugin.define(r=>new HoverPlugin(r,e,n,i,t.hoverTime||300)),showHoverTooltipHost]}}function getTooltip(e,t){let i=e.plugin(tooltipPlugin);if(!i)return null;let n=i.manager.tooltips.indexOf(t);return n<0?null:i.manager.tooltipViews[n]}const closeHoverTooltipEffect=StateEffect.define(),panelConfig=Facet.define({combine(e){let t,i;for(let n of e)t=t||n.topContainer,i=i||n.bottomContainer;return{topContainer:t,bottomContainer:i}}});function getPanel(e,t){let i=e.plugin(panelPlugin),n=i?i.specs.indexOf(t):-1;return n>-1?i.panels[n]:null}const panelPlugin=ViewPlugin.fromClass(class{constructor(e){this.input=e.state.facet(showPanel),this.specs=this.input.filter(e=>e),this.panels=this.specs.map(t=>t(e));let t=e.state.facet(panelConfig);this.top=new PanelGroup(e,!0,t.topContainer),this.bottom=new PanelGroup(e,!1,t.bottomContainer),this.top.sync(this.panels.filter(e=>e.top)),this.bottom.sync(this.panels.filter(e=>!e.top));for(let i of this.panels)i.dom.classList.add("cm-panel"),i.mount&&i.mount()}update(e){let t=e.state.facet(panelConfig);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new PanelGroup(e.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new PanelGroup(e.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=e.state.facet(showPanel);if(i!=this.input){let t=i.filter(e=>e),n=[],r=[],s=[],o=[];for(let i of t){let t,a=this.specs.indexOf(i);a<0?(t=i(e.view),o.push(t)):(t=this.panels[a],t.update&&t.update(e)),n.push(t),(t.top?r:s).push(t)}this.specs=t,this.panels=n,this.top.sync(r),this.bottom.sync(s);for(let e of o)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}else for(let n of this.panels)n.update&&n.update(e)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:e=>EditorView.scrollMargins.of(t=>{let i=t.plugin(e);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}})});class PanelGroup{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=rm(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=rm(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function rm(e){let t=e.nextSibling;return e.remove(),t}const showPanel=Facet.define({enables:panelPlugin});class GutterMarker extends RangeValue{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}GutterMarker.prototype.elementClass="",GutterMarker.prototype.toDOM=void 0,GutterMarker.prototype.mapMode=MapMode.TrackBefore,GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1,GutterMarker.prototype.point=!0;const gutterLineClass=Facet.define(),gutterWidgetClass=Facet.define(),defaults$1={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>RangeSet.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},activeGutters=Facet.define();function gutter(e){return[gutters(),activeGutters.of({...defaults$1,...e})]}const unfixGutters=Facet.define({combine:e=>e.some(e=>e)});function gutters(e){return[gutterView]}const gutterView=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.domAfter=null,this.prevViewport=e.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=e.state.facet(activeGutters).map(t=>new SingleGutterView(e,t)),this.fixed=!e.state.facet(unfixGutters);for(let t of this.gutters)"after"==t.config.side?this.getDOMAfter().appendChild(t.dom):this.dom.appendChild(t.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),e.scrollDOM.insertBefore(this.dom,e.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(e){if(this.updateGutters(e)){let t=this.prevViewport,i=e.view.viewport,n=Math.min(t.to,i.to)-Math.max(t.from,i.from);this.syncGutters(n<.8*(i.to-i.from))}if(e.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=e.view.viewport}syncGutters(e){let t=this.dom.nextSibling;e&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let i=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from),n=[],r=this.gutters.map(e=>new UpdateContext(e,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks)if(n.length&&(n=[]),Array.isArray(s.type)){let e=!0;for(let t of s.type)if(t.type==BlockType.Text&&e){advanceCursor(i,n,t.from);for(let e of r)e.line(this.view,t,n);e=!1}else if(t.widget)for(let e of r)e.widget(this.view,t)}else if(s.type==BlockType.Text){advanceCursor(i,n,s.from);for(let e of r)e.line(this.view,s,n)}else if(s.widget)for(let e of r)e.widget(this.view,s);for(let s of r)s.finish();e&&(this.view.scrollDOM.insertBefore(this.dom,t),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(e){let t=e.startState.facet(activeGutters),i=e.state.facet(activeGutters),n=e.docChanged||e.heightChanged||e.viewportChanged||!RangeSet.eq(e.startState.facet(gutterLineClass),e.state.facet(gutterLineClass),e.view.viewport.from,e.view.viewport.to);if(t==i)for(let r of this.gutters)r.update(e)&&(n=!0);else{n=!0;let r=[];for(let n of i){let i=t.indexOf(n);i<0?r.push(new SingleGutterView(this.view,n)):(this.gutters[i].update(e),r.push(this.gutters[i]))}for(let e of this.gutters)e.dom.remove(),r.indexOf(e)<0&&e.destroy();for(let e of r)"after"==e.config.side?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.gutters=r}return n}destroy(){for(let e of this.gutters)e.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:e=>EditorView.scrollMargins.of(t=>{let i=t.plugin(e);if(!i||0==i.gutters.length||!i.fixed)return null;let n=i.dom.offsetWidth*t.scaleX,r=i.domAfter?i.domAfter.offsetWidth*t.scaleX:0;return t.textDirection==Direction.LTR?{left:n,right:r}:{right:n,left:r}})});function asArray(e){return Array.isArray(e)?e:[e]}function advanceCursor(e,t,i){for(;e.value&&e.from<=i;)e.from==i&&t.push(e.value),e.next()}class UpdateContext{constructor(e,t,i){this.gutter=e,this.height=i,this.i=0,this.cursor=RangeSet.iter(e.markers,t.from)}addElement(e,t,i){let{gutter:n}=this,r=(t.top-this.height)/e.scaleY,s=t.height/e.scaleY;if(this.i==n.elements.length){let t=new GutterElement(e,s,r,i);n.elements.push(t),n.dom.appendChild(t.dom)}else n.elements[this.i].update(e,s,r,i);this.height=t.bottom,this.i++}line(e,t,i){let n=[];advanceCursor(this.cursor,n,t.from),i.length&&(n=n.concat(i));let r=this.gutter.config.lineMarker(e,t,n);r&&n.unshift(r);let s=this.gutter;(0!=n.length||s.config.renderEmptyElements)&&this.addElement(e,t,n)}widget(e,t){let i=this.gutter.config.widgetMarker(e,t.widget,t),n=i?[i]:null;for(let r of e.state.facet(gutterWidgetClass)){let i=r(e,t.widget,t);i&&(n||(n=[])).push(i)}n&&this.addElement(e,t,n)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class SingleGutterView{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,n=>{let r,s=n.target;if(s!=this.dom&&this.dom.contains(s)){for(;s.parentNode!=this.dom;)s=s.parentNode;let e=s.getBoundingClientRect();r=(e.top+e.bottom)/2}else r=n.clientY;let o=e.lineBlockAtHeight(r-e.documentTop);t.domEventHandlers[i](e,o,n)&&n.preventDefault()});this.markers=asArray(t.markers(e)),t.initialSpacer&&(this.spacer=new GutterElement(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=asArray(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let t=this.config.updateSpacer(this.spacer.markers[0],e);t!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[t])}let i=e.view.viewport;return!RangeSet.eq(this.markers,t,i.from,i.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(e)}destroy(){for(let e of this.elements)e.destroy()}}class GutterElement{constructor(e,t,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,n)}update(e,t,i,n){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),sameMarkers(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,t){let i="cm-gutterElement",n=this.dom.firstChild;for(let r=0,s=0;;){let o=s,a=r<t.length?t[r++]:null,l=!1;if(a){let e=a.elementClass;e&&(i+=" "+e);for(let t=s;t<this.markers.length;t++)if(this.markers[t].compare(a)){o=t,l=!0;break}}else o=this.markers.length;for(;s<o;){let e=this.markers[s++];if(e.toDOM){e.destroy(n);let t=n.nextSibling;n.remove(),n=t}}if(!a)break;a.toDOM&&(l?n=n.nextSibling:this.dom.insertBefore(a.toDOM(e),n)),l&&s++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}function sameMarkers(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(!e[i].compare(t[i]))return!1;return!0}const lineNumberMarkers=Facet.define(),lineNumberWidgetMarker=Facet.define(),lineNumberConfig=Facet.define({combine:e=>combineConfig(e,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let n in t){let e=i[n],r=t[n];i[n]=e?(t,i,n)=>e(t,i,n)||r(t,i,n):r}return i}})});class NumberMarker extends GutterMarker{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function formatNumber(e,t){return e.state.facet(lineNumberConfig).formatNumber(t,e.state)}const lineNumberGutter=activeGutters.compute([lineNumberConfig],e=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:e=>e.state.facet(lineNumberMarkers),lineMarker:(e,t,i)=>i.some(e=>e.toDOM)?null:new NumberMarker(formatNumber(e,e.state.doc.lineAt(t.from).number)),widgetMarker:(e,t,i)=>{for(let n of e.state.facet(lineNumberWidgetMarker)){let r=n(e,t,i);if(r)return r}return null},lineMarkerChange:e=>e.startState.facet(lineNumberConfig)!=e.state.facet(lineNumberConfig),initialSpacer:e=>new NumberMarker(formatNumber(e,maxLineNumber(e.state.doc.lines))),updateSpacer(e,t){let i=formatNumber(t.view,maxLineNumber(t.view.state.doc.lines));return i==e.number?e:new NumberMarker(i)},domEventHandlers:e.facet(lineNumberConfig).domEventHandlers,side:"before"}));function lineNumbers(e={}){return[lineNumberConfig.of(e),gutters(),lineNumberGutter]}function maxLineNumber(e){let t=9;for(;t<e;)t=10*t+9;return t}const activeLineGutterMarker=new class extends GutterMarker{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},activeLineGutterHighlighter=gutterLineClass.compute(["selection"],e=>{let t=[],i=-1;for(let n of e.selection.ranges){let r=e.doc.lineAt(n.head).from;r>i&&(i=r,t.push(activeLineGutterMarker.range(r)))}return RangeSet.of(t)});function highlightActiveLineGutter(){return activeLineGutterHighlighter}const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(e,t){this.from=e,this.to=t}}class NodeProp{constructor(e={}){this.id=nextPropID++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=NodeType.match(e)),t=>{let i=e(t);return void 0===i?null:[this,i]}}}NodeProp.closedBy=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.openedBy=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.group=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.isolate=new NodeProp({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw new RangeError("Invalid value for isolate: "+e);return e||"auto"}}),NodeProp.contextHash=new NodeProp({perNode:!0}),NodeProp.lookAhead=new NodeProp({perNode:!0}),NodeProp.mounted=new NodeProp({perNode:!0});class MountedTree{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}static get(e){return e&&e.props&&e.props[NodeProp.mounted.id]}}const noProps=Object.create(null);class NodeType{constructor(e,t,i,n=0){this.name=e,this.props=t,this.id=i,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):noProps,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new NodeType(e.name||"",t,e.id,i);if(e.props)for(let r of e.props)if(Array.isArray(r)||(r=r(n)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(NodeProp.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let n of i.split(" "))t[n]=e[i];return e=>{for(let i=e.prop(NodeProp.group),n=-1;n<(i?i.length:0);n++){let r=t[n<0?e.name:i[n]];if(r)return r}}}}NodeType.none=new NodeType("",Object.create(null),0,8);class NodeSet{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let n=null;for(let t of e){let e=t(i);if(e){n||(n=Object.assign({},i.props));let t=e[1],r=e[0];r.combine&&r.id in n&&(t=r.combine(n[r.id],t)),n[r.id]=t}}t.push(n?new NodeType(i.name,n,i.id,i.flags):i)}return new NodeSet(t)}}const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode,IterMode2;IterMode2=IterMode||(IterMode={}),IterMode2[IterMode2.ExcludeBuffers=1]="ExcludeBuffers",IterMode2[IterMode2.IncludeAnonymous=2]="IncludeAnonymous",IterMode2[IterMode2.IgnoreMounts=4]="IgnoreMounts",IterMode2[IterMode2.IgnoreOverlays=8]="IgnoreOverlays";let Tree$1=class e{constructor(e,t,i,n,r){if(this.type=e,this.children=t,this.positions=i,this.length=n,this.props=null,r&&r.length){this.props=Object.create(null);for(let[e,t]of r)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=MountedTree.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let e=i.toString();e&&(t&&(t+=","),t+=e)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new TreeCursor$1(this.topNode,e)}cursorAt(e,t=0,i=0){let n=CachedNode.get(this)||this.topNode,r=new TreeCursor$1(n);return r.moveTo(e,t),CachedNode.set(this,r._tree),r}get topNode(){return new TreeNode(this,0,0,null)}resolve(e,t=0){let i=resolveNode(CachedNode.get(this)||this.topNode,e,t,!1);return CachedNode.set(this,i),i}resolveInner(e,t=0){let i=resolveNode(CachedInnerNode.get(this)||this.topNode,e,t,!0);return CachedInnerNode.set(this,i),i}resolveStack(e,t=0){return stackIterator(this,e,t)}iterate(e){let{enter:t,leave:i,from:n=0,to:r=this.length}=e,s=e.mode||0,o=(s&IterMode.IncludeAnonymous)>0;for(let a=this.cursor(s|IterMode.IncludeAnonymous);;){let e=!1;if(a.from<=r&&a.to>=n&&(!o&&a.type.isAnonymous||!1!==t(a))){if(a.firstChild())continue;e=!0}for(;e&&i&&(o||!a.type.isAnonymous)&&i(a),!a.nextSibling();){if(!a.parent())return;e=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(t={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,n)=>new e(this.type,t,i,n,this.propValues),t.makeTree||((t,i,n)=>new e(NodeType.none,t,i,n)))}static build(e){return buildTree(e)}};Tree$1.empty=new Tree$1(NodeType.none,[],[],0);class FlatBufferCursor{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return NodeType.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],n=this.set.types[t],r=n.name;if(/\W/.test(r)&&!n.isError&&(r=JSON.stringify(r)),i==(e+=4))return r;let s=[];for(;e<i;)s.push(this.childString(e)),e=this.buffer[e+3];return r+"("+s.join(",")+")"}findChild(e,t,i,n,r){let{buffer:s}=this,o=-1;for(let a=e;a!=t&&!(checkSide(r,n,s[a+1],s[a+2])&&(o=a,i>0));a=s[a+3]);return o}slice(e,t,i){let n=this.buffer,r=new Uint16Array(t-e),s=0;for(let o=e,a=0;o<t;){r[a++]=n[o++],r[a++]=n[o++]-i;let t=r[a++]=n[o++]-i;r[a++]=n[o++]-e,s=Math.max(s,t)}return new TreeBuffer(r,s,this.set)}}function checkSide(e,t,i,n){switch(e){case-2:return i<t;case-1:return n>=t&&i<t;case 0:return i<t&&n>t;case 1:return i<=t&&n>t;case 2:return n>t;case 4:return!0}}function resolveNode(e,t,i,n){for(var r;e.from==e.to||(i<1?e.from>=t:e.from>t)||(i>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof TreeNode&&e.index<0?null:e.parent;if(!t)return e;e=t}let s=n?0:IterMode.IgnoreOverlays;if(n)for(let o=e,a=o.parent;a;o=a,a=o.parent)o instanceof TreeNode&&o.index<0&&(null===(r=a.enter(t,i,s))||void 0===r?void 0:r.from)!=o.from&&(e=a);for(;;){let n=e.enter(t,i,s);if(!n)return e;e=n}}class BaseNode{cursor(e=0){return new TreeCursor$1(this,e)}getChild(e,t=null,i=null){let n=getChildren(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return getChildren(this,e,t,i)}resolve(e,t=0){return resolveNode(this,e,t,!1)}resolveInner(e,t=0){return resolveNode(this,e,t,!0)}matchContext(e){return matchNodeContext(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(i=t,t=e.prevSibling):t=e}return i}get node(){return this}get next(){return this.parent}}class TreeNode extends BaseNode{constructor(e,t,i,n){super(),this._tree=e,this.from=t,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,n,r=0){for(let s=this;;){for(let{children:o,positions:a}=s._tree,l=t>0?o.length:-1;e!=l;e+=t){let l=o[e],c=a[e]+s.from;if(checkSide(n,i,c,c+l.length))if(l instanceof TreeBuffer){if(r&IterMode.ExcludeBuffers)continue;let o=l.findChild(0,l.buffer.length,t,i-c,n);if(o>-1)return new BufferNode(new BufferContext(s,l,e,c),null,o)}else if(r&IterMode.IncludeAnonymous||!l.type.isAnonymous||hasChild(l)){let o;if(!(r&IterMode.IgnoreMounts)&&(o=MountedTree.get(l))&&!o.overlay)return new TreeNode(o.tree,c,e,s);let a=new TreeNode(l,c,e,s);return r&IterMode.IncludeAnonymous||!a.type.isAnonymous?a:a.nextChild(t<0?l.children.length-1:0,t,i,n)}}if(r&IterMode.IncludeAnonymous||!s.type.isAnonymous)return null;if(e=s.index>=0?s.index+t:t<0?-1:s._parent._tree.children.length,s=s._parent,!s)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}prop(e){return this._tree.prop(e)}enter(e,t,i=0){let n;if(!(i&IterMode.IgnoreOverlays)&&(n=MountedTree.get(this._tree))&&n.overlay){let i=e-this.from;for(let{from:e,to:r}of n.overlay)if((t>0?e<=i:e<i)&&(t<0?r>=i:r>i))return new TreeNode(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function getChildren(e,t,i,n){let r=e.cursor(),s=[];if(!r.firstChild())return s;if(null!=i)for(let o=!1;!o;)if(o=r.type.is(i),!r.nextSibling())return s;for(;;){if(null!=n&&r.type.is(n))return s;if(r.type.is(t)&&s.push(r.node),!r.nextSibling())return null==n?s:[]}}function matchNodeContext(e,t,i=t.length-1){for(let n=e;i>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[i]&&t[i]!=n.name)return!1;i--}}return!0}class BufferContext{constructor(e,t,i,n){this.parent=e,this.buffer=t,this.index=i,this.start=n}}class BufferNode extends BaseNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,i);return r<0?null:new BufferNode(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}prop(e){return this.type.prop(e)}enter(e,t,i=0){if(i&IterMode.ExcludeBuffers)return null;let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return r<0?null:new BufferNode(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,n=this.index+4,r=i.buffer[this.index+3];if(r>n){let s=i.buffer[this.index+1];e.push(i.slice(n,r,s)),t.push(0)}return new Tree$1(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function iterStack(e){if(!e.length)return null;let t=0,i=e[0];for(let s=1;s<e.length;s++){let n=e[s];(n.from>i.from||n.to<i.to)&&(i=n,t=s)}let n=i instanceof TreeNode&&i.index<0?null:i.parent,r=e.slice();return n?r[t]=n:r.splice(t,1),new StackIterator(r,i)}class StackIterator{constructor(e,t){this.heads=e,this.node=t}get next(){return iterStack(this.heads)}}function stackIterator(e,t,i){let n=e.resolveInner(t,i),r=null;for(let s=n instanceof TreeNode?n:n.context.parent;s;s=s.parent)if(s.index<0){let e=s.parent;(r||(r=[n])).push(e.resolve(t,i)),s=e}else{let e=MountedTree.get(s.tree);if(e&&e.overlay&&e.overlay[0].from<=t&&e.overlay[e.overlay.length-1].to>=t){let o=new TreeNode(e.tree,e.overlay[0].from+s.from,-1,s);(r||(r=[n])).push(resolveNode(o,t,i,!1))}}return r?iterStack(r):n}let TreeCursor$1=class{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:i,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=i+n.buffer[e+1],this.to=i+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:n}=this.buffer,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,i);return!(r<0)&&(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?!(i&IterMode.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let e=i<0?0:this.stack[i]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(e)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:i}=n)}else({index:t,_parent:i}=this._tree);for(;i;({index:t,_parent:i}=i))if(t>-1)for(let n=t+e,r=e<0?-1:i._tree.children.length;n!=r;n+=e){let e=i._tree.children[n];if(this.mode&IterMode.IncludeAnonymous||e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let n=this.index,r=this.stack.length;r>=0;){for(let s=e;s;s=s._parent)if(s.index==n){if(n==this.index)return s;t=s,i=r+1;break e}n=this.stack[--r]}for(let n=i;n<this.stack.length;n++)t=new BufferNode(this.buffer,t,this.stack[n]);return this.bufferNode=new BufferNode(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;;){if(n&&t&&t(this),n=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,n=!0}}}matchContext(e){if(!this.buffer)return matchNodeContext(this.node.parent,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let n=e.length-1,r=this.stack.length-1;n>=0;r--){if(r<0)return matchNodeContext(this._tree,e,n);let s=i[t.buffer[this.stack[r]]];if(!s.isAnonymous){if(e[n]&&e[n]!=s.name)return!1;n--}}return!0}};function hasChild(e){return e.children.some(e=>e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))}function buildTree(e){var t;let{buffer:i,nodeSet:n,maxBufferLength:r=DefaultBufferLength,reused:s=[],minRepeatType:o=n.types.length}=e,a=Array.isArray(i)?new FlatBufferCursor(i,i.length):i,l=n.types,c=0,h=0;function u(e,t,i,g,y,_){let{id:b,start:w,end:S,size:v}=a,T=h,x=c;if(v<0){if(a.next(),-1==v){let t=s[b];return i.push(t),void g.push(w-e)}if(-3==v)return void(c=b);if(-4==v)return void(h=b);throw new RangeError(`Unrecognized record size: ${v}`)}let C,E,I=l[b],A=w-e;if(S-w<=r&&(E=function(e,t){let i=a.fork(),n=0,s=0,l=0,c=i.end-r,h={size:0,start:0,skip:0};e:for(let r=i.pos-e;i.pos>r;){let e=i.size;if(i.id==t&&e>=0){h.size=n,h.start=s,h.skip=l,l+=4,n+=4,i.next();continue}let a=i.pos-e;if(e<0||a<r||i.start<c)break;let u=i.id>=o?4:0,d=i.start;for(i.next();i.pos>a;){if(i.size<0){if(-3!=i.size&&-4!=i.size)break e;u+=4}else i.id>=o&&(u+=4);i.next()}s=d,n+=e,l+=u}(t<0||n==e)&&(h.size=n,h.start=s,h.skip=l);return h.size>4?h:void 0}(a.pos-t,y))){let t=new Uint16Array(E.size-E.skip),i=a.pos-E.size,r=t.length;for(;a.pos>i;)r=m(E.start,t,r);C=new TreeBuffer(t,S-E.start,n),A=E.start-e}else{let e=a.pos-v;a.next();let t=[],i=[],n=b>=o?b:-1,s=0,l=S;for(;a.pos>e;)n>=0&&a.id==n&&a.size>=0?(a.end<=l-r&&(p(t,i,w,s,a.end,l,n,T,x),s=t.length,l=a.end),a.next()):_>2500?d(w,e,t,i):u(w,e,t,i,n,_+1);if(n>=0&&s>0&&s<t.length&&p(t,i,w,s,w,l,n,T,x),t.reverse(),i.reverse(),n>-1&&s>0){let e=function(e,t){return(i,n,r)=>{let s,o,a=0,l=i.length-1;if(l>=0&&(s=i[l])instanceof Tree$1){if(!l&&s.type==e&&s.length==r)return s;(o=s.prop(NodeProp.lookAhead))&&(a=n[l]+s.length+o)}return f(e,i,n,r,a,t)}}(I,x);C=balanceRange(I,t,i,0,t.length,0,S-w,e,e)}else C=f(I,t,i,S-w,T-S,x)}i.push(C),g.push(A)}function d(e,t,i,s){let o=[],l=0,c=-1;for(;a.pos>t;){let{id:e,start:t,end:i,size:n}=a;if(n>4)a.next();else{if(c>-1&&t<c)break;c<0&&(c=i-r),o.push(e,t,i),l++,a.next()}}if(l){let t=new Uint16Array(4*l),r=o[o.length-2];for(let e=o.length-3,i=0;e>=0;e-=3)t[i++]=o[e],t[i++]=o[e+1]-r,t[i++]=o[e+2]-r,t[i++]=i;i.push(new TreeBuffer(t,o[2]-r,n)),s.push(r-e)}}function p(e,t,i,r,s,o,a,l,c){let h=[],u=[];for(;e.length>r;)h.push(e.pop()),u.push(t.pop()+i-s);e.push(f(n.types[a],h,u,o-s,l-o,c)),t.push(s-i)}function f(e,t,i,n,r,s,o){if(s){let e=[NodeProp.contextHash,s];o=o?[e].concat(o):[e]}if(r>25){let e=[NodeProp.lookAhead,r];o=o?[e].concat(o):[e]}return new Tree$1(e,t,i,n,o)}function m(e,t,i){let{id:n,start:r,end:s,size:l}=a;if(a.next(),l>=0&&n<o){let o=i;if(l>4){let n=a.pos-(l-4);for(;a.pos>n;)i=m(e,t,i)}t[--i]=o,t[--i]=s-e,t[--i]=r-e,t[--i]=n}else-3==l?c=n:-4==l&&(h=n);return i}let g=[],y=[];for(;a.pos>0;)u(e.start||0,e.bufferStart||0,g,y,-1,0);let _=null!==(t=e.length)&&void 0!==t?t:g.length?y[0]+g[0].length:0;return new Tree$1(l[e.topID],g.reverse(),y.reverse(),_)}const nodeSizeCache=new WeakMap;function nodeSize(e,t){if(!e.isAnonymous||t instanceof TreeBuffer||t.type!=e)return 1;let i=nodeSizeCache.get(t);if(null==i){i=1;for(let n of t.children){if(n.type!=e||!(n instanceof Tree$1)){i=1;break}i+=nodeSize(e,n)}nodeSizeCache.set(t,i)}return i}function balanceRange(e,t,i,n,r,s,o,a,l){let c=0;for(let p=n;p<r;p++)c+=nodeSize(e,t[p]);let h=Math.ceil(1.5*c/8),u=[],d=[];return function t(i,n,r,o,a){for(let c=r;c<o;){let r=c,p=n[c],f=nodeSize(e,i[c]);for(c++;c<o;c++){let t=nodeSize(e,i[c]);if(f+t>=h)break;f+=t}if(c==r+1){if(f>h){let e=i[r];t(e.children,e.positions,0,e.children.length,n[r]+a);continue}u.push(i[r])}else{let t=n[c-1]+i[c-1].length-p;u.push(balanceRange(e,i,n,r,c,p,t,null,l))}d.push(p+a-s)}}(t,i,n,r,0),(a||l)(u,d,o)}class TreeFragment{constructor(e,t,i,n,r=!1,s=!1){this.from=e,this.to=t,this.tree=i,this.offset=n,this.open=(r?1:0)|(s?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(e,t=[],i=!1){let n=[new TreeFragment(0,e.length,e,0,!1,i)];for(let r of t)r.to>e.length&&n.push(r);return n}static applyChanges(e,t,i=128){if(!t.length)return e;let n=[],r=1,s=e.length?e[0]:null;for(let o=0,a=0,l=0;;o++){let c=o<t.length?t[o]:null,h=c?c.fromA:1e9;if(h-a>=i)for(;s&&s.from<h;){let t=s;if(a>=t.from||h<=t.to||l){let e=Math.max(t.from,a)-l,i=Math.min(t.to,h)-l;t=e>=i?null:new TreeFragment(e,i,t.tree,t.offset+l,o>0,!!c)}if(t&&n.push(t),s.to>h)break;s=r<e.length?e[r++]:null}if(!c)break;a=c.toA,l=c.toA-c.toB}return n}}let Parser$1=class{startParse(e,t,i){return"string"==typeof e&&(e=new StringInput(e)),i=i?i.length?i.map(e=>new Range(e.from,e.to)):[new Range(0,0)]:[new Range(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let n=this.startParse(e,t,i);for(;;){let e=n.advance();if(e)return e}}};class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new NodeProp({perNode:!0});let nextTagID=0;class Tag{constructor(e,t,i,n){this.name=e,this.set=t,this.base=i,this.modified=n,this.id=nextTagID++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let i="string"==typeof e?e:"?";if(e instanceof Tag&&(t=e),null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let n=new Tag(i,[],null,[]);if(n.set.push(n),t)for(let r of t.set)n.set.push(r);return n}static defineModifier(e){let t=new Modifier(e);return e=>e.modified.indexOf(t)>-1?e:Modifier.get(e.base||e,e.modified.concat(t).sort((e,t)=>e.id-t.id))}}let nextModifierID=0;class Modifier{constructor(e){this.name=e,this.instances=[],this.id=nextModifierID++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(i=>i.base==e&&sameArray(t,i.modified));if(i)return i;let n=[],r=new Tag(e.name,n,e,t);for(let o of t)o.instances.push(r);let s=powerSet(t);for(let o of e.set)if(!o.modified.length)for(let e of s)n.push(Modifier.get(o,e));return r}}function sameArray(e,t){return e.length==t.length&&e.every((e,i)=>e==t[i])}function powerSet(e){let t=[[]];for(let i=0;i<e.length;i++)for(let n=0,r=t.length;n<r;n++)t.push(t[n].concat(e[i]));return t.sort((e,t)=>t.length-e.length)}function styleTags(e){let t=Object.create(null);for(let i in e){let n=e[i];Array.isArray(n)||(n=[n]);for(let e of i.split(" "))if(e){let i=[],r=2,s=e;for(let t=0;;){if("..."==s&&t>0&&t+3==e.length){r=1;break}let n=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(s);if(!n)throw new RangeError("Invalid path: "+e);if(i.push("*"==n[0]?"":'"'==n[0][0]?JSON.parse(n[0]):n[0]),t+=n[0].length,t==e.length)break;let o=e[t++];if(t==e.length&&"!"==o){r=0;break}if("/"!=o)throw new RangeError("Invalid path: "+e);s=e.slice(t)}let o=i.length-1,a=i[o];if(!a)throw new RangeError("Invalid path: "+e);let l=new Rule(n,r,o>0?i.slice(0,o):null);t[a]=l.sort(t[a])}}return ruleNodeProp.add(t)}const ruleNodeProp=new NodeProp({combine(e,t){let i,n,r;for(;e||t;){if(!e||t&&e.depth>=t.depth?(r=t,t=t.next):(r=e,e=e.next),i&&i.mode==r.mode&&!r.context&&!i.context)continue;let s=new Rule(r.tags,r.mode,r.context);i?i.next=s:n=s,i=s}return n}});class Rule{constructor(e,t,i,n){this.tags=e,this.mode=t,this.context=i,this.next=n}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}function tagHighlighter(e,t){let i=Object.create(null);for(let s of e)if(Array.isArray(s.tag))for(let e of s.tag)i[e.id]=s.class;else i[s.tag.id]=s.class;let{scope:n,all:r=null}=t||{};return{style:e=>{let t=r;for(let n of e)for(let e of n.set){let n=i[e.id];if(n){t=t?t+" "+n:n;break}}return t},scope:n}}function highlightTags(e,t){let i=null;for(let n of e){let e=n.style(t);e&&(i=i?i+" "+e:e)}return i}function highlightTree(e,t,i,n=0,r=e.length){let s=new HighlightBuilder(n,Array.isArray(t)?t:[t],i);s.highlightRange(e.cursor(),n,r,"",s.highlighters),s.flush(r)}Rule.empty=new Rule([],2,null);class HighlightBuilder{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,n,r){let{type:s,from:o,to:a}=e;if(o>=i||a<=t)return;s.isTop&&(r=this.highlighters.filter(e=>!e.scope||e.scope(s)));let l=n,c=getStyleTags(e)||Rule.empty,h=highlightTags(r,c.tags);if(h&&(l&&(l+=" "),l+=h,1==c.mode&&(n+=(n?" ":"")+h)),this.startSpan(Math.max(t,o),l),c.opaque)return;let u=e.tree&&e.tree.prop(NodeProp.mounted);if(u&&u.overlay){let s=e.node.enter(u.overlay[0].from+o,1),c=this.highlighters.filter(e=>!e.scope||e.scope(u.tree.type)),h=e.firstChild();for(let d=0,p=o;;d++){let f=d<u.overlay.length?u.overlay[d]:null,m=f?f.from+o:a,g=Math.max(t,p),y=Math.min(i,m);if(g<y&&h)for(;e.from<y&&(this.highlightRange(e,g,y,n,r),this.startSpan(Math.min(y,e.to),l),!(e.to>=m)&&e.nextSibling()););if(!f||m>i)break;p=f.to+o,p>t&&(this.highlightRange(s.cursor(),Math.max(t,f.from+o),Math.min(i,p),"",c),this.startSpan(Math.min(i,p),l))}h&&e.parent()}else if(e.firstChild()){u&&(n="");do{if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,n,r),this.startSpan(Math.min(i,e.to),l)}}while(e.nextSibling());e.parent()}}}function getStyleTags(e){let t=e.type.prop(ruleNodeProp);for(;t&&t.context&&!e.matchContext(t.context);)t=t.next;return t||null}const t=Tag.define,comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t(),tags={comment:comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name:name,variableName:t(name),typeName:typeName,tagName:t(typeName),propertyName:propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal:literal,string:string,docString:t(string),character:t(string),attributeValue:t(string),number:number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword:keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator:operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation:punctuation,separator:t(punctuation),bracket:bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content:content,heading:heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta:meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier("definition"),constant:Tag.defineModifier("constant"),function:Tag.defineModifier("function"),standard:Tag.defineModifier("standard"),local:Tag.defineModifier("local"),special:Tag.defineModifier("special")};for(let e in tags){let t=tags[e];t instanceof Tag&&(t.name=e)}var _a;tagHighlighter([{tag:tags.link,class:"tok-link"},{tag:tags.heading,class:"tok-heading"},{tag:tags.emphasis,class:"tok-emphasis"},{tag:tags.strong,class:"tok-strong"},{tag:tags.keyword,class:"tok-keyword"},{tag:tags.atom,class:"tok-atom"},{tag:tags.bool,class:"tok-bool"},{tag:tags.url,class:"tok-url"},{tag:tags.labelName,class:"tok-labelName"},{tag:tags.inserted,class:"tok-inserted"},{tag:tags.deleted,class:"tok-deleted"},{tag:tags.literal,class:"tok-literal"},{tag:tags.string,class:"tok-string"},{tag:tags.number,class:"tok-number"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],class:"tok-string2"},{tag:tags.variableName,class:"tok-variableName"},{tag:tags.local(tags.variableName),class:"tok-variableName tok-local"},{tag:tags.definition(tags.variableName),class:"tok-variableName tok-definition"},{tag:tags.special(tags.variableName),class:"tok-variableName2"},{tag:tags.definition(tags.propertyName),class:"tok-propertyName tok-definition"},{tag:tags.typeName,class:"tok-typeName"},{tag:tags.namespace,class:"tok-namespace"},{tag:tags.className,class:"tok-className"},{tag:tags.macroName,class:"tok-macroName"},{tag:tags.propertyName,class:"tok-propertyName"},{tag:tags.operator,class:"tok-operator"},{tag:tags.comment,class:"tok-comment"},{tag:tags.meta,class:"tok-meta"},{tag:tags.invalid,class:"tok-invalid"},{tag:tags.punctuation,class:"tok-punctuation"}]);const languageDataProp=new NodeProp;function defineLanguageFacet(e){return Facet.define({combine:e?t=>t.concat(e):void 0})}const sublanguageProp=new NodeProp;let Language$1=class{constructor(e,t,i=[],n=""){this.data=e,this.name=n,EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(EditorState.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=t,this.extension=[language.of(this),EditorState.languageData.of((e,t,i)=>{let n=topNodeAt(e,t,i),r=n.type.prop(languageDataProp);if(!r)return[];let s=e.facet(r),o=n.type.prop(sublanguageProp);if(o){let r=n.resolve(t-n.from,i);for(let t of o)if(t.test(r,e)){let i=e.facet(t.facet);return"replace"==t.type?i:i.concat(s)}}return s})].concat(i)}isActiveAt(e,t,i=-1){return topNodeAt(e,t,i).type.prop(languageDataProp)==this.data}findRegions(e){let t=e.facet(language);if((null==t?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],n=(e,t)=>{if(e.prop(languageDataProp)==this.data)return void i.push({from:t,to:t+e.length});let r=e.prop(NodeProp.mounted);if(r){if(r.tree.prop(languageDataProp)==this.data){if(r.overlay)for(let e of r.overlay)i.push({from:e.from+t,to:e.to+t});else i.push({from:t,to:t+e.length});return}if(r.overlay){let e=i.length;if(n(r.tree,r.overlay[0].from+t),i.length>e)return}}for(let i=0;i<e.children.length;i++){let r=e.children[i];r instanceof Tree$1&&n(r,e.positions[i]+t)}};return n(syntaxTree(e),0),i}get allowsNesting(){return!0}};function topNodeAt(e,t,i){let n=e.facet(language),r=syntaxTree(e).topNode;if(!n||n.allowsNesting)for(let s=r;s;s=s.enter(t,i,IterMode.ExcludeBuffers))s.type.isTop&&(r=s);return r}Language$1.setState=StateEffect.define();class LRLanguage extends Language$1{constructor(e,t,i){super(e,t,[],i),this.parser=t}static define(e){let t=defineLanguageFacet(e.languageData);return new LRLanguage(t,e.parser.configure({props:[languageDataProp.add(e=>e.isTop?t:void 0)]}),e.name)}configure(e,t){return new LRLanguage(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function syntaxTree(e){let t=e.field(Language$1.state,!1);return t?t.tree:Tree$1.empty}class DocInput{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let currentContext=null;class ParseContext{constructor(e,t,i=[],n,r,s,o,a){this.parser=e,this.state=t,this.fragments=i,this.tree=n,this.treeLen=r,this.viewport=s,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new ParseContext(e,t,[],Tree$1.empty,0,i,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(e,t){return null!=t&&t>=this.state.doc.length&&(t=void 0),this.tree!=Tree$1.empty&&this.isDone(null!=t?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=t&&(null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n){if(this.fragments=this.withoutTempSkipped(TreeFragment.addTree(n,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=n,this.parse=null,!(this.treeLen<(null!=t?t:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=currentContext;currentContext=this;try{return e()}finally{currentContext=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=cutFragments(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:n,treeLen:r,viewport:s,skipped:o}=this;if(this.takeTree(),!e.empty){let t=[];if(e.iterChangedRanges((e,i,n,r)=>t.push({fromA:e,toA:i,fromB:n,toB:r})),i=TreeFragment.applyChanges(i,t),n=Tree$1.empty,r=0,s={from:e.mapPos(s.from,-1),to:e.mapPos(s.to,1)},this.skipped.length){o=[];for(let t of this.skipped){let i=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);i<n&&o.push({from:i,to:n})}}}return new ParseContext(this.parser,t,i,n,r,s,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:t,to:n}=this.skipped[i];t<e.to&&n>e.from&&(this.fragments=cutFragments(this.fragments,t,n),this.skipped.splice(i--,1))}return!(this.skipped.length>=t)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Parser$1{createParse(t,i,n){let r=n[0].from,s=n[n.length-1].to;return{parsedPos:r,advance(){let t=currentContext;if(t){for(let e of n)t.tempSkipped.push(e);e&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e)}return this.parsedPos=s,new Tree$1(NodeType.none,[],[],s-r)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&0==t[0].from&&t[0].to>=e}static get(){return currentContext}}function cutFragments(e,t,i){return TreeFragment.applyChanges(e,[{fromA:t,toA:i,fromB:t,toB:i}])}class LanguageState{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new LanguageState(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=ParseContext.create(e.facet(language).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new LanguageState(i)}}Language$1.state=StateField.define({create:LanguageState.init,update(e,t){for(let i of t.effects)if(i.is(Language$1.setState))return i.value;return t.startState.facet(language)!=t.state.facet(language)?LanguageState.init(t.state):e.apply(t)}});let requestIdle=e=>{let t=setTimeout(()=>e(),500);return()=>clearTimeout(t)};"undefined"!=typeof requestIdleCallback&&(requestIdle=e=>{let t=-1,i=setTimeout(()=>{t=requestIdleCallback(e,{timeout:400})},100);return()=>t<0?clearTimeout(i):cancelIdleCallback(t)});const isInputPending="undefined"!=typeof navigator&&(null===(_a=navigator.scheduling)||void 0===_a?void 0:_a.isInputPending)?()=>navigator.scheduling.isInputPending():null,parseWorker=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Language$1.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Language$1.state);t.tree==t.context.tree&&t.context.isDone(e.doc.length)||(this.working=requestIdle(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:n}}=this.view,r=i.field(Language$1.state);if(r.tree==r.context.tree&&r.context.isDone(n+1e5))return;let s=Date.now()+Math.min(this.chunkBudget,100,e&&!isInputPending?Math.max(25,e.timeRemaining()-5):1e9),o=r.context.treeLen<n&&i.doc.length>n+1e3,a=r.context.work(()=>isInputPending&&isInputPending()||Date.now()>s,n+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:Language$1.setState.of(new LanguageState(r.context))})),this.chunkBudget>0&&(!a||o)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(e=>logException(this.view.state,e)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=Facet.define({combine:e=>e.length?e[0]:null,enables:e=>[Language$1.state,parseWorker,EditorView.contentAttributes.compute([e],t=>{let i=t.facet(e);return i&&i.name?{"data-language":i.name}:{}})]});class LanguageSupport{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const indentService=Facet.define(),indentUnit=Facet.define({combine:e=>{if(!e.length)return"  ";let t=e[0];if(!t||/\S/.test(t)||Array.from(t).some(e=>e!=t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return t}});function getIndentUnit(e){let t=e.facet(indentUnit);return 9==t.charCodeAt(0)?e.tabSize*t.length:t.length}function indentString(e,t){let i="",n=e.tabSize,r=e.facet(indentUnit)[0];if("\t"==r){for(;t>=n;)i+="\t",t-=n;r=" "}for(let s=0;s<t;s++)i+=r;return i}function getIndentation(e,t){e instanceof EditorState&&(e=new IndentContext(e));for(let n of e.state.facet(indentService)){let i=n(e,t);if(void 0!==i)return i}let i=syntaxTree(e.state);return i.length>=t?syntaxIndentation(e,i,t):null}class IndentContext{constructor(e,t={}){this.state=e,this.options=t,this.unit=getIndentUnit(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:r}=this.options;return null!=n&&n>=i.from&&n<=i.to?r&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:i.text.slice(n-i.from),from:n}:{text:i.text.slice(0,n-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:n}=this.lineAt(e,t);return i.slice(e-n,Math.min(i.length,e+100-n))}column(e,t=1){let{text:i,from:n}=this.lineAt(e,t),r=this.countColumn(i,e-n),s=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return s>-1&&(r+=s-this.countColumn(i,i.search(/\S|$/))),r}countColumn(e,t=e.length){return countColumn(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:n}=this.lineAt(e,t),r=this.options.overrideIndentation;if(r){let e=r(n);if(e>-1)return e}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const indentNodeProp=new NodeProp;function syntaxIndentation(e,t,i){let n=t.resolveStack(i),r=t.resolveInner(i,-1).resolve(i,0).enterUnfinishedNodesBefore(i);if(r!=n.node){let e=[];for(let t=r;t&&!(t.from<n.node.from||t.to>n.node.to||t.from==n.node.from&&t.type==n.node.type);t=t.parent)e.push(t);for(let t=e.length-1;t>=0;t--)n={node:e[t],next:n}}return indentFor(n,e,i)}function indentFor(e,t,i){for(let n=e;n;n=n.next){let e=indentStrategy(n.node);if(e)return e(TreeIndentContext.create(t,i,n))}return 0}function ignoreClosed(e){return e.pos==e.options.simulateBreak&&e.options.simulateDoubleBreak}function indentStrategy(e){let t=e.type.prop(indentNodeProp);if(t)return t;let i,n=e.firstChild;if(n&&(i=n.type.prop(NodeProp.closedBy))){let t=e.lastChild,n=t&&i.indexOf(t.name)>-1;return e=>delimitedStrategy(e,!0,1,void 0,n&&!ignoreClosed(e)?t.from:void 0)}return null==e.parent?topIndent:null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.context=i}get node(){return this.context.node}static create(e,t,i){return new TreeIndentContext(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let i=e.resolve(t.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(isParent(i,e))break;t=this.state.doc.lineAt(i.from)}return this.lineIndent(t.from)}continue(){return indentFor(this.context.next,this.base,this.pos)}}function isParent(e,t){for(let i=t;i;i=i.parent)if(e==i)return!0;return!1}function bracketedAligned(e){let t=e.node,i=t.childAfter(t.from),n=t.lastChild;if(!i)return null;let r=e.options.simulateBreak,s=e.state.doc.lineAt(i.from),o=null==r||r<=s.from?s.to:Math.min(s.to,r);for(let a=i.to;;){let e=t.childAfter(a);if(!e||e==n)return null;if(!e.type.isSkipped){if(e.from>=o)return null;let t=/^ */.exec(s.text.slice(i.to-s.from))[0].length;return{from:i.from,to:i.to+t}}a=e.to}}function delimitedStrategy(e,t,i,n,r){let s=e.textAfter.match(/^\s*/)[0].length,o=r==e.pos+s,a=bracketedAligned(e);return a?o?e.column(a.from):e.column(a.to):e.baseIndent+(o?0:e.unit*i)}const DontIndentBeyond=200;function indentOnInput(){return EditorState.transactionFilter.of(e=>{if(!e.docChanged||!e.isUserEvent("input.type")&&!e.isUserEvent("input.complete"))return e;let t=e.startState.languageDataAt("indentOnInput",e.startState.selection.main.head);if(!t.length)return e;let i=e.newDoc,{head:n}=e.newSelection.main,r=i.lineAt(n);if(n>r.from+DontIndentBeyond)return e;let s=i.sliceString(r.from,n);if(!t.some(e=>e.test(s)))return e;let{state:o}=e,a=-1,l=[];for(let{head:c}of o.selection.ranges){let e=o.doc.lineAt(c);if(e.from==a)continue;a=e.from;let t=getIndentation(o,e.from);if(null==t)continue;let i=/^\s*/.exec(e.text)[0],n=indentString(o,t);i!=n&&l.push({from:e.from,to:e.from+i.length,insert:n})}return l.length?[e,{changes:l,sequential:!0}]:e})}const foldService=Facet.define(),foldNodeProp=new NodeProp;function syntaxFolding(e,t,i){let n=syntaxTree(e);if(n.length<i)return null;let r=null;for(let s=n.resolveStack(i,1);s;s=s.next){let o=s.node;if(o.to<=i||o.from>i)continue;if(r&&o.from<t)break;let a=o.type.prop(foldNodeProp);if(a&&(o.to<n.length-50||n.length==e.doc.length||!isUnfinished(o))){let n=a(o,e);n&&n.from<=i&&n.from>=t&&n.to>i&&(r=n)}}return r}function isUnfinished(e){let t=e.lastChild;return t&&t.to==e.to&&t.type.isError}function foldable(e,t,i){for(let n of e.facet(foldService)){let r=n(e,t,i);if(r)return r}return syntaxFolding(e,t,i)}function mapRange(e,t){let i=t.mapPos(e.from,1),n=t.mapPos(e.to,-1);return i>=n?void 0:{from:i,to:n}}const foldEffect=StateEffect.define({map:mapRange}),unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(e){let t=[];for(let{head:i}of e.state.selection.ranges)t.some(e=>e.from<=i&&e.to>=i)||t.push(e.lineBlockAt(i));return t}const foldState=StateField.define({create:()=>Decoration.none,update(e,t){t.isUserEvent("delete")&&t.changes.iterChangedRanges((t,i)=>e=clearTouchedFolds(e,t,i)),e=e.map(t.changes);for(let i of t.effects)if(i.is(foldEffect)&&!foldExists(e,i.value.from,i.value.to)){let{preparePlaceholder:n}=t.state.facet(foldConfig),r=n?Decoration.replace({widget:new PreparedFoldWidget(n(t.state,i.value))}):foldWidget;e=e.update({add:[r.range(i.value.from,i.value.to)]})}else i.is(unfoldEffect)&&(e=e.update({filter:(e,t)=>i.value.from!=e||i.value.to!=t,filterFrom:i.value.from,filterTo:i.value.to}));return t.selection&&(e=clearTouchedFolds(e,t.selection.main.head)),e},provide:e=>EditorView.decorations.from(e),toJSON(e,t){let i=[];return e.between(0,t.doc.length,(e,t)=>{i.push(e,t)}),i},fromJSON(e){if(!Array.isArray(e)||e.length%2)throw new RangeError("Invalid JSON for fold state");let t=[];for(let i=0;i<e.length;){let n=e[i++],r=e[i++];if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid JSON for fold state");t.push(foldWidget.range(n,r))}return Decoration.set(t,!0)}});function clearTouchedFolds(e,t,i=t){let n=!1;return e.between(t,i,(e,r)=>{e<i&&r>t&&(n=!0)}),n?e.update({filterFrom:t,filterTo:i,filter:(e,n)=>e>=i||n<=t}):e}function findFold(e,t,i){var n;let r=null;return null===(n=e.field(foldState,!1))||void 0===n||n.between(t,i,(e,t)=>{(!r||r.from>e)&&(r={from:e,to:t})}),r}function foldExists(e,t,i){let n=!1;return e.between(t,t,(e,r)=>{e==t&&r==i&&(n=!0)}),n}function maybeEnable(e,t){return e.field(foldState,!1)?t:t.concat(StateEffect.appendConfig.of(codeFolding()))}const foldCode=e=>{for(let t of selectedLines(e)){let i=foldable(e.state,t.from,t.to);if(i)return e.dispatch({effects:maybeEnable(e.state,[foldEffect.of(i),announceFold(e,i)])}),!0}return!1},unfoldCode=e=>{if(!e.state.field(foldState,!1))return!1;let t=[];for(let i of selectedLines(e)){let n=findFold(e.state,i.from,i.to);n&&t.push(unfoldEffect.of(n),announceFold(e,n,!1))}return t.length&&e.dispatch({effects:t}),t.length>0};function announceFold(e,t,i=!0){let n=e.state.doc.lineAt(t.from).number,r=e.state.doc.lineAt(t.to).number;return EditorView.announce.of(`${e.state.phrase(i?"Folded lines":"Unfolded lines")} ${n} ${e.state.phrase("to")} ${r}.`)}const foldAll=e=>{let{state:t}=e,i=[];for(let n=0;n<t.doc.length;){let r=e.lineBlockAt(n),s=foldable(t,r.from,r.to);s&&i.push(foldEffect.of(s)),n=(s?e.lineBlockAt(s.to):r).to+1}return i.length&&e.dispatch({effects:maybeEnable(e.state,i)}),!!i.length},unfoldAll=e=>{let t=e.state.field(foldState,!1);if(!t||!t.size)return!1;let i=[];return t.between(0,e.state.doc.length,(e,t)=>{i.push(unfoldEffect.of({from:e,to:t}))}),e.dispatch({effects:i}),!0},foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}],defaultConfig={placeholderDOM:null,preparePlaceholder:null,placeholderText:"‚Ä¶"},foldConfig=Facet.define({combine:e=>combineConfig(e,defaultConfig)});function codeFolding(e){return[foldState,baseTheme$1$2]}function widgetToDOM(e,t){let{state:i}=e,n=i.facet(foldConfig),r=t=>{let i=e.lineBlockAt(e.posAtDOM(t.target)),n=findFold(e.state,i.from,i.to);n&&e.dispatch({effects:unfoldEffect.of(n)}),t.preventDefault()};if(n.placeholderDOM)return n.placeholderDOM(e,r,t);let s=document.createElement("span");return s.textContent=n.placeholderText,s.setAttribute("aria-label",i.phrase("folded code")),s.title=i.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=r,s}const foldWidget=Decoration.replace({widget:new class extends WidgetType{toDOM(e){return widgetToDOM(e,null)}}});class PreparedFoldWidget extends WidgetType{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return widgetToDOM(e,this.value)}}const foldGutterDefaults={openText:"‚åÑ",closedText:"‚Ä∫",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class FoldMarker extends GutterMarker{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function foldGutter(e={}){let t={...foldGutterDefaults,...e},i=new FoldMarker(t,!0),n=new FoldMarker(t,!1),r=ViewPlugin.fromClass(class{constructor(e){this.from=e.viewport.from,this.markers=this.buildMarkers(e)}update(e){(e.docChanged||e.viewportChanged||e.startState.facet(language)!=e.state.facet(language)||e.startState.field(foldState,!1)!=e.state.field(foldState,!1)||syntaxTree(e.startState)!=syntaxTree(e.state)||t.foldingChanged(e))&&(this.markers=this.buildMarkers(e.view))}buildMarkers(e){let t=new RangeSetBuilder;for(let r of e.viewportLineBlocks){let s=findFold(e.state,r.from,r.to)?n:foldable(e.state,r.from,r.to)?i:null;s&&t.add(r.from,r.from,s)}return t.finish()}}),{domEventHandlers:s}=t;return[r,gutter({class:"cm-foldGutter",markers(e){var t;return(null===(t=e.plugin(r))||void 0===t?void 0:t.markers)||RangeSet.empty},initialSpacer:()=>new FoldMarker(t,!1),domEventHandlers:{...s,click:(e,t,i)=>{if(s.click&&s.click(e,t,i))return!0;let n=findFold(e.state,t.from,t.to);if(n)return e.dispatch({effects:unfoldEffect.of(n)}),!0;let r=foldable(e.state,t.from,t.to);return!!r&&(e.dispatch({effects:foldEffect.of(r)}),!0)}}}),codeFolding()]}const baseTheme$1$2=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class HighlightStyle{constructor(e,t){let i;function n(e){let t=StyleModule.newName();return(i||(i=Object.create(null)))["."+t]=e,t}this.specs=e;const r="string"==typeof t.all?t.all:t.all?n(t.all):void 0,s=t.scope;this.scope=s instanceof Language$1?e=>e.prop(languageDataProp)==s.data:s?e=>e==s:void 0,this.style=tagHighlighter(e.map(e=>({tag:e.tag,class:e.class||n(Object.assign({},e,{tag:null}))})),{all:r}).style,this.module=i?new StyleModule(i):null,this.themeType=t.themeType}static define(e,t){return new HighlightStyle(e,t||{})}}const highlighterFacet=Facet.define(),fallbackHighlighter=Facet.define({combine:e=>e.length?[e[0]]:null});function getHighlighters(e){let t=e.facet(highlighterFacet);return t.length?t:e.facet(fallbackHighlighter)}function syntaxHighlighting(e,t){let i,n=[treeHighlighter];return e instanceof HighlightStyle&&(e.module&&n.push(EditorView.styleModule.of(e.module)),i=e.themeType),(null==t?void 0:t.fallback)?n.push(fallbackHighlighter.of(e)):i?n.push(highlighterFacet.computeN([EditorView.darkTheme],t=>t.facet(EditorView.darkTheme)==("dark"==i)?[e]:[])):n.push(highlighterFacet.of(e)),n}class TreeHighlighter{constructor(e){this.markCache=Object.create(null),this.tree=syntaxTree(e.state),this.decorations=this.buildDeco(e,getHighlighters(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=syntaxTree(e.state),i=getHighlighters(e.state),n=i!=getHighlighters(e.startState),{viewport:r}=e.view,s=e.changes.mapPos(this.decoratedTo,1);t.length<r.to&&!n&&t.type==this.tree.type&&s>=r.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=s):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i),this.decoratedTo=r.to)}buildDeco(e,t){if(!t||!this.tree.length)return Decoration.none;let i=new RangeSetBuilder;for(let{from:n,to:r}of e.visibleRanges)highlightTree(this.tree,t,(e,t,n)=>{i.add(e,t,this.markCache[n]||(this.markCache[n]=Decoration.mark({class:n})))},n,r);return i.finish()}}const treeHighlighter=Prec.high(ViewPlugin.fromClass(TreeHighlighter,{decorations:e=>e.decorations})),defaultHighlightStyle=HighlightStyle.define([{tag:tags.meta,color:"#404740"},{tag:tags.link,textDecoration:"underline"},{tag:tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strong,fontWeight:"bold"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.keyword,color:"#708"},{tag:[tags.atom,tags.bool,tags.url,tags.contentSeparator,tags.labelName],color:"#219"},{tag:[tags.literal,tags.inserted],color:"#164"},{tag:[tags.string,tags.deleted],color:"#a11"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],color:"#e40"},{tag:tags.definition(tags.variableName),color:"#00f"},{tag:tags.local(tags.variableName),color:"#30a"},{tag:[tags.typeName,tags.namespace],color:"#085"},{tag:tags.className,color:"#167"},{tag:[tags.special(tags.variableName),tags.macroName],color:"#256"},{tag:tags.definition(tags.propertyName),color:"#00c"},{tag:tags.comment,color:"#940"},{tag:tags.invalid,color:"#f00"}]),baseTheme$3=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),DefaultScanDist=1e4,DefaultBrackets="()[]{}",bracketMatchingConfig=Facet.define({combine:e=>combineConfig(e,{afterCursor:!0,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}),matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});function defaultRenderMatch(e){let t=[],i=e.matched?matchingMark:nonmatchingMark;return t.push(i.range(e.start.from,e.start.to)),e.end&&t.push(i.range(e.end.from,e.end.to)),t}const bracketMatchingState=StateField.define({create:()=>Decoration.none,update(e,t){if(!t.docChanged&&!t.selection)return e;let i=[],n=t.state.facet(bracketMatchingConfig);for(let r of t.state.selection.ranges){if(!r.empty)continue;let e=matchBrackets(t.state,r.head,-1,n)||r.head>0&&matchBrackets(t.state,r.head-1,1,n)||n.afterCursor&&(matchBrackets(t.state,r.head,1,n)||r.head<t.state.doc.length&&matchBrackets(t.state,r.head+1,-1,n));e&&(i=i.concat(n.renderMatch(e,t.state)))}return Decoration.set(i,!0)},provide:e=>EditorView.decorations.from(e)}),bracketMatchingUnique=[bracketMatchingState,baseTheme$3];function bracketMatching(e={}){return[bracketMatchingConfig.of(e),bracketMatchingUnique]}const bracketMatchingHandle=new NodeProp;function matchingNodes(e,t,i){let n=e.prop(t<0?NodeProp.openedBy:NodeProp.closedBy);if(n)return n;if(1==e.name.length){let n=i.indexOf(e.name);if(n>-1&&n%2==(t<0?1:0))return[i[n+t]]}return null}function findHandle(e){let t=e.type.prop(bracketMatchingHandle);return t?t(e.node):e}function matchBrackets(e,t,i,n={}){let r=n.maxScanDistance||DefaultScanDist,s=n.brackets||DefaultBrackets,o=syntaxTree(e),a=o.resolveInner(t,i);for(let l=a;l;l=l.parent){let n=matchingNodes(l.type,i,s);if(n&&l.from<l.to){let r=findHandle(l);if(r&&(i>0?t>=r.from&&t<r.to:t>r.from&&t<=r.to))return matchMarkedBrackets(e,t,i,l,r,n,s)}}return matchPlainBrackets(e,t,i,o,a.type,r,s)}function matchMarkedBrackets(e,t,i,n,r,s,o){let a=n.parent,l={from:r.from,to:r.to},c=0,h=null==a?void 0:a.cursor();if(h&&(i<0?h.childBefore(n.from):h.childAfter(n.to)))do{if(i<0?h.to<=n.from:h.from>=n.to){if(0==c&&s.indexOf(h.type.name)>-1&&h.from<h.to){let e=findHandle(h);return{start:l,end:e?{from:e.from,to:e.to}:void 0,matched:!0}}if(matchingNodes(h.type,i,o))c++;else if(matchingNodes(h.type,-i,o)){if(0==c){let e=findHandle(h);return{start:l,end:e&&e.from<e.to?{from:e.from,to:e.to}:void 0,matched:!1}}c--}}}while(i<0?h.prevSibling():h.nextSibling());return{start:l,matched:!1}}function matchPlainBrackets(e,t,i,n,r,s,o){let a=i<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1),l=o.indexOf(a);if(l<0||l%2==0!=i>0)return null;let c={from:i<0?t-1:t,to:i>0?t+1:t},h=e.doc.iterRange(t,i>0?e.doc.length:0),u=0;for(let d=0;!h.next().done&&d<=s;){let e=h.value;i<0&&(d+=e.length);let s=t+d*i;for(let t=i>0?0:e.length-1,a=i>0?e.length:-1;t!=a;t+=i){let a=o.indexOf(e[t]);if(!(a<0||n.resolveInner(s+t,1).type!=r))if(a%2==0==i>0)u++;else{if(1==u)return{start:c,end:{from:s+t,to:s+t+1},matched:a>>1==l>>1};u--}}i>0&&(d+=e.length)}return h.done?{start:c,matched:!1}:null}const noTokens=Object.create(null),typeArray=[NodeType.none],warned=[],byTag=Object.create(null),defaultTable=Object.create(null);for(let[e,r]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[e]=createTokenType(noTokens,r);function warnForPart(e,t){warned.indexOf(e)>-1||(warned.push(e),console.warn(t))}function createTokenType(e,t){let i=[];for(let a of t.split(" ")){let t=[];for(let i of a.split(".")){let n=e[i]||tags[i];n?"function"==typeof n?t.length?t=t.map(n):warnForPart(i,`Modifier ${i} used at start of tag`):t.length?warnForPart(i,`Tag ${i} used as modifier`):t=Array.isArray(n)?n:[n]:warnForPart(i,`Unknown highlighting tag ${i}`)}for(let e of t)i.push(e)}if(!i.length)return 0;let n=t.replace(/ /g,"_"),r=n+" "+i.map(e=>e.id),s=byTag[r];if(s)return s.id;let o=byTag[r]=NodeType.define({id:typeArray.length,name:n,props:[styleTags({[n]:i})]});return typeArray.push(o),o.id}Direction.RTL,Direction.LTR;const toggleComment=e=>{let{state:t}=e,i=t.doc.lineAt(t.selection.main.from),n=getConfig(e.state,i.from);return n.line?toggleLineComment(e):!!n.block&&toggleBlockCommentByLine(e)};function command(e,t){return({state:i,dispatch:n})=>{if(i.readOnly)return!1;let r=e(t,i);return!!r&&(n(i.update(r)),!0)}}const toggleLineComment=command(changeLineComment,0),toggleBlockComment=command(changeBlockComment,0),toggleBlockCommentByLine=command((e,t)=>changeBlockComment(e,t,selectedLineRanges(t)),0);function getConfig(e,t){let i=e.languageDataAt("commentTokens",t,1);return i.length?i[0]:{}}const SearchMargin=50;function findBlockComment(e,{open:t,close:i},n,r){let s,o,a=e.sliceDoc(n-SearchMargin,n),l=e.sliceDoc(r,r+SearchMargin),c=/\s*$/.exec(a)[0].length,h=/^\s*/.exec(l)[0].length,u=a.length-c;if(a.slice(u-t.length,u)==t&&l.slice(h,h+i.length)==i)return{open:{pos:n-c,margin:c&&1},close:{pos:r+h,margin:h&&1}};r-n<=2*SearchMargin?s=o=e.sliceDoc(n,r):(s=e.sliceDoc(n,n+SearchMargin),o=e.sliceDoc(r-SearchMargin,r));let d=/^\s*/.exec(s)[0].length,p=/\s*$/.exec(o)[0].length,f=o.length-p-i.length;return s.slice(d,d+t.length)==t&&o.slice(f,f+i.length)==i?{open:{pos:n+d+t.length,margin:/\s/.test(s.charAt(d+t.length))?1:0},close:{pos:r-p-i.length,margin:/\s/.test(o.charAt(f-1))?1:0}}:null}function selectedLineRanges(e){let t=[];for(let i of e.selection.ranges){let n=e.doc.lineAt(i.from),r=i.to<=n.to?n:e.doc.lineAt(i.to);r.from>n.from&&r.from==i.to&&(r=i.to==n.to+1?n:e.doc.lineAt(i.to-1));let s=t.length-1;s>=0&&t[s].to>n.from?t[s].to=r.to:t.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:r.to})}return t}function changeBlockComment(e,t,i=t.selection.ranges){let n=i.map(e=>getConfig(t,e.from).block);if(!n.every(e=>e))return null;let r=i.map((e,i)=>findBlockComment(t,n[i],e.from,e.to));if(2!=e&&!r.every(e=>e))return{changes:t.changes(i.map((e,t)=>r[t]?[]:[{from:e.from,insert:n[t].open+" "},{from:e.to,insert:" "+n[t].close}]))};if(1!=e&&r.some(e=>e)){let e=[];for(let t,i=0;i<r.length;i++)if(t=r[i]){let r=n[i],{open:s,close:o}=t;e.push({from:s.pos-r.open.length,to:s.pos+s.margin},{from:o.pos-o.margin,to:o.pos+r.close.length})}return{changes:e}}return null}function changeLineComment(e,t,i=t.selection.ranges){let n=[],r=-1;for(let{from:s,to:o}of i){let e=n.length,i=1e9,a=getConfig(t,s).line;if(a){for(let e=s;e<=o;){let l=t.doc.lineAt(e);if(l.from>r&&(s==o||o>l.from)){r=l.from;let e=/^\s*/.exec(l.text)[0].length,t=e==l.length,s=l.text.slice(e,e+a.length)==a?e:-1;e<l.text.length&&e<i&&(i=e),n.push({line:l,comment:s,token:a,indent:e,empty:t,single:!1})}e=l.to+1}if(i<1e9)for(let t=e;t<n.length;t++)n[t].indent<n[t].line.text.length&&(n[t].indent=i);n.length==e+1&&(n[e].single=!0)}}if(2!=e&&n.some(e=>e.comment<0&&(!e.empty||e.single))){let e=[];for(let{line:t,token:r,indent:s,empty:o,single:a}of n)!a&&o||e.push({from:t.from+s,insert:r+" "});let i=t.changes(e);return{changes:i,selection:t.selection.map(i,1)}}if(1!=e&&n.some(e=>e.comment>=0)){let e=[];for(let{line:t,comment:i,token:r}of n)if(i>=0){let n=t.from+i,s=n+r.length;" "==t.text[s-t.from]&&s++,e.push({from:n,to:s})}return{changes:e}}return null}const fromHistory=Annotation.define(),isolateHistory=Annotation.define(),invertedEffects=Facet.define(),historyConfig=Facet.define({combine:e=>combineConfig(e,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(i,n)=>e(i,n)||t(i,n)})}),historyField_=StateField.define({create:()=>HistoryState.empty,update(e,t){let i=t.state.facet(historyConfig),n=t.annotation(fromHistory);if(n){let r=HistEvent.fromTransaction(t,n.selection),s=n.side,o=0==s?e.undone:e.done;return o=r?updateBranch(o,o.length,i.minDepth,r):addSelection(o,t.startState.selection),new HistoryState(0==s?n.rest:o,0==s?o:n.rest)}let r=t.annotation(isolateHistory);if("full"!=r&&"before"!=r||(e=e.isolate()),!1===t.annotation(Transaction.addToHistory))return t.changes.empty?e:e.addMapping(t.changes.desc);let s=HistEvent.fromTransaction(t),o=t.annotation(Transaction.time),a=t.annotation(Transaction.userEvent);return s?e=e.addChanges(s,o,a,i,t):t.selection&&(e=e.addSelection(t.startState.selection,o,a,i.newGroupDelay)),"full"!=r&&"after"!=r||(e=e.isolate()),e},toJSON:e=>({done:e.done.map(e=>e.toJSON()),undone:e.undone.map(e=>e.toJSON())}),fromJSON:e=>new HistoryState(e.done.map(HistEvent.fromJSON),e.undone.map(HistEvent.fromJSON))});function history(e={}){return[historyField_,historyConfig.of(e),EditorView.domEventHandlers({beforeinput(e,t){let i="historyUndo"==e.inputType?undo:"historyRedo"==e.inputType?redo:null;return!!i&&(e.preventDefault(),i(t))}})]}function cmd(e,t){return function({state:i,dispatch:n}){if(!t&&i.readOnly)return!1;let r=i.field(historyField_,!1);if(!r)return!1;let s=r.pop(e,i,t);return!!s&&(n(s),!0)}}const undo=cmd(0,!1),redo=cmd(1,!1),undoSelection=cmd(0,!0),redoSelection=cmd(1,!0);class HistEvent{constructor(e,t,i,n,r){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=n,this.selectionsAfter=r}setSelAfter(e){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(e=>e.toJSON())}}static fromJSON(e){return new HistEvent(e.changes&&ChangeSet.fromJSON(e.changes),[],e.mapped&&ChangeDesc.fromJSON(e.mapped),e.startSelection&&EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(EditorSelection.fromJSON))}static fromTransaction(e,t){let i=none$1;for(let n of e.startState.facet(invertedEffects)){let t=n(e);t.length&&(i=i.concat(t))}return!i.length&&e.changes.empty?null:new HistEvent(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,none$1)}static selection(e){return new HistEvent(void 0,none$1,void 0,void 0,e)}}function updateBranch(e,t,i,n){let r=t+1>i+20?t-i-1:0,s=e.slice(r,t);return s.push(n),s}function isAdjacent(e,t){let i=[],n=!1;return e.iterChangedRanges((e,t)=>i.push(e,t)),t.iterChangedRanges((e,t,r,s)=>{for(let o=0;o<i.length;){let e=i[o++],t=i[o++];s>=e&&r<=t&&(n=!0)}}),n}function eqSelectionShape(e,t){return e.ranges.length==t.ranges.length&&0===e.ranges.filter((e,i)=>e.empty!=t.ranges[i].empty).length}function conc(e,t){return e.length?t.length?e.concat(t):e:t}const none$1=[],MaxSelectionsPerEvent=200;function addSelection(e,t){if(e.length){let i=e[e.length-1],n=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-MaxSelectionsPerEvent));return n.length&&n[n.length-1].eq(t)?e:(n.push(t),updateBranch(e,e.length-1,1e9,i.setSelAfter(n)))}return[HistEvent.selection([t])]}function popSelection(e){let t=e[e.length-1],i=e.slice();return i[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),i}function addMappingToBranch(e,t){if(!e.length)return e;let i=e.length,n=none$1;for(;i;){let r=mapEvent(e[i-1],t,n);if(r.changes&&!r.changes.empty||r.effects.length){let t=e.slice(0,i);return t[i-1]=r,t}t=r.mapped,i--,n=r.selectionsAfter}return n.length?[HistEvent.selection(n)]:none$1}function mapEvent(e,t,i){let n=conc(e.selectionsAfter.length?e.selectionsAfter.map(e=>e.map(t)):none$1,i);if(!e.changes)return HistEvent.selection(n);let r=e.changes.map(t),s=t.mapDesc(e.changes,!0),o=e.mapped?e.mapped.composeDesc(s):s;return new HistEvent(r,StateEffect.mapEffects(e.effects,t),o,e.startSelection.map(s),n)}const joinableUserEvent=/^(input\.type|delete)($|\.)/;class HistoryState{constructor(e,t,i=0,n=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=n}isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this}addChanges(e,t,i,n,r){let s=this.done,o=s[s.length-1];return s=o&&o.changes&&!o.changes.empty&&e.changes&&(!i||joinableUserEvent.test(i))&&(!o.selectionsAfter.length&&t-this.prevTime<n.newGroupDelay&&n.joinToEvent(r,isAdjacent(o.changes,e.changes))||"input.type.compose"==i)?updateBranch(s,s.length-1,n.minDepth,new HistEvent(e.changes.compose(o.changes),conc(StateEffect.mapEffects(e.effects,o.changes),o.effects),o.mapped,o.startSelection,none$1)):updateBranch(s,s.length,n.minDepth,e),new HistoryState(s,none$1,t,i)}addSelection(e,t,i,n){let r=this.done.length?this.done[this.done.length-1].selectionsAfter:none$1;return r.length>0&&t-this.prevTime<n&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&eqSelectionShape(r[r.length-1],e)?this:new HistoryState(addSelection(this.done,e),this.undone,t,i)}addMapping(e){return new HistoryState(addMappingToBranch(this.done,e),addMappingToBranch(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let n=0==e?this.done:this.undone;if(0==n.length)return null;let r=n[n.length-1],s=r.selectionsAfter[0]||t.selection;if(i&&r.selectionsAfter.length)return t.update({selection:r.selectionsAfter[r.selectionsAfter.length-1],annotations:fromHistory.of({side:e,rest:popSelection(n),selection:s}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(r.changes){let i=1==n.length?none$1:n.slice(0,n.length-1);return r.mapped&&(i=addMappingToBranch(i,r.mapped)),t.update({changes:r.changes,selection:r.startSelection,effects:r.effects,annotations:fromHistory.of({side:e,rest:i,selection:s}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}HistoryState.empty=new HistoryState(none$1,none$1);const historyKeymap=[{key:"Mod-z",run:undo,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:!0},{linux:"Ctrl-Shift-z",run:redo,preventDefault:!0},{key:"Mod-u",run:undoSelection,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:!0}];function updateSel(e,t){return EditorSelection.create(e.ranges.map(t),e.mainIndex)}function setSel(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function moveSel({state:e,dispatch:t},i){let n=updateSel(e.selection,i);return!n.eq(e.selection,!0)&&(t(setSel(e,n)),!0)}function rangeEnd(e,t){return EditorSelection.cursor(t?e.to:e.from)}function cursorByChar(e,t){return moveSel(e,i=>i.empty?e.moveByChar(i,t):rangeEnd(i,t))}function ltrAtCursor(e){return e.textDirectionAt(e.state.selection.main.head)==Direction.LTR}const cursorCharLeft=e=>cursorByChar(e,!ltrAtCursor(e)),cursorCharRight=e=>cursorByChar(e,ltrAtCursor(e));function cursorByGroup(e,t){return moveSel(e,i=>i.empty?e.moveByGroup(i,t):rangeEnd(i,t))}const cursorGroupLeft=e=>cursorByGroup(e,!ltrAtCursor(e)),cursorGroupRight=e=>cursorByGroup(e,ltrAtCursor(e));function interestingNode(e,t,i){if(t.type.prop(i))return!0;let n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function moveBySyntax(e,t,i){let n,r,s=syntaxTree(e).resolveInner(t.head),o=i?NodeProp.closedBy:NodeProp.openedBy;for(let a=t.head;;){let t=i?s.childAfter(a):s.childBefore(a);if(!t)break;interestingNode(e,t,o)?s=t:a=i?t.to:t.from}return r=s.type.prop(o)&&(n=i?matchBrackets(e,s.from,1):matchBrackets(e,s.to,-1))&&n.matched?i?n.end.to:n.end.from:i?s.to:s.from,EditorSelection.cursor(r,i?-1:1)}const cursorSyntaxLeft=e=>moveSel(e,t=>moveBySyntax(e.state,t,!ltrAtCursor(e))),cursorSyntaxRight=e=>moveSel(e,t=>moveBySyntax(e.state,t,ltrAtCursor(e)));function cursorByLine(e,t){return moveSel(e,i=>{if(!i.empty)return rangeEnd(i,t);let n=e.moveVertically(i,t);return n.head!=i.head?n:e.moveToLineBoundary(i,t)})}const cursorLineUp=e=>cursorByLine(e,!1),cursorLineDown=e=>cursorByLine(e,!0);function pageInfo(e){let t,i=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,n=0,r=0;if(i){for(let t of e.state.facet(EditorView.scrollMargins)){let i=t(e);(null==i?void 0:i.top)&&(n=Math.max(null==i?void 0:i.top,n)),(null==i?void 0:i.bottom)&&(r=Math.max(null==i?void 0:i.bottom,r))}t=e.scrollDOM.clientHeight-n-r}else t=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:n,marginBottom:r,selfScroll:i,height:Math.max(e.defaultLineHeight,t-5)}}function cursorByPage(e,t){let i,n=pageInfo(e),{state:r}=e,s=updateSel(r.selection,i=>i.empty?e.moveVertically(i,t,n.height):rangeEnd(i,t));if(s.eq(r.selection))return!1;if(n.selfScroll){let t=e.coordsAtPos(r.selection.main.head),o=e.scrollDOM.getBoundingClientRect(),a=o.top+n.marginTop,l=o.bottom-n.marginBottom;t&&t.top>a&&t.bottom<l&&(i=EditorView.scrollIntoView(s.main.head,{y:"start",yMargin:t.top-a}))}return e.dispatch(setSel(r,s),{effects:i}),!0}const cursorPageUp=e=>cursorByPage(e,!1),cursorPageDown=e=>cursorByPage(e,!0);function moveByLineBoundary(e,t,i){let n=e.lineBlockAt(t.head),r=e.moveToLineBoundary(t,i);if(r.head==t.head&&r.head!=(i?n.to:n.from)&&(r=e.moveToLineBoundary(t,i,!1)),!i&&r.head==n.from&&n.length){let i=/^\s*/.exec(e.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;i&&t.head!=n.from+i&&(r=EditorSelection.cursor(n.from+i))}return r}const cursorLineBoundaryForward=e=>moveSel(e,t=>moveByLineBoundary(e,t,!0)),cursorLineBoundaryBackward=e=>moveSel(e,t=>moveByLineBoundary(e,t,!1)),cursorLineBoundaryLeft=e=>moveSel(e,t=>moveByLineBoundary(e,t,!ltrAtCursor(e))),cursorLineBoundaryRight=e=>moveSel(e,t=>moveByLineBoundary(e,t,ltrAtCursor(e))),cursorLineStart=e=>moveSel(e,t=>EditorSelection.cursor(e.lineBlockAt(t.head).from,1)),cursorLineEnd=e=>moveSel(e,t=>EditorSelection.cursor(e.lineBlockAt(t.head).to,-1));function toMatchingBracket(e,t,i){let n=!1,r=updateSel(e.selection,t=>{let i=matchBrackets(e,t.head,-1)||matchBrackets(e,t.head,1)||t.head>0&&matchBrackets(e,t.head-1,1)||t.head<e.doc.length&&matchBrackets(e,t.head+1,-1);if(!i||!i.end)return t;n=!0;let r=i.start.from==t.head?i.end.to:i.end.from;return EditorSelection.cursor(r)});return!!n&&(t(setSel(e,r)),!0)}const cursorMatchingBracket=({state:e,dispatch:t})=>toMatchingBracket(e,t);function extendSel(e,t){let i=updateSel(e.state.selection,e=>{let i=t(e);return EditorSelection.range(e.anchor,i.head,i.goalColumn,i.bidiLevel||void 0)});return!i.eq(e.state.selection)&&(e.dispatch(setSel(e.state,i)),!0)}function selectByChar(e,t){return extendSel(e,i=>e.moveByChar(i,t))}const selectCharLeft=e=>selectByChar(e,!ltrAtCursor(e)),selectCharRight=e=>selectByChar(e,ltrAtCursor(e));function selectByGroup(e,t){return extendSel(e,i=>e.moveByGroup(i,t))}const selectGroupLeft=e=>selectByGroup(e,!ltrAtCursor(e)),selectGroupRight=e=>selectByGroup(e,ltrAtCursor(e)),selectSyntaxLeft=e=>extendSel(e,t=>moveBySyntax(e.state,t,!ltrAtCursor(e))),selectSyntaxRight=e=>extendSel(e,t=>moveBySyntax(e.state,t,ltrAtCursor(e)));function selectByLine(e,t){return extendSel(e,i=>e.moveVertically(i,t))}const selectLineUp=e=>selectByLine(e,!1),selectLineDown=e=>selectByLine(e,!0);function selectByPage(e,t){return extendSel(e,i=>e.moveVertically(i,t,pageInfo(e).height))}const selectPageUp=e=>selectByPage(e,!1),selectPageDown=e=>selectByPage(e,!0),selectLineBoundaryForward=e=>extendSel(e,t=>moveByLineBoundary(e,t,!0)),selectLineBoundaryBackward=e=>extendSel(e,t=>moveByLineBoundary(e,t,!1)),selectLineBoundaryLeft=e=>extendSel(e,t=>moveByLineBoundary(e,t,!ltrAtCursor(e))),selectLineBoundaryRight=e=>extendSel(e,t=>moveByLineBoundary(e,t,ltrAtCursor(e))),selectLineStart=e=>extendSel(e,t=>EditorSelection.cursor(e.lineBlockAt(t.head).from)),selectLineEnd=e=>extendSel(e,t=>EditorSelection.cursor(e.lineBlockAt(t.head).to)),cursorDocStart=({state:e,dispatch:t})=>(t(setSel(e,{anchor:0})),!0),cursorDocEnd=({state:e,dispatch:t})=>(t(setSel(e,{anchor:e.doc.length})),!0),selectDocStart=({state:e,dispatch:t})=>(t(setSel(e,{anchor:e.selection.main.anchor,head:0})),!0),selectDocEnd=({state:e,dispatch:t})=>(t(setSel(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0),selectAll=({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0),selectLine=({state:e,dispatch:t})=>{let i=selectedLineBlocks(e).map(({from:t,to:i})=>EditorSelection.range(t,Math.min(i+1,e.doc.length)));return t(e.update({selection:EditorSelection.create(i),userEvent:"select"})),!0},selectParentSyntax=({state:e,dispatch:t})=>{let i=updateSel(e.selection,t=>{let i=syntaxTree(e),n=i.resolveStack(t.from,1);if(t.empty){let e=i.resolveStack(t.from,-1);e.node.from>=n.node.from&&e.node.to<=n.node.to&&(n=e)}for(let e=n;e;e=e.next){let{node:i}=e;if((i.from<t.from&&i.to>=t.to||i.to>t.to&&i.from<=t.from)&&e.next)return EditorSelection.range(i.to,i.from)}return t});return!i.eq(e.selection)&&(t(setSel(e,i)),!0)};function addCursorVertically(e,t){let{state:i}=e,n=i.selection,r=i.selection.ranges.slice();for(let s of i.selection.ranges){let n=i.doc.lineAt(s.head);if(t?n.to<e.state.doc.length:n.from>0)for(let i=s;;){let s=e.moveVertically(i,t);if(s.head<n.from||s.head>n.to){r.some(e=>e.head==s.head)||r.push(s);break}if(s.head==i.head)break;i=s}}return r.length!=n.ranges.length&&(e.dispatch(setSel(i,EditorSelection.create(r,r.length-1))),!0)}const addCursorAbove=e=>addCursorVertically(e,!1),addCursorBelow=e=>addCursorVertically(e,!0),simplifySelection=({state:e,dispatch:t})=>{let i=e.selection,n=null;return i.ranges.length>1?n=EditorSelection.create([i.main]):i.main.empty||(n=EditorSelection.create([EditorSelection.cursor(i.main.head)])),!!n&&(t(setSel(e,n)),!0)};function deleteBy(e,t){if(e.state.readOnly)return!1;let i="delete.selection",{state:n}=e,r=n.changeByRange(n=>{let{from:r,to:s}=n;if(r==s){let o=t(n);o<r?(i="delete.backward",o=skipAtomic(e,o,!1)):o>r&&(i="delete.forward",o=skipAtomic(e,o,!0)),r=Math.min(r,o),s=Math.max(s,o)}else r=skipAtomic(e,r,!1),s=skipAtomic(e,s,!0);return r==s?{range:n}:{changes:{from:r,to:s},range:EditorSelection.cursor(r,r<n.head?-1:1)}});return!r.changes.empty&&(e.dispatch(n.update(r,{scrollIntoView:!0,userEvent:i,effects:"delete.selection"==i?EditorView.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function skipAtomic(e,t,i){if(e instanceof EditorView)for(let n of e.state.facet(EditorView.atomicRanges).map(t=>t(e)))n.between(t,t,(e,n)=>{e<t&&n>t&&(t=i?n:e)});return t}const deleteByChar=(e,t,i)=>deleteBy(e,n=>{let r,s,o=n.from,{state:a}=e,l=a.doc.lineAt(o);if(i&&!t&&o>l.from&&o<l.from+200&&!/[^ \t]/.test(r=l.text.slice(0,o-l.from))){if("\t"==r[r.length-1])return o-1;let e=countColumn(r,a.tabSize)%getIndentUnit(a)||getIndentUnit(a);for(let t=0;t<e&&" "==r[r.length-1-t];t++)o--;s=o}else s=findClusterBreak(l.text,o-l.from,t,t)+l.from,s==o&&l.number!=(t?a.doc.lines:1)?s+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(l.text.slice(s-l.from,o-l.from))&&(s=findClusterBreak(l.text,s-l.from,!1,!1)+l.from);return s}),deleteCharBackward=e=>deleteByChar(e,!1,!0),deleteCharForward=e=>deleteByChar(e,!0,!1),deleteByGroup=(e,t)=>deleteBy(e,i=>{let n=i.head,{state:r}=e,s=r.doc.lineAt(n),o=r.charCategorizer(n);for(let e=null;;){if(n==(t?s.to:s.from)){n==i.head&&s.number!=(t?r.doc.lines:1)&&(n+=t?1:-1);break}let a=findClusterBreak(s.text,n-s.from,t)+s.from,l=s.text.slice(Math.min(n,a)-s.from,Math.max(n,a)-s.from),c=o(l);if(null!=e&&c!=e)break;" "==l&&n==i.head||(e=c),n=a}return n}),deleteGroupBackward=e=>deleteByGroup(e,!1),deleteGroupForward=e=>deleteByGroup(e,!0),deleteToLineEnd=e=>deleteBy(e,t=>{let i=e.lineBlockAt(t.head).to;return t.head<i?i:Math.min(e.state.doc.length,t.head+1)}),deleteLineBoundaryBackward=e=>deleteBy(e,t=>{let i=e.moveToLineBoundary(t,!1).head;return t.head>i?i:Math.max(0,t.head-1)}),deleteLineBoundaryForward=e=>deleteBy(e,t=>{let i=e.moveToLineBoundary(t,!0).head;return t.head<i?i:Math.min(e.state.doc.length,t.head+1)}),splitLine=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:Text.of(["",""])},range:EditorSelection.cursor(e.from)}));return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0},transposeChars=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange(t=>{if(!t.empty||0==t.from||t.from==e.doc.length)return{range:t};let i=t.from,n=e.doc.lineAt(i),r=i==n.from?i-1:findClusterBreak(n.text,i-n.from,!1)+n.from,s=i==n.to?i+1:findClusterBreak(n.text,i-n.from,!0)+n.from;return{changes:{from:r,to:s,insert:e.doc.slice(i,s).append(e.doc.slice(r,i))},range:EditorSelection.cursor(s)}});return!i.changes.empty&&(t(e.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function selectedLineBlocks(e){let t=[],i=-1;for(let n of e.selection.ranges){let r=e.doc.lineAt(n.from),s=e.doc.lineAt(n.to);if(n.empty||n.to!=s.from||(s=e.doc.lineAt(n.to-1)),i>=r.number){let e=t[t.length-1];e.to=s.to,e.ranges.push(n)}else t.push({from:r.from,to:s.to,ranges:[n]});i=s.number+1}return t}function moveLine(e,t,i){if(e.readOnly)return!1;let n=[],r=[];for(let s of selectedLineBlocks(e)){if(i?s.to==e.doc.length:0==s.from)continue;let t=e.doc.lineAt(i?s.to+1:s.from-1),o=t.length+1;if(i){n.push({from:s.to,to:t.to},{from:s.from,insert:t.text+e.lineBreak});for(let t of s.ranges)r.push(EditorSelection.range(Math.min(e.doc.length,t.anchor+o),Math.min(e.doc.length,t.head+o)))}else{n.push({from:t.from,to:s.from},{from:s.to,insert:e.lineBreak+t.text});for(let e of s.ranges)r.push(EditorSelection.range(e.anchor-o,e.head-o))}}return!!n.length&&(t(e.update({changes:n,scrollIntoView:!0,selection:EditorSelection.create(r,e.selection.mainIndex),userEvent:"move.line"})),!0)}const moveLineUp=({state:e,dispatch:t})=>moveLine(e,t,!1),moveLineDown=({state:e,dispatch:t})=>moveLine(e,t,!0);function copyLine(e,t,i){if(e.readOnly)return!1;let n=[];for(let r of selectedLineBlocks(e))i?n.push({from:r.from,insert:e.doc.slice(r.from,r.to)+e.lineBreak}):n.push({from:r.to,insert:e.lineBreak+e.doc.slice(r.from,r.to)});return t(e.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const copyLineUp=({state:e,dispatch:t})=>copyLine(e,t,!1),copyLineDown=({state:e,dispatch:t})=>copyLine(e,t,!0),deleteLine=e=>{if(e.state.readOnly)return!1;let{state:t}=e,i=t.changes(selectedLineBlocks(t).map(({from:e,to:i})=>(e>0?e--:i<t.doc.length&&i++,{from:e,to:i}))),n=updateSel(t.selection,t=>{let i;if(e.lineWrapping){let n=e.lineBlockAt(t.head),r=e.coordsAtPos(t.head,t.assoc||1);r&&(i=n.bottom+e.documentTop-r.bottom+e.defaultLineHeight/2)}return e.moveVertically(t,!0,i)}).map(i);return e.dispatch({changes:i,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function isBetweenBrackets(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let i,n=syntaxTree(e).resolveInner(t),r=n.childBefore(t),s=n.childAfter(t);return r&&s&&r.to<=t&&s.from>=t&&(i=r.type.prop(NodeProp.closedBy))&&i.indexOf(s.name)>-1&&e.doc.lineAt(r.to).from==e.doc.lineAt(s.from).from&&!/\S/.test(e.sliceDoc(r.to,s.from))?{from:r.to,to:s.from}:null}const insertNewlineAndIndent=newlineAndIndent(!1),insertBlankLine=newlineAndIndent(!0);function newlineAndIndent(e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let n=t.changeByRange(i=>{let{from:n,to:r}=i,s=t.doc.lineAt(n),o=!e&&n==r&&isBetweenBrackets(t,n);e&&(n=r=(r<=s.to?s:t.doc.lineAt(r)).to);let a=new IndentContext(t,{simulateBreak:n,simulateDoubleBreak:!!o}),l=getIndentation(a,n);for(null==l&&(l=countColumn(/^\s*/.exec(t.doc.lineAt(n).text)[0],t.tabSize));r<s.to&&/\s/.test(s.text[r-s.from]);)r++;o?({from:n,to:r}=o):n>s.from&&n<s.from+100&&!/\S/.test(s.text.slice(0,n))&&(n=s.from);let c=["",indentString(t,l)];return o&&c.push(indentString(t,a.lineIndent(s.from,-1))),{changes:{from:n,to:r,insert:Text.of(c)},range:EditorSelection.cursor(n+1+c[1].length)}});return i(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function changeBySelectedLine(e,t){let i=-1;return e.changeByRange(n=>{let r=[];for(let o=n.from;o<=n.to;){let s=e.doc.lineAt(o);s.number>i&&(n.empty||n.to>s.from)&&(t(s,r,n),i=s.number),o=s.to+1}let s=e.changes(r);return{changes:r,range:EditorSelection.range(s.mapPos(n.anchor,1),s.mapPos(n.head,1))}})}const indentSelection=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=Object.create(null),n=new IndentContext(e,{overrideIndentation:e=>{let t=i[e];return null==t?-1:t}}),r=changeBySelectedLine(e,(t,r,s)=>{let o=getIndentation(n,t.from);if(null==o)return;/\S/.test(t.text)||(o=0);let a=/^\s*/.exec(t.text)[0],l=indentString(e,o);(a!=l||s.from<t.from+a.length)&&(i[t.from]=o,r.push({from:t.from,to:t.from+a.length,insert:l}))});return r.changes.empty||t(e.update(r,{userEvent:"indent"})),!0},indentMore=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(changeBySelectedLine(e,(t,i)=>{i.push({from:t.from,insert:e.facet(indentUnit)})}),{userEvent:"input.indent"})),!0),indentLess=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(changeBySelectedLine(e,(t,i)=>{let n=/^\s*/.exec(t.text)[0];if(!n)return;let r=countColumn(n,e.tabSize),s=0,o=indentString(e,Math.max(0,r-getIndentUnit(e)));for(;s<n.length&&s<o.length&&n.charCodeAt(s)==o.charCodeAt(s);)s++;i.push({from:t.from+s,to:t.from+n.length,insert:o.slice(s)})}),{userEvent:"delete.dedent"})),!0),toggleTabFocusMode=e=>(e.setTabFocusMode(),!0),emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}],standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:!0},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:!0},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:!0},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:!0},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:!0},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:!0},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:!0},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent,shift:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward,preventDefault:!0},{key:"Delete",run:deleteCharForward,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward,preventDefault:!0},{mac:"Mod-Backspace",run:deleteLineBoundaryBackward,preventDefault:!0},{mac:"Mod-Delete",run:deleteLineBoundaryForward,preventDefault:!0}].concat(emacsStyleKeymap.map(e=>({mac:e.key,run:e.run,shift:e.shift}))),defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Mod-Alt-ArrowUp",run:addCursorAbove},{key:"Mod-Alt-ArrowDown",run:addCursorBelow},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:!0},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment},{key:"Ctrl-m",mac:"Shift-Alt-m",run:toggleTabFocusMode}].concat(standardKeymap),basicNormalize="function"==typeof String.prototype.normalize?e=>e.normalize("NFKD"):e=>e;class SearchCursor{constructor(e,t,i=0,n=e.length,r,s){this.test=s,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,n),this.bufferStart=i,this.normalize=r?e=>r(basicNormalize(e)):basicNormalize,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return codePointAt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=fromCodePoint(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(e);let n=this.normalize(t);if(n.length)for(let r=0,s=i;;r++){let e=n.charCodeAt(r),o=this.match(e,s,this.bufferPos+this.bufferStart);if(r==n.length-1){if(o)return this.value=o,this;break}s==i&&r<t.length&&t.charCodeAt(r)==e&&s++}}}match(e,t,i){let n=null;for(let r=0;r<this.matches.length;r+=2){let t=this.matches[r],s=!1;this.query.charCodeAt(t)==e&&(t==this.query.length-1?n={from:this.matches[r+1],to:i}:(this.matches[r]++,s=!0)),s||(this.matches.splice(r,2),r-=2)}return this.query.charCodeAt(0)==e&&(1==this.query.length?n={from:t,to:i}:this.matches.push(1,t)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferStart)&&(n=null),n}}"undefined"!=typeof Symbol&&(SearchCursor.prototype[Symbol.iterator]=function(){return this});const empty={from:-1,to:-1,match:/.*/.exec("")},baseFlags="gm"+(null==/x/.unicode?"":"u");class RegExpCursor{constructor(e,t,i,n=0,r=e.length){if(this.text=e,this.to=r,this.curLine="",this.done=!1,this.value=empty,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new MultilineRegExpCursor(e,t,i,n,r);this.re=new RegExp(t,baseFlags+((null==i?void 0:i.ignoreCase)?"i":"")),this.test=null==i?void 0:i.test,this.iter=e.iter();let s=e.lineAt(n);this.curLineStart=s.from,this.matchPos=toCharEnd(e,n),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,n=i+t[0].length;if(this.matchPos=toCharEnd(this.text,n+(i==n?1:0)),i==this.curLineStart+this.curLine.length&&this.nextLine(),(i<n||i>this.value.to)&&(!this.test||this.test(i,n,t)))return this.value={from:i,to:n,match:t},this;e=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),e=0}}}}const flattened=new WeakMap;class FlattenedDoc{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let n=flattened.get(e);if(!n||n.from>=i||n.to<=t){let n=new FlattenedDoc(t,e.sliceString(t,i));return flattened.set(e,n),n}if(n.from==t&&n.to==i)return n;let{text:r,from:s}=n;return s>t&&(r=e.sliceString(t,s)+r,s=t),n.to<i&&(r+=e.sliceString(n.to,i)),flattened.set(e,new FlattenedDoc(s,r)),new FlattenedDoc(t,r.slice(t-s,i-s))}}class MultilineRegExpCursor{constructor(e,t,i,n,r){this.text=e,this.to=r,this.done=!1,this.value=empty,this.matchPos=toCharEnd(e,n),this.re=new RegExp(t,baseFlags+((null==i?void 0:i.ignoreCase)?"i":"")),this.test=null==i?void 0:i.test,this.flat=FlattenedDoc.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let e=this.flat.from+t.index,i=e+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(e,i,t)))return this.value={from:e,to:i,match:t},this.matchPos=toCharEnd(this.text,i+(e==i?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function validRegExp(e){try{return new RegExp(e,baseFlags),!0}catch(t){return!1}}function toCharEnd(e,t){if(t>=e.length)return t;let i,n=e.lineAt(t);for(;t<n.to&&(i=n.text.charCodeAt(t-n.from))>=56320&&i<57344;)t++;return t}function createLineDialog(e){let t=crelt("input",{class:"cm-textfield",name:"line",value:String(e.state.doc.lineAt(e.state.selection.main.head).number)});function i(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!i)return;let{state:n}=e,r=n.doc.lineAt(n.selection.main.head),[,s,o,a,l]=i,c=a?+a.slice(1):0,h=o?+o:r.number;if(o&&l){let e=h/100;s&&(e=e*("-"==s?-1:1)+r.number/n.doc.lines),h=Math.round(n.doc.lines*e)}else o&&s&&(h=h*("-"==s?-1:1)+r.number);let u=n.doc.line(Math.max(1,Math.min(n.doc.lines,h))),d=EditorSelection.cursor(u.from+Math.max(0,Math.min(c,u.length)));e.dispatch({effects:[dialogEffect.of(!1),EditorView.scrollIntoView(d.from,{y:"center"})],selection:d}),e.focus()}return{dom:crelt("form",{class:"cm-gotoLine",onkeydown:t=>{27==t.keyCode?(t.preventDefault(),e.dispatch({effects:dialogEffect.of(!1)}),e.focus()):13==t.keyCode&&(t.preventDefault(),i())},onsubmit:e=>{e.preventDefault(),i()}},crelt("label",e.state.phrase("Go to line"),": ",t)," ",crelt("button",{class:"cm-button",type:"submit"},e.state.phrase("go")),crelt("button",{name:"close",onclick:()=>{e.dispatch({effects:dialogEffect.of(!1)}),e.focus()},"aria-label":e.state.phrase("close"),type:"button"},["√ó"]))}}"undefined"!=typeof Symbol&&(RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this});const dialogEffect=StateEffect.define(),dialogField=StateField.define({create:()=>!0,update(e,t){for(let i of t.effects)i.is(dialogEffect)&&(e=i.value);return e},provide:e=>showPanel.from(e,e=>e?createLineDialog:null)}),gotoLine=e=>{let t=getPanel(e,createLineDialog);if(!t){let i=[dialogEffect.of(!0)];null==e.state.field(dialogField,!1)&&i.push(StateEffect.appendConfig.of([dialogField,baseTheme$1$1])),e.dispatch({effects:i}),t=getPanel(e,createLineDialog)}return t&&t.dom.querySelector("input").select(),!0},baseTheme$1$1=EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),defaultHighlightOptions={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},highlightConfig=Facet.define({combine:e=>combineConfig(e,defaultHighlightOptions,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})});function highlightSelectionMatches(e){return[defaultTheme,matchHighlighter]}const matchDeco=Decoration.mark({class:"cm-selectionMatch"}),mainMatchDeco=Decoration.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function insideWordBoundaries(e,t,i,n){return!(0!=i&&e(t.sliceDoc(i-1,i))==CharCategory.Word||n!=t.doc.length&&e(t.sliceDoc(n,n+1))==CharCategory.Word)}function insideWord(e,t,i,n){return e(t.sliceDoc(i,i+1))==CharCategory.Word&&e(t.sliceDoc(n-1,n))==CharCategory.Word}const matchHighlighter=ViewPlugin.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.selectionSet||e.docChanged||e.viewportChanged)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=e.state.facet(highlightConfig),{state:i}=e,n=i.selection;if(n.ranges.length>1)return Decoration.none;let r,s=n.main,o=null;if(s.empty){if(!t.highlightWordAroundCursor)return Decoration.none;let e=i.wordAt(s.head);if(!e)return Decoration.none;o=i.charCategorizer(s.head),r=i.sliceDoc(e.from,e.to)}else{let e=s.to-s.from;if(e<t.minSelectionLength||e>200)return Decoration.none;if(t.wholeWords){if(r=i.sliceDoc(s.from,s.to),o=i.charCategorizer(s.head),!insideWordBoundaries(o,i,s.from,s.to)||!insideWord(o,i,s.from,s.to))return Decoration.none}else if(r=i.sliceDoc(s.from,s.to),!r)return Decoration.none}let a=[];for(let l of e.visibleRanges){let e=new SearchCursor(i.doc,r,l.from,l.to);for(;!e.next().done;){let{from:n,to:r}=e.value;if((!o||insideWordBoundaries(o,i,n,r))&&(s.empty&&n<=s.from&&r>=s.to?a.push(mainMatchDeco.range(n,r)):(n>=s.to||r<=s.from)&&a.push(matchDeco.range(n,r)),a.length>t.maxMatches))return Decoration.none}}return Decoration.set(a)}},{decorations:e=>e.decorations}),defaultTheme=EditorView.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),selectWord=({state:e,dispatch:t})=>{let{selection:i}=e,n=EditorSelection.create(i.ranges.map(t=>e.wordAt(t.head)||EditorSelection.cursor(t.head)),i.mainIndex);return!n.eq(i)&&(t(e.update({selection:n})),!0)};function findNextOccurrence(e,t){let{main:i,ranges:n}=e.selection,r=e.wordAt(i.head),s=r&&r.from==i.from&&r.to==i.to;for(let o=!1,a=new SearchCursor(e.doc,t,n[n.length-1].to);;){if(a.next(),!a.done){if(o&&n.some(e=>e.from==a.value.from))continue;if(s){let t=e.wordAt(a.value.from);if(!t||t.from!=a.value.from||t.to!=a.value.to)continue}return a.value}if(o)return null;a=new SearchCursor(e.doc,t,0,Math.max(0,n[n.length-1].from-1)),o=!0}}const selectNextOccurrence=({state:e,dispatch:t})=>{let{ranges:i}=e.selection;if(i.some(e=>e.from===e.to))return selectWord({state:e,dispatch:t});let n=e.sliceDoc(i[0].from,i[0].to);if(e.selection.ranges.some(t=>e.sliceDoc(t.from,t.to)!=n))return!1;let r=findNextOccurrence(e,n);return!!r&&(t(e.update({selection:e.selection.addRange(EditorSelection.range(r.from,r.to),!1),effects:EditorView.scrollIntoView(r.to)})),!0)},searchConfigFacet=Facet.define({combine:e=>combineConfig(e,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new SearchPanel(e),scrollToMatch:e=>EditorView.scrollIntoView(e)})});class SearchQuery{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||validRegExp(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(e,t)=>"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new RegExpQuery(this):new StringQuery(this)}getCursor(e,t=0,i){let n=e.doc?e:EditorState.create({doc:e});return null==i&&(i=n.doc.length),this.regexp?regexpCursor(this,n,t,i):stringCursor(this,n,t,i)}}class QueryType{constructor(e){this.spec=e}}function stringCursor(e,t,i,n){return new SearchCursor(t.doc,e.unquoted,i,n,e.caseSensitive?void 0:e=>e.toLowerCase(),e.wholeWord?stringWordTest(t.doc,t.charCategorizer(t.selection.main.head)):void 0)}function stringWordTest(e,t){return(i,n,r,s)=>((s>i||s+r.length<n)&&(s=Math.max(0,i-2),r=e.sliceString(s,Math.min(e.length,n+2))),!(t(charBefore(r,i-s))==CharCategory.Word&&t(charAfter(r,i-s))==CharCategory.Word||t(charAfter(r,n-s))==CharCategory.Word&&t(charBefore(r,n-s))==CharCategory.Word))}class StringQuery extends QueryType{constructor(e){super(e)}nextMatch(e,t,i){let n=stringCursor(this.spec,e,i,e.doc.length).nextOverlapping();if(n.done){let i=Math.min(e.doc.length,t+this.spec.unquoted.length);n=stringCursor(this.spec,e,0,i).nextOverlapping()}return n.done||n.value.from==t&&n.value.to==i?null:n.value}prevMatchInRange(e,t,i){for(let n=i;;){let i=Math.max(t,n-1e4-this.spec.unquoted.length),r=stringCursor(this.spec,e,i,n),s=null;for(;!r.nextOverlapping().done;)s=r.value;if(s)return s;if(i==t)return null;n-=1e4}}prevMatch(e,t,i){let n=this.prevMatchInRange(e,0,t);return n||(n=this.prevMatchInRange(e,Math.max(0,i-this.spec.unquoted.length),e.doc.length)),!n||n.from==t&&n.to==i?null:n}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let i=stringCursor(this.spec,e,0,e.doc.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let r=stringCursor(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.doc.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}function regexpCursor(e,t,i,n){return new RegExpCursor(t.doc,e.search,{ignoreCase:!e.caseSensitive,test:e.wholeWord?regexpWordTest(t.charCategorizer(t.selection.main.head)):void 0},i,n)}function charBefore(e,t){return e.slice(findClusterBreak(e,t,!1),t)}function charAfter(e,t){return e.slice(t,findClusterBreak(e,t))}function regexpWordTest(e){return(t,i,n)=>!n[0].length||(e(charBefore(n.input,n.index))!=CharCategory.Word||e(charAfter(n.input,n.index))!=CharCategory.Word)&&(e(charAfter(n.input,n.index+n[0].length))!=CharCategory.Word||e(charBefore(n.input,n.index+n[0].length))!=CharCategory.Word)}class RegExpQuery extends QueryType{nextMatch(e,t,i){let n=regexpCursor(this.spec,e,i,e.doc.length).next();return n.done&&(n=regexpCursor(this.spec,e,0,t).next()),n.done?null:n.value}prevMatchInRange(e,t,i){for(let n=1;;n++){let r=Math.max(t,i-1e4*n),s=regexpCursor(this.spec,e,r,i),o=null;for(;!s.next().done;)o=s.value;if(o&&(r==t||o.from>r+10))return o;if(r==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(t,i)=>{if("&"==i)return e.match[0];if("$"==i)return"$";for(let n=i.length;n>0;n--){let t=+i.slice(0,n);if(t>0&&t<e.match.length)return e.match[t]+i.slice(n)}return t})}matchAll(e,t){let i=regexpCursor(this.spec,e,0,e.doc.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let r=regexpCursor(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.doc.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}const setSearchQuery=StateEffect.define(),togglePanel$1=StateEffect.define(),searchState=StateField.define({create:e=>new SearchState(defaultQuery(e).create(),null),update(e,t){for(let i of t.effects)i.is(setSearchQuery)?e=new SearchState(i.value.create(),e.panel):i.is(togglePanel$1)&&(e=new SearchState(e.query,i.value?createSearchPanel:null));return e},provide:e=>showPanel.from(e,e=>e.panel)});class SearchState{constructor(e,t){this.query=e,this.panel=t}}const matchMark=Decoration.mark({class:"cm-searchMatch"}),selectedMatchMark=Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"}),searchHighlighter=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(searchState))}update(e){let t=e.state.field(searchState);(t!=e.startState.field(searchState)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return Decoration.none;let{view:i}=this,n=new RangeSetBuilder;for(let r=0,s=i.visibleRanges,o=s.length;r<o;r++){let{from:t,to:a}=s[r];for(;r<o-1&&a>s[r+1].from-500;)a=s[++r].to;e.highlight(i.state,t,a,(e,t)=>{let r=i.state.selection.ranges.some(i=>i.from==e&&i.to==t);n.add(e,t,r?selectedMatchMark:matchMark)})}return n.finish()}},{decorations:e=>e.decorations});function searchCommand(e){return t=>{let i=t.state.field(searchState,!1);return i&&i.query.spec.valid?e(t,i):openSearchPanel(t)}}const findNext=searchCommand((e,{query:t})=>{let{to:i}=e.state.selection.main,n=t.nextMatch(e.state,i,i);if(!n)return!1;let r=EditorSelection.single(n.from,n.to),s=e.state.facet(searchConfigFacet);return e.dispatch({selection:r,effects:[announceMatch(e,n),s.scrollToMatch(r.main,e)],userEvent:"select.search"}),selectSearchInput(e),!0}),findPrevious=searchCommand((e,{query:t})=>{let{state:i}=e,{from:n}=i.selection.main,r=t.prevMatch(i,n,n);if(!r)return!1;let s=EditorSelection.single(r.from,r.to),o=e.state.facet(searchConfigFacet);return e.dispatch({selection:s,effects:[announceMatch(e,r),o.scrollToMatch(s.main,e)],userEvent:"select.search"}),selectSearchInput(e),!0}),selectMatches=searchCommand((e,{query:t})=>{let i=t.matchAll(e.state,1e3);return!(!i||!i.length)&&(e.dispatch({selection:EditorSelection.create(i.map(e=>EditorSelection.range(e.from,e.to))),userEvent:"select.search.matches"}),!0)}),selectSelectionMatches=({state:e,dispatch:t})=>{let i=e.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:n,to:r}=i.main,s=[],o=0;for(let a=new SearchCursor(e.doc,e.sliceDoc(n,r));!a.next().done;){if(s.length>1e3)return!1;a.value.from==n&&(o=s.length),s.push(EditorSelection.range(a.value.from,a.value.to))}return t(e.update({selection:EditorSelection.create(s,o),userEvent:"select.search.matches"})),!0},replaceNext=searchCommand((e,{query:t})=>{let{state:i}=e,{from:n,to:r}=i.selection.main;if(i.readOnly)return!1;let s=t.nextMatch(i,n,n);if(!s)return!1;let o,a,l=s,c=[],h=[];l.from==n&&l.to==r&&(a=i.toText(t.getReplacement(l)),c.push({from:l.from,to:l.to,insert:a}),l=t.nextMatch(i,l.from,l.to),h.push(EditorView.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(n).number)+".")));let u=e.state.changes(c);return l&&(o=EditorSelection.single(l.from,l.to).map(u),h.push(announceMatch(e,l)),h.push(i.facet(searchConfigFacet).scrollToMatch(o.main,e))),e.dispatch({changes:u,selection:o,effects:h,userEvent:"input.replace"}),!0}),replaceAll=searchCommand((e,{query:t})=>{if(e.state.readOnly)return!1;let i=t.matchAll(e.state,1e9).map(e=>{let{from:i,to:n}=e;return{from:i,to:n,insert:t.getReplacement(e)}});if(!i.length)return!1;let n=e.state.phrase("replaced $ matches",i.length)+".";return e.dispatch({changes:i,effects:EditorView.announce.of(n),userEvent:"input.replace.all"}),!0});function createSearchPanel(e){return e.state.facet(searchConfigFacet).createPanel(e)}function defaultQuery(e,t){var i,n,r,s,o;let a=e.selection.main,l=a.empty||a.to>a.from+100?"":e.sliceDoc(a.from,a.to);if(t&&!l)return t;let c=e.facet(searchConfigFacet);return new SearchQuery({search:(null!==(i=null==t?void 0:t.literal)&&void 0!==i?i:c.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:null!==(n=null==t?void 0:t.caseSensitive)&&void 0!==n?n:c.caseSensitive,literal:null!==(r=null==t?void 0:t.literal)&&void 0!==r?r:c.literal,regexp:null!==(s=null==t?void 0:t.regexp)&&void 0!==s?s:c.regexp,wholeWord:null!==(o=null==t?void 0:t.wholeWord)&&void 0!==o?o:c.wholeWord})}function getSearchInput(e){let t=getPanel(e,createSearchPanel);return t&&t.dom.querySelector("[main-field]")}function selectSearchInput(e){let t=getSearchInput(e);t&&t==e.root.activeElement&&t.select()}const openSearchPanel=e=>{let t=e.state.field(searchState,!1);if(t&&t.panel){let i=getSearchInput(e);if(i&&i!=e.root.activeElement){let n=defaultQuery(e.state,t.query.spec);n.valid&&e.dispatch({effects:setSearchQuery.of(n)}),i.focus(),i.select()}}else e.dispatch({effects:[togglePanel$1.of(!0),t?setSearchQuery.of(defaultQuery(e.state,t.query.spec)):StateEffect.appendConfig.of(searchExtensions)]});return!0},closeSearchPanel=e=>{let t=e.state.field(searchState,!1);if(!t||!t.panel)return!1;let i=getPanel(e,createSearchPanel);return i&&i.dom.contains(e.root.activeElement)&&e.focus(),e.dispatch({effects:togglePanel$1.of(!1)}),!0},searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Mod-Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence,preventDefault:!0}];class SearchPanel{constructor(e){this.view=e;let t=this.query=e.state.field(searchState).query.spec;function i(e,t,i){return crelt("button",{class:"cm-button",name:e,onclick:t,type:"button"},i)}this.commit=this.commit.bind(this),this.searchField=crelt("input",{value:t.search,placeholder:phrase(e,"Find"),"aria-label":phrase(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=crelt("input",{value:t.replace,placeholder:phrase(e,"Replace"),"aria-label":phrase(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=crelt("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=crelt("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=crelt("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit}),this.dom=crelt("div",{onkeydown:e=>this.keydown(e),class:"cm-search"},[this.searchField,i("next",()=>findNext(e),[phrase(e,"next")]),i("prev",()=>findPrevious(e),[phrase(e,"previous")]),i("select",()=>selectMatches(e),[phrase(e,"all")]),crelt("label",null,[this.caseField,phrase(e,"match case")]),crelt("label",null,[this.reField,phrase(e,"regexp")]),crelt("label",null,[this.wordField,phrase(e,"by word")]),...e.state.readOnly?[]:[crelt("br"),this.replaceField,i("replace",()=>replaceNext(e),[phrase(e,"replace")]),i("replaceAll",()=>replaceAll(e),[phrase(e,"replace all")])],crelt("button",{name:"close",onclick:()=>closeSearchPanel(e),"aria-label":phrase(e,"close"),type:"button"},["√ó"])])}commit(){let e=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:setSearchQuery.of(e)}))}keydown(e){runScopeHandlers(this.view,e,"search-panel")?e.preventDefault():13==e.keyCode&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?findPrevious:findNext)(this.view)):13==e.keyCode&&e.target==this.replaceField&&(e.preventDefault(),replaceNext(this.view))}update(e){for(let t of e.transactions)for(let e of t.effects)e.is(setSearchQuery)&&!e.value.eq(this.query)&&this.setQuery(e.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(searchConfigFacet).top}}function phrase(e,t){return e.state.phrase(t)}const AnnounceMargin=30,Break=/[\s\.,:;?!]/;function announceMatch(e,{from:t,to:i}){let n=e.state.doc.lineAt(t),r=e.state.doc.lineAt(i).to,s=Math.max(n.from,t-AnnounceMargin),o=Math.min(r,i+AnnounceMargin),a=e.state.sliceDoc(s,o);if(s!=n.from)for(let l=0;l<AnnounceMargin;l++)if(!Break.test(a[l+1])&&Break.test(a[l])){a=a.slice(l);break}if(o!=r)for(let l=a.length-1;l>a.length-AnnounceMargin;l--)if(!Break.test(a[l-1])&&Break.test(a[l])){a=a.slice(0,l);break}return EditorView.announce.of(`${e.state.phrase("current match")}. ${a} ${e.state.phrase("on line")} ${n.number}.`)}const baseTheme$2=EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),searchExtensions=[searchState,Prec.low(searchHighlighter),baseTheme$2];class CompletionContext{constructor(e,t,i,n){this.state=e,this.pos=t,this.explicit=i,this.view=n,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=syntaxTree(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),n=t.text.slice(i-t.from,this.pos-t.from),r=n.search(ensureAnchor(e,!1));return r<0?null:{from:i+r,to:this.pos,text:n.slice(r)}}get aborted(){return null==this.abortListeners}addEventListener(e,t,i){"abort"==e&&this.abortListeners&&(this.abortListeners.push(t),i&&i.onDocChange&&(this.abortOnDocChange=!0))}}function toSet(e){let t=Object.keys(e).join(""),i=/\w/.test(t);return i&&(t=t.replace(/\w/g,"")),`[${i?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function prefixMatch(e){let t=Object.create(null),i=Object.create(null);for(let{label:r}of e){t[r[0]]=!0;for(let e=1;e<r.length;e++)i[r[e]]=!0}let n=toSet(t)+toSet(i)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function completeFromList(e){let t=e.map(e=>"string"==typeof e?{label:e}:e),[i,n]=t.every(e=>/^\w+$/.test(e.label))?[/\w*$/,/\w+$/]:prefixMatch(t);return e=>{let r=e.matchBefore(n);return r||e.explicit?{from:r?r.from:e.pos,options:t,validFor:i}:null}}class Option{constructor(e,t,i,n){this.completion=e,this.source=t,this.match=i,this.score=n}}function cur(e){return e.selection.main.from}function ensureAnchor(e,t){var i;let{source:n}=e,r=t&&"^"!=n[0],s="$"!=n[n.length-1];return r||s?new RegExp(`${r?"^":""}(?:${n})${s?"$":""}`,null!==(i=e.flags)&&void 0!==i?i:e.ignoreCase?"i":""):e}const pickedCompletion=Annotation.define();function insertCompletionText(e,t,i,n){let{main:r}=e.selection,s=i-r.from,o=n-r.from;return{...e.changeByRange(a=>{if(a!=r&&i!=n&&e.sliceDoc(a.from+s,a.from+o)!=e.sliceDoc(i,n))return{range:a};let l=e.toText(t);return{changes:{from:a.from+s,to:n==r.from?a.to:a.from+o,insert:l},range:EditorSelection.cursor(a.from+s+l.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const SourceCache=new WeakMap;function asSource(e){if(!Array.isArray(e))return e;let t=SourceCache.get(e);return t||SourceCache.set(e,t=completeFromList(e)),t}const startCompletionEffect=StateEffect.define(),closeCompletionEffect=StateEffect.define();class FuzzyMatcher{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let i=codePointAt(e,t),n=codePointSize(i);this.chars.push(i);let r=e.slice(t,t+n),s=r.toUpperCase();this.folded.push(codePointAt(s==r?r.toLowerCase():s,0)),t+=n}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(e){if(0==this.pattern.length)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:n,precise:r,byWord:s}=this;if(1==t.length){let n=codePointAt(e,0),r=codePointSize(n),s=r==e.length?0:-100;if(n==t[0]);else{if(n!=i[0])return null;s+=-200}return this.ret(s,[0,r])}let o=e.indexOf(this.pattern);if(0==o)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=t.length,l=0;if(o<0){for(let r=0,s=Math.min(e.length,200);r<s&&l<a;){let s=codePointAt(e,r);s!=t[l]&&s!=i[l]||(n[l++]=r),r+=codePointSize(s)}if(l<a)return null}let c=0,h=0,u=!1,d=0,p=-1,f=-1,m=/[a-z]/.test(e),g=!0;for(let y=0,_=Math.min(e.length,200),b=0;y<_&&h<a;){let n=codePointAt(e,y);o<0&&(c<a&&n==t[c]&&(r[c++]=y),d<a&&(n==t[d]||n==i[d]?(0==d&&(p=y),f=y+1,d++):d=0));let l,_=n<255?n>=48&&n<=57||n>=97&&n<=122?2:n>=65&&n<=90?1:0:(l=fromCodePoint(n))!=l.toLowerCase()?1:l!=l.toUpperCase()?2:0;(!y||1==_&&m||0==b&&0!=_)&&(t[h]==n||i[h]==n&&(u=!0)?s[h++]=y:s.length&&(g=!1)),b=_,y+=codePointSize(n)}return h==a&&0==s[0]&&g?this.result((u?-200:0)-100,s,e):d==a&&0==p?this.ret(-200-e.length+(f==e.length?0:-100),[0,f]):o>-1?this.ret(-700-e.length,[o,o+this.pattern.length]):d==a?this.ret(-900-e.length,[p,f]):h==a?this.result((u?-200:0)-100-700+(g?0:-1100),s,e):2==t.length?null:this.result((n[0]?-700:0)-200-1100,n,e)}result(e,t,i){let n=[],r=0;for(let s of t){let e=s+(this.astral?codePointSize(codePointAt(i,s)):1);r&&n[r-1]==s?n[r-1]=e:(n[r++]=s,n[r++]=e)}return this.ret(e-i.length,n)}}class StrictMatcher{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),i=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return null==i?null:(this.matched=[0,t.length],this.score=i+(e.length==this.pattern.length?0:-100),this)}}const completionConfig=Facet.define({combine:e=>combineConfig(e,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:defaultPositionInfo,filterStrict:!1,compareCompletions:(e,t)=>(e.sortText||e.label).localeCompare(t.sortText||t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>i=>joinClass(e(i),t(i)),optionClass:(e,t)=>i=>joinClass(e(i),t(i)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})});function joinClass(e,t){return e?t?e+" "+t:e:t}function defaultPositionInfo(e,t,i,n,r,s){let o,a,l=e.textDirection==Direction.RTL,c=l,h=!1,u="top",d=t.left-r.left,p=r.right-t.right,f=n.right-n.left,m=n.bottom-n.top;if(c&&d<Math.min(f,p)?c=!1:!c&&p<Math.min(f,d)&&(c=!0),f<=(c?d:p))o=Math.max(r.top,Math.min(i.top,r.bottom-m))-t.top,a=Math.min(400,c?d:p);else{h=!0,a=Math.min(400,(l?t.right:r.right-t.left)-30);let e=r.bottom-t.bottom;e>=m||e>t.top?o=i.bottom-t.top:(u="bottom",o=t.bottom-i.top)}return{style:`${u}: ${o/((t.bottom-t.top)/s.offsetHeight)}px; max-width: ${a/((t.right-t.left)/s.offsetWidth)}px`,class:"cm-completionInfo-"+(h?l?"left-narrow":"right-narrow":c?"left":"right")}}function optionContent(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(e){let t=document.createElement("div");return t.classList.add("cm-completionIcon"),e.type&&t.classList.add(...e.type.split(/\s+/g).map(e=>"cm-completionIcon-"+e)),t.setAttribute("aria-hidden","true"),t},position:20}),t.push({render(e,t,i,n){let r=document.createElement("span");r.className="cm-completionLabel";let s=e.displayLabel||e.label,o=0;for(let a=0;a<n.length;){let e=n[a++],t=n[a++];e>o&&r.appendChild(document.createTextNode(s.slice(o,e)));let i=r.appendChild(document.createElement("span"));i.appendChild(document.createTextNode(s.slice(e,t))),i.className="cm-completionMatchedText",o=t}return o<s.length&&r.appendChild(document.createTextNode(s.slice(o))),r},position:50},{render(e){if(!e.detail)return null;let t=document.createElement("span");return t.className="cm-completionDetail",t.textContent=e.detail,t},position:80}),t.sort((e,t)=>e.position-t.position).map(e=>e.render)}function rangeAroundSelected(e,t,i){if(e<=i)return{from:0,to:e};if(t<0&&(t=0),t<=e>>1){let e=Math.floor(t/i);return{from:e*i,to:(e+1)*i}}let n=Math.floor((e-t)/i);return{from:e-(n+1)*i,to:e-n*i}}class CompletionTooltip{constructor(e,t,i){this.view=e,this.stateField=t,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:e=>this.placeInfo(e),key:this},this.space=null,this.currentClass="";let n=e.state.field(t),{options:r,selected:s}=n.open,o=e.state.facet(completionConfig);this.optionContent=optionContent(o),this.optionClass=o.optionClass,this.tooltipClass=o.tooltipClass,this.range=rangeAroundSelected(r.length,s,o.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",i=>{let{options:n}=e.state.field(t).open;for(let t,r=i.target;r&&r!=this.dom;r=r.parentNode)if("LI"==r.nodeName&&(t=/-(\d+)$/.exec(r.id))&&+t[1]<n.length)return this.applyCompletion(e,n[+t[1]]),void i.preventDefault()}),this.dom.addEventListener("focusout",t=>{let i=e.state.field(this.stateField,!1);i&&i.tooltip&&e.state.facet(completionConfig).closeOnBlur&&t.relatedTarget!=e.contentDOM&&e.dispatch({effects:closeCompletionEffect.of(null)})}),this.showOptions(r,n.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let i=e.state.field(this.stateField),n=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),i!=n){let{options:r,selected:s,disabled:o}=i.open;n.open&&n.open.options==r||(this.range=rangeAroundSelected(r.length,s,e.state.facet(completionConfig).maxRenderedOptions),this.showOptions(r,i.id)),this.updateSel(),o!=(null===(t=n.open)||void 0===t?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!o)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let e of this.currentClass.split(" "))e&&this.dom.classList.remove(e);for(let e of t.split(" "))e&&this.dom.classList.add(e);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;(t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=rangeAroundSelected(t.options.length,t.selected,this.view.state.facet(completionConfig).maxRenderedOptions),this.showOptions(t.options,e.id));let i=this.updateSelectedOption(t.selected);if(i){this.destroyInfo();let{completion:n}=t.options[t.selected],{info:r}=n;if(!r)return;let s="string"==typeof r?document.createTextNode(r):r(n);if(!s)return;"then"in s?s.then(t=>{t&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(t,n)}).catch(e=>logException(this.view.state,e,"completion info")):(this.addInfoPane(s,n),i.setAttribute("aria-describedby",this.info.id))}}addInfoPane(e,t){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",i.id="cm-completionInfo-"+Math.floor(65535*Math.random()).toString(16),null!=e.nodeType)i.appendChild(e),this.infoDestroy=null;else{let{dom:t,destroy:n}=e;i.appendChild(t),this.infoDestroy=n||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,n=this.range.from;i;i=i.nextSibling,n++)"LI"==i.nodeName&&i.id?n==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&(i.removeAttribute("aria-selected"),i.removeAttribute("aria-describedby")):n--;return t&&scrollIntoView(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),n=e.getBoundingClientRect(),r=this.space;if(!r){let e=this.dom.ownerDocument.documentElement;r={left:0,top:0,right:e.clientWidth,bottom:e.clientHeight}}return n.top>Math.min(r.bottom,t.bottom)-10||n.bottom<Math.max(r.top,t.top)+10?null:this.view.state.facet(completionConfig).positionInfo(this.view,t,n,i,r,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,i){const n=document.createElement("ul");n.id=t,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions")),n.addEventListener("mousedown",e=>{e.target==n&&e.preventDefault()});let r=null;for(let s=i.from;s<i.to;s++){let{completion:o,match:a}=e[s],{section:l}=o;if(l){let e="string"==typeof l?l:l.name;if(e!=r&&(s>i.from||0==i.from))if(r=e,"string"!=typeof l&&l.header)n.appendChild(l.header(l));else{n.appendChild(document.createElement("completion-section")).textContent=e}}const c=n.appendChild(document.createElement("li"));c.id=t+"-"+s,c.setAttribute("role","option");let h=this.optionClass(o);h&&(c.className=h);for(let e of this.optionContent){let t=e(o,this.view.state,this.view,a);t&&c.appendChild(t)}}return i.from&&n.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function completionTooltip(e,t){return i=>new CompletionTooltip(i,e,t)}function scrollIntoView(e,t){let i=e.getBoundingClientRect(),n=t.getBoundingClientRect(),r=i.height/e.offsetHeight;n.top<i.top?e.scrollTop-=(i.top-n.top)/r:n.bottom>i.bottom&&(e.scrollTop+=(n.bottom-i.bottom)/r)}function score(e){return 100*(e.boost||0)+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}function sortOptions(e,t){let i=[],n=null,r=null,s=e=>{i.push(e);let{section:t}=e.completion;if(t){n||(n=[]);let e="string"==typeof t?t:t.name;n.some(t=>t.name==e)||n.push("string"==typeof t?{name:e}:t)}},o=t.facet(completionConfig);for(let h of e)if(h.hasResult()){let e=h.result.getMatch;if(!1===h.result.filter)for(let t of h.result.options)s(new Option(t,h.source,e?e(t):[],1e9-i.length));else{let i,n=t.sliceDoc(h.from,h.to),a=o.filterStrict?new StrictMatcher(n):new FuzzyMatcher(n);for(let t of h.result.options)if(i=a.match(t.label)){let n=t.displayLabel?e?e(t,i.matched):[]:i.matched,o=i.score+(t.boost||0);if(s(new Option(t,h.source,n,o)),"object"==typeof t.section&&"dynamic"===t.section.rank){let{name:e}=t.section;r||(r=Object.create(null)),r[e]=Math.max(o,r[e]||-1e9)}}}}if(n){let e=Object.create(null),t=0,s=(e,t)=>("dynamic"===e.rank&&"dynamic"===t.rank?r[t.name]-r[e.name]:0)||("number"==typeof e.rank?e.rank:1e9)-("number"==typeof t.rank?t.rank:1e9)||(e.name<t.name?-1:1);for(let i of n.sort(s))t-=1e5,e[i.name]=t;for(let n of i){let{section:t}=n.completion;t&&(n.score+=e["string"==typeof t?t:t.name])}}let a=[],l=null,c=o.compareCompletions;for(let h of i.sort((e,t)=>t.score-e.score||c(e.completion,t.completion))){let e=h.completion;!l||l.label!=e.label||l.detail!=e.detail||null!=l.type&&null!=e.type&&l.type!=e.type||l.apply!=e.apply||l.boost!=e.boost?a.push(h):score(h.completion)>score(l)&&(a[a.length-1]=h),l=h.completion}return a}class CompletionDialog{constructor(e,t,i,n,r,s){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=n,this.selected=r,this.disabled=s}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new CompletionDialog(this.options,makeAttrs(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,i,n,r,s){if(n&&!s&&e.some(e=>e.isPending))return n.setDisabled();let o=sortOptions(e,t);if(!o.length)return n&&e.some(e=>e.isPending)?n.setDisabled():null;let a=t.facet(completionConfig).selectOnOpen?0:-1;if(n&&n.selected!=a&&-1!=n.selected){let e=n.options[n.selected].completion;for(let t=0;t<o.length;t++)if(o[t].completion==e){a=t;break}}return new CompletionDialog(o,makeAttrs(i,a),{pos:e.reduce((e,t)=>t.hasResult()?Math.min(e,t.from):e,1e8),create:createTooltip,above:r.aboveCursor},n?n.timestamp:Date.now(),a,!1)}map(e){return new CompletionDialog(this.options,this.attrs,{...this.tooltip,pos:e.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new CompletionDialog(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class CompletionState{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new CompletionState(none,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(e){let{state:t}=e,i=t.facet(completionConfig),n=(i.override||t.languageDataAt("autocomplete",cur(t)).map(asSource)).map(t=>{let n=this.active.find(e=>e.source==t)||new ActiveSource(t,this.active.some(e=>0!=e.state)?1:0);return n.update(e,i)});n.length==this.active.length&&n.every((e,t)=>e==this.active[t])&&(n=this.active);let r=this.open,s=e.effects.some(e=>e.is(setActiveEffect));r&&e.docChanged&&(r=r.map(e.changes)),e.selection||n.some(t=>t.hasResult()&&e.changes.touchesRange(t.from,t.to))||!sameResults(n,this.active)||s?r=CompletionDialog.build(n,t,this.id,r,i,s):r&&r.disabled&&!n.some(e=>e.isPending)&&(r=null),!r&&n.every(e=>!e.isPending)&&n.some(e=>e.hasResult())&&(n=n.map(e=>e.hasResult()?new ActiveSource(e.source,0):e));for(let o of e.effects)o.is(setSelectedEffect)&&(r=r&&r.setSelected(o.value,this.id));return n==this.active&&r==this.open?this:new CompletionState(n,this.id,r)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?baseAttrs:noAttrs}}function sameResults(e,t){if(e==t)return!0;for(let i=0,n=0;;){for(;i<e.length&&!e[i].hasResult();)i++;for(;n<t.length&&!t[n].hasResult();)n++;let r=i==e.length,s=n==t.length;if(r||s)return r==s;if(e[i++].result!=t[n++].result)return!1}}const baseAttrs={"aria-autocomplete":"list"},noAttrs={};function makeAttrs(e,t){let i={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":e};return t>-1&&(i["aria-activedescendant"]=e+"-"+t),i}const none=[];function getUpdateType(e,t){if(e.isUserEvent("input.complete")){let i=e.annotation(pickedCompletion);if(i&&t.activateOnCompletion(i))return 12}let i=e.isUserEvent("input.type");return i&&t.activateOnTyping?5:i?1:e.isUserEvent("delete.backward")?2:e.selection?8:e.docChanged?16:0}class ActiveSource{constructor(e,t,i=!1){this.source=e,this.state=t,this.explicit=i}hasResult(){return!1}get isPending(){return 1==this.state}update(e,t){let i=getUpdateType(e,t),n=this;(8&i||16&i&&this.touches(e))&&(n=new ActiveSource(n.source,0)),4&i&&0==n.state&&(n=new ActiveSource(this.source,1)),n=n.updateFor(e,i);for(let r of e.effects)if(r.is(startCompletionEffect))n=new ActiveSource(n.source,1,r.value);else if(r.is(closeCompletionEffect))n=new ActiveSource(n.source,0);else if(r.is(setActiveEffect))for(let e of r.value)e.source==n.source&&(n=e);return n}updateFor(e,t){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(cur(e.state))}}class ActiveResult extends ActiveSource{constructor(e,t,i,n,r,s){super(e,3,t),this.limit=i,this.result=n,this.from=r,this.to=s}hasResult(){return!0}updateFor(e,t){var i;if(!(3&t))return this.map(e.changes);let n=this.result;n.map&&!e.changes.empty&&(n=n.map(n,e.changes));let r=e.changes.mapPos(this.from),s=e.changes.mapPos(this.to,1),o=cur(e.state);if(o>s||!n||2&t&&(cur(e.startState)==this.from||o<this.limit))return new ActiveSource(this.source,4&t?1:0);let a=e.changes.mapPos(this.limit);return checkValid(n.validFor,e.state,r,s)?new ActiveResult(this.source,this.explicit,a,n,r,s):n.update&&(n=n.update(n,r,s,new CompletionContext(e.state,o,!1)))?new ActiveResult(this.source,this.explicit,a,n,n.from,null!==(i=n.to)&&void 0!==i?i:cur(e.state)):new ActiveSource(this.source,1,this.explicit)}map(e){if(e.empty)return this;return(this.result.map?this.result.map(this.result,e):this.result)?new ActiveResult(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new ActiveSource(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function checkValid(e,t,i,n){if(!e)return!1;let r=t.sliceDoc(i,n);return"function"==typeof e?e(r,i,n,t):ensureAnchor(e,!0).test(r)}const setActiveEffect=StateEffect.define({map:(e,t)=>e.map(e=>e.map(t))}),setSelectedEffect=StateEffect.define(),completionState=StateField.define({create:()=>CompletionState.start(),update:(e,t)=>e.update(t),provide:e=>[showTooltip.from(e,e=>e.tooltip),EditorView.contentAttributes.from(e,e=>e.attrs)]});function applyCompletion(e,t){const i=t.completion.apply||t.completion.label;let n=e.state.field(completionState).active.find(e=>e.source==t.source);return n instanceof ActiveResult&&("string"==typeof i?e.dispatch({...insertCompletionText(e.state,i,n.from,n.to),annotations:pickedCompletion.of(t.completion)}):i(e,t.completion,n.from,n.to),!0)}const createTooltip=completionTooltip(completionState,applyCompletion);function moveCompletionSelection(e,t="option"){return i=>{let n=i.state.field(completionState,!1);if(!n||!n.open||n.open.disabled||Date.now()-n.open.timestamp<i.state.facet(completionConfig).interactionDelay)return!1;let r,s=1;"page"==t&&(r=getTooltip(i,n.open.tooltip))&&(s=Math.max(2,Math.floor(r.dom.offsetHeight/r.dom.querySelector("li").offsetHeight)-1));let{length:o}=n.open.options,a=n.open.selected>-1?n.open.selected+s*(e?1:-1):e?0:o-1;return a<0?a="page"==t?0:o-1:a>=o&&(a="page"==t?o-1:0),i.dispatch({effects:setSelectedEffect.of(a)}),!0}}const acceptCompletion=e=>{let t=e.state.field(completionState,!1);return!(e.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<e.state.facet(completionConfig).interactionDelay)&&applyCompletion(e,t.open.options[t.open.selected])},startCompletion=e=>!!e.state.field(completionState,!1)&&(e.dispatch({effects:startCompletionEffect.of(!0)}),!0),closeCompletion=e=>{let t=e.state.field(completionState,!1);return!(!t||!t.active.some(e=>0!=e.state))&&(e.dispatch({effects:closeCompletionEffect.of(null)}),!0)};class RunningQuery{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const MaxUpdateCount=50,MinAbortTime=1e3,completionPlugin=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of e.state.field(completionState).active)t.isPending&&this.startQuery(t)}update(e){let t=e.state.field(completionState),i=e.state.facet(completionConfig);if(!e.selectionSet&&!e.docChanged&&e.startState.field(completionState)==t)return;let n=e.transactions.some(e=>{let t=getUpdateType(e,i);return 8&t||(e.selection||e.docChanged)&&!(3&t)});for(let o=0;o<this.running.length;o++){let t=this.running[o];if(n||t.context.abortOnDocChange&&e.docChanged||t.updates.length+e.transactions.length>MaxUpdateCount&&Date.now()-t.time>MinAbortTime){for(let e of t.context.abortListeners)try{e()}catch(s){logException(this.view.state,s)}t.context.abortListeners=null,this.running.splice(o--,1)}else t.updates.push(...e.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),e.transactions.some(e=>e.effects.some(e=>e.is(startCompletionEffect)))&&(this.pendingStart=!0);let r=this.pendingStart?50:i.activateOnTypingDelay;if(this.debounceUpdate=t.active.some(e=>e.isPending&&!this.running.some(t=>t.active.source==e.source))?setTimeout(()=>this.startUpdate(),r):-1,0!=this.composing)for(let o of e.transactions)o.isUserEvent("input.type")?this.composing=2:2==this.composing&&o.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:e}=this.view,t=e.field(completionState);for(let i of t.active)i.isPending&&!this.running.some(e=>e.active.source==i.source)&&this.startQuery(i);this.running.length&&t.open&&t.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(completionConfig).updateSyncTime))}startQuery(e){let{state:t}=this.view,i=cur(t),n=new CompletionContext(t,i,e.explicit,this.view),r=new RunningQuery(e,n);this.running.push(r),Promise.resolve(e.source(n)).then(e=>{r.context.aborted||(r.done=e||null,this.scheduleAccept())},e=>{this.view.dispatch({effects:closeCompletionEffect.of(null)}),logException(this.view.state,e)})}scheduleAccept(){this.running.every(e=>void 0!==e.done)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(completionConfig).updateSyncTime))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],i=this.view.state.facet(completionConfig),n=this.view.state.field(completionState);for(let r=0;r<this.running.length;r++){let s=this.running[r];if(void 0===s.done)continue;if(this.running.splice(r--,1),s.done){let n=cur(s.updates.length?s.updates[0].startState:this.view.state),r=Math.min(n,s.done.from+(s.active.explicit?0:1)),o=new ActiveResult(s.active.source,s.active.explicit,r,s.done,s.done.from,null!==(e=s.done.to)&&void 0!==e?e:n);for(let e of s.updates)o=o.update(e,i);if(o.hasResult()){t.push(o);continue}}let o=n.active.find(e=>e.source==s.active.source);if(o&&o.isPending)if(null==s.done){let e=new ActiveSource(s.active.source,0);for(let t of s.updates)e=e.update(t,i);e.isPending||t.push(e)}else this.startQuery(o)}(t.length||n.open&&n.open.disabled)&&this.view.dispatch({effects:setActiveEffect.of(t)})}},{eventHandlers:{blur(e){let t=this.view.state.field(completionState,!1);if(t&&t.tooltip&&this.view.state.facet(completionConfig).closeOnBlur){let i=t.open&&getTooltip(this.view,t.open.tooltip);i&&i.dom.contains(e.relatedTarget)||setTimeout(()=>this.view.dispatch({effects:closeCompletionEffect.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout(()=>this.view.dispatch({effects:startCompletionEffect.of(!1)}),20),this.composing=0}}}),windows="object"==typeof navigator&&/Win/.test(navigator.platform),commitCharacters=Prec.highest(EditorView.domEventHandlers({keydown(e,t){let i=t.state.field(completionState,!1);if(!i||!i.open||i.open.disabled||i.open.selected<0||e.key.length>1||e.ctrlKey&&(!windows||!e.altKey)||e.metaKey)return!1;let n=i.open.options[i.open.selected],r=i.active.find(e=>e.source==n.source),s=n.completion.commitCharacters||r.result.commitCharacters;return s&&s.indexOf(e.key)>-1&&applyCompletion(t,n),!1}})),baseTheme$1=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"¬∑¬∑¬∑"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'∆í'"}},".cm-completionIcon-class":{"&:after":{content:"'‚óã'"}},".cm-completionIcon-interface":{"&:after":{content:"'‚óå'"}},".cm-completionIcon-variable":{"&:after":{content:"'ùë•'"}},".cm-completionIcon-constant":{"&:after":{content:"'ùê∂'"}},".cm-completionIcon-type":{"&:after":{content:"'ùë°'"}},".cm-completionIcon-enum":{"&:after":{content:"'‚à™'"}},".cm-completionIcon-property":{"&:after":{content:"'‚ñ°'"}},".cm-completionIcon-keyword":{"&:after":{content:"'üîëÔ∏é'"}},".cm-completionIcon-namespace":{"&:after":{content:"'‚ñ¢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class FieldPos{constructor(e,t,i,n){this.field=e,this.line=t,this.from=i,this.to=n}}class FieldRange{constructor(e,t,i){this.field=e,this.from=t,this.to=i}map(e){let t=e.mapPos(this.from,-1,MapMode.TrackDel),i=e.mapPos(this.to,1,MapMode.TrackDel);return null==t||null==i?null:new FieldRange(this.field,t,i)}}class Snippet{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let i=[],n=[t],r=e.doc.lineAt(t),s=/^\s*/.exec(r.text)[0];for(let o of this.lines){if(i.length){let i=s,r=/^\t*/.exec(o)[0].length;for(let t=0;t<r;t++)i+=e.facet(indentUnit);n.push(t+i.length-r),o=i+o.slice(r)}i.push(o),t+=o.length+1}return{text:i,ranges:this.fieldPositions.map(e=>new FieldRange(e.field,n[e.line]+e.from,n[e.line]+e.to))}}static parse(e){let t,i=[],n=[],r=[];for(let s of e.split(/\r\n?|\n/)){for(;t=/[#$]\{(?:(\d+)(?::([^{}]*))?|((?:\\[{}]|[^{}])*))\}/.exec(s);){let e=t[1]?+t[1]:null,o=t[2]||t[3]||"",a=-1,l=o.replace(/\\[{}]/g,e=>e[1]);for(let t=0;t<i.length;t++)(null!=e?i[t].seq==e:l&&i[t].name==l)&&(a=t);if(a<0){let t=0;for(;t<i.length&&(null==e||null!=i[t].seq&&i[t].seq<e);)t++;i.splice(t,0,{seq:e,name:l}),a=t;for(let e of r)e.field>=a&&e.field++}for(let i of r)if(i.line==n.length&&i.from>t.index){let e=t[2]?3+(t[1]||"").length:2;i.from-=e,i.to-=e}r.push(new FieldPos(a,n.length,t.index,t.index+l.length)),s=s.slice(0,t.index)+o+s.slice(t.index+t[0].length)}s=s.replace(/\\([{}])/g,(e,t,i)=>{for(let s of r)s.line==n.length&&s.from>i&&(s.from--,s.to--);return t}),n.push(s)}return new Snippet(n,r)}}let fieldMarker=Decoration.widget({widget:new class extends WidgetType{toDOM(){let e=document.createElement("span");return e.className="cm-snippetFieldPosition",e}ignoreEvent(){return!1}}}),fieldRange=Decoration.mark({class:"cm-snippetField"});class ActiveSnippet{constructor(e,t){this.ranges=e,this.active=t,this.deco=Decoration.set(e.map(e=>(e.from==e.to?fieldMarker:fieldRange).range(e.from,e.to)),!0)}map(e){let t=[];for(let i of this.ranges){let n=i.map(e);if(!n)return null;t.push(n)}return new ActiveSnippet(t,this.active)}selectionInsideField(e){return e.ranges.every(e=>this.ranges.some(t=>t.field==this.active&&t.from<=e.from&&t.to>=e.to))}}const setActive=StateEffect.define({map:(e,t)=>e&&e.map(t)}),moveToField=StateEffect.define(),snippetState=StateField.define({create:()=>null,update(e,t){for(let i of t.effects){if(i.is(setActive))return i.value;if(i.is(moveToField)&&e)return new ActiveSnippet(e.ranges,i.value)}return e&&t.docChanged&&(e=e.map(t.changes)),e&&t.selection&&!e.selectionInsideField(t.selection)&&(e=null),e},provide:e=>EditorView.decorations.from(e,e=>e?e.deco:Decoration.none)});function fieldSelection(e,t){return EditorSelection.create(e.filter(e=>e.field==t).map(e=>EditorSelection.range(e.from,e.to)))}function snippet(e){let t=Snippet.parse(e);return(e,i,n,r)=>{let{text:s,ranges:o}=t.instantiate(e.state,n),{main:a}=e.state.selection,l={changes:{from:n,to:r==a.from?a.to:r,insert:Text.of(s)},scrollIntoView:!0,annotations:i?[pickedCompletion.of(i),Transaction.userEvent.of("input.complete")]:void 0};if(o.length&&(l.selection=fieldSelection(o,0)),o.some(e=>e.field>0)){let t=new ActiveSnippet(o,0),i=l.effects=[setActive.of(t)];void 0===e.state.field(snippetState,!1)&&i.push(StateEffect.appendConfig.of([snippetState,addSnippetKeymap,snippetPointerHandler,baseTheme$1]))}e.dispatch(e.state.update(l))}}function moveField(e){return({state:t,dispatch:i})=>{let n=t.field(snippetState,!1);if(!n||e<0&&0==n.active)return!1;let r=n.active+e,s=e>0&&!n.ranges.some(t=>t.field==r+e);return i(t.update({selection:fieldSelection(n.ranges,r),effects:setActive.of(s?null:new ActiveSnippet(n.ranges,r)),scrollIntoView:!0})),!0}}const clearSnippet=({state:e,dispatch:t})=>!!e.field(snippetState,!1)&&(t(e.update({effects:setActive.of(null)})),!0),nextSnippetField=moveField(1),prevSnippetField=moveField(-1),defaultSnippetKeymap=[{key:"Tab",run:nextSnippetField,shift:prevSnippetField},{key:"Escape",run:clearSnippet}],snippetKeymap=Facet.define({combine:e=>e.length?e[0]:defaultSnippetKeymap}),addSnippetKeymap=Prec.highest(keymap.compute([snippetKeymap],e=>e.facet(snippetKeymap))),snippetPointerHandler=EditorView.domEventHandlers({mousedown(e,t){let i,n=t.state.field(snippetState,!1);if(!n||null==(i=t.posAtCoords({x:e.clientX,y:e.clientY})))return!1;let r=n.ranges.find(e=>e.from<=i&&e.to>=i);return!(!r||r.field==n.active)&&(t.dispatch({selection:fieldSelection(n.ranges,r.field),effects:setActive.of(n.ranges.some(e=>e.field>r.field)?new ActiveSnippet(n.ranges,r.field):null),scrollIntoView:!0}),!0)}}),defaults={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},closeBracketEffect=StateEffect.define({map(e,t){let i=t.mapPos(e,-1,MapMode.TrackAfter);return null==i?void 0:i}}),closedBracket=new class extends RangeValue{};closedBracket.startSide=1,closedBracket.endSide=-1;const bracketState=StateField.define({create:()=>RangeSet.empty,update(e,t){if(e=e.map(t.changes),t.selection){let i=t.state.doc.lineAt(t.selection.main.head);e=e.update({filter:e=>e>=i.from&&e<=i.to})}for(let i of t.effects)i.is(closeBracketEffect)&&(e=e.update({add:[closedBracket.range(i.value,i.value+1)]}));return e}});function closeBrackets(){return[inputHandler,bracketState]}const definedClosing="()[]{}<>¬´¬ª¬ª¬´ÔºªÔºΩÔΩõÔΩù";function closing(e){for(let t=0;t<definedClosing.length;t+=2)if(definedClosing.charCodeAt(t)==e)return definedClosing.charAt(t+1);return fromCodePoint(e<128?e:e+1)}function config(e,t){return e.languageDataAt("closeBrackets",t)[0]||defaults}const android="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),inputHandler=EditorView.inputHandler.of((e,t,i,n)=>{if((android?e.composing:e.compositionStarted)||e.state.readOnly)return!1;let r=e.state.selection.main;if(n.length>2||2==n.length&&1==codePointSize(codePointAt(n,0))||t!=r.from||i!=r.to)return!1;let s=insertBracket(e.state,n);return!!s&&(e.dispatch(s),!0)}),deleteBracketPair=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=config(e,e.selection.main.head).brackets||defaults.brackets,n=null,r=e.changeByRange(t=>{if(t.empty){let n=prevChar(e.doc,t.head);for(let r of i)if(r==n&&nextChar(e.doc,t.head)==closing(codePointAt(r,0)))return{changes:{from:t.head-r.length,to:t.head+r.length},range:EditorSelection.cursor(t.head-r.length)}}return{range:n=t}});return n||t(e.update(r,{scrollIntoView:!0,userEvent:"delete.backward"})),!n},closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(e,t){let i=config(e,e.selection.main.head),n=i.brackets||defaults.brackets;for(let r of n){let s=closing(codePointAt(r,0));if(t==r)return s==r?handleSame(e,r,n.indexOf(r+r+r)>-1,i):handleOpen(e,r,s,i.before||defaults.before);if(t==s&&closedBracketAt(e,e.selection.main.from))return handleClose(e,r,s)}return null}function closedBracketAt(e,t){let i=!1;return e.field(bracketState).between(0,e.doc.length,e=>{e==t&&(i=!0)}),i}function nextChar(e,t){let i=e.sliceString(t,t+2);return i.slice(0,codePointSize(codePointAt(i,0)))}function prevChar(e,t){let i=e.sliceString(t-2,t);return codePointSize(codePointAt(i,0))==i.length?i:i.slice(1)}function handleOpen(e,t,i,n){let r=null,s=e.changeByRange(s=>{if(!s.empty)return{changes:[{insert:t,from:s.from},{insert:i,from:s.to}],effects:closeBracketEffect.of(s.to+t.length),range:EditorSelection.range(s.anchor+t.length,s.head+t.length)};let o=nextChar(e.doc,s.head);return!o||/\s/.test(o)||n.indexOf(o)>-1?{changes:{insert:t+i,from:s.head},effects:closeBracketEffect.of(s.head+t.length),range:EditorSelection.cursor(s.head+t.length)}:{range:r=s}});return r?null:e.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function handleClose(e,t,i){let n=null,r=e.changeByRange(t=>t.empty&&nextChar(e.doc,t.head)==i?{changes:{from:t.head,to:t.head+i.length,insert:i},range:EditorSelection.cursor(t.head+i.length)}:n={range:t});return n?null:e.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function handleSame(e,t,i,n){let r=n.stringPrefixes||defaults.stringPrefixes,s=null,o=e.changeByRange(n=>{if(!n.empty)return{changes:[{insert:t,from:n.from},{insert:t,from:n.to}],effects:closeBracketEffect.of(n.to+t.length),range:EditorSelection.range(n.anchor+t.length,n.head+t.length)};let o,a=n.head,l=nextChar(e.doc,a);if(l==t){if(nodeStart(e,a))return{changes:{insert:t+t,from:a},effects:closeBracketEffect.of(a+t.length),range:EditorSelection.cursor(a+t.length)};if(closedBracketAt(e,a)){let n=i&&e.sliceDoc(a,a+3*t.length)==t+t+t?t+t+t:t;return{changes:{from:a,to:a+n.length,insert:n},range:EditorSelection.cursor(a+n.length)}}}else{if(i&&e.sliceDoc(a-2*t.length,a)==t+t&&(o=canStartStringAt(e,a-2*t.length,r))>-1&&nodeStart(e,o))return{changes:{insert:t+t+t+t,from:a},effects:closeBracketEffect.of(a+t.length),range:EditorSelection.cursor(a+t.length)};if(e.charCategorizer(a)(l)!=CharCategory.Word&&canStartStringAt(e,a,r)>-1&&!probablyInString(e,a,t,r))return{changes:{insert:t+t,from:a},effects:closeBracketEffect.of(a+t.length),range:EditorSelection.cursor(a+t.length)}}return{range:s=n}});return s?null:e.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function nodeStart(e,t){let i=syntaxTree(e).resolveInner(t+1);return i.parent&&i.from==t}function probablyInString(e,t,i,n){let r=syntaxTree(e).resolveInner(t,-1),s=n.reduce((e,t)=>Math.max(e,t.length),0);for(let o=0;o<5;o++){let o=e.sliceDoc(r.from,Math.min(r.to,r.from+i.length+s)),a=o.indexOf(i);if(!a||a>-1&&n.indexOf(o.slice(0,a))>-1){let t=r.firstChild;for(;t&&t.from==r.from&&t.to-t.from>i.length+a;){if(e.sliceDoc(t.to-i.length,t.to)==i)return!1;t=t.firstChild}return!0}let l=r.to==t&&r.parent;if(!l)break;r=l}return!1}function canStartStringAt(e,t,i){let n=e.charCategorizer(t);if(n(e.sliceDoc(t-1,t))!=CharCategory.Word)return t;for(let r of i){let i=t-r.length;if(e.sliceDoc(i,t)==r&&n(e.sliceDoc(i-1,i))!=CharCategory.Word)return i}return-1}function autocompletion(e={}){return[commitCharacters,completionState,completionConfig.of(e),completionPlugin,completionKeymapExt,baseTheme$1]}const completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{mac:"Alt-`",run:startCompletion},{mac:"Alt-i",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(!0)},{key:"ArrowUp",run:moveCompletionSelection(!1)},{key:"PageDown",run:moveCompletionSelection(!0,"page")},{key:"PageUp",run:moveCompletionSelection(!1,"page")},{key:"Enter",run:acceptCompletion}],completionKeymapExt=Prec.highest(keymap.computeN([completionConfig],e=>e.facet(completionConfig).defaultKeymap?[completionKeymap]:[]));class SelectedDiagnostic{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class LintState{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let n=i.facet(lintConfig).markerFilter;n&&(e=n(e,i));let r=e.slice().sort((e,t)=>e.from-t.from||e.to-t.to),s=new RangeSetBuilder,o=[],a=0,l=i.doc.iter(),c=0,h=i.doc.length;for(let d=0;;){let e,t,i=d==r.length?null:r[d];if(!i&&!o.length)break;if(o.length)e=a,t=o.reduce((e,t)=>Math.min(e,t.to),i&&i.from>e?i.from:1e8);else{if(e=i.from,e>h)break;t=i.to,o.push(i),d++}for(;d<r.length;){let i=r[d];if(i.from!=e||!(i.to>i.from||i.to==e)){t=Math.min(i.from,t);break}o.push(i),d++,t=Math.min(i.to,t)}t=Math.min(t,h);let n=!1;if(o.some(i=>i.from==e&&(i.to==t||t==h))&&(n=e==t,!n&&t-e<10)){let i=e-(c+l.value.length);i>0&&(l.next(i),c=e);for(let r=e;;){if(r>=t){n=!0;break}if(!l.lineBreak&&c+l.value.length>r)break;r=c+l.value.length,c+=l.value.length,l.next()}}let u=maxSeverity(o);if(n)s.add(e,e,Decoration.widget({widget:new DiagnosticWidget(u),diagnostics:o.slice()}));else{let i=o.reduce((e,t)=>t.markClass?e+" "+t.markClass:e,"");s.add(e,t,Decoration.mark({class:"cm-lintRange cm-lintRange-"+u+i,diagnostics:o.slice(),inclusiveEnd:o.some(e=>e.to>t)}))}if(a=t,a==h)break;for(let r=0;r<o.length;r++)o[r].to<=a&&o.splice(r--,1)}let u=s.finish();return new LintState(u,t,findDiagnostic(u))}}function findDiagnostic(e,t=null,i=0){let n=null;return e.between(i,1e9,(e,i,{spec:r})=>{if(!(t&&r.diagnostics.indexOf(t)<0))if(n){if(r.diagnostics.indexOf(n.diagnostic)<0)return!1;n=new SelectedDiagnostic(n.from,i,n.diagnostic)}else n=new SelectedDiagnostic(e,i,t||r.diagnostics[0])}),n}function hideTooltip(e,t){let i=t.pos,n=t.end||i,r=e.state.facet(lintConfig).hideOn(e,i,n);if(null!=r)return r;let s=e.startState.doc.lineAt(t.pos);return!(!e.effects.some(e=>e.is(setDiagnosticsEffect))&&!e.changes.touchesRange(s.from,Math.max(s.to,n)))}function maybeEnableLint(e,t){return e.field(lintState,!1)?t:t.concat(StateEffect.appendConfig.of(lintExtensions))}function setDiagnostics(e,t){return{effects:maybeEnableLint(e,[setDiagnosticsEffect.of(t)])}}const setDiagnosticsEffect=StateEffect.define(),togglePanel=StateEffect.define(),movePanelSelection=StateEffect.define(),lintState=StateField.define({create:()=>new LintState(Decoration.none,null,null),update(e,t){if(t.docChanged&&e.diagnostics.size){let i=e.diagnostics.map(t.changes),n=null,r=e.panel;if(e.selected){let r=t.changes.mapPos(e.selected.from,1);n=findDiagnostic(i,e.selected.diagnostic,r)||findDiagnostic(i,null,r)}!i.size&&r&&t.state.facet(lintConfig).autoPanel&&(r=null),e=new LintState(i,r,n)}for(let i of t.effects)if(i.is(setDiagnosticsEffect)){let n=t.state.facet(lintConfig).autoPanel?i.value.length?LintPanel.open:null:e.panel;e=LintState.init(i.value,n,t.state)}else i.is(togglePanel)?e=new LintState(e.diagnostics,i.value?LintPanel.open:null,e.selected):i.is(movePanelSelection)&&(e=new LintState(e.diagnostics,e.panel,i.value));return e},provide:e=>[showPanel.from(e,e=>e.panel),EditorView.decorations.from(e,e=>e.diagnostics)]}),activeMark=Decoration.mark({class:"cm-lintRange cm-lintRange-active"});function lintTooltip(e,t,i){let n,{diagnostics:r}=e.state.field(lintState),s=-1,o=-1;r.between(t-(i<0?1:0),t+(i>0?1:0),(e,r,{spec:a})=>{if(t>=e&&t<=r&&(e==r||(t>e||i>0)&&(t<r||i<0)))return n=a.diagnostics,s=e,o=r,!1});let a=e.state.facet(lintConfig).tooltipFilter;return n&&a&&(n=a(n,e.state)),n?{pos:s,end:o,above:e.state.doc.lineAt(s).to<o,create:()=>({dom:diagnosticsTooltip(e,n)})}:null}function diagnosticsTooltip(e,t){return crelt("ul",{class:"cm-tooltip-lint"},t.map(t=>renderDiagnostic(e,t,!1)))}const openLintPanel=e=>{let t=e.state.field(lintState,!1);t&&t.panel||e.dispatch({effects:maybeEnableLint(e.state,[togglePanel.of(!0)])});let i=getPanel(e,LintPanel.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0},closeLintPanel=e=>{let t=e.state.field(lintState,!1);return!(!t||!t.panel)&&(e.dispatch({effects:togglePanel.of(!1)}),!0)},nextDiagnostic=e=>{let t=e.state.field(lintState,!1);if(!t)return!1;let i=e.state.selection.main,n=t.diagnostics.iter(i.to+1);return!(!n.value&&(n=t.diagnostics.iter(0),!n.value||n.from==i.from&&n.to==i.to))&&(e.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},lintKeymap=[{key:"Mod-Shift-m",run:openLintPanel,preventDefault:!0},{key:"F8",run:nextDiagnostic}],lintPlugin=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.timeout=-1,this.set=!0;let{delay:t}=e.state.facet(lintConfig);this.lintTime=Date.now()+t,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,t)}run(){clearTimeout(this.timeout);let e=Date.now();if(e<this.lintTime-10)this.timeout=setTimeout(this.run,this.lintTime-e);else{this.set=!1;let{state:e}=this.view,{sources:t}=e.facet(lintConfig);t.length&&batchResults(t.map(e=>Promise.resolve(e(this.view))),t=>{this.view.state.doc==e.doc&&this.view.dispatch(setDiagnostics(this.view.state,t.reduce((e,t)=>e.concat(t))))},e=>{logException(this.view.state,e)})}}update(e){let t=e.state.facet(lintConfig);(e.docChanged||t!=e.startState.facet(lintConfig)||t.needsRefresh&&t.needsRefresh(e))&&(this.lintTime=Date.now()+t.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,t.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}});function batchResults(e,t,i){let n=[],r=-1;for(let s of e)s.then(i=>{n.push(i),clearTimeout(r),n.length==e.length?t(n):r=setTimeout(()=>t(n),200)},i)}const lintConfig=Facet.define({combine:e=>({sources:e.map(e=>e.source).filter(e=>null!=e),...combineConfig(e.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{delay:Math.max,markerFilter:combineFilter,tooltipFilter:combineFilter,needsRefresh:(e,t)=>e?t?i=>e(i)||t(i):e:t,hideOn:(e,t)=>e?t?(i,n,r)=>e(i,n,r)||t(i,n,r):e:t,autoPanel:(e,t)=>e||t})})});function combineFilter(e,t){return e?t?(i,n)=>t(e(i,n),n):e:t}function linter(e,t={}){return[lintConfig.of({source:e,config:t}),lintPlugin,lintExtensions]}function assignKeys(e){let t=[];if(e)e:for(let{name:i}of e){for(let e=0;e<i.length;e++){let n=i[e];if(/[a-zA-Z]/.test(n)&&!t.some(e=>e.toLowerCase()==n.toLowerCase())){t.push(n);continue e}}t.push("")}return t}function renderDiagnostic(e,t,i){var n;let r=i?assignKeys(t.actions):[];return crelt("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},crelt("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage(e):t.message),null===(n=t.actions)||void 0===n?void 0:n.map((i,n)=>{let s=!1,o=n=>{if(n.preventDefault(),s)return;s=!0;let r=findDiagnostic(e.state.field(lintState).diagnostics,t);r&&i.apply(e,r.from,r.to)},{name:a}=i,l=r[n]?a.indexOf(r[n]):-1,c=l<0?a:[a.slice(0,l),crelt("u",a.slice(l,l+1)),a.slice(l+1)];return crelt("button",{type:"button",class:"cm-diagnosticAction"+(i.markClass?" "+i.markClass:""),onclick:o,onmousedown:o,"aria-label":` Action: ${a}${l<0?"":` (access key "${r[n]})"`}.`},c)}),t.source&&crelt("div",{class:"cm-diagnosticSource"},t.source))}class DiagnosticWidget extends WidgetType{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return crelt("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class PanelItem{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=renderDiagnostic(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class LintPanel{constructor(e){this.view=e,this.items=[];this.list=crelt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t=>{if(27==t.keyCode)closeLintPanel(this.view),this.view.focus();else if(38==t.keyCode||33==t.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==t.keyCode||34==t.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==t.keyCode)this.moveSelection(0);else if(35==t.keyCode)this.moveSelection(this.items.length-1);else if(13==t.keyCode)this.view.focus();else{if(!(t.keyCode>=65&&t.keyCode<=90&&this.selectedIndex>=0))return;{let{diagnostic:i}=this.items[this.selectedIndex],n=assignKeys(i.actions);for(let r=0;r<n.length;r++)if(n[r].toUpperCase().charCodeAt(0)==t.keyCode){let t=findDiagnostic(this.view.state.field(lintState).diagnostics,i);t&&i.actions[r].apply(e,t.from,t.to)}}}t.preventDefault()},onclick:e=>{for(let t=0;t<this.items.length;t++)this.items[t].dom.contains(e.target)&&this.moveSelection(t)}}),this.dom=crelt("div",{class:"cm-panel-lint"},this.list,crelt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>closeLintPanel(this.view)},"√ó")),this.update()}get selectedIndex(){let e=this.view.state.field(lintState).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(lintState),i=0,n=!1,r=null,s=new Set;for(e.between(0,this.view.state.doc.length,(e,o,{spec:a})=>{for(let l of a.diagnostics){if(s.has(l))continue;s.add(l);let e,o=-1;for(let t=i;t<this.items.length;t++)if(this.items[t].diagnostic==l){o=t;break}o<0?(e=new PanelItem(this.view,l),this.items.splice(i,0,e),n=!0):(e=this.items[o],o>i&&(this.items.splice(i,o-i),n=!0)),t&&e.diagnostic==t.diagnostic?e.dom.hasAttribute("aria-selected")||(e.dom.setAttribute("aria-selected","true"),r=e):e.dom.hasAttribute("aria-selected")&&e.dom.removeAttribute("aria-selected"),i++}});i<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();0==this.items.length&&(this.items.push(new PanelItem(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),r?(this.list.setAttribute("aria-activedescendant",r.id),this.view.requestMeasure({key:this,read:()=>({sel:r.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:e,panel:t})=>{let i=t.height/this.list.offsetHeight;e.top<t.top?this.list.scrollTop-=(t.top-e.top)/i:e.bottom>t.bottom&&(this.list.scrollTop+=(e.bottom-t.bottom)/i)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let e=this.list.firstChild;function t(){let t=e;e=t.nextSibling,t.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=findDiagnostic(this.view.state.field(lintState).diagnostics,this.items[e].diagnostic);t&&this.view.dispatch({selection:{anchor:t.from,head:t.to},scrollIntoView:!0,effects:movePanelSelection.of(t)})}static open(e){return new LintPanel(e)}}function svg(e,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(e)}</svg>')`}function underline(e){return svg(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${e}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const baseTheme=EditorView.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:underline("#d11")},".cm-lintRange-warning":{backgroundImage:underline("orange")},".cm-lintRange-info":{backgroundImage:underline("#999")},".cm-lintRange-hint":{backgroundImage:underline("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function severityWeight(e){return"error"==e?4:"warning"==e?3:"info"==e?2:1}function maxSeverity(e){let t="hint",i=1;for(let n of e){let e=severityWeight(n.severity);e>i&&(i=e,t=n.severity)}return t}const lintExtensions=[lintState,EditorView.decorations.compute([lintState],e=>{let{selected:t,panel:i}=e.field(lintState);return t&&i&&t.from!=t.to?Decoration.set([activeMark.range(t.from,t.to)]):Decoration.none}),hoverTooltip(lintTooltip,{hideOn:hideTooltip}),baseTheme],basicSetup=(()=>[lineNumbers(),highlightActiveLineGutter(),highlightSpecialChars(),history(),foldGutter(),drawSelection(),dropCursor(),EditorState.allowMultipleSelections.of(!0),indentOnInput(),syntaxHighlighting(defaultHighlightStyle,{fallback:!0}),bracketMatching(),closeBrackets(),autocompletion(),rectangularSelection(),crosshairCursor(),highlightActiveLine(),highlightSelectionMatches(),keymap.of([...closeBracketsKeymap,...defaultKeymap,...searchKeymap,...historyKeymap,...foldKeymap,...completionKeymap,...lintKeymap])])();var define_process_env_default={};class Stack{constructor(e,t,i,n,r,s,o,a,l,c=0,h){this.p=e,this.stack=t,this.state=i,this.reducePos=n,this.pos=r,this.score=s,this.buffer=o,this.bufferBase=a,this.curContext=l,this.lookAhead=c,this.parent=h}toString(){return`[${this.stack.filter((e,t)=>t%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,i=0){let n=e.parser.context;return new Stack(e,[],t,i,i,0,[],0,n?new StackContext(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let i=e>>19,n=65535&e,{parser:r}=this.p,s=this.reducePos<this.pos-25&&this.setLookAhead(this.pos),o=r.dynamicPrecedence(n);if(o&&(this.score+=o),0==i)return this.pushState(r.getGoto(this.state,n,!0),this.reducePos),n<r.minRepeatTerm&&this.storeNode(n,this.reducePos,this.reducePos,s?8:4,!0),void this.reduceContext(n,this.reducePos);let a=this.stack.length-3*(i-1)-(262144&e?6:0),l=a?this.stack[a-2]:this.p.ranges[0].from,c=this.reducePos-l;c>=2e3&&!(null===(t=this.p.parser.nodeSet.types[n])||void 0===t?void 0:t.isAnonymous)&&(l==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=c):this.p.lastBigReductionSize<c&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=l,this.p.lastBigReductionSize=c));let h=a?this.stack[a-1]:0,u=this.bufferBase+this.buffer.length-h;if(n<r.minRepeatTerm||131072&e){let e=r.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(n,l,e,u+4,!0)}if(262144&e)this.state=this.stack[a];else{let e=this.stack[a-3];this.state=r.getGoto(e,n,!0)}for(;this.stack.length>a;)this.stack.pop();this.reduceContext(n,l)}storeNode(e,t,i,n=4,r=!1){if(0==e&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let e=this,n=this.buffer.length;if(0==n&&e.parent&&(n=e.bufferBase-e.parent.bufferBase,e=e.parent),n>0&&0==e.buffer[n-4]&&e.buffer[n-1]>-1){if(t==i)return;if(e.buffer[n-2]>=t)return void(e.buffer[n-2]=i)}}if(r&&this.pos!=i){let r=this.buffer.length;if(r>0&&(0!=this.buffer[r-4]||this.buffer[r-1]<0)){let e=!1;for(let t=r;t>0&&this.buffer[t-2]>i;t-=4)if(this.buffer[t-1]>=0){e=!0;break}if(e)for(;r>0&&this.buffer[r-2]>i;)this.buffer[r]=this.buffer[r-4],this.buffer[r+1]=this.buffer[r-3],this.buffer[r+2]=this.buffer[r-2],this.buffer[r+3]=this.buffer[r-1],r-=4,n>4&&(n-=4)}this.buffer[r]=e,this.buffer[r+1]=t,this.buffer[r+2]=i,this.buffer[r+3]=n}else this.buffer.push(e,t,i,n)}shift(e,t,i,n){if(131072&e)this.pushState(65535&e,this.pos);else if(262144&e)this.pos=n,this.shiftContext(t,i),t<=this.p.parser.maxNode&&this.buffer.push(t,i,n,4);else{let r=e,{parser:s}=this.p;(n>this.pos||t<=s.maxNode)&&(this.pos=n,s.stateFlag(r,1)||(this.reducePos=n)),this.pushState(r,i),this.shiftContext(t,i),t<=s.maxNode&&this.buffer.push(t,i,n,4)}}apply(e,t,i,n){65536&e?this.reduce(e):this.shift(e,t,i,n)}useNode(e,t){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=e)&&(this.p.reused.push(e),i++);let n=this.pos;this.reducePos=this.pos=n+e.length,this.pushState(t,n),this.buffer.push(i,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let i=e.buffer.slice(t),n=e.bufferBase+t;for(;e&&n==e.bufferBase;)e=e.parent;return new Stack(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,n,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let i=e<=this.p.parser.maxNode;i&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,i?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new SimulatedStack(this);;){let i=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(0==i)return!1;if(!(65536&i))return!0;t.reduce(i)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let i=[];for(let n,r=0;r<t.length;r+=2)(n=t[r+1])!=this.state&&this.p.parser.hasAction(n,e)&&i.push(t[r],n);if(this.stack.length<120)for(let e=0;i.length<8&&e<t.length;e+=2){let n=t[e+1];i.some((e,t)=>1&t&&e==n)||i.push(t[e],n)}t=i}let i=[];for(let n=0;n<t.length&&i.length<4;n+=2){let e=t[n+1];if(e==this.state)continue;let r=this.split();r.pushState(e,this.pos),r.storeNode(0,r.pos,r.pos,4,!0),r.shiftContext(t[n],this.pos),r.reducePos=this.pos,r.score-=200,i.push(r)}return i}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if(!(65536&t))return!1;if(!e.validAction(this.state,t)){let i=t>>19,n=65535&t,r=this.stack.length-3*i;if(r<0||e.getGoto(this.stack[r],n,!1)<0){let e=this.findForcedReduction();if(null==e)return!1;t=e}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],i=(n,r)=>{if(!t.includes(n))return t.push(n),e.allActions(n,t=>{if(393216&t);else if(65536&t){let i=(t>>19)-r;if(i>1){let n=65535&t,r=this.stack.length-3*i;if(r>=0&&e.getGoto(this.stack[r],n,!1)>=0)return i<<19|65536|n}}else{let e=i(t,r+1);if(null!=e)return e}})};return i(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:e}=this.p;return 65535==e.data[e.stateSlot(this.state,1)]&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||-3!=this.buffer[e])&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||-4!=this.buffer[e])&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new StackContext(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){return!(e<=this.lookAhead)&&(this.emitLookAhead(),this.lookAhead=e,!0)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class StackContext{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class SimulatedStack{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=65535&e,i=e>>19;0==i?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=3*(i-1);let n=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=n}}class StackBufferCursor{constructor(e,t,i){this.stack=e,this.pos=t,this.index=i,this.buffer=e.buffer,0==this.index&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new StackBufferCursor(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;null!=e&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new StackBufferCursor(this.stack,this.pos,this.index)}}function decodeArray(e,t=Uint16Array){if("string"!=typeof e)return e;let i=null;for(let n=0,r=0;n<e.length;){let s=0;for(;;){let t=e.charCodeAt(n++),i=!1;if(126==t){s=65535;break}t>=92&&t--,t>=34&&t--;let r=t-32;if(r>=46&&(r-=46,i=!0),s+=r,i)break;s*=46}i?i[r++]=s:i=new t(s)}return i}class CachedToken{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const nullToken=new CachedToken;class InputStream{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=nullToken,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let i=this.range,n=this.rangeIndex,r=this.pos+e;for(;r<i.from;){if(!n)return null;let e=this.ranges[--n];r-=i.from-e.to,i=e}for(;t<0?r>i.to:r>=i.to;){if(n==this.ranges.length-1)return null;let e=this.ranges[++n];r+=e.from-i.to,i=e}return r}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t,i,n=this.chunkOff+e;if(n>=0&&n<this.chunk.length)t=this.pos+e,i=this.chunk.charCodeAt(n);else{let n=this.resolveOffset(e,1);if(null==n)return-1;if(t=n,t>=this.chunk2Pos&&t<this.chunk2Pos+this.chunk2.length)i=this.chunk2.charCodeAt(t-this.chunk2Pos);else{let e=this.rangeIndex,n=this.range;for(;n.to<=t;)n=this.ranges[++e];this.chunk2=this.input.chunk(this.chunk2Pos=t),t+this.chunk2.length>n.to&&(this.chunk2=this.chunk2.slice(0,n.to-t)),i=this.chunk2.charCodeAt(0)}}return t>=this.token.lookAhead&&(this.token.lookAhead=t+1),i}acceptToken(e,t=0){let i=t?this.resolveOffset(t,-1):this.pos;if(null==i||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=i}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=nullToken,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let i="";for(let n of this.ranges){if(n.from>=t)break;n.to>e&&(i+=this.input.read(Math.max(n.from,e),Math.min(n.to,t)))}return i}}class TokenGroup{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:i}=t.p;readToken(this.data,e,t,this.id,i.data,i.tokenPrecTable)}}function readToken(e,t,i,n,r,s){let o=0,a=1<<n,{dialect:l}=i.p.parser;e:for(;0!=(a&e[o]);){let i=e[o+1];for(let u=o+3;u<i;u+=2)if((e[u+1]&a)>0){let i=e[u];if(l.allows(i)&&(-1==t.token.value||t.token.value==i||overrides(i,t.token.value,r,s))){t.acceptToken(i);break}}let n=t.next,c=0,h=e[o+2];if(!(t.next<0&&h>c&&65535==e[i+3*h-3])){for(;c<h;){let r=c+h>>1,s=i+r+(r<<1),a=e[s],l=e[s+1]||65536;if(n<a)h=r;else{if(!(n>=l)){o=e[s+2],t.advance();continue e}c=r+1}}break}o=e[i+3*h-1]}}function findOffset(e,t,i){for(let n,r=t;65535!=(n=e[r]);r++)if(n==i)return r-t;return-1}function overrides(e,t,i,n){let r=findOffset(i,n,t);return r<0||findOffset(i,n,e)<r}TokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1,TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;const verbose="undefined"!=typeof process&&define_process_env_default&&/\bparse\b/.test(define_process_env_default.LOG);let stackIDs=null;function cutAt(e,t,i){let n=e.cursor(IterMode.IncludeAnonymous);for(n.moveTo(t);;)if(!(i<0?n.childBefore(t):n.childAfter(t)))for(;;){if((i<0?n.to<t:n.from>t)&&!n.type.isError)return i<0?Math.max(0,Math.min(n.to-1,t-25)):Math.min(e.length,Math.max(n.from+1,t+25));if(i<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return i<0?0:e.length}}class FragmentCursor{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?cutAt(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?cutAt(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let i=this.trees[t],n=this.index[t];if(n==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let r=i.children[n],s=this.start[t]+i.positions[n];if(s>e)return this.nextStart=s,null;if(r instanceof Tree$1){if(s==e){if(s<this.safeFrom)return null;let e=s+r.length;if(e<=this.safeTo){let t=r.prop(NodeProp.lookAhead);if(!t||e+t<this.fragment.to)return r}}this.index[t]++,s+r.length>=Math.max(this.safeFrom,e)&&(this.trees.push(r),this.start.push(s),this.index.push(0))}else this.index[t]++,this.nextStart=s+r.length}}}class TokenCache{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(e=>new CachedToken)}getActions(e){let t=0,i=null,{parser:n}=e.p,{tokenizers:r}=n,s=n.stateSlot(e.state,3),o=e.curContext?e.curContext.hash:0,a=0;for(let l=0;l<r.length;l++){if(!(1<<l&s))continue;let n=r[l],c=this.tokens[l];if((!i||n.fallback)&&((n.contextual||c.start!=e.pos||c.mask!=s||c.context!=o)&&(this.updateCachedToken(c,n,e),c.mask=s,c.context=o),c.lookAhead>c.end+25&&(a=Math.max(c.lookAhead,a)),0!=c.value)){let r=t;if(c.extended>-1&&(t=this.addActions(e,c.extended,c.end,t)),t=this.addActions(e,c.value,c.end,t),!n.extend&&(i=c,t>r))break}}for(;this.actions.length>t;)this.actions.pop();return a&&e.setLookAhead(a),i||e.pos!=this.stream.end||(i=new CachedToken,i.value=e.p.parser.eofTerm,i.start=i.end=e.pos,t=this.addActions(e,i.value,i.end,t)),this.mainToken=i,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new CachedToken,{pos:i,p:n}=e;return t.start=i,t.end=Math.min(i+1,n.stream.end),t.value=i==n.stream.end?n.parser.eofTerm:0,t}updateCachedToken(e,t,i){let n=this.stream.clipPos(i.pos);if(t.token(this.stream.reset(n,e),i),e.value>-1){let{parser:t}=i.p;for(let n=0;n<t.specialized.length;n++)if(t.specialized[n]==e.value){let r=t.specializers[n](this.stream.read(e.start,e.end),i);if(r>=0&&i.p.parser.dialect.allows(r>>1)){1&r?e.extended=r>>1:e.value=r>>1;break}}}else e.value=0,e.end=this.stream.clipPos(n+1)}putAction(e,t,i,n){for(let r=0;r<n;r+=3)if(this.actions[r]==e)return n;return this.actions[n++]=e,this.actions[n++]=t,this.actions[n++]=i,n}addActions(e,t,i,n){let{state:r}=e,{parser:s}=e.p,{data:o}=s;for(let a=0;a<2;a++)for(let e=s.stateSlot(r,a?2:1);;e+=3){if(65535==o[e]){if(1!=o[e+1]){0==n&&2==o[e+1]&&(n=this.putAction(pair(o,e+2),t,i,n));break}e=pair(o,e+2)}o[e]==t&&(n=this.putAction(pair(o,e+1),t,i,n))}return n}}class Parse{constructor(e,t,i,n){this.parser=e,this.input=t,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new InputStream(t,n),this.tokens=new TokenCache(e,this.stream),this.topTerm=e.top[1];let{from:r}=n[0];this.stacks=[Stack.start(this,e.top[0],r)],this.fragments=i.length&&this.stream.end-r>4*e.bufferLength?new FragmentCursor(i,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e,t,i=this.stacks,n=this.minStackPos,r=this.stacks=[];if(this.bigReductionCount>300&&1==i.length){let[e]=i;for(;e.forceReduce()&&e.stack.length&&e.stack[e.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let s=0;s<i.length;s++){let o=i[s];for(;;){if(this.tokens.mainToken=null,o.pos>n)r.push(o);else{if(this.advanceStack(o,r,i))continue;{e||(e=[],t=[]),e.push(o);let i=this.tokens.getMainToken(o);t.push(i.value,i.end)}}break}}if(!r.length){let t=e&&findFinished(e);if(t)return verbose&&console.log("Finish with "+this.stackID(t)),this.stackToTree(t);if(this.parser.strict)throw verbose&&e&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+n);this.recovering||(this.recovering=5)}if(this.recovering&&e){let i=null!=this.stoppedAt&&e[0].pos>this.stoppedAt?e[0]:this.runRecovery(e,t,r);if(i)return verbose&&console.log("Force-finish "+this.stackID(i)),this.stackToTree(i.forceAll())}if(this.recovering){let e=1==this.recovering?1:3*this.recovering;if(r.length>e)for(r.sort((e,t)=>t.score-e.score);r.length>e;)r.pop();r.some(e=>e.reducePos>n)&&this.recovering--}else if(r.length>1){e:for(let e=0;e<r.length-1;e++){let t=r[e];for(let i=e+1;i<r.length;i++){let n=r[i];if(t.sameState(n)||t.buffer.length>500&&n.buffer.length>500){if(!((t.score-n.score||t.buffer.length-n.buffer.length)>0)){r.splice(e--,1);continue e}r.splice(i--,1)}}}r.length>12&&r.splice(12,r.length-12)}this.minStackPos=r[0].pos;for(let s=1;s<r.length;s++)r[s].pos<this.minStackPos&&(this.minStackPos=r[s].pos);return null}stopAt(e){if(null!=this.stoppedAt&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,i){let n=e.pos,{parser:r}=this,s=verbose?this.stackID(e)+" -> ":"";if(null!=this.stoppedAt&&n>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let t=e.curContext&&e.curContext.tracker.strict,i=t?e.curContext.hash:0;for(let o=this.fragments.nodeAt(n);o;){let n=this.parser.nodeSet.types[o.type.id]==o.type?r.getGoto(e.state,o.type.id):-1;if(n>-1&&o.length&&(!t||(o.prop(NodeProp.contextHash)||0)==i))return e.useNode(o,n),verbose&&console.log(s+this.stackID(e)+` (via reuse of ${r.getName(o.type.id)})`),!0;if(!(o instanceof Tree$1)||0==o.children.length||o.positions[0]>0)break;let a=o.children[0];if(!(a instanceof Tree$1&&0==o.positions[0]))break;o=a}}let o=r.stateSlot(e.state,4);if(o>0)return e.reduce(o),verbose&&console.log(s+this.stackID(e)+` (via always-reduce ${r.getName(65535&o)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let a=this.tokens.getActions(e);for(let l=0;l<a.length;){let o=a[l++],c=a[l++],h=a[l++],u=l==a.length||!i,d=u?e:e.split(),p=this.tokens.mainToken;if(d.apply(o,c,p?p.start:d.pos,h),verbose&&console.log(s+this.stackID(d)+` (via ${65536&o?`reduce of ${r.getName(65535&o)}`:"shift"} for ${r.getName(c)} @ ${n}${d==e?"":", split"})`),u)return!0;d.pos>n?t.push(d):i.push(d)}return!1}advanceFully(e,t){let i=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>i)return pushStackDedup(e,t),!0}}runRecovery(e,t,i){let n=null,r=!1;for(let s=0;s<e.length;s++){let o=e[s],a=t[s<<1],l=t[1+(s<<1)],c=verbose?this.stackID(o)+" -> ":"";if(o.deadEnd){if(r)continue;if(r=!0,o.restart(),verbose&&console.log(c+this.stackID(o)+" (restarted)"),this.advanceFully(o,i))continue}let h=o.split(),u=c;for(let e=0;e<10&&h.forceReduce();e++){if(verbose&&console.log(u+this.stackID(h)+" (via force-reduce)"),this.advanceFully(h,i))break;verbose&&(u=this.stackID(h)+" -> ")}for(let e of o.recoverByInsert(a))verbose&&console.log(c+this.stackID(e)+" (via recover-insert)"),this.advanceFully(e,i);this.stream.end>o.pos?(l==o.pos&&(l++,a=0),o.recoverByDelete(a,l),verbose&&console.log(c+this.stackID(o)+` (via recover-delete ${this.parser.getName(a)})`),pushStackDedup(o,i)):(!n||n.score<o.score)&&(n=o)}return n}stackToTree(e){return e.close(),Tree$1.build({buffer:StackBufferCursor.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(stackIDs||(stackIDs=new WeakMap)).get(e);return t||stackIDs.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function pushStackDedup(e,t){for(let i=0;i<t.length;i++){let n=t[i];if(n.pos==e.pos&&n.sameState(e))return void(t[i].score<e.score&&(t[i]=e))}t.push(e)}class Dialect{constructor(e,t,i){this.source=e,this.flags=t,this.disabled=i}allows(e){return!this.disabled||0==this.disabled[e]}}class LRParser extends Parser$1{constructor(e){if(super(),this.wrappers=[],14!=e.version)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let o=0;o<e.repeatNodeCount;o++)t.push("");let i=Object.keys(e.topRules).map(t=>e.topRules[t][1]),n=[];for(let o=0;o<t.length;o++)n.push([]);function r(e,t,i){n[e].push([t,t.deserialize(String(i))])}if(e.nodeProps)for(let o of e.nodeProps){let e=o[0];"string"==typeof e&&(e=NodeProp[e]);for(let t=1;t<o.length;){let i=o[t++];if(i>=0)r(i,e,o[t++]);else{let n=o[t+-i];for(let s=-i;s>0;s--)r(o[t++],e,n);t++}}}this.nodeSet=new NodeSet(t.map((t,r)=>NodeType.define({name:r>=this.minRepeatTerm?void 0:t,id:r,props:n[r],top:i.indexOf(r)>-1,error:0==r,skipped:e.skippedNodes&&e.skippedNodes.indexOf(r)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=DefaultBufferLength;let s=decodeArray(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let o=0;o<this.specializerSpecs.length;o++)this.specialized[o]=this.specializerSpecs[o].term;this.specializers=this.specializerSpecs.map(getSpecializer),this.states=decodeArray(e.states,Uint32Array),this.data=decodeArray(e.stateData),this.goto=decodeArray(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(e=>"number"==typeof e?new TokenGroup(s,e):e),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,i){let n=new Parse(this,e,t,i);for(let r of this.wrappers)n=r(n,e,t,i);return n}getGoto(e,t,i=!1){let n=this.goto;if(t>=n[0])return-1;for(let r=n[t+1];;){let t=n[r++],s=1&t,o=n[r++];if(s&&i)return o;for(let i=r+(t>>1);r<i;r++)if(n[r]==e)return o;if(s)return-1}}hasAction(e,t){let i=this.data;for(let n=0;n<2;n++)for(let r,s=this.stateSlot(e,n?2:1);;s+=3){if(65535==(r=i[s])){if(1!=i[s+1]){if(2==i[s+1])return pair(i,s+2);break}r=i[s=pair(i,s+2)]}if(r==t||0==r)return pair(i,s+1)}return 0}stateSlot(e,t){return this.states[6*e+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,e=>e==t||null)}allActions(e,t){let i=this.stateSlot(e,4),n=i?t(i):void 0;for(let r=this.stateSlot(e,1);null==n;r+=3){if(65535==this.data[r]){if(1!=this.data[r+1])break;r=pair(this.data,r+2)}n=t(pair(this.data,r+1))}return n}nextStates(e){let t=[];for(let i=this.stateSlot(e,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])break;i=pair(this.data,i+2)}if(!(1&this.data[i+2])){let e=this.data[i+1];t.some((t,i)=>1&i&&t==e)||t.push(this.data[i],e)}}return t}configure(e){let t=Object.assign(Object.create(LRParser.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let i=this.topRules[e.top];if(!i)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=i}return e.tokenizers&&(t.tokenizers=this.tokenizers.map(t=>{let i=e.tokenizers.find(e=>e.from==t);return i?i.to:t})),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map((i,n)=>{let r=e.specializers.find(e=>e.from==i.external);if(!r)return i;let s=Object.assign(Object.assign({},i),{external:r.to});return t.specializers[n]=getSpecializer(s),s})),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),null!=e.strict&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),null!=e.bufferLength&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return null==t?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),i=t.map(()=>!1);if(e)for(let r of e.split(" ")){let e=t.indexOf(r);e>=0&&(i[e]=!0)}let n=null;for(let r=0;r<t.length;r++)if(!i[r])for(let e,i=this.dialects[t[r]];65535!=(e=this.data[i++]);)(n||(n=new Uint8Array(this.maxTerm+1)))[e]=1;return new Dialect(e,i,n)}static deserialize(e){return new LRParser(e)}}function pair(e,t){return e[t]|e[t+1]<<16}function findFinished(e){let t=null;for(let i of e){let e=i.p.stoppedAt;(i.pos==i.p.stream.end||null!=e&&i.pos>e)&&i.p.parser.stateFlag(i.state,2)&&(!t||t.score<i.score)&&(t=i)}return t}function getSpecializer(e){if(e.external){let t=e.extend?1:0;return(i,n)=>e.external(i,n)<<1|t}return e.get}const spec_Identifier={__proto__:null,where:16,not:18,contains:40,"!contains":42,startswith:44,endswith:46,has:48,"!has":50,in:52,"!in":54,and:56,or:58,project:60,extend:64,sort:66,by:68,asc:70,desc:72,limit:74,take:76,top:78,distinct:80,summarize:82,join:84,inner:86,leftouter:88,rightouter:90,fullouter:92,leftanti:94,rightanti:96,leftsemi:98,rightsemi:100,on:102,let:104},parser$1=LRParser.deserialize({version:14,states:"1pOYQPOOOeQPO'#DvOOQO'#Du'#DuOOQO'#Ds'#DsOjQPO'#DsQOQPOOOxQPO'#DtO!QQPO'#EbO!YQPO,5:bOOQO,5:_,5:_O!_QPO'#DdO#]QPO,5:`O#eQPO,5:|OOQO1G/|1G/|OOQO'#Dw'#DwOOQO,5:O,5:OO#jQPO'#EVO#uQPO'#EYO!QQPO'#E[O#zQPO'#E`O$lQPO'#DwO!QQPO'#DwO%QQPO'#DwO!QQPO'#DwOOQO-E7b-E7bO$lQPO1G0hO%VQPO'#EXO%hQPO'#EWOOQO,5:q,5:qO!QQPO,5:qO%sQPO,5:tO&OQPO'#E^OOQO'#E^'#E^O&WQPO'#E]O&fQPO,5:vOOQO'#Ea'#EaO&qQPO,5:zO!QQPO,5:zOOQO'#EQ'#EQO&vQQO'#EROOQO'#EO'#EOO(dQQO'#D}O)zQQO'#D|O+vQQO'#D{OOQO'#Dz'#DzO,dQPO'#DyO-OQPO'#DxO$lQPO'#EOO$lQPO'#DzOOQO,5:c,5:cO-gQPO'#EUO-uQPO'#ETO.QQPO'#EZO.]QPO7+&SOOQO,5:s,5:sO!QQPO'#DmO.bQPO,5:rOOQO1G0]1G0]O.mQPO1G0`O!QQPO1G0`O!QQPO,5:xO.{QPO,5:yO!QQPO'#DoO/SQPO,5:wO!QQPO1G0bO$lQPO1G0fO/bQPO1G0fO/gQQO,5:mO$lQPO'#DfO1QQPO'#DgO1cQQO,5:iO1QQPO'#DhO2yQQO,5:hOOQO'#ES'#ESO1QQPO'#DiO4WQQO,5:gO4tQPO,5:eO$lQPO'#DjO5`QPO,5:dO$lQPO'#DkO5wQPO,5:jOOQO,5:f,5:fO$lQPO,5:pO!QQPO'#DlO5|QPO,5:oO!QQPO'#DnO6XQPO,5:uOOQO<<In<<InOOQO,5:X,5:XOOQO-E7k-E7kOOQO7+%z7+%zO6dQPO7+%zOOQO1G0d1G0dO6rQPO'#E_O6wQPO'#EPOOQO1G0e1G0eO7PQPO1G0eOOQO,5:Z,5:ZOOQO-E7m-E7mOOQO7+%|7+%|OOQO7+&Q7+&QO$lQPO7+&QOOQO-E7d-E7dO7UQPO,5:QOOQO,5:R,5:ROOQO-E7e-E7eOOQO,5:S,5:SOOQO-E7f-E7fOOQO,5:T,5:TOOQO-E7g-E7gOOQO-E7h-E7hOOQO,5:U,5:UOOQO-E7i-E7iOOQO,5:V,5:VOOQO1G0U1G0UOOQO1G0[1G0[OOQO,5:W,5:WOOQO-E7j-E7jOOQO,5:Y,5:YOOQO-E7l-E7lOOQO<<If<<IfO7ZQPO,5:kO$lQPO'#DeOOQO7+&P7+&POOQO<<Il<<IlOOQO1G/l1G/lOOQO-E7c-E7cOOQO,5:P,5:P",stateData:"7f~O!fOSPOS~ORQOSPO!UVO~OTWO~ORQOSPO!UVO!d!gX~OVYO!d!hX~ORQOSPO~OU]O~ORQOSPOT^OWdO]^OneOpeOq`OufOvfOwaOxgOybOzcO~OVYO!d!ha~OoiO~ORQOSPOrmO~O]nO~ORQOSPO{sO|sO}sO!OsO!PsO!QsO!RsO!SsO~ORQOSPOTvOX!QOY!PO]vO~O]!RO~Os!WOt!WOV!{XZ!{X!d!{X~OZ!XOV!zX!d!zX~ORQOSPOr!]O~OY!_Oo!^O~OZ!`OV#PXr#PX!d#PX~Or!bOV#Oa!d#Oa~O!T!cO~OS!fOY!_OV!uX^!uX_!uX`!uXa!uXb!uXc!uXd!uXe!uXf!uXg!uXh!uXi!uXj!uXk!uXl!uXm!uX!d!uX!V!uX[!uXZ!uXU!uX~O^!gO_!gO`!gOV!qXa!qXb!qXc!qXd!qXe!qXf!qXg!qXh!qXi!qXj!qXk!qXl!qXm!qX!d!qX!V!qX[!qXZ!qXU!qX~Oa!iOb!iOV!pXc!pXd!pXe!pXf!pXg!pXh!pXi!pXj!pXk!pXl!pXm!pX!d!pX!V!pX[!pXZ!pXU!pX~Oc!kOd!kOe!kOf!kOg!kOh!kOi!kOj!kOk!kO~OV!oXl!oXm!oX!d!oX!V!oX[!oXZ!oXU!oX~P+XOl!oOV!mXm!mX!d!mX!V!mX[!mXZ!mXU!mX~Om!qOV!lX!d!lX!V!lX[!lXZ!lXU!lX~Oo!tOV!xXZ!xX!d!xX~OZ!uOV!wX!d!wX~OZ!wOV!}X!d!}X~O!V!yO~OZ!XOV!za!d!za~Os!|Ot!|OV!|i!d!|i~O[#RO~P$lOZ!`OV#Par#Pa!d#Pa~O!T#XO~OS!fOV!ua^!ua_!ua`!uaa!uab!uac!uad!uae!uaf!uag!uah!uai!uaj!uak!ual!uam!ua!d!ua!V!ua[!uaZ!uaU!ua~ORQOSPOTvOY!PO]vO~O^!gO_!gO`!gOV!qaa!qab!qac!qad!qae!qaf!qag!qah!qai!qaj!qak!qal!qam!qa!d!qa!V!qa[!qaZ!qaU!qa~Oa!iOb!iOV!pac!pad!pae!paf!pag!pah!pai!paj!pak!pal!pam!pa!d!pa!V!pa[!paZ!paU!pa~OV!oal!oam!oa!d!oa!V!oa[!oaZ!oaU!oa~P+XOl!oOV!mam!ma!d!ma!V!ma[!maZ!maU!ma~Om!qOV!la!d!la!V!la[!laZ!laU!la~O[#fO~OZ!uOV!wa!d!wa~OZ!wOV!}a!d!}a~Os#lOt#lOV!|q!d!|q~OY!_O~OZ#nO[!sX~O[#oO~OU#qO~OZ#nO[!sa~OP_~",goto:"+}#VPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP#W#^#d#j#p#v#|$S$Y$`$f$lPPP$r$x$|&^'S'V'r(Q(d(r)T)g)z)})}*`*d*g*m*p*v*m*}*m+T+W+^*m+v+yQZURhZQ#m#QR#r#mQ!ewR#Y!eQ!hyR#]!hQ!jzR#_!jQ!m{R#a!mQ!n}R#b!nQ!p!OR#d!pQ!v!TR#i!vQ!YkR!{!YQ!x!UR#k!xQ!aqR#U!aQTORXSTROSSUOSQ[VQ^YUj`m!XSob!`Qtcnwdi!P!Q!_!c!f!g!i!l!o!q!t#X#nS!Se!uS!Ug!bQ![nQ!duQ!}!]Q#P!^R#j!w!gQOSVY`bcdegimnu!P!Q!X!]!^!_!`!b!c!f!g!i!l!o!q!t!u!w#X#nR_YQ!RdQ!ViQ!r!PQ#Q!_Q#W!cQ#Z!fQ#g!tQ#p#XR#s#nb!Odi!P!_!c!f!t#X#nR#e!qd}di!P!_!c!f!q!t#X#nQ!s!QR#c!oi|di!P!Q!_!c!f!o!q!t#X#nh{di!P!Q!_!c!f!o!q!t#X#nR#`!ljzdi!P!Q!_!c!f!l!o!q!t#X#nR#^!ilydi!P!Q!_!c!f!i!l!o!q!t#X#nR#[!gR#S!_oxdi!P!Q!_!c!f!g!i!l!o!q!t#X#nT!l{!mR!ReQ!TeR#h!uR^YQl`R!ZmSk`mR!z!XQ!RgR#V!bRrbQqbR#T!`Spb!`nxdi!P!Q!_!c!f!g!i!l!o!q!t#X#nR#O!^RucTSOS",nodeNames:"‚ö† LineComment Query Identifier OpenBracket String CloseBracket Pipe where not OpenParen Comma CloseParen Number Star Slash Percent Plus Minus ComparisonOp contains NotContains startswith endswith has NotHas in NotIn and or project Equals extend sort by asc desc limit take top distinct summarize join inner leftouter rightouter fullouter leftanti rightanti leftsemi rightsemi on let Semicolon",maxTerm:98,skippedNodes:[0,1],repeatNodeCount:12,tokenData:"*U~RjXY!sYZ!s]^!spq!sqr#Urs#auv%Zwx%`xy'Tyz'Yz{'_{|'d|}'i}!O'n!P!Q's!Q![(d!]!^(}!^!_)S!_!`)[!`!a)S!c!})d!}#O)u#P#Q)z#R#S)d#T#o)d#p#q*P~!xS!f~XY!sYZ!s]^!spq!sQ#XP!_!`#[Q#aOcQ~#dWOY#aZr#ars#|s#O#a#O#P$R#P;'S#a;'S;=`%T<%lO#a~$ROT~~$UP#O#P$X~$[RO;'S#a;'S;=`$e;=`O#a~$hXOY#aZr#ars#|s#O#a#O#P$R#P;'S#a;'S;=`%T;=`<%l#a<%lO#a~%WP;=`<%l#a~%`O`~~%cWOY%`Zw%`wx#|x#O%`#O#P%{#P;'S%`;'S;=`&}<%lO%`~&OP#O#P&R~&URO;'S%`;'S;=`&_;=`O%`~&bXOY%`Zw%`wx#|x#O%`#O#P%{#P;'S%`;'S;=`&};=`<%l%`<%lO%`~'QP;=`<%l%`~'YOY~~'_O[~~'dO^~~'iOa~~'nOZ~~'sOb~~'xP_~!P!Q'{~(QSP~OY'{Z;'S'{;'S;=`(^<%lO'{~(aP;=`<%l'{~(iQ]~!O!P(o!Q![(d~(rP!Q![(u~(zP]~!Q![(u~)SO!V~Q)XPcQ!_!`#[R)aPoP!_!`#[~)iSR~!Q![)d!c!})d#R#S)d#T#o)d~)zOS~~*POU~~*UOV~",tokenizers:[0,1],topRules:{Query:[0,2]},specialized:[{term:3,get:e=>spec_Identifier[e]||-1}],tokenPrec:1031});function toParsedAST(e){return{ast:void 0,errors:findErrors(parser$1.parse(e))}}function findErrors(e){const t=[],i=e.cursor();do{"‚ö†"===i.name&&t.push({type:"ParseError",message:`Syntax error at position ${i.from}`,start:i.from,end:i.to})}while(i.next());return t}const kqlLanguage=LRLanguage.define({parser:parser$1.configure({props:[styleTags({"where project extend sort limit take top distinct summarize join":tags.keyword,let:tags.definitionKeyword,"inner leftouter rightouter fullouter leftanti rightanti leftsemi rightsemi":tags.modifier,"by asc desc on":tags.modifier,"and or not":tags.logicOperator,"contains startswith endswith has in":tags.operatorKeyword,"NotContains NotHas NotIn":tags.operatorKeyword,Pipe:tags.punctuation,ComparisonOp:tags.compareOperator,Plus:tags.arithmeticOperator,Minus:tags.arithmeticOperator,Star:tags.arithmeticOperator,Slash:tags.arithmeticOperator,Percent:tags.arithmeticOperator,Equals:tags.definitionOperator,OpenParen:tags.paren,CloseParen:tags.paren,OpenBracket:tags.squareBracket,CloseBracket:tags.squareBracket,Comma:tags.separator,Semicolon:tags.separator,Number:tags.number,String:tags.string,LineComment:tags.lineComment,"functionName/Identifier":tags.function(tags.variableName),"tableExpression/Identifier":tags.typeName,"columnSpec/Identifier":tags.propertyName,"sortColumn/Identifier":tags.propertyName,"columnNameList/Identifier":tags.propertyName,"aggregation/Identifier":tags.propertyName,"comparison/Identifier":tags.propertyName,"letStatement/Identifier":tags.definition(tags.variableName),Identifier:tags.variableName})]}),languageData:{commentTokens:{line:"//"}}});function kql(){return new LanguageSupport(kqlLanguage)}const colors={light:{queryOperator:"#0000FF",definitionKeyword:"#0000FF",modifier:"#0550ae",logicOperator:"#1F2328",operatorKeyword:"#CE3600",operator:"#CE3600",number:"#0550ae",string:"#B22222",comment:"#6e7781",function:"#8250df",table:"#9932CC",column:"#0550ae",variable:"#1F2328",definition:"#1F2328",punctuation:"#656d76",bracket:"#0550ae",fg:"#1F2328",fgMuted:"#656d76",canvasDefault:"#ffffff",canvasSubtle:"#f6f8fa",borderDefault:"#d0d7de"},dark:{queryOperator:"#569CD6",definitionKeyword:"#569CD6",modifier:"#9CDCFE",logicOperator:"#e6edf3",operatorKeyword:"#4EC9B0",operator:"#4EC9B0",number:"#B5CEA8",string:"#CE9178",comment:"#6A9955",function:"#DCDCAA",table:"#D7BA7D",column:"#9CDCFE",variable:"#e6edf3",definition:"#9CDCFE",punctuation:"#808080",bracket:"#569CD6",fg:"#e6edf3",fgMuted:"#7d8590",canvasDefault:"#0d1117",canvasSubtle:"#161b22",borderDefault:"#30363d"}},kqlLightHighlightStyle=HighlightStyle.define([{tag:tags.keyword,color:colors.light.queryOperator,fontWeight:"bold"},{tag:tags.definitionKeyword,color:colors.light.definitionKeyword,fontWeight:"bold"},{tag:tags.modifier,color:colors.light.modifier},{tag:tags.logicOperator,color:colors.light.logicOperator,fontWeight:"bold"},{tag:tags.operatorKeyword,color:colors.light.operatorKeyword,fontWeight:"bold"},{tag:tags.compareOperator,color:colors.light.operator},{tag:tags.arithmeticOperator,color:colors.light.operator},{tag:tags.operator,color:colors.light.operator},{tag:tags.definitionOperator,color:colors.light.operator},{tag:tags.number,color:colors.light.number},{tag:tags.string,color:colors.light.string},{tag:tags.comment,color:colors.light.comment,fontStyle:"italic"},{tag:tags.function(tags.variableName),color:colors.light.function},{tag:tags.typeName,color:colors.light.table},{tag:tags.propertyName,color:colors.light.column},{tag:tags.variableName,color:colors.light.variable},{tag:tags.definition(tags.variableName),color:colors.light.definition,fontWeight:"bold"},{tag:tags.punctuation,color:colors.light.punctuation},{tag:tags.separator,color:colors.light.punctuation},{tag:tags.paren,color:colors.light.bracket},{tag:tags.squareBracket,color:colors.light.bracket}]),kqlDarkHighlightStyle=HighlightStyle.define([{tag:tags.keyword,color:colors.dark.queryOperator,fontWeight:"bold"},{tag:tags.definitionKeyword,color:colors.dark.definitionKeyword,fontWeight:"bold"},{tag:tags.modifier,color:colors.dark.modifier},{tag:tags.logicOperator,color:colors.dark.logicOperator,fontWeight:"bold"},{tag:tags.operatorKeyword,color:colors.dark.operatorKeyword,fontWeight:"bold"},{tag:tags.compareOperator,color:colors.dark.operator},{tag:tags.arithmeticOperator,color:colors.dark.operator},{tag:tags.operator,color:colors.dark.operator},{tag:tags.definitionOperator,color:colors.dark.operator},{tag:tags.number,color:colors.dark.number},{tag:tags.string,color:colors.dark.string},{tag:tags.comment,color:colors.dark.comment,fontStyle:"italic"},{tag:tags.function(tags.variableName),color:colors.dark.function},{tag:tags.typeName,color:colors.dark.table},{tag:tags.propertyName,color:colors.dark.column},{tag:tags.variableName,color:colors.dark.variable},{tag:tags.definition(tags.variableName),color:colors.dark.definition,fontWeight:"bold"},{tag:tags.punctuation,color:colors.dark.punctuation},{tag:tags.separator,color:colors.dark.punctuation},{tag:tags.paren,color:colors.dark.bracket},{tag:tags.squareBracket,color:colors.dark.bracket}]),kqlLightTheme=[syntaxHighlighting(kqlLightHighlightStyle),EditorView.theme({"&":{backgroundColor:colors.light.canvasDefault,color:colors.light.fg},".cm-cursor":{borderLeftColor:colors.light.fg},".cm-gutters":{backgroundColor:colors.light.canvasSubtle,color:colors.light.fgMuted,borderRight:`1px solid ${colors.light.borderDefault}`},".cm-activeLine":{backgroundColor:"rgba(208, 215, 222, 0.32)"},".cm-activeLineGutter":{backgroundColor:"rgba(208, 215, 222, 0.32)"},".cm-selectionBackground":{backgroundColor:"rgba(9, 105, 218, 0.15)"},"&.cm-focused .cm-selectionBackground":{backgroundColor:"rgba(9, 105, 218, 0.2)"}})],kqlDarkTheme=[syntaxHighlighting(kqlDarkHighlightStyle),EditorView.theme({"&":{backgroundColor:colors.dark.canvasDefault,color:colors.dark.fg},".cm-cursor":{borderLeftColor:colors.dark.fg},".cm-gutters":{backgroundColor:colors.dark.canvasSubtle,color:colors.dark.fgMuted,borderRight:`1px solid ${colors.dark.borderDefault}`},".cm-activeLine":{backgroundColor:"rgba(48, 54, 61, 0.48)"},".cm-activeLineGutter":{backgroundColor:"rgba(48, 54, 61, 0.48)"},".cm-selectionBackground":{backgroundColor:"rgba(47, 129, 247, 0.15)"},"&.cm-focused .cm-selectionBackground":{backgroundColor:"rgba(47, 129, 247, 0.25)"}},{dark:!0})],kqlKeywords=[{label:"where",type:"keyword",info:"Filter a table to the subset of rows that satisfy a predicate."},{label:"project",type:"keyword",info:"Select the columns to include, rename or drop, and insert new computed columns."},{label:"extend",type:"keyword",info:"Create calculated columns and append them to the result set."},{label:"summarize",type:"keyword",info:"Produce a table that aggregates the content of the input table."},{label:"sort by",type:"keyword",info:"Sort the rows of the input table into order by one or more columns."},{label:"order by",type:"keyword",info:"Sort the rows of the input table into order by one or more columns."},{label:"limit",type:"keyword",info:"Return up to the specified number of rows."},{label:"take",type:"keyword",info:"Return up to the specified number of rows."},{label:"top",type:"keyword",info:"Return the first N records sorted by the specified columns."},{label:"distinct",type:"keyword",info:"Produces a table with the distinct combination of the provided columns of the input table."},{label:"count",type:"keyword",info:"Returns the number of records in the input table."},{label:"join",type:"keyword",info:"Merge the rows of two tables to form a new table by matching values of the specified columns from each table."},{label:"union",type:"keyword",info:"Takes two or more tables and returns the rows of all of them."},{label:"mv-expand",type:"keyword",info:"Expands multi-value arrays or property bags into multiple records."},{label:"search",type:"keyword",info:"Search a text pattern in multiple tables and columns."},{label:"let",type:"keyword",info:"Binds a name to an expression."},{label:"print",type:"keyword",info:"Outputs a single row with one or more scalar expressions."},{label:"iff",type:"function",info:"Returns one of two values depending on the evaluation of the predicate."},{label:"now",type:"function",info:"Returns the current UTC clock time.",apply:"now()"},{label:"ago",type:"function",info:"Subtracts the given timespan from the current UTC clock time.",apply:snippet("ago(${1:1h})")},{label:"bin",type:"function",info:"Rounds values down to an integer multiple of a given bin size.",apply:snippet("bin(${1:value}, ${2:roundTo})")},{label:"strcat",type:"function",info:"Concatenates between 1 and 64 arguments.",apply:snippet("strcat(${1:val1}, ${2:val2})")},{label:"substring",type:"function",info:"Extracts a substring from a source string.",apply:snippet("substring(${1:source}, ${2:startingIndex}, ${3:length})")},{label:"tolower",type:"function",info:"Converts a string to lower case.",apply:snippet("tolower(${1:source})")},{label:"toupper",type:"function",info:"Converts a string to upper case.",apply:snippet("toupper(${1:source})")},{label:"contains",type:"keyword"},{label:"has",type:"keyword"},{label:"startswith",type:"keyword"},{label:"endswith",type:"keyword"},{label:"matches regex",type:"keyword"},{label:"in",type:"keyword"},{label:"between",type:"keyword"},{label:"and",type:"keyword"},{label:"or",type:"keyword"},{label:"not",type:"keyword"},{label:"asc",type:"keyword"},{label:"desc",type:"keyword"}],aggregationFunctions=[{label:"count",type:"function",info:"Returns the count of records.",apply:snippet("count()")},{label:"sum",type:"function",info:"Returns the sum of distinct values.",apply:snippet("sum(${1:expr})")},{label:"avg",type:"function",info:"Returns the average of expr.",apply:snippet("avg(${1:expr})")},{label:"min",type:"function",info:"Returns the minimum value.",apply:snippet("min(${1:expr})")},{label:"max",type:"function",info:"Returns the maximum value.",apply:snippet("max(${1:expr})")},{label:"dcount",type:"function",info:"Returns the distinct count.",apply:snippet("dcount(${1:expr})")}];function createKqlCompletion(e){return t=>{const i=t.matchBefore(/\w*/);if(!i||i.from===i.to&&!t.explicit)return null;let n=syntaxTree(t.state).resolveInner(t.pos,-1),r=!1;for(;n;){if("summarizeClause"===n.name){r=!0;break}n=n.parent}const s=e.map(e=>({label:e.name,type:"class",info:`Table with ${e.rowCount} rows`})),o=e.flatMap(e=>e.columns.map(t=>({label:t.name,type:"variable",info:`Column (${t.type}) in ${e.name}`,boost:-1}))),a=Array.from(new Map(o.map(e=>[e.label,e])).values()),l=t.state.doc.toString(),c=/\b([a-zA-Z0-9_]+)\s*=/g,h=[];let u;for(;null!==(u=c.exec(l));)u[1]&&h.push({label:u[1],type:"variable",info:"Calculated column (alias)",boost:0});const d=Array.from(new Map(h.map(e=>[e.label,e])).values()),p=[...kqlKeywords,...s,...a,...d];return r&&p.push(...aggregationFunctions),{from:i.from,options:p}}}const createKqlLinter=e=>t=>{const i=t.state.doc.toString(),n=[],{errors:r}=toParsedAST(i);r.forEach(e=>{n.push({from:e.start,to:e.end,severity:"error",message:e.message,source:"KQL Syntax"})});return syntaxTree(t.state).cursor().iterate(t=>{if("Identifier"===t.name){const r=t.node.parent;if("tableExpression"===r?.name){const r=i.slice(t.from,t.to),s=e.some(e=>e.name===r);s||n.push({from:t.from,to:t.to,severity:"error",message:`Table '${r}' not found in schema`,source:"Semantic Check"})}}}),n};var _tmpl$$2=template("<div style=height:100%;width:100%>");const Editor=e=>{let t;const{theme:i}=useTheme(),{tables:n}=useSchema(),r=new Compartment,s=new Compartment,o=new Compartment;return onMount(()=>{if(!t)return;const a=()=>!!e.onRun&&(e.onRun(),!0),l=new EditorView({doc:e.initialValue||"Events | take 10",extensions:[basicSetup,kql(),o.of(linter(createKqlLinter(n()))),r.of("dark"===i()?kqlDarkTheme:kqlLightTheme),s.of(autocompletion({override:[createKqlCompletion(n())]})),keymap.of([{key:"Mod-Enter",run:a},{key:"Shift-Enter",run:a}]),EditorView.updateListener.of(t=>{t.docChanged&&e.onChange&&e.onChange(t.state.doc.toString())})],parent:t});return createEffect(()=>{l.dispatch({effects:r.reconfigure("dark"===i()?kqlDarkTheme:kqlLightTheme)})}),createEffect(()=>{l.dispatch({effects:s.reconfigure(autocompletion({override:[createKqlCompletion(n())]}))})}),createEffect(()=>{l.dispatch({effects:o.reconfigure(linter(createKqlLinter(n())))})}),()=>{l.destroy()}}),a=_tmpl$$2(),"function"==typeof t?use(t,a):t=a,a;var a};
/**
   * table-core
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function functionalUpdate(e,t){return"function"==typeof e?e(t):e}function makeStateUpdater(e,t){return i=>{t.setState(t=>({...t,[e]:functionalUpdate(i,t[e])}))}}function isFunction(e){return e instanceof Function}function isNumberArray(e){return Array.isArray(e)&&e.every(e=>"number"==typeof e)}function flattenBy(e,t){const i=[],n=e=>{e.forEach(e=>{i.push(e);const r=t(e);null!=r&&r.length&&n(r)})};return n(e),i}function memo$1(e,t,i){let n,r=[];return s=>{let o;i.key&&i.debug&&(o=Date.now());const a=e(s);if(!(a.length!==r.length||a.some((e,t)=>r[t]!==e)))return n;let l;if(r=a,i.key&&i.debug&&(l=Date.now()),n=t(...a),null==i||null==i.onChange||i.onChange(n),i.key&&i.debug&&null!=i&&i.debug()){const e=Math.round(100*(Date.now()-o))/100,t=Math.round(100*(Date.now()-l))/100,n=t/16,r=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c‚è± ${r(t,5)} /${r(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*n,120))}deg 100% 31%);`,null==i?void 0:i.key)}return n}}function getMemoOptions(e,t,i,n){return{debug:()=>{var i;return null!=(i=null==e?void 0:e.debugAll)?i:e[t]},key:!1,onChange:n}}function createCell(e,t,i,n){const r={id:`${t.id}_${i.id}`,row:t,column:i,getValue:()=>t.getValue(n),renderValue:()=>{var t;return null!=(t=r.getValue())?t:e.options.renderFallbackValue},getContext:memo$1(()=>[e,i,t,r],(e,t,i,n)=>({table:e,column:t,row:i,cell:n,getValue:n.getValue,renderValue:n.renderValue}),getMemoOptions(e.options,"debugCells"))};return e._features.forEach(n=>{null==n.createCell||n.createCell(r,i,t,e)},{}),r}function createColumn(e,t,i,n){var r,s;const o={...e._getDefaultColumnDef(),...t},a=o.accessorKey;let l,c=null!=(r=null!=(s=o.id)?s:a?"function"==typeof String.prototype.replaceAll?a.replaceAll(".","_"):a.replace(/\./g,"_"):void 0)?r:"string"==typeof o.header?o.header:void 0;if(o.accessorFn?l=o.accessorFn:a&&(l=a.includes(".")?e=>{let t=e;for(const n of a.split(".")){var i;t=null==(i=t)?void 0:i[n]}return t}:e=>e[o.accessorKey]),!c)throw new Error;let h={id:`${String(c)}`,accessorFn:l,parent:n,depth:i,columnDef:o,columns:[],getFlatColumns:memo$1(()=>[!0],()=>{var e;return[h,...null==(e=h.columns)?void 0:e.flatMap(e=>e.getFlatColumns())]},getMemoOptions(e.options,"debugColumns")),getLeafColumns:memo$1(()=>[e._getOrderColumnsFn()],e=>{var t;if(null!=(t=h.columns)&&t.length){return e(h.columns.flatMap(e=>e.getLeafColumns()))}return[h]},getMemoOptions(e.options,"debugColumns"))};for(const u of e._features)null==u.createColumn||u.createColumn(h,e);return h}const debug="debugHeaders";function createHeader(e,t,i){var n;let r={id:null!=(n=i.id)?n:t.id,column:t,index:i.index,isPlaceholder:!!i.isPlaceholder,placeholderId:i.placeholderId,depth:i.depth,subHeaders:[],colSpan:0,rowSpan:0,headerGroup:null,getLeafHeaders:()=>{const e=[],t=i=>{i.subHeaders&&i.subHeaders.length&&i.subHeaders.map(t),e.push(i)};return t(r),e},getContext:()=>({table:e,header:r,column:t})};return e._features.forEach(t=>{null==t.createHeader||t.createHeader(r,e)}),r}const Headers={createTable:e=>{e.getHeaderGroups=memo$1(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,i,n,r)=>{var s,o;const a=null!=(s=null==n?void 0:n.map(e=>i.find(t=>t.id===e)).filter(Boolean))?s:[],l=null!=(o=null==r?void 0:r.map(e=>i.find(t=>t.id===e)).filter(Boolean))?o:[];return buildHeaderGroups(t,[...a,...i.filter(e=>!(null!=n&&n.includes(e.id)||null!=r&&r.includes(e.id))),...l],e)},getMemoOptions(e.options,debug)),e.getCenterHeaderGroups=memo$1(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(t,i,n,r)=>buildHeaderGroups(t,i=i.filter(e=>!(null!=n&&n.includes(e.id)||null!=r&&r.includes(e.id))),e,"center"),getMemoOptions(e.options,debug)),e.getLeftHeaderGroups=memo$1(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left],(t,i,n)=>{var r;return buildHeaderGroups(t,null!=(r=null==n?void 0:n.map(e=>i.find(t=>t.id===e)).filter(Boolean))?r:[],e,"left")},getMemoOptions(e.options,debug)),e.getRightHeaderGroups=memo$1(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.right],(t,i,n)=>{var r;return buildHeaderGroups(t,null!=(r=null==n?void 0:n.map(e=>i.find(t=>t.id===e)).filter(Boolean))?r:[],e,"right")},getMemoOptions(e.options,debug)),e.getFooterGroups=memo$1(()=>[e.getHeaderGroups()],e=>[...e].reverse(),getMemoOptions(e.options,debug)),e.getLeftFooterGroups=memo$1(()=>[e.getLeftHeaderGroups()],e=>[...e].reverse(),getMemoOptions(e.options,debug)),e.getCenterFooterGroups=memo$1(()=>[e.getCenterHeaderGroups()],e=>[...e].reverse(),getMemoOptions(e.options,debug)),e.getRightFooterGroups=memo$1(()=>[e.getRightHeaderGroups()],e=>[...e].reverse(),getMemoOptions(e.options,debug)),e.getFlatHeaders=memo$1(()=>[e.getHeaderGroups()],e=>e.map(e=>e.headers).flat(),getMemoOptions(e.options,debug)),e.getLeftFlatHeaders=memo$1(()=>[e.getLeftHeaderGroups()],e=>e.map(e=>e.headers).flat(),getMemoOptions(e.options,debug)),e.getCenterFlatHeaders=memo$1(()=>[e.getCenterHeaderGroups()],e=>e.map(e=>e.headers).flat(),getMemoOptions(e.options,debug)),e.getRightFlatHeaders=memo$1(()=>[e.getRightHeaderGroups()],e=>e.map(e=>e.headers).flat(),getMemoOptions(e.options,debug)),e.getCenterLeafHeaders=memo$1(()=>[e.getCenterFlatHeaders()],e=>e.filter(e=>{var t;return!(null!=(t=e.subHeaders)&&t.length)}),getMemoOptions(e.options,debug)),e.getLeftLeafHeaders=memo$1(()=>[e.getLeftFlatHeaders()],e=>e.filter(e=>{var t;return!(null!=(t=e.subHeaders)&&t.length)}),getMemoOptions(e.options,debug)),e.getRightLeafHeaders=memo$1(()=>[e.getRightFlatHeaders()],e=>e.filter(e=>{var t;return!(null!=(t=e.subHeaders)&&t.length)}),getMemoOptions(e.options,debug)),e.getLeafHeaders=memo$1(()=>[e.getLeftHeaderGroups(),e.getCenterHeaderGroups(),e.getRightHeaderGroups()],(e,t,i)=>{var n,r,s,o,a,l;return[...null!=(n=null==(r=e[0])?void 0:r.headers)?n:[],...null!=(s=null==(o=t[0])?void 0:o.headers)?s:[],...null!=(a=null==(l=i[0])?void 0:l.headers)?a:[]].map(e=>e.getLeafHeaders()).flat()},getMemoOptions(e.options,debug))}};function buildHeaderGroups(e,t,i,n){var r,s;let o=0;const a=function(e,t){void 0===t&&(t=1),o=Math.max(o,t),e.filter(e=>e.getIsVisible()).forEach(e=>{var i;null!=(i=e.columns)&&i.length&&a(e.columns,t+1)},0)};a(e);let l=[];const c=(e,t)=>{const r={depth:t,id:[n,`${t}`].filter(Boolean).join("_"),headers:[]},s=[];e.forEach(e=>{const o=[...s].reverse()[0];let a,l=!1;if(e.column.depth===r.depth&&e.column.parent?a=e.column.parent:(a=e.column,l=!0),o&&(null==o?void 0:o.column)===a)o.subHeaders.push(e);else{const r=createHeader(i,a,{id:[n,t,a.id,null==e?void 0:e.id].filter(Boolean).join("_"),isPlaceholder:l,placeholderId:l?`${s.filter(e=>e.column===a).length}`:void 0,depth:t,index:s.length});r.subHeaders.push(e),s.push(r)}r.headers.push(e),e.headerGroup=r}),l.push(r),t>0&&c(s,t-1)},h=t.map((e,t)=>createHeader(i,e,{depth:o,index:t}));c(h,o-1),l.reverse();const u=e=>e.filter(e=>e.column.getIsVisible()).map(e=>{let t=0,i=0,n=[0];e.subHeaders&&e.subHeaders.length?(n=[],u(e.subHeaders).forEach(e=>{let{colSpan:i,rowSpan:r}=e;t+=i,n.push(r)})):t=1;return i+=Math.min(...n),e.colSpan=t,e.rowSpan=i,{colSpan:t,rowSpan:i}});return u(null!=(r=null==(s=l[0])?void 0:s.headers)?r:[]),l}const createRow=(e,t,i,n,r,s,o)=>{let a={id:t,index:n,original:i,depth:r,parentId:o,_valuesCache:{},_uniqueValuesCache:{},getValue:t=>{if(a._valuesCache.hasOwnProperty(t))return a._valuesCache[t];const i=e.getColumn(t);return null!=i&&i.accessorFn?(a._valuesCache[t]=i.accessorFn(a.original,n),a._valuesCache[t]):void 0},getUniqueValues:t=>{if(a._uniqueValuesCache.hasOwnProperty(t))return a._uniqueValuesCache[t];const i=e.getColumn(t);return null!=i&&i.accessorFn?i.columnDef.getUniqueValues?(a._uniqueValuesCache[t]=i.columnDef.getUniqueValues(a.original,n),a._uniqueValuesCache[t]):(a._uniqueValuesCache[t]=[a.getValue(t)],a._uniqueValuesCache[t]):void 0},renderValue:t=>{var i;return null!=(i=a.getValue(t))?i:e.options.renderFallbackValue},subRows:[],getLeafRows:()=>flattenBy(a.subRows,e=>e.subRows),getParentRow:()=>a.parentId?e.getRow(a.parentId,!0):void 0,getParentRows:()=>{let e=[],t=a;for(;;){const i=t.getParentRow();if(!i)break;e.push(i),t=i}return e.reverse()},getAllCells:memo$1(()=>[e.getAllLeafColumns()],t=>t.map(t=>createCell(e,a,t,t.id)),getMemoOptions(e.options,"debugRows")),_getAllCellsByColumnId:memo$1(()=>[a.getAllCells()],e=>e.reduce((e,t)=>(e[t.column.id]=t,e),{}),getMemoOptions(e.options,"debugRows"))};for(let l=0;l<e._features.length;l++){const t=e._features[l];null==t||null==t.createRow||t.createRow(a,e)}return a},ColumnFaceting={createColumn:(e,t)=>{e._getFacetedRowModel=t.options.getFacetedRowModel&&t.options.getFacetedRowModel(t,e.id),e.getFacetedRowModel=()=>e._getFacetedRowModel?e._getFacetedRowModel():t.getPreFilteredRowModel(),e._getFacetedUniqueValues=t.options.getFacetedUniqueValues&&t.options.getFacetedUniqueValues(t,e.id),e.getFacetedUniqueValues=()=>e._getFacetedUniqueValues?e._getFacetedUniqueValues():new Map,e._getFacetedMinMaxValues=t.options.getFacetedMinMaxValues&&t.options.getFacetedMinMaxValues(t,e.id),e.getFacetedMinMaxValues=()=>{if(e._getFacetedMinMaxValues)return e._getFacetedMinMaxValues()}}},includesString=(e,t,i)=>{var n,r;const s=null==i||null==(n=i.toString())?void 0:n.toLowerCase();return Boolean(null==(r=e.getValue(t))||null==(r=r.toString())||null==(r=r.toLowerCase())?void 0:r.includes(s))};includesString.autoRemove=e=>testFalsey(e);const includesStringSensitive=(e,t,i)=>{var n;return Boolean(null==(n=e.getValue(t))||null==(n=n.toString())?void 0:n.includes(i))};includesStringSensitive.autoRemove=e=>testFalsey(e);const equalsString=(e,t,i)=>{var n;return(null==(n=e.getValue(t))||null==(n=n.toString())?void 0:n.toLowerCase())===(null==i?void 0:i.toLowerCase())};equalsString.autoRemove=e=>testFalsey(e);const arrIncludes=(e,t,i)=>{var n;return null==(n=e.getValue(t))?void 0:n.includes(i)};arrIncludes.autoRemove=e=>testFalsey(e);const arrIncludesAll=(e,t,i)=>!i.some(i=>{var n;return!(null!=(n=e.getValue(t))&&n.includes(i))});arrIncludesAll.autoRemove=e=>testFalsey(e)||!(null!=e&&e.length);const arrIncludesSome=(e,t,i)=>i.some(i=>{var n;return null==(n=e.getValue(t))?void 0:n.includes(i)});arrIncludesSome.autoRemove=e=>testFalsey(e)||!(null!=e&&e.length);const equals=(e,t,i)=>e.getValue(t)===i;equals.autoRemove=e=>testFalsey(e);const weakEquals=(e,t,i)=>e.getValue(t)==i;weakEquals.autoRemove=e=>testFalsey(e);const inNumberRange=(e,t,i)=>{let[n,r]=i;const s=e.getValue(t);return s>=n&&s<=r};inNumberRange.resolveFilterValue=e=>{let[t,i]=e,n="number"!=typeof t?parseFloat(t):t,r="number"!=typeof i?parseFloat(i):i,s=null===t||Number.isNaN(n)?-1/0:n,o=null===i||Number.isNaN(r)?1/0:r;if(s>o){const e=s;s=o,o=e}return[s,o]},inNumberRange.autoRemove=e=>testFalsey(e)||testFalsey(e[0])&&testFalsey(e[1]);const filterFns={includesString:includesString,includesStringSensitive:includesStringSensitive,equalsString:equalsString,arrIncludes:arrIncludes,arrIncludesAll:arrIncludesAll,arrIncludesSome:arrIncludesSome,equals:equals,weakEquals:weakEquals,inNumberRange:inNumberRange};function testFalsey(e){return null==e||""===e}const ColumnFiltering={getDefaultColumnDef:()=>({filterFn:"auto"}),getInitialState:e=>({columnFilters:[],...e}),getDefaultOptions:e=>({onColumnFiltersChange:makeStateUpdater("columnFilters",e),filterFromLeafRows:!1,maxLeafRowFilterDepth:100}),createColumn:(e,t)=>{e.getAutoFilterFn=()=>{const i=t.getCoreRowModel().flatRows[0],n=null==i?void 0:i.getValue(e.id);return"string"==typeof n?filterFns.includesString:"number"==typeof n?filterFns.inNumberRange:"boolean"==typeof n||null!==n&&"object"==typeof n?filterFns.equals:Array.isArray(n)?filterFns.arrIncludes:filterFns.weakEquals},e.getFilterFn=()=>{var i,n;return isFunction(e.columnDef.filterFn)?e.columnDef.filterFn:"auto"===e.columnDef.filterFn?e.getAutoFilterFn():null!=(i=null==(n=t.options.filterFns)?void 0:n[e.columnDef.filterFn])?i:filterFns[e.columnDef.filterFn]},e.getCanFilter=()=>{var i,n,r;return(null==(i=e.columnDef.enableColumnFilter)||i)&&(null==(n=t.options.enableColumnFilters)||n)&&(null==(r=t.options.enableFilters)||r)&&!!e.accessorFn},e.getIsFiltered=()=>e.getFilterIndex()>-1,e.getFilterValue=()=>{var i;return null==(i=t.getState().columnFilters)||null==(i=i.find(t=>t.id===e.id))?void 0:i.value},e.getFilterIndex=()=>{var i,n;return null!=(i=null==(n=t.getState().columnFilters)?void 0:n.findIndex(t=>t.id===e.id))?i:-1},e.setFilterValue=i=>{t.setColumnFilters(t=>{const n=e.getFilterFn(),r=null==t?void 0:t.find(t=>t.id===e.id),s=functionalUpdate(i,r?r.value:void 0);var o;if(shouldAutoRemoveFilter(n,s,e))return null!=(o=null==t?void 0:t.filter(t=>t.id!==e.id))?o:[];const a={id:e.id,value:s};var l;return r?null!=(l=null==t?void 0:t.map(t=>t.id===e.id?a:t))?l:[]:null!=t&&t.length?[...t,a]:[a]})}},createRow:(e,t)=>{e.columnFilters={},e.columnFiltersMeta={}},createTable:e=>{e.setColumnFilters=t=>{const i=e.getAllLeafColumns();null==e.options.onColumnFiltersChange||e.options.onColumnFiltersChange(e=>{var n;return null==(n=functionalUpdate(t,e))?void 0:n.filter(e=>{const t=i.find(t=>t.id===e.id);if(t){if(shouldAutoRemoveFilter(t.getFilterFn(),e.value,t))return!1}return!0})})},e.resetColumnFilters=t=>{var i,n;e.setColumnFilters(t?[]:null!=(i=null==(n=e.initialState)?void 0:n.columnFilters)?i:[])},e.getPreFilteredRowModel=()=>e.getCoreRowModel(),e.getFilteredRowModel=()=>(!e._getFilteredRowModel&&e.options.getFilteredRowModel&&(e._getFilteredRowModel=e.options.getFilteredRowModel(e)),e.options.manualFiltering||!e._getFilteredRowModel?e.getPreFilteredRowModel():e._getFilteredRowModel())}};function shouldAutoRemoveFilter(e,t,i){return!(!e||!e.autoRemove)&&e.autoRemove(t,i)||void 0===t||"string"==typeof t&&!t}const sum=(e,t,i)=>i.reduce((t,i)=>{const n=i.getValue(e);return t+("number"==typeof n?n:0)},0),min=(e,t,i)=>{let n;return i.forEach(t=>{const i=t.getValue(e);null!=i&&(n>i||void 0===n&&i>=i)&&(n=i)}),n},max=(e,t,i)=>{let n;return i.forEach(t=>{const i=t.getValue(e);null!=i&&(n<i||void 0===n&&i>=i)&&(n=i)}),n},extent=(e,t,i)=>{let n,r;return i.forEach(t=>{const i=t.getValue(e);null!=i&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)))}),[n,r]},mean=(e,t)=>{let i=0,n=0;if(t.forEach(t=>{let r=t.getValue(e);null!=r&&(r=+r)>=r&&(++i,n+=r)}),i)return n/i},median=(e,t)=>{if(!t.length)return;const i=t.map(t=>t.getValue(e));if(!isNumberArray(i))return;if(1===i.length)return i[0];const n=Math.floor(i.length/2),r=i.sort((e,t)=>e-t);return i.length%2!=0?r[n]:(r[n-1]+r[n])/2},unique=(e,t)=>Array.from(new Set(t.map(t=>t.getValue(e))).values()),uniqueCount=(e,t)=>new Set(t.map(t=>t.getValue(e))).size,count=(e,t)=>t.length,aggregationFns={sum:sum,min:min,max:max,extent:extent,mean:mean,median:median,unique:unique,uniqueCount:uniqueCount,count:count},ColumnGrouping={getDefaultColumnDef:()=>({aggregatedCell:e=>{var t,i;return null!=(t=null==(i=e.getValue())||null==i.toString?void 0:i.toString())?t:null},aggregationFn:"auto"}),getInitialState:e=>({grouping:[],...e}),getDefaultOptions:e=>({onGroupingChange:makeStateUpdater("grouping",e),groupedColumnMode:"reorder"}),createColumn:(e,t)=>{e.toggleGrouping=()=>{t.setGrouping(t=>null!=t&&t.includes(e.id)?t.filter(t=>t!==e.id):[...null!=t?t:[],e.id])},e.getCanGroup=()=>{var i,n;return(null==(i=e.columnDef.enableGrouping)||i)&&(null==(n=t.options.enableGrouping)||n)&&(!!e.accessorFn||!!e.columnDef.getGroupingValue)},e.getIsGrouped=()=>{var i;return null==(i=t.getState().grouping)?void 0:i.includes(e.id)},e.getGroupedIndex=()=>{var i;return null==(i=t.getState().grouping)?void 0:i.indexOf(e.id)},e.getToggleGroupingHandler=()=>{const t=e.getCanGroup();return()=>{t&&e.toggleGrouping()}},e.getAutoAggregationFn=()=>{const i=t.getCoreRowModel().flatRows[0],n=null==i?void 0:i.getValue(e.id);return"number"==typeof n?aggregationFns.sum:"[object Date]"===Object.prototype.toString.call(n)?aggregationFns.extent:void 0},e.getAggregationFn=()=>{var i,n;if(!e)throw new Error;return isFunction(e.columnDef.aggregationFn)?e.columnDef.aggregationFn:"auto"===e.columnDef.aggregationFn?e.getAutoAggregationFn():null!=(i=null==(n=t.options.aggregationFns)?void 0:n[e.columnDef.aggregationFn])?i:aggregationFns[e.columnDef.aggregationFn]}},createTable:e=>{e.setGrouping=t=>null==e.options.onGroupingChange?void 0:e.options.onGroupingChange(t),e.resetGrouping=t=>{var i,n;e.setGrouping(t?[]:null!=(i=null==(n=e.initialState)?void 0:n.grouping)?i:[])},e.getPreGroupedRowModel=()=>e.getFilteredRowModel(),e.getGroupedRowModel=()=>(!e._getGroupedRowModel&&e.options.getGroupedRowModel&&(e._getGroupedRowModel=e.options.getGroupedRowModel(e)),e.options.manualGrouping||!e._getGroupedRowModel?e.getPreGroupedRowModel():e._getGroupedRowModel())},createRow:(e,t)=>{e.getIsGrouped=()=>!!e.groupingColumnId,e.getGroupingValue=i=>{if(e._groupingValuesCache.hasOwnProperty(i))return e._groupingValuesCache[i];const n=t.getColumn(i);return null!=n&&n.columnDef.getGroupingValue?(e._groupingValuesCache[i]=n.columnDef.getGroupingValue(e.original),e._groupingValuesCache[i]):e.getValue(i)},e._groupingValuesCache={}},createCell:(e,t,i,n)=>{e.getIsGrouped=()=>t.getIsGrouped()&&t.id===i.groupingColumnId,e.getIsPlaceholder=()=>!e.getIsGrouped()&&t.getIsGrouped(),e.getIsAggregated=()=>{var t;return!e.getIsGrouped()&&!e.getIsPlaceholder()&&!(null==(t=i.subRows)||!t.length)}}};function orderColumns(e,t,i){if(null==t||!t.length||!i)return e;const n=e.filter(e=>!t.includes(e.id));if("remove"===i)return n;return[...t.map(t=>e.find(e=>e.id===t)).filter(Boolean),...n]}const ColumnOrdering={getInitialState:e=>({columnOrder:[],...e}),getDefaultOptions:e=>({onColumnOrderChange:makeStateUpdater("columnOrder",e)}),createColumn:(e,t)=>{e.getIndex=memo$1(e=>[_getVisibleLeafColumns(t,e)],t=>t.findIndex(t=>t.id===e.id),getMemoOptions(t.options,"debugColumns")),e.getIsFirstColumn=i=>{var n;return(null==(n=_getVisibleLeafColumns(t,i)[0])?void 0:n.id)===e.id},e.getIsLastColumn=i=>{var n;const r=_getVisibleLeafColumns(t,i);return(null==(n=r[r.length-1])?void 0:n.id)===e.id}},createTable:e=>{e.setColumnOrder=t=>null==e.options.onColumnOrderChange?void 0:e.options.onColumnOrderChange(t),e.resetColumnOrder=t=>{var i;e.setColumnOrder(t?[]:null!=(i=e.initialState.columnOrder)?i:[])},e._getOrderColumnsFn=memo$1(()=>[e.getState().columnOrder,e.getState().grouping,e.options.groupedColumnMode],(e,t,i)=>n=>{let r=[];if(null!=e&&e.length){const t=[...e],i=[...n];for(;i.length&&t.length;){const e=t.shift(),n=i.findIndex(t=>t.id===e);n>-1&&r.push(i.splice(n,1)[0])}r=[...r,...i]}else r=n;return orderColumns(r,t,i)},getMemoOptions(e.options,"debugTable"))}},getDefaultColumnPinningState=()=>({left:[],right:[]}),ColumnPinning={getInitialState:e=>({columnPinning:getDefaultColumnPinningState(),...e}),getDefaultOptions:e=>({onColumnPinningChange:makeStateUpdater("columnPinning",e)}),createColumn:(e,t)=>{e.pin=i=>{const n=e.getLeafColumns().map(e=>e.id).filter(Boolean);t.setColumnPinning(e=>{var t,r,s,o,a,l;return"right"===i?{left:(null!=(s=null==e?void 0:e.left)?s:[]).filter(e=>!(null!=n&&n.includes(e))),right:[...(null!=(o=null==e?void 0:e.right)?o:[]).filter(e=>!(null!=n&&n.includes(e))),...n]}:"left"===i?{left:[...(null!=(a=null==e?void 0:e.left)?a:[]).filter(e=>!(null!=n&&n.includes(e))),...n],right:(null!=(l=null==e?void 0:e.right)?l:[]).filter(e=>!(null!=n&&n.includes(e)))}:{left:(null!=(t=null==e?void 0:e.left)?t:[]).filter(e=>!(null!=n&&n.includes(e))),right:(null!=(r=null==e?void 0:e.right)?r:[]).filter(e=>!(null!=n&&n.includes(e)))}})},e.getCanPin=()=>e.getLeafColumns().some(e=>{var i,n,r;return(null==(i=e.columnDef.enablePinning)||i)&&(null==(n=null!=(r=t.options.enableColumnPinning)?r:t.options.enablePinning)||n)}),e.getIsPinned=()=>{const i=e.getLeafColumns().map(e=>e.id),{left:n,right:r}=t.getState().columnPinning,s=i.some(e=>null==n?void 0:n.includes(e)),o=i.some(e=>null==r?void 0:r.includes(e));return s?"left":!!o&&"right"},e.getPinnedIndex=()=>{var i,n;const r=e.getIsPinned();return r?null!=(i=null==(n=t.getState().columnPinning)||null==(n=n[r])?void 0:n.indexOf(e.id))?i:-1:0}},createRow:(e,t)=>{e.getCenterVisibleCells=memo$1(()=>[e._getAllVisibleCells(),t.getState().columnPinning.left,t.getState().columnPinning.right],(e,t,i)=>{const n=[...null!=t?t:[],...null!=i?i:[]];return e.filter(e=>!n.includes(e.column.id))},getMemoOptions(t.options,"debugRows")),e.getLeftVisibleCells=memo$1(()=>[e._getAllVisibleCells(),t.getState().columnPinning.left],(e,t)=>(null!=t?t:[]).map(t=>e.find(e=>e.column.id===t)).filter(Boolean).map(e=>({...e,position:"left"})),getMemoOptions(t.options,"debugRows")),e.getRightVisibleCells=memo$1(()=>[e._getAllVisibleCells(),t.getState().columnPinning.right],(e,t)=>(null!=t?t:[]).map(t=>e.find(e=>e.column.id===t)).filter(Boolean).map(e=>({...e,position:"right"})),getMemoOptions(t.options,"debugRows"))},createTable:e=>{e.setColumnPinning=t=>null==e.options.onColumnPinningChange?void 0:e.options.onColumnPinningChange(t),e.resetColumnPinning=t=>{var i,n;return e.setColumnPinning(t?getDefaultColumnPinningState():null!=(i=null==(n=e.initialState)?void 0:n.columnPinning)?i:getDefaultColumnPinningState())},e.getIsSomeColumnsPinned=t=>{var i;const n=e.getState().columnPinning;var r,s;return t?Boolean(null==(i=n[t])?void 0:i.length):Boolean((null==(r=n.left)?void 0:r.length)||(null==(s=n.right)?void 0:s.length))},e.getLeftLeafColumns=memo$1(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left],(e,t)=>(null!=t?t:[]).map(t=>e.find(e=>e.id===t)).filter(Boolean),getMemoOptions(e.options,"debugColumns")),e.getRightLeafColumns=memo$1(()=>[e.getAllLeafColumns(),e.getState().columnPinning.right],(e,t)=>(null!=t?t:[]).map(t=>e.find(e=>e.id===t)).filter(Boolean),getMemoOptions(e.options,"debugColumns")),e.getCenterLeafColumns=memo$1(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(e,t,i)=>{const n=[...null!=t?t:[],...null!=i?i:[]];return e.filter(e=>!n.includes(e.id))},getMemoOptions(e.options,"debugColumns"))}};function safelyAccessDocument(e){return e||("undefined"!=typeof document?document:null)}const defaultColumnSizing={size:150,minSize:20,maxSize:Number.MAX_SAFE_INTEGER},getDefaultColumnSizingInfoState=()=>({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),ColumnSizing={getDefaultColumnDef:()=>defaultColumnSizing,getInitialState:e=>({columnSizing:{},columnSizingInfo:getDefaultColumnSizingInfoState(),...e}),getDefaultOptions:e=>({columnResizeMode:"onEnd",columnResizeDirection:"ltr",onColumnSizingChange:makeStateUpdater("columnSizing",e),onColumnSizingInfoChange:makeStateUpdater("columnSizingInfo",e)}),createColumn:(e,t)=>{e.getSize=()=>{var i,n,r;const s=t.getState().columnSizing[e.id];return Math.min(Math.max(null!=(i=e.columnDef.minSize)?i:defaultColumnSizing.minSize,null!=(n=null!=s?s:e.columnDef.size)?n:defaultColumnSizing.size),null!=(r=e.columnDef.maxSize)?r:defaultColumnSizing.maxSize)},e.getStart=memo$1(e=>[e,_getVisibleLeafColumns(t,e),t.getState().columnSizing],(t,i)=>i.slice(0,e.getIndex(t)).reduce((e,t)=>e+t.getSize(),0),getMemoOptions(t.options,"debugColumns")),e.getAfter=memo$1(e=>[e,_getVisibleLeafColumns(t,e),t.getState().columnSizing],(t,i)=>i.slice(e.getIndex(t)+1).reduce((e,t)=>e+t.getSize(),0),getMemoOptions(t.options,"debugColumns")),e.resetSize=()=>{t.setColumnSizing(t=>{let{[e.id]:i,...n}=t;return n})},e.getCanResize=()=>{var i,n;return(null==(i=e.columnDef.enableResizing)||i)&&(null==(n=t.options.enableColumnResizing)||n)},e.getIsResizing=()=>t.getState().columnSizingInfo.isResizingColumn===e.id},createHeader:(e,t)=>{e.getSize=()=>{let t=0;const i=e=>{var n;e.subHeaders.length?e.subHeaders.forEach(i):t+=null!=(n=e.column.getSize())?n:0};return i(e),t},e.getStart=()=>{if(e.index>0){const t=e.headerGroup.headers[e.index-1];return t.getStart()+t.getSize()}return 0},e.getResizeHandler=i=>{const n=t.getColumn(e.column.id),r=null==n?void 0:n.getCanResize();return s=>{if(!n||!r)return;if(null==s.persist||s.persist(),isTouchStartEvent(s)&&s.touches&&s.touches.length>1)return;const o=e.getSize(),a=e?e.getLeafHeaders().map(e=>[e.column.id,e.column.getSize()]):[[n.id,n.getSize()]],l=isTouchStartEvent(s)?Math.round(s.touches[0].clientX):s.clientX,c={},h=(e,i)=>{"number"==typeof i&&(t.setColumnSizingInfo(e=>{var n,r;const s="rtl"===t.options.columnResizeDirection?-1:1,o=(i-(null!=(n=null==e?void 0:e.startOffset)?n:0))*s,a=Math.max(o/(null!=(r=null==e?void 0:e.startSize)?r:0),-.999999);return e.columnSizingStart.forEach(e=>{let[t,i]=e;c[t]=Math.round(100*Math.max(i+i*a,0))/100}),{...e,deltaOffset:o,deltaPercentage:a}}),"onChange"!==t.options.columnResizeMode&&"end"!==e||t.setColumnSizing(e=>({...e,...c})))},u=e=>h("move",e),d=e=>{h("end",e),t.setColumnSizingInfo(e=>({...e,isResizingColumn:!1,startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,columnSizingStart:[]}))},p=safelyAccessDocument(i),f={moveHandler:e=>u(e.clientX),upHandler:e=>{null==p||p.removeEventListener("mousemove",f.moveHandler),null==p||p.removeEventListener("mouseup",f.upHandler),d(e.clientX)}},m={moveHandler:e=>(e.cancelable&&(e.preventDefault(),e.stopPropagation()),u(e.touches[0].clientX),!1),upHandler:e=>{var t;null==p||p.removeEventListener("touchmove",m.moveHandler),null==p||p.removeEventListener("touchend",m.upHandler),e.cancelable&&(e.preventDefault(),e.stopPropagation()),d(null==(t=e.touches[0])?void 0:t.clientX)}},g=!!passiveEventSupported()&&{passive:!1};isTouchStartEvent(s)?(null==p||p.addEventListener("touchmove",m.moveHandler,g),null==p||p.addEventListener("touchend",m.upHandler,g)):(null==p||p.addEventListener("mousemove",f.moveHandler,g),null==p||p.addEventListener("mouseup",f.upHandler,g)),t.setColumnSizingInfo(e=>({...e,startOffset:l,startSize:o,deltaOffset:0,deltaPercentage:0,columnSizingStart:a,isResizingColumn:n.id}))}}},createTable:e=>{e.setColumnSizing=t=>null==e.options.onColumnSizingChange?void 0:e.options.onColumnSizingChange(t),e.setColumnSizingInfo=t=>null==e.options.onColumnSizingInfoChange?void 0:e.options.onColumnSizingInfoChange(t),e.resetColumnSizing=t=>{var i;e.setColumnSizing(t?{}:null!=(i=e.initialState.columnSizing)?i:{})},e.resetHeaderSizeInfo=t=>{var i;e.setColumnSizingInfo(t?getDefaultColumnSizingInfoState():null!=(i=e.initialState.columnSizingInfo)?i:getDefaultColumnSizingInfoState())},e.getTotalSize=()=>{var t,i;return null!=(t=null==(i=e.getHeaderGroups()[0])?void 0:i.headers.reduce((e,t)=>e+t.getSize(),0))?t:0},e.getLeftTotalSize=()=>{var t,i;return null!=(t=null==(i=e.getLeftHeaderGroups()[0])?void 0:i.headers.reduce((e,t)=>e+t.getSize(),0))?t:0},e.getCenterTotalSize=()=>{var t,i;return null!=(t=null==(i=e.getCenterHeaderGroups()[0])?void 0:i.headers.reduce((e,t)=>e+t.getSize(),0))?t:0},e.getRightTotalSize=()=>{var t,i;return null!=(t=null==(i=e.getRightHeaderGroups()[0])?void 0:i.headers.reduce((e,t)=>e+t.getSize(),0))?t:0}}};let passiveSupported=null;function passiveEventSupported(){if("boolean"==typeof passiveSupported)return passiveSupported;let e=!1;try{const t={get passive(){return e=!0,!1}},i=()=>{};window.addEventListener("test",i,t),window.removeEventListener("test",i)}catch(t){e=!1}return passiveSupported=e,passiveSupported}function isTouchStartEvent(e){return"touchstart"===e.type}const ColumnVisibility={getInitialState:e=>({columnVisibility:{},...e}),getDefaultOptions:e=>({onColumnVisibilityChange:makeStateUpdater("columnVisibility",e)}),createColumn:(e,t)=>{e.toggleVisibility=i=>{e.getCanHide()&&t.setColumnVisibility(t=>({...t,[e.id]:null!=i?i:!e.getIsVisible()}))},e.getIsVisible=()=>{var i,n;const r=e.columns;return null==(i=r.length?r.some(e=>e.getIsVisible()):null==(n=t.getState().columnVisibility)?void 0:n[e.id])||i},e.getCanHide=()=>{var i,n;return(null==(i=e.columnDef.enableHiding)||i)&&(null==(n=t.options.enableHiding)||n)},e.getToggleVisibilityHandler=()=>t=>{null==e.toggleVisibility||e.toggleVisibility(t.target.checked)}},createRow:(e,t)=>{e._getAllVisibleCells=memo$1(()=>[e.getAllCells(),t.getState().columnVisibility],e=>e.filter(e=>e.column.getIsVisible()),getMemoOptions(t.options,"debugRows")),e.getVisibleCells=memo$1(()=>[e.getLeftVisibleCells(),e.getCenterVisibleCells(),e.getRightVisibleCells()],(e,t,i)=>[...e,...t,...i],getMemoOptions(t.options,"debugRows"))},createTable:e=>{const t=(t,i)=>memo$1(()=>[i(),i().filter(e=>e.getIsVisible()).map(e=>e.id).join("_")],e=>e.filter(e=>null==e.getIsVisible?void 0:e.getIsVisible()),getMemoOptions(e.options,"debugColumns"));e.getVisibleFlatColumns=t(0,()=>e.getAllFlatColumns()),e.getVisibleLeafColumns=t(0,()=>e.getAllLeafColumns()),e.getLeftVisibleLeafColumns=t(0,()=>e.getLeftLeafColumns()),e.getRightVisibleLeafColumns=t(0,()=>e.getRightLeafColumns()),e.getCenterVisibleLeafColumns=t(0,()=>e.getCenterLeafColumns()),e.setColumnVisibility=t=>null==e.options.onColumnVisibilityChange?void 0:e.options.onColumnVisibilityChange(t),e.resetColumnVisibility=t=>{var i;e.setColumnVisibility(t?{}:null!=(i=e.initialState.columnVisibility)?i:{})},e.toggleAllColumnsVisible=t=>{var i;t=null!=(i=t)?i:!e.getIsAllColumnsVisible(),e.setColumnVisibility(e.getAllLeafColumns().reduce((e,i)=>({...e,[i.id]:t||!(null!=i.getCanHide&&i.getCanHide())}),{}))},e.getIsAllColumnsVisible=()=>!e.getAllLeafColumns().some(e=>!(null!=e.getIsVisible&&e.getIsVisible())),e.getIsSomeColumnsVisible=()=>e.getAllLeafColumns().some(e=>null==e.getIsVisible?void 0:e.getIsVisible()),e.getToggleAllColumnsVisibilityHandler=()=>t=>{var i;e.toggleAllColumnsVisible(null==(i=t.target)?void 0:i.checked)}}};function _getVisibleLeafColumns(e,t){return t?"center"===t?e.getCenterVisibleLeafColumns():"left"===t?e.getLeftVisibleLeafColumns():e.getRightVisibleLeafColumns():e.getVisibleLeafColumns()}const GlobalFaceting={createTable:e=>{e._getGlobalFacetedRowModel=e.options.getFacetedRowModel&&e.options.getFacetedRowModel(e,"__global__"),e.getGlobalFacetedRowModel=()=>e.options.manualFiltering||!e._getGlobalFacetedRowModel?e.getPreFilteredRowModel():e._getGlobalFacetedRowModel(),e._getGlobalFacetedUniqueValues=e.options.getFacetedUniqueValues&&e.options.getFacetedUniqueValues(e,"__global__"),e.getGlobalFacetedUniqueValues=()=>e._getGlobalFacetedUniqueValues?e._getGlobalFacetedUniqueValues():new Map,e._getGlobalFacetedMinMaxValues=e.options.getFacetedMinMaxValues&&e.options.getFacetedMinMaxValues(e,"__global__"),e.getGlobalFacetedMinMaxValues=()=>{if(e._getGlobalFacetedMinMaxValues)return e._getGlobalFacetedMinMaxValues()}}},GlobalFiltering={getInitialState:e=>({globalFilter:void 0,...e}),getDefaultOptions:e=>({onGlobalFilterChange:makeStateUpdater("globalFilter",e),globalFilterFn:"auto",getColumnCanGlobalFilter:t=>{var i;const n=null==(i=e.getCoreRowModel().flatRows[0])||null==(i=i._getAllCellsByColumnId()[t.id])?void 0:i.getValue();return"string"==typeof n||"number"==typeof n}}),createColumn:(e,t)=>{e.getCanGlobalFilter=()=>{var i,n,r,s;return(null==(i=e.columnDef.enableGlobalFilter)||i)&&(null==(n=t.options.enableGlobalFilter)||n)&&(null==(r=t.options.enableFilters)||r)&&(null==(s=null==t.options.getColumnCanGlobalFilter?void 0:t.options.getColumnCanGlobalFilter(e))||s)&&!!e.accessorFn}},createTable:e=>{e.getGlobalAutoFilterFn=()=>filterFns.includesString,e.getGlobalFilterFn=()=>{var t,i;const{globalFilterFn:n}=e.options;return isFunction(n)?n:"auto"===n?e.getGlobalAutoFilterFn():null!=(t=null==(i=e.options.filterFns)?void 0:i[n])?t:filterFns[n]},e.setGlobalFilter=t=>{null==e.options.onGlobalFilterChange||e.options.onGlobalFilterChange(t)},e.resetGlobalFilter=t=>{e.setGlobalFilter(t?void 0:e.initialState.globalFilter)}}},RowExpanding={getInitialState:e=>({expanded:{},...e}),getDefaultOptions:e=>({onExpandedChange:makeStateUpdater("expanded",e),paginateExpandedRows:!0}),createTable:e=>{let t=!1,i=!1;e._autoResetExpanded=()=>{var n,r;if(t){if(null!=(n=null!=(r=e.options.autoResetAll)?r:e.options.autoResetExpanded)?n:!e.options.manualExpanding){if(i)return;i=!0,e._queue(()=>{e.resetExpanded(),i=!1})}}else e._queue(()=>{t=!0})},e.setExpanded=t=>null==e.options.onExpandedChange?void 0:e.options.onExpandedChange(t),e.toggleAllRowsExpanded=t=>{(null!=t?t:!e.getIsAllRowsExpanded())?e.setExpanded(!0):e.setExpanded({})},e.resetExpanded=t=>{var i,n;e.setExpanded(t?{}:null!=(i=null==(n=e.initialState)?void 0:n.expanded)?i:{})},e.getCanSomeRowsExpand=()=>e.getPrePaginationRowModel().flatRows.some(e=>e.getCanExpand()),e.getToggleAllRowsExpandedHandler=()=>t=>{null==t.persist||t.persist(),e.toggleAllRowsExpanded()},e.getIsSomeRowsExpanded=()=>{const t=e.getState().expanded;return!0===t||Object.values(t).some(Boolean)},e.getIsAllRowsExpanded=()=>{const t=e.getState().expanded;return"boolean"==typeof t?!0===t:!!Object.keys(t).length&&!e.getRowModel().flatRows.some(e=>!e.getIsExpanded())},e.getExpandedDepth=()=>{let t=0;return(!0===e.getState().expanded?Object.keys(e.getRowModel().rowsById):Object.keys(e.getState().expanded)).forEach(e=>{const i=e.split(".");t=Math.max(t,i.length)}),t},e.getPreExpandedRowModel=()=>e.getSortedRowModel(),e.getExpandedRowModel=()=>(!e._getExpandedRowModel&&e.options.getExpandedRowModel&&(e._getExpandedRowModel=e.options.getExpandedRowModel(e)),e.options.manualExpanding||!e._getExpandedRowModel?e.getPreExpandedRowModel():e._getExpandedRowModel())},createRow:(e,t)=>{e.toggleExpanded=i=>{t.setExpanded(n=>{var r;const s=!0===n||!(null==n||!n[e.id]);let o={};if(!0===n?Object.keys(t.getRowModel().rowsById).forEach(e=>{o[e]=!0}):o=n,i=null!=(r=i)?r:!s,!s&&i)return{...o,[e.id]:!0};if(s&&!i){const{[e.id]:t,...i}=o;return i}return n})},e.getIsExpanded=()=>{var i;const n=t.getState().expanded;return!!(null!=(i=null==t.options.getIsRowExpanded?void 0:t.options.getIsRowExpanded(e))?i:!0===n||(null==n?void 0:n[e.id]))},e.getCanExpand=()=>{var i,n,r;return null!=(i=null==t.options.getRowCanExpand?void 0:t.options.getRowCanExpand(e))?i:(null==(n=t.options.enableExpanding)||n)&&!(null==(r=e.subRows)||!r.length)},e.getIsAllParentsExpanded=()=>{let i=!0,n=e;for(;i&&n.parentId;)n=t.getRow(n.parentId,!0),i=n.getIsExpanded();return i},e.getToggleExpandedHandler=()=>{const t=e.getCanExpand();return()=>{t&&e.toggleExpanded()}}}},defaultPageIndex=0,defaultPageSize=10,getDefaultPaginationState=()=>({pageIndex:defaultPageIndex,pageSize:defaultPageSize}),RowPagination={getInitialState:e=>({...e,pagination:{...getDefaultPaginationState(),...null==e?void 0:e.pagination}}),getDefaultOptions:e=>({onPaginationChange:makeStateUpdater("pagination",e)}),createTable:e=>{let t=!1,i=!1;e._autoResetPageIndex=()=>{var n,r;if(t){if(null!=(n=null!=(r=e.options.autoResetAll)?r:e.options.autoResetPageIndex)?n:!e.options.manualPagination){if(i)return;i=!0,e._queue(()=>{e.resetPageIndex(),i=!1})}}else e._queue(()=>{t=!0})},e.setPagination=t=>null==e.options.onPaginationChange?void 0:e.options.onPaginationChange(e=>functionalUpdate(t,e)),e.resetPagination=t=>{var i;e.setPagination(t?getDefaultPaginationState():null!=(i=e.initialState.pagination)?i:getDefaultPaginationState())},e.setPageIndex=t=>{e.setPagination(i=>{let n=functionalUpdate(t,i.pageIndex);const r=void 0===e.options.pageCount||-1===e.options.pageCount?Number.MAX_SAFE_INTEGER:e.options.pageCount-1;return n=Math.max(0,Math.min(n,r)),{...i,pageIndex:n}})},e.resetPageIndex=t=>{var i,n;e.setPageIndex(t?defaultPageIndex:null!=(i=null==(n=e.initialState)||null==(n=n.pagination)?void 0:n.pageIndex)?i:defaultPageIndex)},e.resetPageSize=t=>{var i,n;e.setPageSize(t?defaultPageSize:null!=(i=null==(n=e.initialState)||null==(n=n.pagination)?void 0:n.pageSize)?i:defaultPageSize)},e.setPageSize=t=>{e.setPagination(e=>{const i=Math.max(1,functionalUpdate(t,e.pageSize)),n=e.pageSize*e.pageIndex,r=Math.floor(n/i);return{...e,pageIndex:r,pageSize:i}})},e.setPageCount=t=>e.setPagination(i=>{var n;let r=functionalUpdate(t,null!=(n=e.options.pageCount)?n:-1);return"number"==typeof r&&(r=Math.max(-1,r)),{...i,pageCount:r}}),e.getPageOptions=memo$1(()=>[e.getPageCount()],e=>{let t=[];return e&&e>0&&(t=[...new Array(e)].fill(null).map((e,t)=>t)),t},getMemoOptions(e.options,"debugTable")),e.getCanPreviousPage=()=>e.getState().pagination.pageIndex>0,e.getCanNextPage=()=>{const{pageIndex:t}=e.getState().pagination,i=e.getPageCount();return-1===i||0!==i&&t<i-1},e.previousPage=()=>e.setPageIndex(e=>e-1),e.nextPage=()=>e.setPageIndex(e=>e+1),e.firstPage=()=>e.setPageIndex(0),e.lastPage=()=>e.setPageIndex(e.getPageCount()-1),e.getPrePaginationRowModel=()=>e.getExpandedRowModel(),e.getPaginationRowModel=()=>(!e._getPaginationRowModel&&e.options.getPaginationRowModel&&(e._getPaginationRowModel=e.options.getPaginationRowModel(e)),e.options.manualPagination||!e._getPaginationRowModel?e.getPrePaginationRowModel():e._getPaginationRowModel()),e.getPageCount=()=>{var t;return null!=(t=e.options.pageCount)?t:Math.ceil(e.getRowCount()/e.getState().pagination.pageSize)},e.getRowCount=()=>{var t;return null!=(t=e.options.rowCount)?t:e.getPrePaginationRowModel().rows.length}}},getDefaultRowPinningState=()=>({top:[],bottom:[]}),RowPinning={getInitialState:e=>({rowPinning:getDefaultRowPinningState(),...e}),getDefaultOptions:e=>({onRowPinningChange:makeStateUpdater("rowPinning",e)}),createRow:(e,t)=>{e.pin=(i,n,r)=>{const s=n?e.getLeafRows().map(e=>{let{id:t}=e;return t}):[],o=r?e.getParentRows().map(e=>{let{id:t}=e;return t}):[],a=new Set([...o,e.id,...s]);t.setRowPinning(e=>{var t,n,r,s,o,l;return"bottom"===i?{top:(null!=(r=null==e?void 0:e.top)?r:[]).filter(e=>!(null!=a&&a.has(e))),bottom:[...(null!=(s=null==e?void 0:e.bottom)?s:[]).filter(e=>!(null!=a&&a.has(e))),...Array.from(a)]}:"top"===i?{top:[...(null!=(o=null==e?void 0:e.top)?o:[]).filter(e=>!(null!=a&&a.has(e))),...Array.from(a)],bottom:(null!=(l=null==e?void 0:e.bottom)?l:[]).filter(e=>!(null!=a&&a.has(e)))}:{top:(null!=(t=null==e?void 0:e.top)?t:[]).filter(e=>!(null!=a&&a.has(e))),bottom:(null!=(n=null==e?void 0:e.bottom)?n:[]).filter(e=>!(null!=a&&a.has(e)))}})},e.getCanPin=()=>{var i;const{enableRowPinning:n,enablePinning:r}=t.options;return"function"==typeof n?n(e):null==(i=null!=n?n:r)||i},e.getIsPinned=()=>{const i=[e.id],{top:n,bottom:r}=t.getState().rowPinning,s=i.some(e=>null==n?void 0:n.includes(e)),o=i.some(e=>null==r?void 0:r.includes(e));return s?"top":!!o&&"bottom"},e.getPinnedIndex=()=>{var i,n;const r=e.getIsPinned();if(!r)return-1;const s=null==(i="top"===r?t.getTopRows():t.getBottomRows())?void 0:i.map(e=>{let{id:t}=e;return t});return null!=(n=null==s?void 0:s.indexOf(e.id))?n:-1}},createTable:e=>{e.setRowPinning=t=>null==e.options.onRowPinningChange?void 0:e.options.onRowPinningChange(t),e.resetRowPinning=t=>{var i,n;return e.setRowPinning(t?getDefaultRowPinningState():null!=(i=null==(n=e.initialState)?void 0:n.rowPinning)?i:getDefaultRowPinningState())},e.getIsSomeRowsPinned=t=>{var i;const n=e.getState().rowPinning;var r,s;return t?Boolean(null==(i=n[t])?void 0:i.length):Boolean((null==(r=n.top)?void 0:r.length)||(null==(s=n.bottom)?void 0:s.length))},e._getPinnedRows=(t,i,n)=>{var r;return(null==(r=e.options.keepPinnedRows)||r?(null!=i?i:[]).map(t=>{const i=e.getRow(t,!0);return i.getIsAllParentsExpanded()?i:null}):(null!=i?i:[]).map(e=>t.find(t=>t.id===e))).filter(Boolean).map(e=>({...e,position:n}))},e.getTopRows=memo$1(()=>[e.getRowModel().rows,e.getState().rowPinning.top],(t,i)=>e._getPinnedRows(t,i,"top"),getMemoOptions(e.options,"debugRows")),e.getBottomRows=memo$1(()=>[e.getRowModel().rows,e.getState().rowPinning.bottom],(t,i)=>e._getPinnedRows(t,i,"bottom"),getMemoOptions(e.options,"debugRows")),e.getCenterRows=memo$1(()=>[e.getRowModel().rows,e.getState().rowPinning.top,e.getState().rowPinning.bottom],(e,t,i)=>{const n=new Set([...null!=t?t:[],...null!=i?i:[]]);return e.filter(e=>!n.has(e.id))},getMemoOptions(e.options,"debugRows"))}},RowSelection={getInitialState:e=>({rowSelection:{},...e}),getDefaultOptions:e=>({onRowSelectionChange:makeStateUpdater("rowSelection",e),enableRowSelection:!0,enableMultiRowSelection:!0,enableSubRowSelection:!0}),createTable:e=>{e.setRowSelection=t=>null==e.options.onRowSelectionChange?void 0:e.options.onRowSelectionChange(t),e.resetRowSelection=t=>{var i;return e.setRowSelection(t?{}:null!=(i=e.initialState.rowSelection)?i:{})},e.toggleAllRowsSelected=t=>{e.setRowSelection(i=>{t=void 0!==t?t:!e.getIsAllRowsSelected();const n={...i},r=e.getPreGroupedRowModel().flatRows;return t?r.forEach(e=>{e.getCanSelect()&&(n[e.id]=!0)}):r.forEach(e=>{delete n[e.id]}),n})},e.toggleAllPageRowsSelected=t=>e.setRowSelection(i=>{const n=void 0!==t?t:!e.getIsAllPageRowsSelected(),r={...i};return e.getRowModel().rows.forEach(t=>{mutateRowIsSelected(r,t.id,n,!0,e)}),r}),e.getPreSelectedRowModel=()=>e.getCoreRowModel(),e.getSelectedRowModel=memo$1(()=>[e.getState().rowSelection,e.getCoreRowModel()],(t,i)=>Object.keys(t).length?selectRowsFn(e,i):{rows:[],flatRows:[],rowsById:{}},getMemoOptions(e.options,"debugTable")),e.getFilteredSelectedRowModel=memo$1(()=>[e.getState().rowSelection,e.getFilteredRowModel()],(t,i)=>Object.keys(t).length?selectRowsFn(e,i):{rows:[],flatRows:[],rowsById:{}},getMemoOptions(e.options,"debugTable")),e.getGroupedSelectedRowModel=memo$1(()=>[e.getState().rowSelection,e.getSortedRowModel()],(t,i)=>Object.keys(t).length?selectRowsFn(e,i):{rows:[],flatRows:[],rowsById:{}},getMemoOptions(e.options,"debugTable")),e.getIsAllRowsSelected=()=>{const t=e.getFilteredRowModel().flatRows,{rowSelection:i}=e.getState();let n=Boolean(t.length&&Object.keys(i).length);return n&&t.some(e=>e.getCanSelect()&&!i[e.id])&&(n=!1),n},e.getIsAllPageRowsSelected=()=>{const t=e.getPaginationRowModel().flatRows.filter(e=>e.getCanSelect()),{rowSelection:i}=e.getState();let n=!!t.length;return n&&t.some(e=>!i[e.id])&&(n=!1),n},e.getIsSomeRowsSelected=()=>{var t;const i=Object.keys(null!=(t=e.getState().rowSelection)?t:{}).length;return i>0&&i<e.getFilteredRowModel().flatRows.length},e.getIsSomePageRowsSelected=()=>{const t=e.getPaginationRowModel().flatRows;return!e.getIsAllPageRowsSelected()&&t.filter(e=>e.getCanSelect()).some(e=>e.getIsSelected()||e.getIsSomeSelected())},e.getToggleAllRowsSelectedHandler=()=>t=>{e.toggleAllRowsSelected(t.target.checked)},e.getToggleAllPageRowsSelectedHandler=()=>t=>{e.toggleAllPageRowsSelected(t.target.checked)}},createRow:(e,t)=>{e.toggleSelected=(i,n)=>{const r=e.getIsSelected();t.setRowSelection(s=>{var o;if(i=void 0!==i?i:!r,e.getCanSelect()&&r===i)return s;const a={...s};return mutateRowIsSelected(a,e.id,i,null==(o=null==n?void 0:n.selectChildren)||o,t),a})},e.getIsSelected=()=>{const{rowSelection:i}=t.getState();return isRowSelected(e,i)},e.getIsSomeSelected=()=>{const{rowSelection:i}=t.getState();return"some"===isSubRowSelected(e,i)},e.getIsAllSubRowsSelected=()=>{const{rowSelection:i}=t.getState();return"all"===isSubRowSelected(e,i)},e.getCanSelect=()=>{var i;return"function"==typeof t.options.enableRowSelection?t.options.enableRowSelection(e):null==(i=t.options.enableRowSelection)||i},e.getCanSelectSubRows=()=>{var i;return"function"==typeof t.options.enableSubRowSelection?t.options.enableSubRowSelection(e):null==(i=t.options.enableSubRowSelection)||i},e.getCanMultiSelect=()=>{var i;return"function"==typeof t.options.enableMultiRowSelection?t.options.enableMultiRowSelection(e):null==(i=t.options.enableMultiRowSelection)||i},e.getToggleSelectedHandler=()=>{const t=e.getCanSelect();return i=>{var n;t&&e.toggleSelected(null==(n=i.target)?void 0:n.checked)}}}},mutateRowIsSelected=(e,t,i,n,r)=>{var s;const o=r.getRow(t,!0);i?(o.getCanMultiSelect()||Object.keys(e).forEach(t=>delete e[t]),o.getCanSelect()&&(e[t]=!0)):delete e[t],n&&null!=(s=o.subRows)&&s.length&&o.getCanSelectSubRows()&&o.subRows.forEach(t=>mutateRowIsSelected(e,t.id,i,n,r))};function selectRowsFn(e,t){const i=e.getState().rowSelection,n=[],r={},s=function(e,t){return e.map(e=>{var t;const o=isRowSelected(e,i);if(o&&(n.push(e),r[e.id]=e),null!=(t=e.subRows)&&t.length&&(e={...e,subRows:s(e.subRows)}),o)return e}).filter(Boolean)};return{rows:s(t.rows),flatRows:n,rowsById:r}}function isRowSelected(e,t){var i;return null!=(i=t[e.id])&&i}function isSubRowSelected(e,t,i){var n;if(null==(n=e.subRows)||!n.length)return!1;let r=!0,s=!1;return e.subRows.forEach(e=>{if((!s||r)&&(e.getCanSelect()&&(isRowSelected(e,t)?s=!0:r=!1),e.subRows&&e.subRows.length)){const i=isSubRowSelected(e,t);"all"===i?s=!0:"some"===i?(s=!0,r=!1):r=!1}}),r?"all":!!s&&"some"}const reSplitAlphaNumeric=/([0-9]+)/gm,alphanumeric=(e,t,i)=>compareAlphanumeric(toString(e.getValue(i)).toLowerCase(),toString(t.getValue(i)).toLowerCase()),alphanumericCaseSensitive=(e,t,i)=>compareAlphanumeric(toString(e.getValue(i)),toString(t.getValue(i))),text=(e,t,i)=>compareBasic(toString(e.getValue(i)).toLowerCase(),toString(t.getValue(i)).toLowerCase()),textCaseSensitive=(e,t,i)=>compareBasic(toString(e.getValue(i)),toString(t.getValue(i))),datetime=(e,t,i)=>{const n=e.getValue(i),r=t.getValue(i);return n>r?1:n<r?-1:0},basic=(e,t,i)=>compareBasic(e.getValue(i),t.getValue(i));function compareBasic(e,t){return e===t?0:e>t?1:-1}function toString(e){return"number"==typeof e?isNaN(e)||e===1/0||e===-1/0?"":String(e):"string"==typeof e?e:""}function compareAlphanumeric(e,t){const i=e.split(reSplitAlphaNumeric).filter(Boolean),n=t.split(reSplitAlphaNumeric).filter(Boolean);for(;i.length&&n.length;){const e=i.shift(),t=n.shift(),r=parseInt(e,10),s=parseInt(t,10),o=[r,s].sort();if(isNaN(o[0])){if(e>t)return 1;if(t>e)return-1}else{if(isNaN(o[1]))return isNaN(r)?-1:1;if(r>s)return 1;if(s>r)return-1}}return i.length-n.length}const sortingFns={alphanumeric:alphanumeric,alphanumericCaseSensitive:alphanumericCaseSensitive,text:text,textCaseSensitive:textCaseSensitive,datetime:datetime,basic:basic},RowSorting={getInitialState:e=>({sorting:[],...e}),getDefaultColumnDef:()=>({sortingFn:"auto",sortUndefined:1}),getDefaultOptions:e=>({onSortingChange:makeStateUpdater("sorting",e),isMultiSortEvent:e=>e.shiftKey}),createColumn:(e,t)=>{e.getAutoSortingFn=()=>{const i=t.getFilteredRowModel().flatRows.slice(10);let n=!1;for(const t of i){const i=null==t?void 0:t.getValue(e.id);if("[object Date]"===Object.prototype.toString.call(i))return sortingFns.datetime;if("string"==typeof i&&(n=!0,i.split(reSplitAlphaNumeric).length>1))return sortingFns.alphanumeric}return n?sortingFns.text:sortingFns.basic},e.getAutoSortDir=()=>{const i=t.getFilteredRowModel().flatRows[0];return"string"==typeof(null==i?void 0:i.getValue(e.id))?"asc":"desc"},e.getSortingFn=()=>{var i,n;if(!e)throw new Error;return isFunction(e.columnDef.sortingFn)?e.columnDef.sortingFn:"auto"===e.columnDef.sortingFn?e.getAutoSortingFn():null!=(i=null==(n=t.options.sortingFns)?void 0:n[e.columnDef.sortingFn])?i:sortingFns[e.columnDef.sortingFn]},e.toggleSorting=(i,n)=>{const r=e.getNextSortingOrder(),s=null!=i;t.setSorting(o=>{const a=null==o?void 0:o.find(t=>t.id===e.id),l=null==o?void 0:o.findIndex(t=>t.id===e.id);let c,h=[],u=s?i:"desc"===r;var d;(c=null!=o&&o.length&&e.getCanMultiSort()&&n?a?"toggle":"add":null!=o&&o.length&&l!==o.length-1?"replace":a?"toggle":"replace","toggle"===c&&(s||r||(c="remove")),"add"===c)?(h=[...o,{id:e.id,desc:u}],h.splice(0,h.length-(null!=(d=t.options.maxMultiSortColCount)?d:Number.MAX_SAFE_INTEGER))):h="toggle"===c?o.map(t=>t.id===e.id?{...t,desc:u}:t):"remove"===c?o.filter(t=>t.id!==e.id):[{id:e.id,desc:u}];return h})},e.getFirstSortDir=()=>{var i,n;return(null!=(i=null!=(n=e.columnDef.sortDescFirst)?n:t.options.sortDescFirst)?i:"desc"===e.getAutoSortDir())?"desc":"asc"},e.getNextSortingOrder=i=>{var n,r;const s=e.getFirstSortDir(),o=e.getIsSorted();return o?!!(o===s||null!=(n=t.options.enableSortingRemoval)&&!n||i&&null!=(r=t.options.enableMultiRemove)&&!r)&&("desc"===o?"asc":"desc"):s},e.getCanSort=()=>{var i,n;return(null==(i=e.columnDef.enableSorting)||i)&&(null==(n=t.options.enableSorting)||n)&&!!e.accessorFn},e.getCanMultiSort=()=>{var i,n;return null!=(i=null!=(n=e.columnDef.enableMultiSort)?n:t.options.enableMultiSort)?i:!!e.accessorFn},e.getIsSorted=()=>{var i;const n=null==(i=t.getState().sorting)?void 0:i.find(t=>t.id===e.id);return!!n&&(n.desc?"desc":"asc")},e.getSortIndex=()=>{var i,n;return null!=(i=null==(n=t.getState().sorting)?void 0:n.findIndex(t=>t.id===e.id))?i:-1},e.clearSorting=()=>{t.setSorting(t=>null!=t&&t.length?t.filter(t=>t.id!==e.id):[])},e.getToggleSortingHandler=()=>{const i=e.getCanSort();return n=>{i&&(null==n.persist||n.persist(),null==e.toggleSorting||e.toggleSorting(void 0,!!e.getCanMultiSort()&&(null==t.options.isMultiSortEvent?void 0:t.options.isMultiSortEvent(n))))}}},createTable:e=>{e.setSorting=t=>null==e.options.onSortingChange?void 0:e.options.onSortingChange(t),e.resetSorting=t=>{var i,n;e.setSorting(t?[]:null!=(i=null==(n=e.initialState)?void 0:n.sorting)?i:[])},e.getPreSortedRowModel=()=>e.getGroupedRowModel(),e.getSortedRowModel=()=>(!e._getSortedRowModel&&e.options.getSortedRowModel&&(e._getSortedRowModel=e.options.getSortedRowModel(e)),e.options.manualSorting||!e._getSortedRowModel?e.getPreSortedRowModel():e._getSortedRowModel())}},builtInFeatures=[Headers,ColumnVisibility,ColumnOrdering,ColumnPinning,ColumnFaceting,ColumnFiltering,GlobalFaceting,GlobalFiltering,RowSorting,ColumnGrouping,RowExpanding,RowPagination,RowPinning,RowSelection,ColumnSizing];function createTable(e){var t,i;const n=[...builtInFeatures,...null!=(t=e._features)?t:[]];let r={_features:n};const s=r._features.reduce((e,t)=>Object.assign(e,null==t.getDefaultOptions?void 0:t.getDefaultOptions(r)),{});let o={...null!=(i=e.initialState)?i:{}};r._features.forEach(e=>{var t;o=null!=(t=null==e.getInitialState?void 0:e.getInitialState(o))?t:o});const a=[];let l=!1;const c={_features:n,options:{...s,...e},initialState:o,_queue:e=>{a.push(e),l||(l=!0,Promise.resolve().then(()=>{for(;a.length;)a.shift()();l=!1}).catch(e=>setTimeout(()=>{throw e})))},reset:()=>{r.setState(r.initialState)},setOptions:e=>{const t=functionalUpdate(e,r.options);var i;r.options=(i=t,r.options.mergeOptions?r.options.mergeOptions(s,i):{...s,...i})},getState:()=>r.options.state,setState:e=>{null==r.options.onStateChange||r.options.onStateChange(e)},_getRowId:(e,t,i)=>{var n;return null!=(n=null==r.options.getRowId?void 0:r.options.getRowId(e,t,i))?n:`${i?[i.id,t].join("."):t}`},getCoreRowModel:()=>(r._getCoreRowModel||(r._getCoreRowModel=r.options.getCoreRowModel(r)),r._getCoreRowModel()),getRowModel:()=>r.getPaginationRowModel(),getRow:(e,t)=>{let i=(t?r.getPrePaginationRowModel():r.getRowModel()).rowsById[e];if(!i&&(i=r.getCoreRowModel().rowsById[e],!i))throw new Error;return i},_getDefaultColumnDef:memo$1(()=>[r.options.defaultColumn],e=>{var t;return e=null!=(t=e)?t:{},{header:e=>{const t=e.header.column.columnDef;return t.accessorKey?t.accessorKey:t.accessorFn?t.id:null},cell:e=>{var t,i;return null!=(t=null==(i=e.renderValue())||null==i.toString?void 0:i.toString())?t:null},...r._features.reduce((e,t)=>Object.assign(e,null==t.getDefaultColumnDef?void 0:t.getDefaultColumnDef()),{}),...e}},getMemoOptions(e,"debugColumns")),_getColumnDefs:()=>r.options.columns,getAllColumns:memo$1(()=>[r._getColumnDefs()],e=>{const t=function(e,i,n){return void 0===n&&(n=0),e.map(e=>{const s=createColumn(r,e,n,i),o=e;return s.columns=o.columns?t(o.columns,s,n+1):[],s})};return t(e)},getMemoOptions(e,"debugColumns")),getAllFlatColumns:memo$1(()=>[r.getAllColumns()],e=>e.flatMap(e=>e.getFlatColumns()),getMemoOptions(e,"debugColumns")),_getAllFlatColumnsById:memo$1(()=>[r.getAllFlatColumns()],e=>e.reduce((e,t)=>(e[t.id]=t,e),{}),getMemoOptions(e,"debugColumns")),getAllLeafColumns:memo$1(()=>[r.getAllColumns(),r._getOrderColumnsFn()],(e,t)=>t(e.flatMap(e=>e.getLeafColumns())),getMemoOptions(e,"debugColumns")),getColumn:e=>r._getAllFlatColumnsById()[e]};Object.assign(r,c);for(let h=0;h<r._features.length;h++){const e=r._features[h];null==e||null==e.createTable||e.createTable(r)}return r}function getCoreRowModel(){return e=>memo$1(()=>[e.options.data],t=>{const i={rows:[],flatRows:[],rowsById:{}},n=function(t,r,s){void 0===r&&(r=0);const o=[];for(let l=0;l<t.length;l++){const c=createRow(e,e._getRowId(t[l],l,s),t[l],l,r,void 0,null==s?void 0:s.id);var a;if(i.flatRows.push(c),i.rowsById[c.id]=c,o.push(c),e.options.getSubRows)c.originalSubRows=e.options.getSubRows(t[l],l),null!=(a=c.originalSubRows)&&a.length&&(c.subRows=n(c.originalSubRows,r+1,c))}return o};return i.rows=n(t),i},getMemoOptions(e.options,"debugTable","getRowModel",()=>e._autoResetPageIndex()))}function getSortedRowModel(){return e=>memo$1(()=>[e.getState().sorting,e.getPreSortedRowModel()],(t,i)=>{if(!i.rows.length||null==t||!t.length)return i;const n=e.getState().sorting,r=[],s=n.filter(t=>{var i;return null==(i=e.getColumn(t.id))?void 0:i.getCanSort()}),o={};s.forEach(t=>{const i=e.getColumn(t.id);i&&(o[t.id]={sortUndefined:i.columnDef.sortUndefined,invertSorting:i.columnDef.invertSorting,sortingFn:i.getSortingFn()})});const a=e=>{const t=e.map(e=>({...e}));return t.sort((e,t)=>{for(let n=0;n<s.length;n+=1){var i;const r=s[n],a=o[r.id],l=a.sortUndefined,c=null!=(i=null==r?void 0:r.desc)&&i;let h=0;if(l){const i=void 0===e.getValue(r.id),n=void 0===t.getValue(r.id);if(i||n){if("first"===l)return i?-1:1;if("last"===l)return i?1:-1;h=i&&n?0:i?l:-l}}if(0===h&&(h=a.sortingFn(e,t,r.id)),0!==h)return c&&(h*=-1),a.invertSorting&&(h*=-1),h}return e.index-t.index}),t.forEach(e=>{var t;r.push(e),null!=(t=e.subRows)&&t.length&&(e.subRows=a(e.subRows))}),t};return{rows:a(i.rows),flatRows:r,rowsById:i.rowsById}},getMemoOptions(e.options,"debugTable","getSortedRowModel",()=>e._autoResetPageIndex()))}const $RAW=Symbol("store-raw"),$NODE=Symbol("store-node"),$HAS=Symbol("store-has"),$SELF=Symbol("store-self");function wrap$1(e){let t=e[$PROXY];if(!t&&(Object.defineProperty(e,$PROXY,{value:t=new Proxy(e,proxyTraps$1)}),!Array.isArray(e))){const i=Object.keys(e),n=Object.getOwnPropertyDescriptors(e);for(let r=0,s=i.length;r<s;r++){const s=i[r];n[s].get&&Object.defineProperty(e,s,{enumerable:n[s].enumerable,get:n[s].get.bind(t)})}}return t}function isWrappable(e){let t;return null!=e&&"object"==typeof e&&(e[$PROXY]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function unwrap(e,t=new Set){let i,n,r,s;if(i=null!=e&&e[$RAW])return i;if(!isWrappable(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let i=0,s=e.length;i<s;i++)r=e[i],(n=unwrap(r,t))!==r&&(e[i]=n)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const i=Object.keys(e),o=Object.getOwnPropertyDescriptors(e);for(let a=0,l=i.length;a<l;a++)s=i[a],o[s].get||(r=e[s],(n=unwrap(r,t))!==r&&(e[s]=n))}return e}function getNodes(e,t){let i=e[t];return i||Object.defineProperty(e,t,{value:i=Object.create(null)}),i}function getNode(e,t,i){if(e[t])return e[t];const[n,r]=createSignal(i,{equals:!1,internal:!0});return n.$=r,e[t]=n}function proxyDescriptor$1(e,t){const i=Reflect.getOwnPropertyDescriptor(e,t);return i&&!i.get&&i.configurable&&t!==$PROXY&&t!==$NODE?(delete i.value,delete i.writable,i.get=()=>e[$PROXY][t],i):i}function trackSelf(e){getListener()&&getNode(getNodes(e,$NODE),$SELF)()}function ownKeys(e){return trackSelf(e),Reflect.ownKeys(e)}const proxyTraps$1={get(e,t,i){if(t===$RAW)return e;if(t===$PROXY)return i;if(t===$TRACK)return trackSelf(e),i;const n=getNodes(e,$NODE),r=n[t];let s=r?r():e[t];if(t===$NODE||t===$HAS||"__proto__"===t)return s;if(!r){const i=Object.getOwnPropertyDescriptor(e,t);!getListener()||"function"==typeof s&&!e.hasOwnProperty(t)||i&&i.get||(s=getNode(n,t,s)())}return isWrappable(s)?wrap$1(s):s},has:(e,t)=>t===$RAW||t===$PROXY||t===$TRACK||t===$NODE||t===$HAS||"__proto__"===t||(getListener()&&getNode(getNodes(e,$HAS),t)(),t in e),set:()=>!0,deleteProperty:()=>!0,ownKeys:ownKeys,getOwnPropertyDescriptor:proxyDescriptor$1};function setProperty(e,t,i,n=!1){if(!n&&e[t]===i)return;const r=e[t],s=e.length;void 0===i?(delete e[t],e[$HAS]&&e[$HAS][t]&&void 0!==r&&e[$HAS][t].$()):(e[t]=i,e[$HAS]&&e[$HAS][t]&&void 0===r&&e[$HAS][t].$());let o,a=getNodes(e,$NODE);if((o=getNode(a,t,r))&&o.$(()=>i),Array.isArray(e)&&e.length!==s){for(let t=e.length;t<s;t++)(o=a[t])&&o.$();(o=getNode(a,"length",s))&&o.$(e.length)}(o=a[$SELF])&&o.$()}function mergeStoreNode(e,t){const i=Object.keys(t);for(let n=0;n<i.length;n+=1){const r=i[n];setProperty(e,r,t[r])}}function updateArray(e,t){if("function"==typeof t&&(t=t(e)),t=unwrap(t),Array.isArray(t)){if(e===t)return;let i=0,n=t.length;for(;i<n;i++){const n=t[i];e[i]!==n&&setProperty(e,i,n)}setProperty(e,"length",n)}else mergeStoreNode(e,t)}function updatePath(e,t,i=[]){let n,r=e;if(t.length>1){n=t.shift();const s=typeof n,o=Array.isArray(e);if(Array.isArray(n)){for(let r=0;r<n.length;r++)updatePath(e,[n[r]].concat(t),i);return}if(o&&"function"===s){for(let r=0;r<e.length;r++)n(e[r],r)&&updatePath(e,[r].concat(t),i);return}if(o&&"object"===s){const{from:r=0,to:s=e.length-1,by:o=1}=n;for(let n=r;n<=s;n+=o)updatePath(e,[n].concat(t),i);return}if(t.length>1)return void updatePath(e[n],t,[n].concat(i));r=e[n],i=[n].concat(i)}let s=t[0];"function"==typeof s&&(s=s(r,i),s===r)||void 0===n&&null==s||(s=unwrap(s),void 0===n||isWrappable(r)&&isWrappable(s)&&!Array.isArray(s)?mergeStoreNode(r,s):setProperty(e,n,s))}function createStore(...[e,t]){const i=unwrap(e||{}),n=Array.isArray(i);return[wrap$1(i),function(...e){batch(()=>{n&&1===e.length?updateArray(i,e[0]):updatePath(i,e)})}]}const $ROOT=Symbol("store-root");function applyState(e,t,i,n,r){const s=t[i];if(e===s)return;const o=Array.isArray(e);if(i!==$ROOT&&(!isWrappable(e)||!isWrappable(s)||o!==Array.isArray(s)||r&&e[r]!==s[r]))return void setProperty(t,i,e);if(o){if(e.length&&s.length&&(!n||r&&e[0]&&null!=e[0][r])){let t,i,o,a,l,c,h,u;for(o=0,a=Math.min(s.length,e.length);o<a&&(s[o]===e[o]||r&&s[o]&&e[o]&&s[o][r]&&s[o][r]===e[o][r]);o++)applyState(e[o],s,o,n,r);const d=new Array(e.length),p=new Map;for(a=s.length-1,l=e.length-1;a>=o&&l>=o&&(s[a]===e[l]||r&&s[a]&&e[l]&&s[a][r]&&s[a][r]===e[l][r]);a--,l--)d[l]=s[a];if(o>l||o>a){for(i=o;i<=l;i++)setProperty(s,i,e[i]);for(;i<e.length;i++)setProperty(s,i,d[i]),applyState(e[i],s,i,n,r);return void(s.length>e.length&&setProperty(s,"length",e.length))}for(h=new Array(l+1),i=l;i>=o;i--)c=e[i],u=r&&c?c[r]:c,t=p.get(u),h[i]=void 0===t?-1:t,p.set(u,i);for(t=o;t<=a;t++)c=s[t],u=r&&c?c[r]:c,i=p.get(u),void 0!==i&&-1!==i&&(d[i]=s[t],i=h[i],p.set(u,i));for(i=o;i<e.length;i++)i in d?(setProperty(s,i,d[i]),applyState(e[i],s,i,n,r)):setProperty(s,i,e[i])}else for(let t=0,i=e.length;t<i;t++)applyState(e[t],s,t,n,r);return void(s.length>e.length&&setProperty(s,"length",e.length))}const a=Object.keys(e);for(let c=0,h=a.length;c<h;c++)applyState(e[a[c]],s,a[c],n,r);const l=Object.keys(s);for(let c=0,h=l.length;c<h;c++)void 0===e[l[c]]&&setProperty(s,l[c],void 0)}function reconcile(e,t={}){const{merge:i,key:n="id"}=t,r=unwrap(e);return e=>{if(!isWrappable(e)||!isWrappable(r))return r;const t=applyState(r,{[$ROOT]:e},$ROOT,i,n);return void 0===t?e:t}}
/**
   * solid-table
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function flexRender(e,t){return e?"function"==typeof e?createComponent(e,t):e:null}function createSolidTable(e){const t=createTable(mergeProps({state:{},onStateChange:()=>{},renderFallbackValue:null,mergeOptions:(e,t)=>mergeProps(e,t)},e)),[i,n]=createStore(t.initialState);return createComputed(()=>{t.setOptions(t=>mergeProps(t,e,{state:mergeProps(i,e.state||{}),onStateChange:t=>{n(t),null==e.onStateChange||e.onStateChange(t)}}))}),t}function memo(e,t,i){let n,r=i.initialDeps??[],s=!0;function o(){var o,a,l;let c;i.key&&(null==(o=i.debug)?void 0:o.call(i))&&(c=Date.now());const h=e();if(!(h.length!==r.length||h.some((e,t)=>r[t]!==e)))return n;let u;if(r=h,i.key&&(null==(a=i.debug)?void 0:a.call(i))&&(u=Date.now()),n=t(...h),i.key&&(null==(l=i.debug)?void 0:l.call(i))){const e=Math.round(100*(Date.now()-c))/100,t=Math.round(100*(Date.now()-u))/100,n=t/16,r=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c‚è± ${r(t,5)} /${r(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*n,120))}deg 100% 31%);`,null==i?void 0:i.key)}return!(null==i?void 0:i.onChange)||s&&i.skipInitialOnChange||i.onChange(n),s=!1,n}return o.updateDeps=e=>{r=e},o}function notUndefined(e,t){if(void 0===e)throw new Error("Unexpected undefined");return e}const approxEqual=(e,t)=>Math.abs(e-t)<1.01,debounce=(e,t,i)=>{let n;return function(...r){e.clearTimeout(n),n=e.setTimeout(()=>t.apply(this,r),i)}},getRect=e=>{const{offsetWidth:t,offsetHeight:i}=e;return{width:t,height:i}},defaultKeyExtractor=e=>e,defaultRangeExtractor=e=>{const t=Math.max(e.startIndex-e.overscan,0),i=Math.min(e.endIndex+e.overscan,e.count-1),n=[];for(let r=t;r<=i;r++)n.push(r);return n},observeElementRect=(e,t)=>{const i=e.scrollElement;if(!i)return;const n=e.targetWindow;if(!n)return;const r=e=>{const{width:i,height:n}=e;t({width:Math.round(i),height:Math.round(n)})};if(r(getRect(i)),!n.ResizeObserver)return()=>{};const s=new n.ResizeObserver(t=>{const n=()=>{const e=t[0];if(null==e?void 0:e.borderBoxSize){const t=e.borderBoxSize[0];if(t)return void r({width:t.inlineSize,height:t.blockSize})}r(getRect(i))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(n):n()});return s.observe(i,{box:"border-box"}),()=>{s.unobserve(i)}},addEventListenerOptions={passive:!0},supportsScrollend="undefined"==typeof window||"onscrollend"in window,observeElementOffset=(e,t)=>{const i=e.scrollElement;if(!i)return;const n=e.targetWindow;if(!n)return;let r=0;const s=e.options.useScrollendEvent&&supportsScrollend?()=>{}:debounce(n,()=>{t(r,!1)},e.options.isScrollingResetDelay),o=n=>()=>{const{horizontal:o,isRtl:a}=e.options;r=o?i.scrollLeft*(a?-1:1):i.scrollTop,s(),t(r,n)},a=o(!0),l=o(!1);l(),i.addEventListener("scroll",a,addEventListenerOptions);const c=e.options.useScrollendEvent&&supportsScrollend;return c&&i.addEventListener("scrollend",l,addEventListenerOptions),()=>{i.removeEventListener("scroll",a),c&&i.removeEventListener("scrollend",l)}},measureElement=(e,t,i)=>{if(null==t?void 0:t.borderBoxSize){const e=t.borderBoxSize[0];if(e){return Math.round(e[i.options.horizontal?"inlineSize":"blockSize"])}}return e[i.options.horizontal?"offsetWidth":"offsetHeight"]},elementScroll=(e,{adjustments:t=0,behavior:i},n)=>{var r,s;const o=e+t;null==(s=null==(r=n.scrollElement)?void 0:r.scrollTo)||s.call(r,{[n.options.horizontal?"left":"top"]:o,behavior:i})};class Virtualizer{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{const t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()})}):null);return{disconnect:()=>{var i;null==(i=t())||i.disconnect(),e=null},observe:e=>{var i;return null==(i=t())?void 0:i.observe(e,{box:"border-box"})},unobserve:e=>{var i;return null==(i=t())?void 0:i.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,i])=>{void 0===i&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:defaultKeyExtractor,rangeExtractor:defaultRangeExtractor,onChange:()=>{},measureElement:measureElement,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var t,i;null==(i=(t=this.options).onChange)||i.call(t,this,e)},this.maybeNotify=memo(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t)return void this.maybeNotify();this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,t)=>{const i=new Map,n=new Map;for(let r=t-1;r>=0;r--){const t=e[r];if(i.has(t.lane))continue;const s=n.get(t.lane);if(null==s||t.end>s.end?n.set(t.lane,t):t.end<s.end&&i.set(t.lane,!0),i.size===this.options.lanes)break}return n.size===this.options.lanes?Array.from(n.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0},this.getMeasurementOptions=memo(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(e,t,i,n,r,s)=>(void 0!==this.prevLanes&&this.prevLanes!==s&&(this.lanesChangedFlag=!0),this.prevLanes=s,this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:i,getItemKey:n,enabled:r,lanes:s}),{key:!1,skipInitialOnChange:!0,onChange:()=>{this.notify(this.isScrolling)}}),this.getMeasurements=memo(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:i,getItemKey:n,enabled:r,lanes:s},o)=>{if(!r)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>e)for(const h of this.laneAssignments.keys())h>=e&&this.laneAssignments.delete(h);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));const a=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===e&&(this.lanesSettling=!1);const l=this.measurementsCache.slice(0,a),c=new Array(s).fill(void 0);for(let h=0;h<a;h++){const e=l[h];e&&(c[e.lane]=h)}for(let h=a;h<e;h++){const e=n(h),r=this.laneAssignments.get(h);let s,a;if(void 0!==r&&this.options.lanes>1){s=r;const e=c[s],n=void 0!==e?l[e]:void 0;a=n?n.end+this.options.gap:t+i}else{const e=1===this.options.lanes?l[h-1]:this.getFurthestMeasurement(l,h);a=e?e.end+this.options.gap:t+i,s=e?e.lane:h%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(h,s)}const u=o.get(e),d="number"==typeof u?u:this.options.estimateSize(h),p=a+d;l[h]={index:h,start:a,size:d,end:p,key:e,lane:s},c[s]=h}return this.measurementsCache=l,l},{key:!1,debug:()=>this.options.debug}),this.calculateRange=memo(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,t,i,n)=>this.range=e.length>0&&t>0?calculateRange({measurements:e,outerSize:t,scrollOffset:i,lanes:n}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=memo(()=>{let e=null,t=null;const i=this.calculateRange();return i&&(e=i.startIndex,t=i.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]},(e,t,i,n,r)=>null===n||null===r?[]:e({startIndex:n,endIndex:r,overscan:t,count:i}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const t=this.options.indexAttribute,i=e.getAttribute(t);return i?parseInt(i,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{const i=this.indexFromElement(e),n=this.measurementsCache[i];if(!n)return;const r=n.key,s=this.elementsCache.get(r);s!==e&&(s&&this.observer.unobserve(s),this.observer.observe(e),this.elementsCache.set(r,e)),e.isConnected&&this.resizeItem(i,this.options.measureElement(e,t,this))},this.resizeItem=(e,t)=>{const i=this.measurementsCache[e];if(!i)return;const n=t-(this.itemSizeCache.get(i.key)??i.size);0!==n&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(i,n,this):i.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=n,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(i.index),this.itemSizeCache=new Map(this.itemSizeCache.set(i.key,t)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))})},this.getVirtualItems=memo(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,t)=>{const i=[];for(let n=0,r=e.length;n<r;n++){const r=t[e[n]];i.push(r)}return i},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const t=this.getMeasurements();if(0!==t.length)return notUndefined(t[findNearestBinarySearch(0,t.length-1,e=>notUndefined(t[e]).start,e)])},this.getOffsetForAlignment=(e,t,i=0)=>{const n=this.getSize(),r=this.getScrollOffset();"auto"===t&&(t=e>=r+n?"end":"start"),"center"===t?e+=(i-n)/2:"end"===t&&(e-=n);const s=this.getTotalSize()+this.options.scrollMargin-n;return Math.max(Math.min(s,e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const i=this.measurementsCache[e];if(!i)return;const n=this.getSize(),r=this.getScrollOffset();if("auto"===t)if(i.end>=r+n-this.options.scrollPaddingEnd)t="end";else{if(!(i.start<=r+this.options.scrollPaddingStart))return[r,t];t="start"}const s="end"===t?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(s,t,i.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:t="start",behavior:i}={})=>{"smooth"===i&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:i})},this.scrollToIndex=(e,{align:t="auto",behavior:i}={})=>{"smooth"===i&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let n=0;const r=t=>{if(!this.targetWindow)return;const n=this.getOffsetForIndex(e,t);if(!n)return void console.warn("Failed to get offset for index:",e);const[r,o]=n;this._scrollToOffset(r,{adjustments:void 0,behavior:i}),this.targetWindow.requestAnimationFrame(()=>{const t=this.getScrollOffset(),i=this.getOffsetForIndex(e,o);i?approxEqual(i[0],t)||s(o):console.warn("Failed to get offset for index:",e)})},s=t=>{this.targetWindow&&(n++,n<10?this.targetWindow.requestAnimationFrame(()=>r(t)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};r(t)},this.scrollBy=(e,{behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;const t=this.getMeasurements();let i;if(0===t.length)i=this.options.paddingStart;else if(1===this.options.lanes)i=(null==(e=t[t.length-1])?void 0:e.end)??0;else{const e=Array(this.options.lanes).fill(null);let n=t.length-1;for(;n>=0&&e.some(e=>null===e);){const i=t[n];null===e[i.lane]&&(e[i.lane]=i.end),n--}i=Math.max(...e.filter(e=>null!==e))}return Math.max(i-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:t,behavior:i})=>{this.options.scrollToFn(e,{behavior:i,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(e)}}const findNearestBinarySearch=(e,t,i,n)=>{for(;e<=t;){const r=(e+t)/2|0,s=i(r);if(s<n)e=r+1;else{if(!(s>n))return r;t=r-1}}return e>0?e-1:0};function calculateRange({measurements:e,outerSize:t,scrollOffset:i,lanes:n}){const r=e.length-1;if(e.length<=n)return{startIndex:0,endIndex:r};let s=findNearestBinarySearch(0,r,t=>e[t].start,i),o=s;if(1===n)for(;o<r&&e[o].end<i+t;)o++;else if(n>1){const a=Array(n).fill(0);for(;o<r&&a.some(e=>e<i+t);){const t=e[o];a[t.lane]=t.end,o++}const l=Array(n).fill(i+t);for(;s>=0&&l.some(e=>e>=i);){const t=e[s];l[t.lane]=t.start,s--}s=Math.max(0,s-s%n),o=Math.min(r,o+(n-1-o%n))}return{startIndex:s,endIndex:o}}function createVirtualizerBase(e){const t=mergeProps(e),i=new Virtualizer(t),[n,r]=createStore(i.getVirtualItems()),[s,o]=createSignal(i.getTotalSize()),a=new Proxy(i,{get(e,t){switch(t){case"getVirtualItems":return()=>n;case"getTotalSize":return()=>s();default:return Reflect.get(e,t)}}});return a.setOptions(t),onMount(()=>{const e=a._didMount();a._willUpdate(),onCleanup(e)}),createComputed(()=>{a.setOptions(mergeProps(t,e,{onChange:(t,i)=>{var n;t._willUpdate(),r(reconcile(t.getVirtualItems(),{key:"index"})),o(t.getTotalSize()),null==(n=e.onChange)||n.call(e,t,i)}})),a.measure()}),a}function createVirtualizer(e){return createVirtualizerBase(mergeProps({observeElementRect:observeElementRect,observeElementOffset:observeElementOffset,scrollToFn:elementScroll},e))}var _tmpl$$1=template("<div class=table-container style=height:100%;overflow:auto;position:relative><table style=width:100%;border-collapse:collapse><thead style=position:sticky;top:0;z-index:1;background:var(--bg-secondary)></thead><tbody>"),_tmpl$2$1=template("<tr>"),_tmpl$3=template('<th style="padding:0.5rem 1rem;font-weight:bold;white-space:nowrap;text-align:left;border-bottom:1px solid var(--border-color);min-width:100px;max-width:250px;overflow:hidden;text-overflow:ellipsis">'),_tmpl$4=template("<tr><td>"),_tmpl$5=template('<td title style="padding:0.5rem 1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:250px;cursor:pointer">'),_tmpl$6=template('<div style="position:fixed;max-width:400px;max-height:200px;overflow:auto;padding:0.75rem;background:var(--bg-primary);border:1px solid var(--border-color);border-radius:4px;box-shadow:0 4px 12px rgba(0,0,0,0.15);z-index:1000;white-space:pre-wrap;word-break:break-all;font-family:monospace;font-size:0.875rem"><button style="position:absolute;top:4px;right:4px;background:none;border:none;cursor:pointer;padding:2px 6px;font-size:0.75rem;color:var(--text-secondary)">‚úï</button><div style=margin-top:0.5rem>');const ResultsTable=e=>{const[t,i]=createSignal([]),[n,r]=createSignal(null);let s;const o=createMemo(()=>{if(!e.data||0===e.data.length)return[];const t=e.data[0];return Object.keys(t).map(e=>({accessorKey:e,header:e,cell:e=>{const t=e.getValue();return"bigint"==typeof t?t.toString():t}}))}),a=createSolidTable({get data(){return e.data},get columns(){return o()},state:{get sorting(){return t()}},onSortingChange:i,getCoreRowModel:getCoreRowModel(),getSortedRowModel:getSortedRowModel()}),l=createMemo(()=>a.getRowModel().rows),c=createMemo(()=>a.getHeaderGroups()),h=createVirtualizer({get count(){return l().length},getScrollElement:()=>s??null,estimateSize:()=>35,overscan:10}),u=()=>h.getVirtualItems(),d=()=>r(null);return(()=>{var e=_tmpl$$1(),t=e.firstChild.firstChild,i=t.nextSibling;e.$$click=e=>{e.target.closest("td")||d()};var o,a;return"function"==typeof s?use(s,e):s=e,insert$1(t,createComponent(For,{get each(){return c()},children:e=>{return insert$1(t=_tmpl$2$1(),createComponent(For,{get each(){return e.headers},children:e=>{return addEventListener(t=_tmpl$3(),"click",e.column.getToggleSortingHandler()),insert$1(t,()=>flexRender(e.column.columnDef.header,e.getContext()),null),insert$1(t,()=>({asc:" üîº",desc:" üîΩ"}[e.column.getIsSorted()]??null),null),createRenderEffect(i=>setStyleProperty(t,"cursor",e.column.getCanSort()?"pointer":"default")),t;var t}})),t;var t}})),insert$1(i,(o=memo$2(()=>u().length>0),()=>{return o()&&(e=_tmpl$4(),t=e.firstChild,createRenderEffect(e=>{var i=`${u()[0]?.start??0}px`,n=c()[0]?.headers.length||1;return i!==e.e&&setStyleProperty(t,"height",e.e=i),n!==e.t&&setAttribute(t,"colspan",e.t=n),e},{e:void 0,t:void 0}),e);var e,t}),null),insert$1(i,createComponent(For,{get each(){return u()},children:e=>{const t=l()[e.index],i=e.index%2==0;return setStyleProperty(s=_tmpl$2$1(),"background-color",i?"var(--bg-primary)":"var(--bg-secondary)"),insert$1(s,createComponent(For,{get each(){return t.getVisibleCells()},children:e=>{const t=e.getValue();return(i=_tmpl$5()).$$click=e=>((e,t)=>{const i=e.currentTarget,s=String(t??"");if(i.scrollWidth<=i.clientWidth)return;const o=n();if(o&&o.content===s)return void r(null);const a=i.getBoundingClientRect();r({content:s,x:a.left,y:a.bottom+4})})(e,t),insert$1(i,()=>flexRender(e.column.columnDef.cell,e.getContext())),i;var i}})),createRenderEffect(t=>setStyleProperty(s,"height",`${e.size}px`)),s;var s}}),null),insert$1(i,(a=memo$2(()=>u().length>0),()=>{return a()&&(e=_tmpl$4(),t=e.firstChild,createRenderEffect(e=>{var i=h.getTotalSize()-(u()[u().length-1]?.end??0)+"px",n=c()[0]?.headers.length||1;return i!==e.e&&setStyleProperty(t,"height",e.e=i),n!==e.t&&setAttribute(t,"colspan",e.t=n),e},{e:void 0,t:void 0}),e);var e,t}),null),insert$1(e,createComponent(Show,{get when(){return n()},children:e=>{return t=_tmpl$6(),i=t.firstChild,n=i.nextSibling,i.$$click=d,insert$1(n,()=>e().content),createRenderEffect(i=>{var n=`${e().x}px`,r=`${e().y}px`;return n!==i.e&&setStyleProperty(t,"left",i.e=n),r!==i.t&&setStyleProperty(t,"top",i.t=r),i},{e:void 0,t:void 0}),t;var t,i,n}}),null),e})()};delegateEvents(["click"]);const scriptRel="modulepreload",assetsURL=function(e){return"/"+e},seen={},__vitePreload=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),i=e?.nonce||e?.getAttribute("nonce");n=Promise.allSettled(t.map(e=>{if((e=assetsURL(e))in seen)return;seen[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":scriptRel,t||(r.as="script"),r.crossOrigin="",r.href=e,i&&r.setAttribute("nonce",i),document.head.appendChild(r),t?new Promise((t,i)=>{r.addEventListener("load",t),r.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})};var __defProp=Object.defineProperty,__name=(e,t)=>__defProp(e,"name",{value:t,configurable:!0}),SIZE_OF_SHORT=2,SIZE_OF_INT=4,SIZE_OF_CURSOR=4*SIZE_OF_INT,SIZE_OF_NODE=5*SIZE_OF_INT,SIZE_OF_POINT=2*SIZE_OF_INT,SIZE_OF_RANGE=2*SIZE_OF_INT+2*SIZE_OF_POINT,ZERO_POINT={row:0,column:0},INTERNAL=Symbol("INTERNAL"),C;function assertInternal(e){if(e!==INTERNAL)throw new Error("Illegal constructor")}function isPoint(e){return!!e&&"number"==typeof e.row&&"number"==typeof e.column}function setModule(e){C=e}__name(assertInternal,"assertInternal"),__name(isPoint,"isPoint"),__name(setModule,"setModule");var LookaheadIterator=class{static{__name(this,"LookaheadIterator")}0=0;language;constructor(e,t,i){assertInternal(e),this[0]=t,this.language=i}get currentTypeId(){return C._ts_lookahead_iterator_current_symbol(this[0])}get currentType(){return this.language.types[this.currentTypeId]||"ERROR"}delete(){C._ts_lookahead_iterator_delete(this[0]),this[0]=0}reset(e,t){return!!C._ts_lookahead_iterator_reset(this[0],e[0],t)&&(this.language=e,!0)}resetState(e){return Boolean(C._ts_lookahead_iterator_reset_state(this[0],e))}[Symbol.iterator](){return{next:__name(()=>C._ts_lookahead_iterator_next(this[0])?{done:!1,value:this.currentType}:{done:!0,value:""},"next")}}};function getText(e,t,i,n){const r=i-t;let s=e.textCallback(t,n);if(s){for(t+=s.length;t<i;){const i=e.textCallback(t,n);if(!(i&&i.length>0))break;t+=i.length,s+=i}t>i&&(s=s.slice(0,r))}return s??""}__name(getText,"getText");var Tree=class e{static{__name(this,"Tree")}0=0;textCallback;language;constructor(e,t,i,n){assertInternal(e),this[0]=t,this.language=i,this.textCallback=n}copy(){const t=C._ts_tree_copy(this[0]);return new e(INTERNAL,t,this.language,this.textCallback)}delete(){C._ts_tree_delete(this[0]),this[0]=0}get rootNode(){return C._ts_tree_root_node_wasm(this[0]),unmarshalNode(this)}rootNodeWithOffset(e,t){const i=TRANSFER_BUFFER+SIZE_OF_NODE;return C.setValue(i,e,"i32"),marshalPoint(i+SIZE_OF_INT,t),C._ts_tree_root_node_with_offset_wasm(this[0]),unmarshalNode(this)}edit(e){marshalEdit(e),C._ts_tree_edit_wasm(this[0])}walk(){return this.rootNode.walk()}getChangedRanges(t){if(!(t instanceof e))throw new TypeError("Argument must be a Tree");C._ts_tree_get_changed_ranges_wasm(this[0],t[0]);const i=C.getValue(TRANSFER_BUFFER,"i32"),n=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),r=new Array(i);if(i>0){let e=n;for(let t=0;t<i;t++)r[t]=unmarshalRange(e),e+=SIZE_OF_RANGE;C._free(n)}return r}getIncludedRanges(){C._ts_tree_included_ranges_wasm(this[0]);const e=C.getValue(TRANSFER_BUFFER,"i32"),t=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),i=new Array(e);if(e>0){let n=t;for(let t=0;t<e;t++)i[t]=unmarshalRange(n),n+=SIZE_OF_RANGE;C._free(t)}return i}},TreeCursor=class e{static{__name(this,"TreeCursor")}0=0;1=0;2=0;3=0;tree;constructor(e,t){assertInternal(e),this.tree=t,unmarshalTreeCursor(this)}copy(){const t=new e(INTERNAL,this.tree);return C._ts_tree_cursor_copy_wasm(this.tree[0]),unmarshalTreeCursor(t),t}delete(){marshalTreeCursor(this),C._ts_tree_cursor_delete_wasm(this.tree[0]),this[0]=this[1]=this[2]=0}get currentNode(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_wasm(this.tree[0]),unmarshalNode(this.tree)}get currentFieldId(){return marshalTreeCursor(this),C._ts_tree_cursor_current_field_id_wasm(this.tree[0])}get currentFieldName(){return this.tree.language.fields[this.currentFieldId]}get currentDepth(){return marshalTreeCursor(this),C._ts_tree_cursor_current_depth_wasm(this.tree[0])}get currentDescendantIndex(){return marshalTreeCursor(this),C._ts_tree_cursor_current_descendant_index_wasm(this.tree[0])}get nodeType(){return this.tree.language.types[this.nodeTypeId]||"ERROR"}get nodeTypeId(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_type_id_wasm(this.tree[0])}get nodeStateId(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_state_id_wasm(this.tree[0])}get nodeId(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_id_wasm(this.tree[0])}get nodeIsNamed(){return marshalTreeCursor(this),1===C._ts_tree_cursor_current_node_is_named_wasm(this.tree[0])}get nodeIsMissing(){return marshalTreeCursor(this),1===C._ts_tree_cursor_current_node_is_missing_wasm(this.tree[0])}get nodeText(){marshalTreeCursor(this);const e=C._ts_tree_cursor_start_index_wasm(this.tree[0]),t=C._ts_tree_cursor_end_index_wasm(this.tree[0]);C._ts_tree_cursor_start_position_wasm(this.tree[0]);const i=unmarshalPoint(TRANSFER_BUFFER);return getText(this.tree,e,t,i)}get startPosition(){return marshalTreeCursor(this),C._ts_tree_cursor_start_position_wasm(this.tree[0]),unmarshalPoint(TRANSFER_BUFFER)}get endPosition(){return marshalTreeCursor(this),C._ts_tree_cursor_end_position_wasm(this.tree[0]),unmarshalPoint(TRANSFER_BUFFER)}get startIndex(){return marshalTreeCursor(this),C._ts_tree_cursor_start_index_wasm(this.tree[0])}get endIndex(){return marshalTreeCursor(this),C._ts_tree_cursor_end_index_wasm(this.tree[0])}gotoFirstChild(){marshalTreeCursor(this);const e=C._ts_tree_cursor_goto_first_child_wasm(this.tree[0]);return unmarshalTreeCursor(this),1===e}gotoLastChild(){marshalTreeCursor(this);const e=C._ts_tree_cursor_goto_last_child_wasm(this.tree[0]);return unmarshalTreeCursor(this),1===e}gotoParent(){marshalTreeCursor(this);const e=C._ts_tree_cursor_goto_parent_wasm(this.tree[0]);return unmarshalTreeCursor(this),1===e}gotoNextSibling(){marshalTreeCursor(this);const e=C._ts_tree_cursor_goto_next_sibling_wasm(this.tree[0]);return unmarshalTreeCursor(this),1===e}gotoPreviousSibling(){marshalTreeCursor(this);const e=C._ts_tree_cursor_goto_previous_sibling_wasm(this.tree[0]);return unmarshalTreeCursor(this),1===e}gotoDescendant(e){marshalTreeCursor(this),C._ts_tree_cursor_goto_descendant_wasm(this.tree[0],e),unmarshalTreeCursor(this)}gotoFirstChildForIndex(e){marshalTreeCursor(this),C.setValue(TRANSFER_BUFFER+SIZE_OF_CURSOR,e,"i32");const t=C._ts_tree_cursor_goto_first_child_for_index_wasm(this.tree[0]);return unmarshalTreeCursor(this),1===t}gotoFirstChildForPosition(e){marshalTreeCursor(this),marshalPoint(TRANSFER_BUFFER+SIZE_OF_CURSOR,e);const t=C._ts_tree_cursor_goto_first_child_for_position_wasm(this.tree[0]);return unmarshalTreeCursor(this),1===t}reset(e){marshalNode(e),marshalTreeCursor(this,TRANSFER_BUFFER+SIZE_OF_NODE),C._ts_tree_cursor_reset_wasm(this.tree[0]),unmarshalTreeCursor(this)}resetTo(e){marshalTreeCursor(this,TRANSFER_BUFFER),marshalTreeCursor(e,TRANSFER_BUFFER+SIZE_OF_CURSOR),C._ts_tree_cursor_reset_to_wasm(this.tree[0],e.tree[0]),unmarshalTreeCursor(this)}},Node=class{static{__name(this,"Node")}0=0;_children;_namedChildren;constructor(e,{id:t,tree:i,startIndex:n,startPosition:r,other:s}){assertInternal(e),this[0]=s,this.id=t,this.tree=i,this.startIndex=n,this.startPosition=r}id;startIndex;startPosition;tree;get typeId(){return marshalNode(this),C._ts_node_symbol_wasm(this.tree[0])}get grammarId(){return marshalNode(this),C._ts_node_grammar_symbol_wasm(this.tree[0])}get type(){return this.tree.language.types[this.typeId]||"ERROR"}get grammarType(){return this.tree.language.types[this.grammarId]||"ERROR"}get isNamed(){return marshalNode(this),1===C._ts_node_is_named_wasm(this.tree[0])}get isExtra(){return marshalNode(this),1===C._ts_node_is_extra_wasm(this.tree[0])}get isError(){return marshalNode(this),1===C._ts_node_is_error_wasm(this.tree[0])}get isMissing(){return marshalNode(this),1===C._ts_node_is_missing_wasm(this.tree[0])}get hasChanges(){return marshalNode(this),1===C._ts_node_has_changes_wasm(this.tree[0])}get hasError(){return marshalNode(this),1===C._ts_node_has_error_wasm(this.tree[0])}get endIndex(){return marshalNode(this),C._ts_node_end_index_wasm(this.tree[0])}get endPosition(){return marshalNode(this),C._ts_node_end_point_wasm(this.tree[0]),unmarshalPoint(TRANSFER_BUFFER)}get text(){return getText(this.tree,this.startIndex,this.endIndex,this.startPosition)}get parseState(){return marshalNode(this),C._ts_node_parse_state_wasm(this.tree[0])}get nextParseState(){return marshalNode(this),C._ts_node_next_parse_state_wasm(this.tree[0])}equals(e){return this.tree===e.tree&&this.id===e.id}child(e){return marshalNode(this),C._ts_node_child_wasm(this.tree[0],e),unmarshalNode(this.tree)}namedChild(e){return marshalNode(this),C._ts_node_named_child_wasm(this.tree[0],e),unmarshalNode(this.tree)}childForFieldId(e){return marshalNode(this),C._ts_node_child_by_field_id_wasm(this.tree[0],e),unmarshalNode(this.tree)}childForFieldName(e){const t=this.tree.language.fields.indexOf(e);return-1!==t?this.childForFieldId(t):null}fieldNameForChild(e){marshalNode(this);const t=C._ts_node_field_name_for_child_wasm(this.tree[0],e);return t?C.AsciiToString(t):null}fieldNameForNamedChild(e){marshalNode(this);const t=C._ts_node_field_name_for_named_child_wasm(this.tree[0],e);return t?C.AsciiToString(t):null}childrenForFieldName(e){const t=this.tree.language.fields.indexOf(e);return-1!==t&&0!==t?this.childrenForFieldId(t):[]}childrenForFieldId(e){marshalNode(this),C._ts_node_children_by_field_id_wasm(this.tree[0],e);const t=C.getValue(TRANSFER_BUFFER,"i32"),i=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),n=new Array(t);if(t>0){let e=i;for(let i=0;i<t;i++)n[i]=unmarshalNode(this.tree,e),e+=SIZE_OF_NODE;C._free(i)}return n}firstChildForIndex(e){marshalNode(this);const t=TRANSFER_BUFFER+SIZE_OF_NODE;return C.setValue(t,e,"i32"),C._ts_node_first_child_for_byte_wasm(this.tree[0]),unmarshalNode(this.tree)}firstNamedChildForIndex(e){marshalNode(this);const t=TRANSFER_BUFFER+SIZE_OF_NODE;return C.setValue(t,e,"i32"),C._ts_node_first_named_child_for_byte_wasm(this.tree[0]),unmarshalNode(this.tree)}get childCount(){return marshalNode(this),C._ts_node_child_count_wasm(this.tree[0])}get namedChildCount(){return marshalNode(this),C._ts_node_named_child_count_wasm(this.tree[0])}get firstChild(){return this.child(0)}get firstNamedChild(){return this.namedChild(0)}get lastChild(){return this.child(this.childCount-1)}get lastNamedChild(){return this.namedChild(this.namedChildCount-1)}get children(){if(!this._children){marshalNode(this),C._ts_node_children_wasm(this.tree[0]);const e=C.getValue(TRANSFER_BUFFER,"i32"),t=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32");if(this._children=new Array(e),e>0){let i=t;for(let t=0;t<e;t++)this._children[t]=unmarshalNode(this.tree,i),i+=SIZE_OF_NODE;C._free(t)}}return this._children}get namedChildren(){if(!this._namedChildren){marshalNode(this),C._ts_node_named_children_wasm(this.tree[0]);const e=C.getValue(TRANSFER_BUFFER,"i32"),t=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32");if(this._namedChildren=new Array(e),e>0){let i=t;for(let t=0;t<e;t++)this._namedChildren[t]=unmarshalNode(this.tree,i),i+=SIZE_OF_NODE;C._free(t)}}return this._namedChildren}descendantsOfType(e,t=ZERO_POINT,i=ZERO_POINT){Array.isArray(e)||(e=[e]);const n=[],r=this.tree.language.types;for(const c of e)"ERROR"==c&&n.push(65535);for(let c=0,h=r.length;c<h;c++)e.includes(r[c])&&n.push(c);const s=C._malloc(SIZE_OF_INT*n.length);for(let c=0,h=n.length;c<h;c++)C.setValue(s+c*SIZE_OF_INT,n[c],"i32");marshalNode(this),C._ts_node_descendants_of_type_wasm(this.tree[0],s,n.length,t.row,t.column,i.row,i.column);const o=C.getValue(TRANSFER_BUFFER,"i32"),a=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),l=new Array(o);if(o>0){let e=a;for(let t=0;t<o;t++)l[t]=unmarshalNode(this.tree,e),e+=SIZE_OF_NODE}return C._free(a),C._free(s),l}get nextSibling(){return marshalNode(this),C._ts_node_next_sibling_wasm(this.tree[0]),unmarshalNode(this.tree)}get previousSibling(){return marshalNode(this),C._ts_node_prev_sibling_wasm(this.tree[0]),unmarshalNode(this.tree)}get nextNamedSibling(){return marshalNode(this),C._ts_node_next_named_sibling_wasm(this.tree[0]),unmarshalNode(this.tree)}get previousNamedSibling(){return marshalNode(this),C._ts_node_prev_named_sibling_wasm(this.tree[0]),unmarshalNode(this.tree)}get descendantCount(){return marshalNode(this),C._ts_node_descendant_count_wasm(this.tree[0])}get parent(){return marshalNode(this),C._ts_node_parent_wasm(this.tree[0]),unmarshalNode(this.tree)}childWithDescendant(e){return marshalNode(this),marshalNode(e,1),C._ts_node_child_with_descendant_wasm(this.tree[0]),unmarshalNode(this.tree)}descendantForIndex(e,t=e){if("number"!=typeof e||"number"!=typeof t)throw new Error("Arguments must be numbers");marshalNode(this);const i=TRANSFER_BUFFER+SIZE_OF_NODE;return C.setValue(i,e,"i32"),C.setValue(i+SIZE_OF_INT,t,"i32"),C._ts_node_descendant_for_index_wasm(this.tree[0]),unmarshalNode(this.tree)}namedDescendantForIndex(e,t=e){if("number"!=typeof e||"number"!=typeof t)throw new Error("Arguments must be numbers");marshalNode(this);const i=TRANSFER_BUFFER+SIZE_OF_NODE;return C.setValue(i,e,"i32"),C.setValue(i+SIZE_OF_INT,t,"i32"),C._ts_node_named_descendant_for_index_wasm(this.tree[0]),unmarshalNode(this.tree)}descendantForPosition(e,t=e){if(!isPoint(e)||!isPoint(t))throw new Error("Arguments must be {row, column} objects");marshalNode(this);const i=TRANSFER_BUFFER+SIZE_OF_NODE;return marshalPoint(i,e),marshalPoint(i+SIZE_OF_POINT,t),C._ts_node_descendant_for_position_wasm(this.tree[0]),unmarshalNode(this.tree)}namedDescendantForPosition(e,t=e){if(!isPoint(e)||!isPoint(t))throw new Error("Arguments must be {row, column} objects");marshalNode(this);const i=TRANSFER_BUFFER+SIZE_OF_NODE;return marshalPoint(i,e),marshalPoint(i+SIZE_OF_POINT,t),C._ts_node_named_descendant_for_position_wasm(this.tree[0]),unmarshalNode(this.tree)}walk(){return marshalNode(this),C._ts_tree_cursor_new_wasm(this.tree[0]),new TreeCursor(INTERNAL,this.tree)}edit(e){if(this.startIndex>=e.oldEndIndex){let t,i;this.startIndex=e.newEndIndex+(this.startIndex-e.oldEndIndex),this.startPosition.row>e.oldEndPosition.row?(t=this.startPosition.row-e.oldEndPosition.row,i=this.startPosition.column):(t=0,i=this.startPosition.column,this.startPosition.column>=e.oldEndPosition.column&&(i=this.startPosition.column-e.oldEndPosition.column)),t>0?(this.startPosition.row+=t,this.startPosition.column=i):this.startPosition.column+=i}else this.startIndex>e.startIndex&&(this.startIndex=e.newEndIndex,this.startPosition.row=e.newEndPosition.row,this.startPosition.column=e.newEndPosition.column)}toString(){marshalNode(this);const e=C._ts_node_to_string_wasm(this.tree[0]),t=C.AsciiToString(e);return C._free(e),t}};function unmarshalCaptures(e,t,i,n,r){for(let s=0,o=r.length;s<o;s++){const o=C.getValue(i,"i32"),a=unmarshalNode(t,i+=SIZE_OF_INT);i+=SIZE_OF_NODE,r[s]={patternIndex:n,name:e.captureNames[o],node:a}}return i}function marshalNode(e,t=0){let i=TRANSFER_BUFFER+t*SIZE_OF_NODE;C.setValue(i,e.id,"i32"),i+=SIZE_OF_INT,C.setValue(i,e.startIndex,"i32"),i+=SIZE_OF_INT,C.setValue(i,e.startPosition.row,"i32"),i+=SIZE_OF_INT,C.setValue(i,e.startPosition.column,"i32"),i+=SIZE_OF_INT,C.setValue(i,e[0],"i32")}function unmarshalNode(e,t=TRANSFER_BUFFER){const i=C.getValue(t,"i32");if(t+=SIZE_OF_INT,0===i)return null;const n=C.getValue(t,"i32");t+=SIZE_OF_INT;const r=C.getValue(t,"i32");t+=SIZE_OF_INT;const s=C.getValue(t,"i32");t+=SIZE_OF_INT;const o=C.getValue(t,"i32");return new Node(INTERNAL,{id:i,tree:e,startIndex:n,startPosition:{row:r,column:s},other:o})}function marshalTreeCursor(e,t=TRANSFER_BUFFER){C.setValue(t+0*SIZE_OF_INT,e[0],"i32"),C.setValue(t+1*SIZE_OF_INT,e[1],"i32"),C.setValue(t+2*SIZE_OF_INT,e[2],"i32"),C.setValue(t+3*SIZE_OF_INT,e[3],"i32")}function unmarshalTreeCursor(e){e[0]=C.getValue(TRANSFER_BUFFER+0*SIZE_OF_INT,"i32"),e[1]=C.getValue(TRANSFER_BUFFER+1*SIZE_OF_INT,"i32"),e[2]=C.getValue(TRANSFER_BUFFER+2*SIZE_OF_INT,"i32"),e[3]=C.getValue(TRANSFER_BUFFER+3*SIZE_OF_INT,"i32")}function marshalPoint(e,t){C.setValue(e,t.row,"i32"),C.setValue(e+SIZE_OF_INT,t.column,"i32")}function unmarshalPoint(e){return{row:C.getValue(e,"i32")>>>0,column:C.getValue(e+SIZE_OF_INT,"i32")>>>0}}function marshalRange(e,t){marshalPoint(e,t.startPosition),marshalPoint(e+=SIZE_OF_POINT,t.endPosition),e+=SIZE_OF_POINT,C.setValue(e,t.startIndex,"i32"),e+=SIZE_OF_INT,C.setValue(e,t.endIndex,"i32"),e+=SIZE_OF_INT}function unmarshalRange(e){const t={};return t.startPosition=unmarshalPoint(e),e+=SIZE_OF_POINT,t.endPosition=unmarshalPoint(e),e+=SIZE_OF_POINT,t.startIndex=C.getValue(e,"i32")>>>0,e+=SIZE_OF_INT,t.endIndex=C.getValue(e,"i32")>>>0,t}function marshalEdit(e,t=TRANSFER_BUFFER){marshalPoint(t,e.startPosition),marshalPoint(t+=SIZE_OF_POINT,e.oldEndPosition),marshalPoint(t+=SIZE_OF_POINT,e.newEndPosition),t+=SIZE_OF_POINT,C.setValue(t,e.startIndex,"i32"),t+=SIZE_OF_INT,C.setValue(t,e.oldEndIndex,"i32"),t+=SIZE_OF_INT,C.setValue(t,e.newEndIndex,"i32"),t+=SIZE_OF_INT}function unmarshalLanguageMetadata(e){return{major_version:C.getValue(e,"i32"),minor_version:C.getValue(e+=SIZE_OF_INT,"i32"),patch_version:C.getValue(e+=SIZE_OF_INT,"i32")}}__name(unmarshalCaptures,"unmarshalCaptures"),__name(marshalNode,"marshalNode"),__name(unmarshalNode,"unmarshalNode"),__name(marshalTreeCursor,"marshalTreeCursor"),__name(unmarshalTreeCursor,"unmarshalTreeCursor"),__name(marshalPoint,"marshalPoint"),__name(unmarshalPoint,"unmarshalPoint"),__name(marshalRange,"marshalRange"),__name(unmarshalRange,"unmarshalRange"),__name(marshalEdit,"marshalEdit"),__name(unmarshalLanguageMetadata,"unmarshalLanguageMetadata");var PREDICATE_STEP_TYPE_CAPTURE=1,PREDICATE_STEP_TYPE_STRING=2,QUERY_WORD_REGEX=/[\w-]+/g,isCaptureStep=__name(e=>"capture"===e.type,"isCaptureStep"),isStringStep=__name(e=>"string"===e.type,"isStringStep"),QueryErrorKind={Syntax:1,NodeName:2,FieldName:3,CaptureName:4,PatternStructure:5},QueryError=class e extends Error{constructor(t,i,n,r){super(e.formatMessage(t,i)),this.kind=t,this.info=i,this.index=n,this.length=r,this.name="QueryError"}static{__name(this,"QueryError")}static formatMessage(e,t){switch(e){case QueryErrorKind.NodeName:return`Bad node name '${t.word}'`;case QueryErrorKind.FieldName:return`Bad field name '${t.word}'`;case QueryErrorKind.CaptureName:return`Bad capture name @${t.word}`;case QueryErrorKind.PatternStructure:return`Bad pattern structure at offset ${t.suffix}`;case QueryErrorKind.Syntax:return`Bad syntax at offset ${t.suffix}`}}};function parseAnyPredicate(e,t,i,n){if(3!==e.length)throw new Error(`Wrong number of arguments to \`#${i}\` predicate. Expected 2, got ${e.length-1}`);if(!isCaptureStep(e[1]))throw new Error(`First argument of \`#${i}\` predicate must be a capture. Got "${e[1].value}"`);const r="eq?"===i||"any-eq?"===i,s=!i.startsWith("any-");if(isCaptureStep(e[2])){const i=e[1].name,o=e[2].name;n[t].push(e=>{const t=[],n=[];for(const r of e)r.name===i&&t.push(r.node),r.name===o&&n.push(r.node);const a=__name((e,t,i)=>i?e.text===t.text:e.text!==t.text,"compare");return s?t.every(e=>n.some(t=>a(e,t,r))):t.some(e=>n.some(t=>a(e,t,r)))})}else{const i=e[1].name,o=e[2].value,a=__name(e=>e.text===o,"matches"),l=__name(e=>e.text!==o,"doesNotMatch");n[t].push(e=>{const t=[];for(const r of e)r.name===i&&t.push(r.node);const n=r?a:l;return s?t.every(n):t.some(n)})}}function parseMatchPredicate(e,t,i,n){if(3!==e.length)throw new Error(`Wrong number of arguments to \`#${i}\` predicate. Expected 2, got ${e.length-1}.`);if("capture"!==e[1].type)throw new Error(`First argument of \`#${i}\` predicate must be a capture. Got "${e[1].value}".`);if("string"!==e[2].type)throw new Error(`Second argument of \`#${i}\` predicate must be a string. Got @${e[2].name}.`);const r="match?"===i||"any-match?"===i,s=!i.startsWith("any-"),o=e[1].name,a=new RegExp(e[2].value);n[t].push(e=>{const t=[];for(const n of e)n.name===o&&t.push(n.node.text);const i=__name((e,t)=>t?a.test(e):!a.test(e),"test");return 0===t.length?!r:s?t.every(e=>i(e,r)):t.some(e=>i(e,r))})}function parseAnyOfPredicate(e,t,i,n){if(e.length<2)throw new Error(`Wrong number of arguments to \`#${i}\` predicate. Expected at least 1. Got ${e.length-1}.`);if("capture"!==e[1].type)throw new Error(`First argument of \`#${i}\` predicate must be a capture. Got "${e[1].value}".`);const r="any-of?"===i,s=e[1].name,o=e.slice(2);if(!o.every(isStringStep))throw new Error(`Arguments to \`#${i}\` predicate must be strings.".`);const a=o.map(e=>e.value);n[t].push(e=>{const t=[];for(const i of e)i.name===s&&t.push(i.node.text);return 0===t.length?!r:t.every(e=>a.includes(e))===r})}function parseIsPredicate(e,t,i,n,r){if(e.length<2||e.length>3)throw new Error(`Wrong number of arguments to \`#${i}\` predicate. Expected 1 or 2. Got ${e.length-1}.`);if(!e.every(isStringStep))throw new Error(`Arguments to \`#${i}\` predicate must be strings.".`);const s="is?"===i?n:r;s[t]||(s[t]={}),s[t][e[1].value]=e[2]?.value??null}function parseSetDirective(e,t,i){if(e.length<2||e.length>3)throw new Error(`Wrong number of arguments to \`#set!\` predicate. Expected 1 or 2. Got ${e.length-1}.`);if(!e.every(isStringStep))throw new Error('Arguments to `#set!` predicate must be strings.".');i[t]||(i[t]={}),i[t][e[1].value]=e[2]?.value??null}function parsePattern(e,t,i,n,r,s,o,a,l,c,h){if(t===PREDICATE_STEP_TYPE_CAPTURE){const e=n[i];s.push({type:"capture",name:e})}else if(t===PREDICATE_STEP_TYPE_STRING)s.push({type:"string",value:r[i]});else if(s.length>0){if("string"!==s[0].type)throw new Error("Predicates must begin with a literal value");const t=s[0].value;switch(t){case"any-not-eq?":case"not-eq?":case"any-eq?":case"eq?":parseAnyPredicate(s,e,t,o);break;case"any-not-match?":case"not-match?":case"any-match?":case"match?":parseMatchPredicate(s,e,t,o);break;case"not-any-of?":case"any-of?":parseAnyOfPredicate(s,e,t,o);break;case"is?":case"is-not?":parseIsPredicate(s,e,t,c,h);break;case"set!":parseSetDirective(s,e,l);break;default:a[e].push({operator:t,operands:s.slice(1)})}s.length=0}}__name(parseAnyPredicate,"parseAnyPredicate"),__name(parseMatchPredicate,"parseMatchPredicate"),__name(parseAnyOfPredicate,"parseAnyOfPredicate"),__name(parseIsPredicate,"parseIsPredicate"),__name(parseSetDirective,"parseSetDirective"),__name(parsePattern,"parsePattern");var Query=class{static{__name(this,"Query")}0=0;exceededMatchLimit;textPredicates;captureNames;captureQuantifiers;predicates;setProperties;assertedProperties;refutedProperties;matchLimit;constructor(e,t){const i=C.lengthBytesUTF8(t),n=C._malloc(i+1);C.stringToUTF8(t,n,i+1);const r=C._ts_query_new(e[0],n,i,TRANSFER_BUFFER,TRANSFER_BUFFER+SIZE_OF_INT);if(!r){const e=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),i=C.getValue(TRANSFER_BUFFER,"i32"),r=C.UTF8ToString(n,i).length,s=t.slice(r,r+100).split("\n")[0],o=s.match(QUERY_WORD_REGEX)?.[0]??"";switch(C._free(n),e){case QueryErrorKind.Syntax:throw new QueryError(QueryErrorKind.Syntax,{suffix:`${r}: '${s}'...`},r,0);case QueryErrorKind.NodeName:case QueryErrorKind.FieldName:case QueryErrorKind.CaptureName:throw new QueryError(e,{word:o},r,o.length);case QueryErrorKind.PatternStructure:throw new QueryError(e,{suffix:`${r}: '${s}'...`},r,0)}}const s=C._ts_query_string_count(r),o=C._ts_query_capture_count(r),a=C._ts_query_pattern_count(r),l=new Array(o),c=new Array(a),h=new Array(s);for(let g=0;g<o;g++){const e=C._ts_query_capture_name_for_id(r,g,TRANSFER_BUFFER),t=C.getValue(TRANSFER_BUFFER,"i32");l[g]=C.UTF8ToString(e,t)}for(let g=0;g<a;g++){const e=new Array(o);for(let t=0;t<o;t++){const i=C._ts_query_capture_quantifier_for_id(r,g,t);e[t]=i}c[g]=e}for(let g=0;g<s;g++){const e=C._ts_query_string_value_for_id(r,g,TRANSFER_BUFFER),t=C.getValue(TRANSFER_BUFFER,"i32");h[g]=C.UTF8ToString(e,t)}const u=new Array(a),d=new Array(a),p=new Array(a),f=new Array(a),m=new Array(a);for(let g=0;g<a;g++){const e=C._ts_query_predicates_for_pattern(r,g,TRANSFER_BUFFER),t=C.getValue(TRANSFER_BUFFER,"i32");f[g]=[],m[g]=[];const i=new Array;let n=e;for(let r=0;r<t;r++){const e=C.getValue(n,"i32");n+=SIZE_OF_INT;const t=C.getValue(n,"i32");n+=SIZE_OF_INT,parsePattern(g,e,t,l,h,i,m,f,u,d,p)}Object.freeze(m[g]),Object.freeze(f[g]),Object.freeze(u[g]),Object.freeze(d[g]),Object.freeze(p[g])}C._free(n),this[0]=r,this.captureNames=l,this.captureQuantifiers=c,this.textPredicates=m,this.predicates=f,this.setProperties=u,this.assertedProperties=d,this.refutedProperties=p,this.exceededMatchLimit=!1}delete(){C._ts_query_delete(this[0]),this[0]=0}matches(e,t={}){const i=t.startPosition??ZERO_POINT,n=t.endPosition??ZERO_POINT,r=t.startIndex??0,s=t.endIndex??0,o=t.matchLimit??4294967295,a=t.maxStartDepth??4294967295,l=t.timeoutMicros??0,c=t.progressCallback;if("number"!=typeof o)throw new Error("Arguments must be numbers");if(this.matchLimit=o,0!==s&&r>s)throw new Error("`startIndex` cannot be greater than `endIndex`");if(n!==ZERO_POINT&&(i.row>n.row||i.row===n.row&&i.column>n.column))throw new Error("`startPosition` cannot be greater than `endPosition`");c&&(C.currentQueryProgressCallback=c),marshalNode(e),C._ts_query_matches_wasm(this[0],e.tree[0],i.row,i.column,n.row,n.column,r,s,o,a,l);const h=C.getValue(TRANSFER_BUFFER,"i32"),u=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),d=C.getValue(TRANSFER_BUFFER+2*SIZE_OF_INT,"i32"),p=new Array(h);this.exceededMatchLimit=Boolean(d);let f=0,m=u;for(let g=0;g<h;g++){const t=C.getValue(m,"i32");m+=SIZE_OF_INT;const i=C.getValue(m,"i32");m+=SIZE_OF_INT;const n=new Array(i);if(m=unmarshalCaptures(this,e.tree,m,t,n),this.textPredicates[t].every(e=>e(n))){p[f]={pattern:t,patternIndex:t,captures:n};const e=this.setProperties[t];p[f].setProperties=e;const i=this.assertedProperties[t];p[f].assertedProperties=i;const r=this.refutedProperties[t];p[f].refutedProperties=r,f++}}return p.length=f,C._free(u),C.currentQueryProgressCallback=null,p}captures(e,t={}){const i=t.startPosition??ZERO_POINT,n=t.endPosition??ZERO_POINT,r=t.startIndex??0,s=t.endIndex??0,o=t.matchLimit??4294967295,a=t.maxStartDepth??4294967295,l=t.timeoutMicros??0,c=t.progressCallback;if("number"!=typeof o)throw new Error("Arguments must be numbers");if(this.matchLimit=o,0!==s&&r>s)throw new Error("`startIndex` cannot be greater than `endIndex`");if(n!==ZERO_POINT&&(i.row>n.row||i.row===n.row&&i.column>n.column))throw new Error("`startPosition` cannot be greater than `endPosition`");c&&(C.currentQueryProgressCallback=c),marshalNode(e),C._ts_query_captures_wasm(this[0],e.tree[0],i.row,i.column,n.row,n.column,r,s,o,a,l);const h=C.getValue(TRANSFER_BUFFER,"i32"),u=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),d=C.getValue(TRANSFER_BUFFER+2*SIZE_OF_INT,"i32"),p=new Array;this.exceededMatchLimit=Boolean(d);const f=new Array;let m=u;for(let g=0;g<h;g++){const t=C.getValue(m,"i32");m+=SIZE_OF_INT;const i=C.getValue(m,"i32");m+=SIZE_OF_INT;const n=C.getValue(m,"i32");if(m+=SIZE_OF_INT,f.length=i,m=unmarshalCaptures(this,e.tree,m,t,f),this.textPredicates[t].every(e=>e(f))){const e=f[n],i=this.setProperties[t];e.setProperties=i;const r=this.assertedProperties[t];e.assertedProperties=r;const s=this.refutedProperties[t];e.refutedProperties=s,p.push(e)}}return C._free(u),C.currentQueryProgressCallback=null,p}predicatesForPattern(e){return this.predicates[e]}disableCapture(e){const t=C.lengthBytesUTF8(e),i=C._malloc(t+1);C.stringToUTF8(e,i,t+1),C._ts_query_disable_capture(this[0],i,t),C._free(i)}disablePattern(e){if(e>=this.predicates.length)throw new Error(`Pattern index is ${e} but the pattern count is ${this.predicates.length}`);C._ts_query_disable_pattern(this[0],e)}didExceedMatchLimit(){return this.exceededMatchLimit}startIndexForPattern(e){if(e>=this.predicates.length)throw new Error(`Pattern index is ${e} but the pattern count is ${this.predicates.length}`);return C._ts_query_start_byte_for_pattern(this[0],e)}endIndexForPattern(e){if(e>=this.predicates.length)throw new Error(`Pattern index is ${e} but the pattern count is ${this.predicates.length}`);return C._ts_query_end_byte_for_pattern(this[0],e)}patternCount(){return C._ts_query_pattern_count(this[0])}captureIndexForName(e){return this.captureNames.indexOf(e)}isPatternRooted(e){return 1===C._ts_query_is_pattern_rooted(this[0],e)}isPatternNonLocal(e){return 1===C._ts_query_is_pattern_non_local(this[0],e)}isPatternGuaranteedAtStep(e){return 1===C._ts_query_is_pattern_guaranteed_at_step(this[0],e)}},LANGUAGE_FUNCTION_REGEX=/^tree_sitter_\w+$/,Language=class e{static{__name(this,"Language")}0=0;types;fields;constructor(e,t){assertInternal(e),this[0]=t,this.types=new Array(C._ts_language_symbol_count(this[0]));for(let i=0,n=this.types.length;i<n;i++)C._ts_language_symbol_type(this[0],i)<2&&(this.types[i]=C.UTF8ToString(C._ts_language_symbol_name(this[0],i)));this.fields=new Array(C._ts_language_field_count(this[0])+1);for(let i=0,n=this.fields.length;i<n;i++){const e=C._ts_language_field_name_for_id(this[0],i);this.fields[i]=0!==e?C.UTF8ToString(e):null}}get name(){const e=C._ts_language_name(this[0]);return 0===e?null:C.UTF8ToString(e)}get version(){return C._ts_language_version(this[0])}get abiVersion(){return C._ts_language_abi_version(this[0])}get metadata(){C._ts_language_metadata(this[0]);const e=C.getValue(TRANSFER_BUFFER,"i32"),t=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32");return 0===e?null:unmarshalLanguageMetadata(t)}get fieldCount(){return this.fields.length-1}get stateCount(){return C._ts_language_state_count(this[0])}fieldIdForName(e){const t=this.fields.indexOf(e);return-1!==t?t:null}fieldNameForId(e){return this.fields[e]??null}idForNodeType(e,t){const i=C.lengthBytesUTF8(e),n=C._malloc(i+1);C.stringToUTF8(e,n,i+1);const r=C._ts_language_symbol_for_name(this[0],n,i,t?1:0);return C._free(n),r||null}get nodeTypeCount(){return C._ts_language_symbol_count(this[0])}nodeTypeForId(e){const t=C._ts_language_symbol_name(this[0],e);return t?C.UTF8ToString(t):null}nodeTypeIsNamed(e){return!!C._ts_language_type_is_named_wasm(this[0],e)}nodeTypeIsVisible(e){return!!C._ts_language_type_is_visible_wasm(this[0],e)}get supertypes(){C._ts_language_supertypes_wasm(this[0]);const e=C.getValue(TRANSFER_BUFFER,"i32"),t=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),i=new Array(e);if(e>0){let n=t;for(let t=0;t<e;t++)i[t]=C.getValue(n,"i16"),n+=SIZE_OF_SHORT}return i}subtypes(e){C._ts_language_subtypes_wasm(this[0],e);const t=C.getValue(TRANSFER_BUFFER,"i32"),i=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),n=new Array(t);if(t>0){let e=i;for(let i=0;i<t;i++)n[i]=C.getValue(e,"i16"),e+=SIZE_OF_SHORT}return n}nextState(e,t){return C._ts_language_next_state(this[0],e,t)}lookaheadIterator(e){const t=C._ts_lookahead_iterator_new(this[0],e);return t?new LookaheadIterator(INTERNAL,t,this):null}query(e){return console.warn("Language.query is deprecated. Use new Query(language, source) instead."),new Query(this,e)}static async load(t){let i;if(t instanceof Uint8Array)i=Promise.resolve(t);else if(globalThis.process?.versions.node){i=(await __vitePreload(()=>import("./__vite-browser-external-FmFgRqLi.js"),[])).readFile(t)}else i=fetch(t).then(e=>e.arrayBuffer().then(t=>{if(e.ok)return new Uint8Array(t);{const i=new TextDecoder("utf-8").decode(t);throw new Error(`Language.load failed with status ${e.status}.\n\n${i}`)}}));const n=await C.loadWebAssemblyModule(await i,{loadAsync:!0}),r=Object.keys(n),s=r.find(e=>LANGUAGE_FUNCTION_REGEX.test(e)&&!e.includes("external_scanner_"));if(!s)throw console.log(`Couldn't find language function in WASM file. Symbols:\n${JSON.stringify(r,null,2)}`),new Error("Language.load failed: no language function found in WASM file");const o=n[s]();return new e(INTERNAL,o)}},Module2=(()=>{var _scriptName=import.meta.url;return async function(moduleArg={}){var moduleRtn,Module=moduleArg,readyPromiseResolve,readyPromiseReject,readyPromise=new Promise((e,t)=>{readyPromiseResolve=e,readyPromiseReject=t}),ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="undefined"!=typeof WorkerGlobalScope,ENVIRONMENT_IS_NODE="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&"renderer"!=process.type;if(ENVIRONMENT_IS_NODE){const{createRequire:e}=await __vitePreload(async()=>{const{createRequire:e}=await import("./__vite-browser-external-FmFgRqLi.js");return{createRequire:e}},[]);var require=e(import.meta.url)}Module.currentQueryProgressCallback=null,Module.currentProgressCallback=null,Module.currentLogCallback=null,Module.currentParseCallback=null;var moduleOverrides=Object.assign({},Module),arguments_=[],thisProgram="./this.program",quit_=__name((e,t)=>{throw t},"quit_"),scriptDirectory="",readAsync,readBinary;function locateFile(e){return Module.locateFile?Module.locateFile(e,scriptDirectory):scriptDirectory+e}if(__name(locateFile,"locateFile"),ENVIRONMENT_IS_NODE){var fs=require("fs"),nodePath=require("path");import.meta.url.startsWith("data:")||(scriptDirectory=nodePath.dirname(require("url").fileURLToPath(import.meta.url))+"/"),readBinary=__name(e=>(e=isFileURI(e)?new URL(e):e,fs.readFileSync(e)),"readBinary"),readAsync=__name(async(e,t=!0)=>(e=isFileURI(e)?new URL(e):e,fs.readFileSync(e,t?void 0:"utf8")),"readAsync"),!Module.thisProgram&&process.argv.length>1&&(thisProgram=process.argv[1].replace(/\\/g,"/")),arguments_=process.argv.slice(2),quit_=__name((e,t)=>{throw process.exitCode=e,t},"quit_")}else(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&(ENVIRONMENT_IS_WORKER?scriptDirectory=self.location.href:"undefined"!=typeof document&&document.currentScript&&(scriptDirectory=document.currentScript.src),_scriptName&&(scriptDirectory=_scriptName),scriptDirectory=scriptDirectory.startsWith("blob:")?"":scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1),ENVIRONMENT_IS_WORKER&&(readBinary=__name(e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)},"readBinary")),readAsync=__name(async e=>{if(isFileURI(e))return new Promise((t,i)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?t(n.response):i(n.status)},n.onerror=i,n.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)},"readAsync"));var out=Module.print||console.log.bind(console),err=Module.printErr||console.error.bind(console);Object.assign(Module,moduleOverrides),moduleOverrides=null,Module.arguments&&(arguments_=Module.arguments),Module.thisProgram&&(thisProgram=Module.thisProgram);var dynamicLibraries=Module.dynamicLibraries||[],wasmBinary=Module.wasmBinary,wasmMemory,ABORT=!1,EXITSTATUS,HEAP8,HEAPU8,HEAP64,HEAP_DATA_VIEW;function assert(e,t){e||abort(t)}__name(assert,"assert");var runtimeInitialized=!1,isFileURI=__name(e=>e.startsWith("file://"),"isFileURI");function updateMemoryViews(){var e=wasmMemory.buffer;Module.HEAP_DATA_VIEW=HEAP_DATA_VIEW=new DataView(e),Module.HEAP8=HEAP8=new Int8Array(e),Module.HEAP16=new Int16Array(e),Module.HEAPU8=HEAPU8=new Uint8Array(e),Module.HEAPU16=new Uint16Array(e),Module.HEAP32=new Int32Array(e),Module.HEAPU32=new Uint32Array(e),Module.HEAPF32=new Float32Array(e),Module.HEAPF64=new Float64Array(e),Module.HEAP64=HEAP64=new BigInt64Array(e),Module.HEAPU64=new BigUint64Array(e)}if(__name(updateMemoryViews,"updateMemoryViews"),Module.wasmMemory)wasmMemory=Module.wasmMemory;else{var INITIAL_MEMORY=Module.INITIAL_MEMORY||33554432;wasmMemory=new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:32768})}updateMemoryViews();var __RELOC_FUNCS__=[];function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(onPreRuns)}function initRuntime(){runtimeInitialized=!0,callRuntimeCallbacks(__RELOC_FUNCS__),wasmExports.__wasm_call_ctors(),callRuntimeCallbacks(onPostCtors)}function preMain(){}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(onPostRuns)}__name(preRun,"preRun"),__name(initRuntime,"initRuntime"),__name(preMain,"preMain"),__name(postRun,"postRun");var runDependencies=0,dependenciesFulfilled=null,wasmBinaryFile;function getUniqueRunDependency(e){return e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies?.(runDependencies)}function removeRunDependency(e){if(runDependencies--,Module.monitorRunDependencies?.(runDependencies),0==runDependencies&&dependenciesFulfilled){var t=dependenciesFulfilled;dependenciesFulfilled=null,t()}}function abort(e){Module.onAbort?.(e),err(e="Aborted("+e+")"),ABORT=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw readyPromiseReject(t),t}function findWasmBinary(){return Module.locateFile?locateFile("tree-sitter.wasm"):new URL("/assets/tree-sitter-qKYAACSa.wasm",import.meta.url).href}function getBinarySync(e){if(e==wasmBinaryFile&&wasmBinary)return new Uint8Array(wasmBinary);if(readBinary)return readBinary(e);throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(e){if(!wasmBinary)try{var t=await readAsync(e);return new Uint8Array(t)}catch{}return getBinarySync(e)}async function instantiateArrayBuffer(e,t){try{var i=await getWasmBinary(e);return await WebAssembly.instantiate(i,t)}catch(n){err(`failed to asynchronously prepare wasm: ${n}`),abort(n)}}async function instantiateAsync(e,t,i){if(!e&&"function"==typeof WebAssembly.instantiateStreaming&&!isFileURI(t)&&!ENVIRONMENT_IS_NODE)try{var n=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(n,i)}catch(r){err(`wasm streaming compile failed: ${r}`),err("falling back to ArrayBuffer instantiation")}return instantiateArrayBuffer(t,i)}function getWasmImports(){return{env:wasmImports,wasi_snapshot_preview1:wasmImports,"GOT.mem":new Proxy(wasmImports,GOTHandler),"GOT.func":new Proxy(wasmImports,GOTHandler)}}async function createWasm(){function e(e,t){wasmExports=e.exports,wasmExports=relocateExports(wasmExports,1024);var i=getDylinkMetadata(t);return i.neededDynlibs&&(dynamicLibraries=i.neededDynlibs.concat(dynamicLibraries)),mergeLibSymbols(wasmExports,"main"),LDSO.init(),loadDylibs(),__RELOC_FUNCS__.push(wasmExports.__wasm_apply_data_relocs),removeRunDependency(),wasmExports}function t(t){return e(t.instance,t.module)}__name(e,"receiveInstance"),addRunDependency(),__name(t,"receiveInstantiationResult");var i=getWasmImports();if(Module.instantiateWasm)return new Promise((t,n)=>{Module.instantiateWasm(i,(i,n)=>{e(i,n),t(i.exports)})});wasmBinaryFile??=findWasmBinary();try{return t(await instantiateAsync(wasmBinary,wasmBinaryFile,i))}catch(n){return readyPromiseReject(n),Promise.reject(n)}}__name(getUniqueRunDependency,"getUniqueRunDependency"),__name(addRunDependency,"addRunDependency"),__name(removeRunDependency,"removeRunDependency"),__name(abort,"abort"),__name(findWasmBinary,"findWasmBinary"),__name(getBinarySync,"getBinarySync"),__name(getWasmBinary,"getWasmBinary"),__name(instantiateArrayBuffer,"instantiateArrayBuffer"),__name(instantiateAsync,"instantiateAsync"),__name(getWasmImports,"getWasmImports"),__name(createWasm,"createWasm");class ExitStatus{static{__name(this,"ExitStatus")}name="ExitStatus";constructor(e){this.message=`Program terminated with exit(${e})`,this.status=e}}var GOT={},currentModuleWeakSymbols=new Set([]),GOTHandler={get(e,t){var i=GOT[t];return i||(i=GOT[t]=new WebAssembly.Global({value:"i32",mutable:!0})),currentModuleWeakSymbols.has(t)||(i.required=!0),i}},LE_HEAP_LOAD_F32=__name(e=>HEAP_DATA_VIEW.getFloat32(e,!0),"LE_HEAP_LOAD_F32"),LE_HEAP_LOAD_F64=__name(e=>HEAP_DATA_VIEW.getFloat64(e,!0),"LE_HEAP_LOAD_F64"),LE_HEAP_LOAD_I16=__name(e=>HEAP_DATA_VIEW.getInt16(e,!0),"LE_HEAP_LOAD_I16"),LE_HEAP_LOAD_I32=__name(e=>HEAP_DATA_VIEW.getInt32(e,!0),"LE_HEAP_LOAD_I32"),LE_HEAP_LOAD_U32=__name(e=>HEAP_DATA_VIEW.getUint32(e,!0),"LE_HEAP_LOAD_U32"),LE_HEAP_STORE_F32=__name((e,t)=>HEAP_DATA_VIEW.setFloat32(e,t,!0),"LE_HEAP_STORE_F32"),LE_HEAP_STORE_F64=__name((e,t)=>HEAP_DATA_VIEW.setFloat64(e,t,!0),"LE_HEAP_STORE_F64"),LE_HEAP_STORE_I16=__name((e,t)=>HEAP_DATA_VIEW.setInt16(e,t,!0),"LE_HEAP_STORE_I16"),LE_HEAP_STORE_I32=__name((e,t)=>HEAP_DATA_VIEW.setInt32(e,t,!0),"LE_HEAP_STORE_I32"),LE_HEAP_STORE_U32=__name((e,t)=>HEAP_DATA_VIEW.setUint32(e,t,!0),"LE_HEAP_STORE_U32"),callRuntimeCallbacks=__name(e=>{for(;e.length>0;)e.shift()(Module)},"callRuntimeCallbacks"),onPostRuns=[],addOnPostRun=__name(e=>onPostRuns.unshift(e),"addOnPostRun"),onPreRuns=[],addOnPreRun=__name(e=>onPreRuns.unshift(e),"addOnPreRun"),UTF8Decoder="undefined"!=typeof TextDecoder?new TextDecoder:void 0,UTF8ArrayToString=__name((e,t=0,i=NaN)=>{for(var n=t+i,r=t;e[r]&&!(r>=n);)++r;if(r-t>16&&e.buffer&&UTF8Decoder)return UTF8Decoder.decode(e.subarray(t,r));for(var s="";t<r;){var o=e[t++];if(128&o){var a=63&e[t++];if(192!=(224&o)){var l=63&e[t++];if((o=224==(240&o)?(15&o)<<12|a<<6|l:(7&o)<<18|a<<12|l<<6|63&e[t++])<65536)s+=String.fromCharCode(o);else{var c=o-65536;s+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else s+=String.fromCharCode((31&o)<<6|a)}else s+=String.fromCharCode(o)}return s},"UTF8ArrayToString"),getDylinkMetadata=__name(e=>{var t=0,i=0;function n(){return e[t++]}function r(){for(var i=0,n=1;;){var r=e[t++];if(i+=(127&r)*n,n*=128,!(128&r))break}return i}function s(){var i=r();return UTF8ArrayToString(e,(t+=i)-i,i)}function o(e,t){if(e)throw new Error(t)}__name(n,"getU8"),__name(r,"getLEB"),__name(s,"getString"),__name(o,"failIf");var a="dylink.0";if(e instanceof WebAssembly.Module){var l=WebAssembly.Module.customSections(e,a);0===l.length&&(a="dylink",l=WebAssembly.Module.customSections(e,a)),o(0===l.length,"need dylink section"),i=(e=new Uint8Array(l[0])).length}else{var c=new Uint32Array(new Uint8Array(e.subarray(0,24)).buffer);o(!(1836278016==c[0]||6386541==c[0]),"need to see wasm magic number"),o(0!==e[8],"need the dylink section to be first"),t=9;var h=r();i=t+h,a=s()}var u={neededDynlibs:[],tlsExports:new Set,weakImports:new Set};if("dylink"==a){u.memorySize=r(),u.memoryAlign=r(),u.tableSize=r(),u.tableAlign=r();for(var d=r(),p=0;p<d;++p){var f=s();u.neededDynlibs.push(f)}}else{o("dylink.0"!==a);for(;t<i;){var m=n(),g=r();if(1===m)u.memorySize=r(),u.memoryAlign=r(),u.tableSize=r(),u.tableAlign=r();else if(2===m)for(d=r(),p=0;p<d;++p)f=s(),u.neededDynlibs.push(f);else if(3===m)for(var y=r();y--;){var _=s();256&r()&&u.tlsExports.add(_)}else if(4===m)for(y=r();y--;){s();_=s();1==(3&r())&&u.weakImports.add(_)}else t+=g}}return u},"getDylinkMetadata");function getValue(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return HEAP8[e];case"i16":return LE_HEAP_LOAD_I16(2*(e>>1));case"i32":return LE_HEAP_LOAD_I32(4*(e>>2));case"i64":return HEAP64[e>>3];case"float":return LE_HEAP_LOAD_F32(4*(e>>2));case"double":return LE_HEAP_LOAD_F64(8*(e>>3));case"*":return LE_HEAP_LOAD_U32(4*(e>>2));default:abort(`invalid type for getValue: ${t}`)}}__name(getValue,"getValue");var newDSO=__name((e,t,i)=>{var n={refcount:1/0,name:e,exports:i,global:!0};return LDSO.loadedLibsByName[e]=n,null!=t&&(LDSO.loadedLibsByHandle[t]=n),n},"newDSO"),LDSO={loadedLibsByName:{},loadedLibsByHandle:{},init(){newDSO("__main__",0,wasmImports)}},___heap_base=78224,alignMemory=__name((e,t)=>Math.ceil(e/t)*t,"alignMemory"),getMemory=__name(e=>{if(runtimeInitialized)return _calloc(e,1);var t=___heap_base,i=t+alignMemory(e,16);return ___heap_base=i,GOT.__heap_base.value=i,t},"getMemory"),isInternalSym=__name(e=>["__cpp_exception","__c_longjmp","__wasm_apply_data_relocs","__dso_handle","__tls_size","__tls_align","__set_stack_limits","_emscripten_tls_init","__wasm_init_tls","__wasm_call_ctors","__start_em_asm","__stop_em_asm","__start_em_js","__stop_em_js"].includes(e)||e.startsWith("__em_js__"),"isInternalSym"),uleb128Encode=__name((e,t)=>{e<128?t.push(e):t.push(e%128|128,e>>7)},"uleb128Encode"),sigToWasmTypes=__name(e=>{for(var t={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},i={parameters:[],results:"v"==e[0]?[]:[t[e[0]]]},n=1;n<e.length;++n)i.parameters.push(t[e[n]]);return i},"sigToWasmTypes"),generateFuncType=__name((e,t)=>{var i=e.slice(0,1),n=e.slice(1),r={i:127,p:127,j:126,f:125,d:124,e:111};t.push(96),uleb128Encode(n.length,t);for(var s=0;s<n.length;++s)t.push(r[n[s]]);"v"==i?t.push(0):t.push(1,r[i])},"generateFuncType"),convertJsFunctionToWasm=__name((e,t)=>{if("function"==typeof WebAssembly.Function)return new WebAssembly.Function(sigToWasmTypes(t),e);var i=[1];generateFuncType(t,i);var n=[0,97,115,109,1,0,0,0,1];uleb128Encode(i.length,n),n.push(...i),n.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var r=new WebAssembly.Module(new Uint8Array(n));return new WebAssembly.Instance(r,{e:{f:e}}).exports.f},"convertJsFunctionToWasm"),wasmTableMirror=[],wasmTable=new WebAssembly.Table({initial:31,element:"anyfunc"}),getWasmTableEntry=__name(e=>{var t=wasmTableMirror[e];return t||(e>=wasmTableMirror.length&&(wasmTableMirror.length=e+1),wasmTableMirror[e]=t=wasmTable.get(e)),t},"getWasmTableEntry"),updateTableMap=__name((e,t)=>{if(functionsInTableMap)for(var i=e;i<e+t;i++){var n=getWasmTableEntry(i);n&&functionsInTableMap.set(n,i)}},"updateTableMap"),functionsInTableMap,getFunctionAddress=__name(e=>(functionsInTableMap||(functionsInTableMap=new WeakMap,updateTableMap(0,wasmTable.length)),functionsInTableMap.get(e)||0),"getFunctionAddress"),freeTableIndexes=[],getEmptyTableSlot=__name(()=>{if(freeTableIndexes.length)return freeTableIndexes.pop();try{wasmTable.grow(1)}catch(e){if(!(e instanceof RangeError))throw e;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return wasmTable.length-1},"getEmptyTableSlot"),setWasmTableEntry=__name((e,t)=>{wasmTable.set(e,t),wasmTableMirror[e]=wasmTable.get(e)},"setWasmTableEntry"),addFunction=__name((e,t)=>{var i=getFunctionAddress(e);if(i)return i;var n=getEmptyTableSlot();try{setWasmTableEntry(n,e)}catch(s){if(!(s instanceof TypeError))throw s;var r=convertJsFunctionToWasm(e,t);setWasmTableEntry(n,r)}return functionsInTableMap.set(e,n),n},"addFunction"),updateGOT=__name((e,t)=>{for(var i in e)if(!isInternalSym(i)){var n=e[i];GOT[i]||=new WebAssembly.Global({value:"i32",mutable:!0}),(t||0==GOT[i].value)&&("function"==typeof n?GOT[i].value=addFunction(n):"number"==typeof n?GOT[i].value=n:err(`unhandled export type for '${i}': ${typeof n}`))}},"updateGOT"),relocateExports=__name((e,t,i)=>{var n={};for(var r in e){var s=e[r];"object"==typeof s&&(s=s.value),"number"==typeof s&&(s+=t),n[r]=s}return updateGOT(n,i),n},"relocateExports"),isSymbolDefined=__name(e=>{var t=wasmImports[e];return!(!t||t.stub)},"isSymbolDefined"),dynCall=__name((e,t,i=[])=>getWasmTableEntry(t)(...i),"dynCall"),stackSave=__name(()=>_emscripten_stack_get_current(),"stackSave"),stackRestore=__name(e=>__emscripten_stack_restore(e),"stackRestore"),createInvokeFunction=__name(e=>(t,...i)=>{var n=stackSave();try{return dynCall(e,t,i)}catch(r){if(stackRestore(n),r!==r+0)throw r;if(_setThrew(1,0),"j"==e[0])return 0n}},"createInvokeFunction"),resolveGlobalSymbol=__name((e,t=!1)=>{var i;return isSymbolDefined(e)?i=wasmImports[e]:e.startsWith("invoke_")&&(i=wasmImports[e]=createInvokeFunction(e.split("_")[1])),{sym:i,name:e}},"resolveGlobalSymbol"),onPostCtors=[],addOnPostCtor=__name(e=>onPostCtors.unshift(e),"addOnPostCtor"),UTF8ToString=__name((e,t)=>e?UTF8ArrayToString(HEAPU8,e,t):"","UTF8ToString"),loadWebAssemblyModule=__name((binary,flags,libName,localScope,handle)=>{var metadata=getDylinkMetadata(binary);function loadModule(){var memAlign=Math.pow(2,metadata.memoryAlign),memoryBase=metadata.memorySize?alignMemory(getMemory(metadata.memorySize+memAlign),memAlign):0,tableBase=metadata.tableSize?wasmTable.length:0,moduleExports;function resolveSymbol(e){var t=resolveGlobalSymbol(e).sym;return!t&&localScope&&(t=localScope[e]),t||(t=moduleExports[e]),t}handle&&(HEAP8[handle+8]=1,LE_HEAP_STORE_U32(4*(handle+12>>2),memoryBase),LE_HEAP_STORE_I32(4*(handle+16>>2),metadata.memorySize),LE_HEAP_STORE_U32(4*(handle+20>>2),tableBase),LE_HEAP_STORE_I32(4*(handle+24>>2),metadata.tableSize)),metadata.tableSize&&wasmTable.grow(metadata.tableSize),__name(resolveSymbol,"resolveSymbol");var proxyHandler={get(e,t){switch(t){case"__memory_base":return memoryBase;case"__table_base":return tableBase}var i;if(t in wasmImports&&!wasmImports[t].stub)return wasmImports[t];t in e||(e[t]=(...e)=>(i||=resolveSymbol(t),i(...e)));return e[t]}},proxy=new Proxy({},proxyHandler),info={"GOT.mem":new Proxy({},GOTHandler),"GOT.func":new Proxy({},GOTHandler),env:proxy,wasi_snapshot_preview1:proxy};function postInstantiation(module,instance){function addEmAsm(addr,body){for(var args=[],arity=0;arity<16&&-1!=body.indexOf("$"+arity);arity++)args.push("$"+arity);args=args.join(",");var func=`(${args}) => { ${body} };`;eval(func)}if(updateTableMap(tableBase,metadata.tableSize),moduleExports=relocateExports(instance.exports,memoryBase),flags.allowUndefined||reportUndefinedSymbols(),__name(addEmAsm,"addEmAsm"),"__start_em_asm"in moduleExports)for(var start=moduleExports.__start_em_asm,stop=moduleExports.__stop_em_asm;start<stop;){var jsString=UTF8ToString(start);addEmAsm(start,jsString),start=HEAPU8.indexOf(0,start)+1}function addEmJs(name,cSig,body){var jsArgs=[];if(cSig=cSig.slice(1,-1),"void"!=cSig)for(var i in cSig=cSig.split(","),cSig){var jsArg=cSig[i].split(" ").pop();jsArgs.push(jsArg.replace("*",""))}var func=`(${jsArgs}) => ${body};`;moduleExports[name]=eval(func)}for(var name in __name(addEmJs,"addEmJs"),moduleExports)if(name.startsWith("__em_js__")){var start=moduleExports[name],jsString=UTF8ToString(start),parts=jsString.split("<::>");addEmJs(name.replace("__em_js__",""),parts[0],parts[1]),delete moduleExports[name]}var applyRelocs=moduleExports.__wasm_apply_data_relocs;applyRelocs&&(runtimeInitialized?applyRelocs():__RELOC_FUNCS__.push(applyRelocs));var init=moduleExports.__wasm_call_ctors;return init&&(runtimeInitialized?init():addOnPostCtor(init)),moduleExports}if(__name(postInstantiation,"postInstantiation"),flags.loadAsync){if(binary instanceof WebAssembly.Module){var instance=new WebAssembly.Instance(binary,info);return Promise.resolve(postInstantiation(binary,instance))}return WebAssembly.instantiate(binary,info).then(e=>postInstantiation(e.module,e.instance))}var module=binary instanceof WebAssembly.Module?binary:new WebAssembly.Module(binary),instance=new WebAssembly.Instance(module,info);return postInstantiation(module,instance)}return currentModuleWeakSymbols=metadata.weakImports,__name(loadModule,"loadModule"),flags.loadAsync?metadata.neededDynlibs.reduce((e,t)=>e.then(()=>loadDynamicLibrary(t,flags,localScope)),Promise.resolve()).then(loadModule):(metadata.neededDynlibs.forEach(e=>loadDynamicLibrary(e,flags,localScope)),loadModule())},"loadWebAssemblyModule"),mergeLibSymbols=__name((e,t)=>{for(var[i,n]of Object.entries(e)){const e=__name(e=>{isSymbolDefined(e)||(wasmImports[e]=n)},"setImport");e(i);const t="__main_argc_argv";"main"==i&&e(t),i==t&&e("main")}},"mergeLibSymbols"),asyncLoad=__name(async e=>{var t=await readAsync(e);return new Uint8Array(t)},"asyncLoad");function loadDynamicLibrary(e,t={global:!0,nodelete:!0},i,n){var r=LDSO.loadedLibsByName[e];if(r)return t.global?r.global||(r.global=!0,mergeLibSymbols(r.exports,e)):i&&Object.assign(i,r.exports),t.nodelete&&r.refcount!==1/0&&(r.refcount=1/0),r.refcount++,n&&(LDSO.loadedLibsByHandle[n]=r),!t.loadAsync||Promise.resolve(!0);function s(){if(n){var i=LE_HEAP_LOAD_U32(4*(n+28>>2)),r=LE_HEAP_LOAD_U32(4*(n+32>>2));if(i&&r){var s=HEAP8.slice(i,i+r);return t.loadAsync?Promise.resolve(s):s}}var o=locateFile(e);if(t.loadAsync)return asyncLoad(o);if(!readBinary)throw new Error(`${o}: file not found, and synchronous loading of external files is not available`);return readBinary(o)}function o(){return t.loadAsync?s().then(r=>loadWebAssemblyModule(r,t,e,i,n)):loadWebAssemblyModule(s(),t,e,i,n)}function a(t){r.global?mergeLibSymbols(t,e):i&&Object.assign(i,t),r.exports=t}return(r=newDSO(e,n,"loading")).refcount=t.nodelete?1/0:1,r.global=t.global,__name(s,"loadLibData"),__name(o,"getExports"),__name(a,"moduleLoaded"),t.loadAsync?o().then(e=>(a(e),!0)):(a(o()),!0)}__name(loadDynamicLibrary,"loadDynamicLibrary");var reportUndefinedSymbols=__name(()=>{for(var[e,t]of Object.entries(GOT))if(0==t.value){var i=resolveGlobalSymbol(e,!0).sym;if(!i&&!t.required)continue;if("function"==typeof i)t.value=addFunction(i,i.sig);else{if("number"!=typeof i)throw new Error(`bad export type for '${e}': ${typeof i}`);t.value=i}}},"reportUndefinedSymbols"),loadDylibs=__name(()=>{dynamicLibraries.length?(addRunDependency(),dynamicLibraries.reduce((e,t)=>e.then(()=>loadDynamicLibrary(t,{loadAsync:!0,global:!0,nodelete:!0,allowUndefined:!0})),Promise.resolve()).then(()=>{reportUndefinedSymbols(),removeRunDependency()})):reportUndefinedSymbols()},"loadDylibs"),noExitRuntime=Module.noExitRuntime||!0;function setValue(e,t,i="i8"){switch(i.endsWith("*")&&(i="*"),i){case"i1":case"i8":HEAP8[e]=t;break;case"i16":LE_HEAP_STORE_I16(2*(e>>1),t);break;case"i32":LE_HEAP_STORE_I32(4*(e>>2),t);break;case"i64":HEAP64[e>>3]=BigInt(t);break;case"float":LE_HEAP_STORE_F32(4*(e>>2),t);break;case"double":LE_HEAP_STORE_F64(8*(e>>3),t);break;case"*":LE_HEAP_STORE_U32(4*(e>>2),t);break;default:abort(`invalid type for setValue: ${i}`)}}__name(setValue,"setValue");var ___memory_base=new WebAssembly.Global({value:"i32",mutable:!1},1024),___stack_pointer=new WebAssembly.Global({value:"i32",mutable:!0},78224),___table_base=new WebAssembly.Global({value:"i32",mutable:!1},1),__abort_js=__name(()=>abort(""),"__abort_js");__abort_js.sig="v";var _emscripten_get_now=__name(()=>performance.now(),"_emscripten_get_now");_emscripten_get_now.sig="d";var _emscripten_date_now=__name(()=>Date.now(),"_emscripten_date_now");_emscripten_date_now.sig="d";var checkWasiClock=__name(e=>e>=0&&e<=3,"checkWasiClock"),INT53_MAX=9007199254740992,INT53_MIN=-9007199254740992,bigintToI53Checked=__name(e=>e<INT53_MIN||e>INT53_MAX?NaN:Number(e),"bigintToI53Checked");function _clock_time_get(e,t,i){if(t=bigintToI53Checked(t),!checkWasiClock(e))return 28;var n;n=0===e?_emscripten_date_now():_emscripten_get_now();var r=Math.round(1e3*n*1e3);return HEAP64[i>>3]=BigInt(r),0}__name(_clock_time_get,"_clock_time_get"),_clock_time_get.sig="iijp";var getHeapMax=__name(()=>2147483648,"getHeapMax"),growMemory=__name(e=>{var t=(e-wasmMemory.buffer.byteLength+65535)/65536|0;try{return wasmMemory.grow(t),updateMemoryViews(),1}catch(i){}},"growMemory"),_emscripten_resize_heap=__name(e=>{var t=HEAPU8.length;e>>>=0;var i=getHeapMax();if(e>i)return!1;for(var n=1;n<=4;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);var s=Math.min(i,alignMemory(Math.max(e,r),65536));if(growMemory(s))return!0}return!1},"_emscripten_resize_heap");_emscripten_resize_heap.sig="ip";var _fd_close=__name(e=>52,"_fd_close");function _fd_seek(e,t,i,n){return t=bigintToI53Checked(t),70}_fd_close.sig="ii",__name(_fd_seek,"_fd_seek"),_fd_seek.sig="iijip";var printCharBuffers=[null,[],[]],printChar=__name((e,t)=>{var i=printCharBuffers[e];0===t||10===t?((1===e?out:err)(UTF8ArrayToString(i)),i.length=0):i.push(t)},"printChar"),_fd_write=__name((e,t,i,n)=>{for(var r=0,s=0;s<i;s++){var o=LE_HEAP_LOAD_U32(4*(t>>2)),a=LE_HEAP_LOAD_U32(4*(t+4>>2));t+=8;for(var l=0;l<a;l++)printChar(e,HEAPU8[o+l]);r+=a}return LE_HEAP_STORE_U32(4*(n>>2),r),0},"_fd_write");function _tree_sitter_log_callback(e,t){if(Module.currentLogCallback){const i=UTF8ToString(t);Module.currentLogCallback(i,0!==e)}}function _tree_sitter_parse_callback(e,t,i,n,r){const s=Module.currentParseCallback(t,{row:i,column:n});"string"==typeof s?(setValue(r,s.length,"i32"),stringToUTF16(s,e,10240)):setValue(r,0,"i32")}function _tree_sitter_progress_callback(e,t){return!!Module.currentProgressCallback&&Module.currentProgressCallback({currentOffset:e,hasError:t})}function _tree_sitter_query_progress_callback(e){return!!Module.currentQueryProgressCallback&&Module.currentQueryProgressCallback({currentOffset:e})}_fd_write.sig="iippp",__name(_tree_sitter_log_callback,"_tree_sitter_log_callback"),__name(_tree_sitter_parse_callback,"_tree_sitter_parse_callback"),__name(_tree_sitter_progress_callback,"_tree_sitter_progress_callback"),__name(_tree_sitter_query_progress_callback,"_tree_sitter_query_progress_callback");var keepRuntimeAlive=__name(()=>noExitRuntime,"keepRuntimeAlive"),_proc_exit=__name(e=>{EXITSTATUS=e,keepRuntimeAlive()||(Module.onExit?.(e),ABORT=!0),quit_(e,new ExitStatus(e))},"_proc_exit");_proc_exit.sig="vi";var exitJS=__name((e,t)=>{EXITSTATUS=e,_proc_exit(e)},"exitJS"),handleException=__name(e=>{if(e instanceof ExitStatus||"unwind"==e)return EXITSTATUS;quit_(1,e)},"handleException"),lengthBytesUTF8=__name(e=>{for(var t=0,i=0;i<e.length;++i){var n=e.charCodeAt(i);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++i):t+=3}return t},"lengthBytesUTF8"),stringToUTF8Array=__name((e,t,i,n)=>{if(!(n>0))return 0;for(var r=i,s=i+n-1,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343)a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o);if(a<=127){if(i>=s)break;t[i++]=a}else if(a<=2047){if(i+1>=s)break;t[i++]=192|a>>6,t[i++]=128|63&a}else if(a<=65535){if(i+2>=s)break;t[i++]=224|a>>12,t[i++]=128|a>>6&63,t[i++]=128|63&a}else{if(i+3>=s)break;t[i++]=240|a>>18,t[i++]=128|a>>12&63,t[i++]=128|a>>6&63,t[i++]=128|63&a}}return t[i]=0,i-r},"stringToUTF8Array"),stringToUTF8=__name((e,t,i)=>stringToUTF8Array(e,HEAPU8,t,i),"stringToUTF8"),stackAlloc=__name(e=>__emscripten_stack_alloc(e),"stackAlloc"),stringToUTF8OnStack=__name(e=>{var t=lengthBytesUTF8(e)+1,i=stackAlloc(t);return stringToUTF8(e,i,t),i},"stringToUTF8OnStack"),AsciiToString=__name(e=>{for(var t="";;){var i=HEAPU8[e++];if(!i)return t;t+=String.fromCharCode(i)}},"AsciiToString"),stringToUTF16=__name((e,t,i)=>{if(i??=2147483647,i<2)return 0;for(var n=t,r=(i-=2)<2*e.length?i/2:e.length,s=0;s<r;++s){var o=e.charCodeAt(s);LE_HEAP_STORE_I16(2*(t>>1),o),t+=2}return LE_HEAP_STORE_I16(2*(t>>1),0),t-n},"stringToUTF16"),wasmImports={__heap_base:___heap_base,__indirect_function_table:wasmTable,__memory_base:___memory_base,__stack_pointer:___stack_pointer,__table_base:___table_base,_abort_js:__abort_js,clock_time_get:_clock_time_get,emscripten_resize_heap:_emscripten_resize_heap,fd_close:_fd_close,fd_seek:_fd_seek,fd_write:_fd_write,memory:wasmMemory,tree_sitter_log_callback:_tree_sitter_log_callback,tree_sitter_parse_callback:_tree_sitter_parse_callback,tree_sitter_progress_callback:_tree_sitter_progress_callback,tree_sitter_query_progress_callback:_tree_sitter_query_progress_callback},wasmExports=await createWasm();wasmExports.__wasm_call_ctors,Module._malloc=wasmExports.malloc;var _calloc=Module._calloc=wasmExports.calloc;Module._realloc=wasmExports.realloc,Module._free=wasmExports.free,Module._memcmp=wasmExports.memcmp,Module._ts_language_symbol_count=wasmExports.ts_language_symbol_count,Module._ts_language_state_count=wasmExports.ts_language_state_count,Module._ts_language_version=wasmExports.ts_language_version,Module._ts_language_abi_version=wasmExports.ts_language_abi_version,Module._ts_language_metadata=wasmExports.ts_language_metadata,Module._ts_language_name=wasmExports.ts_language_name,Module._ts_language_field_count=wasmExports.ts_language_field_count,Module._ts_language_next_state=wasmExports.ts_language_next_state,Module._ts_language_symbol_name=wasmExports.ts_language_symbol_name,Module._ts_language_symbol_for_name=wasmExports.ts_language_symbol_for_name,Module._strncmp=wasmExports.strncmp,Module._ts_language_symbol_type=wasmExports.ts_language_symbol_type,Module._ts_language_field_name_for_id=wasmExports.ts_language_field_name_for_id,Module._ts_lookahead_iterator_new=wasmExports.ts_lookahead_iterator_new,Module._ts_lookahead_iterator_delete=wasmExports.ts_lookahead_iterator_delete,Module._ts_lookahead_iterator_reset_state=wasmExports.ts_lookahead_iterator_reset_state,Module._ts_lookahead_iterator_reset=wasmExports.ts_lookahead_iterator_reset,Module._ts_lookahead_iterator_next=wasmExports.ts_lookahead_iterator_next,Module._ts_lookahead_iterator_current_symbol=wasmExports.ts_lookahead_iterator_current_symbol,Module._ts_parser_delete=wasmExports.ts_parser_delete,Module._ts_parser_reset=wasmExports.ts_parser_reset,Module._ts_parser_set_language=wasmExports.ts_parser_set_language,Module._ts_parser_timeout_micros=wasmExports.ts_parser_timeout_micros,Module._ts_parser_set_timeout_micros=wasmExports.ts_parser_set_timeout_micros,Module._ts_parser_set_included_ranges=wasmExports.ts_parser_set_included_ranges,Module._ts_query_new=wasmExports.ts_query_new,Module._ts_query_delete=wasmExports.ts_query_delete,Module._iswspace=wasmExports.iswspace,Module._iswalnum=wasmExports.iswalnum,Module._ts_query_pattern_count=wasmExports.ts_query_pattern_count,Module._ts_query_capture_count=wasmExports.ts_query_capture_count,Module._ts_query_string_count=wasmExports.ts_query_string_count,Module._ts_query_capture_name_for_id=wasmExports.ts_query_capture_name_for_id,Module._ts_query_capture_quantifier_for_id=wasmExports.ts_query_capture_quantifier_for_id,Module._ts_query_string_value_for_id=wasmExports.ts_query_string_value_for_id,Module._ts_query_predicates_for_pattern=wasmExports.ts_query_predicates_for_pattern,Module._ts_query_start_byte_for_pattern=wasmExports.ts_query_start_byte_for_pattern,Module._ts_query_end_byte_for_pattern=wasmExports.ts_query_end_byte_for_pattern,Module._ts_query_is_pattern_rooted=wasmExports.ts_query_is_pattern_rooted,Module._ts_query_is_pattern_non_local=wasmExports.ts_query_is_pattern_non_local,Module._ts_query_is_pattern_guaranteed_at_step=wasmExports.ts_query_is_pattern_guaranteed_at_step,Module._ts_query_disable_capture=wasmExports.ts_query_disable_capture,Module._ts_query_disable_pattern=wasmExports.ts_query_disable_pattern,Module._ts_tree_copy=wasmExports.ts_tree_copy,Module._ts_tree_delete=wasmExports.ts_tree_delete,Module._ts_init=wasmExports.ts_init,Module._ts_parser_new_wasm=wasmExports.ts_parser_new_wasm,Module._ts_parser_enable_logger_wasm=wasmExports.ts_parser_enable_logger_wasm,Module._ts_parser_parse_wasm=wasmExports.ts_parser_parse_wasm,Module._ts_parser_included_ranges_wasm=wasmExports.ts_parser_included_ranges_wasm,Module._ts_language_type_is_named_wasm=wasmExports.ts_language_type_is_named_wasm,Module._ts_language_type_is_visible_wasm=wasmExports.ts_language_type_is_visible_wasm,Module._ts_language_supertypes_wasm=wasmExports.ts_language_supertypes_wasm,Module._ts_language_subtypes_wasm=wasmExports.ts_language_subtypes_wasm,Module._ts_tree_root_node_wasm=wasmExports.ts_tree_root_node_wasm,Module._ts_tree_root_node_with_offset_wasm=wasmExports.ts_tree_root_node_with_offset_wasm,Module._ts_tree_edit_wasm=wasmExports.ts_tree_edit_wasm,Module._ts_tree_included_ranges_wasm=wasmExports.ts_tree_included_ranges_wasm,Module._ts_tree_get_changed_ranges_wasm=wasmExports.ts_tree_get_changed_ranges_wasm,Module._ts_tree_cursor_new_wasm=wasmExports.ts_tree_cursor_new_wasm,Module._ts_tree_cursor_copy_wasm=wasmExports.ts_tree_cursor_copy_wasm,Module._ts_tree_cursor_delete_wasm=wasmExports.ts_tree_cursor_delete_wasm,Module._ts_tree_cursor_reset_wasm=wasmExports.ts_tree_cursor_reset_wasm,Module._ts_tree_cursor_reset_to_wasm=wasmExports.ts_tree_cursor_reset_to_wasm,Module._ts_tree_cursor_goto_first_child_wasm=wasmExports.ts_tree_cursor_goto_first_child_wasm,Module._ts_tree_cursor_goto_last_child_wasm=wasmExports.ts_tree_cursor_goto_last_child_wasm,Module._ts_tree_cursor_goto_first_child_for_index_wasm=wasmExports.ts_tree_cursor_goto_first_child_for_index_wasm,Module._ts_tree_cursor_goto_first_child_for_position_wasm=wasmExports.ts_tree_cursor_goto_first_child_for_position_wasm,Module._ts_tree_cursor_goto_next_sibling_wasm=wasmExports.ts_tree_cursor_goto_next_sibling_wasm,Module._ts_tree_cursor_goto_previous_sibling_wasm=wasmExports.ts_tree_cursor_goto_previous_sibling_wasm,Module._ts_tree_cursor_goto_descendant_wasm=wasmExports.ts_tree_cursor_goto_descendant_wasm,Module._ts_tree_cursor_goto_parent_wasm=wasmExports.ts_tree_cursor_goto_parent_wasm,Module._ts_tree_cursor_current_node_type_id_wasm=wasmExports.ts_tree_cursor_current_node_type_id_wasm,Module._ts_tree_cursor_current_node_state_id_wasm=wasmExports.ts_tree_cursor_current_node_state_id_wasm,Module._ts_tree_cursor_current_node_is_named_wasm=wasmExports.ts_tree_cursor_current_node_is_named_wasm,Module._ts_tree_cursor_current_node_is_missing_wasm=wasmExports.ts_tree_cursor_current_node_is_missing_wasm,Module._ts_tree_cursor_current_node_id_wasm=wasmExports.ts_tree_cursor_current_node_id_wasm,Module._ts_tree_cursor_start_position_wasm=wasmExports.ts_tree_cursor_start_position_wasm,Module._ts_tree_cursor_end_position_wasm=wasmExports.ts_tree_cursor_end_position_wasm,Module._ts_tree_cursor_start_index_wasm=wasmExports.ts_tree_cursor_start_index_wasm,Module._ts_tree_cursor_end_index_wasm=wasmExports.ts_tree_cursor_end_index_wasm,Module._ts_tree_cursor_current_field_id_wasm=wasmExports.ts_tree_cursor_current_field_id_wasm,Module._ts_tree_cursor_current_depth_wasm=wasmExports.ts_tree_cursor_current_depth_wasm,Module._ts_tree_cursor_current_descendant_index_wasm=wasmExports.ts_tree_cursor_current_descendant_index_wasm,Module._ts_tree_cursor_current_node_wasm=wasmExports.ts_tree_cursor_current_node_wasm,Module._ts_node_symbol_wasm=wasmExports.ts_node_symbol_wasm,Module._ts_node_field_name_for_child_wasm=wasmExports.ts_node_field_name_for_child_wasm,Module._ts_node_field_name_for_named_child_wasm=wasmExports.ts_node_field_name_for_named_child_wasm,Module._ts_node_children_by_field_id_wasm=wasmExports.ts_node_children_by_field_id_wasm,Module._ts_node_first_child_for_byte_wasm=wasmExports.ts_node_first_child_for_byte_wasm,Module._ts_node_first_named_child_for_byte_wasm=wasmExports.ts_node_first_named_child_for_byte_wasm,Module._ts_node_grammar_symbol_wasm=wasmExports.ts_node_grammar_symbol_wasm,Module._ts_node_child_count_wasm=wasmExports.ts_node_child_count_wasm,Module._ts_node_named_child_count_wasm=wasmExports.ts_node_named_child_count_wasm,Module._ts_node_child_wasm=wasmExports.ts_node_child_wasm,Module._ts_node_named_child_wasm=wasmExports.ts_node_named_child_wasm,Module._ts_node_child_by_field_id_wasm=wasmExports.ts_node_child_by_field_id_wasm,Module._ts_node_next_sibling_wasm=wasmExports.ts_node_next_sibling_wasm,Module._ts_node_prev_sibling_wasm=wasmExports.ts_node_prev_sibling_wasm,Module._ts_node_next_named_sibling_wasm=wasmExports.ts_node_next_named_sibling_wasm,Module._ts_node_prev_named_sibling_wasm=wasmExports.ts_node_prev_named_sibling_wasm,Module._ts_node_descendant_count_wasm=wasmExports.ts_node_descendant_count_wasm,Module._ts_node_parent_wasm=wasmExports.ts_node_parent_wasm,Module._ts_node_child_with_descendant_wasm=wasmExports.ts_node_child_with_descendant_wasm,Module._ts_node_descendant_for_index_wasm=wasmExports.ts_node_descendant_for_index_wasm,Module._ts_node_named_descendant_for_index_wasm=wasmExports.ts_node_named_descendant_for_index_wasm,Module._ts_node_descendant_for_position_wasm=wasmExports.ts_node_descendant_for_position_wasm,Module._ts_node_named_descendant_for_position_wasm=wasmExports.ts_node_named_descendant_for_position_wasm,Module._ts_node_start_point_wasm=wasmExports.ts_node_start_point_wasm,Module._ts_node_end_point_wasm=wasmExports.ts_node_end_point_wasm,Module._ts_node_start_index_wasm=wasmExports.ts_node_start_index_wasm,Module._ts_node_end_index_wasm=wasmExports.ts_node_end_index_wasm,Module._ts_node_to_string_wasm=wasmExports.ts_node_to_string_wasm,Module._ts_node_children_wasm=wasmExports.ts_node_children_wasm,Module._ts_node_named_children_wasm=wasmExports.ts_node_named_children_wasm,Module._ts_node_descendants_of_type_wasm=wasmExports.ts_node_descendants_of_type_wasm,Module._ts_node_is_named_wasm=wasmExports.ts_node_is_named_wasm,Module._ts_node_has_changes_wasm=wasmExports.ts_node_has_changes_wasm,Module._ts_node_has_error_wasm=wasmExports.ts_node_has_error_wasm,Module._ts_node_is_error_wasm=wasmExports.ts_node_is_error_wasm,Module._ts_node_is_missing_wasm=wasmExports.ts_node_is_missing_wasm,Module._ts_node_is_extra_wasm=wasmExports.ts_node_is_extra_wasm,Module._ts_node_parse_state_wasm=wasmExports.ts_node_parse_state_wasm,Module._ts_node_next_parse_state_wasm=wasmExports.ts_node_next_parse_state_wasm,Module._ts_query_matches_wasm=wasmExports.ts_query_matches_wasm,Module._ts_query_captures_wasm=wasmExports.ts_query_captures_wasm,Module._memset=wasmExports.memset,Module._memcpy=wasmExports.memcpy,Module._memmove=wasmExports.memmove,Module._iswalpha=wasmExports.iswalpha,Module._iswblank=wasmExports.iswblank,Module._iswdigit=wasmExports.iswdigit,Module._iswlower=wasmExports.iswlower,Module._iswupper=wasmExports.iswupper,Module._iswxdigit=wasmExports.iswxdigit,Module._memchr=wasmExports.memchr,Module._strlen=wasmExports.strlen,Module._strcmp=wasmExports.strcmp,Module._strncat=wasmExports.strncat,Module._strncpy=wasmExports.strncpy,Module._towlower=wasmExports.towlower,Module._towupper=wasmExports.towupper;var _setThrew=wasmExports.setThrew,__emscripten_stack_restore=wasmExports._emscripten_stack_restore,__emscripten_stack_alloc=wasmExports._emscripten_stack_alloc,_emscripten_stack_get_current=wasmExports.emscripten_stack_get_current;function callMain(e=[]){var t=resolveGlobalSymbol("main").sym;if(t){e.unshift(thisProgram);var i=e.length,n=stackAlloc(4*(i+1)),r=n;e.forEach(e=>{LE_HEAP_STORE_U32(4*(r>>2),stringToUTF8OnStack(e)),r+=4}),LE_HEAP_STORE_U32(4*(r>>2),0);try{var s=t(i,n);return exitJS(s,!0),s}catch(o){return handleException(o)}}}function run(e=arguments_){function t(){(Module.calledRun=!0,ABORT)||(initRuntime(),readyPromiseResolve(Module),Module.onRuntimeInitialized?.(),Module.noInitialRun||callMain(e),postRun())}runDependencies>0?dependenciesFulfilled=run:(preRun(),runDependencies>0?dependenciesFulfilled=run:(__name(t,"doRun"),Module.setStatus?(Module.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>Module.setStatus(""),1),t()},1)):t()))}if(wasmExports.__wasm_apply_data_relocs,Module.setValue=setValue,Module.getValue=getValue,Module.UTF8ToString=UTF8ToString,Module.stringToUTF8=stringToUTF8,Module.lengthBytesUTF8=lengthBytesUTF8,Module.AsciiToString=AsciiToString,Module.stringToUTF16=stringToUTF16,Module.loadWebAssemblyModule=loadWebAssemblyModule,__name(callMain,"callMain"),__name(run,"run"),Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();return run(),moduleRtn=readyPromise,moduleRtn}})(),tree_sitter_default=Module2,Module3=null,TRANSFER_BUFFER,LANGUAGE_VERSION,MIN_COMPATIBLE_VERSION;async function initializeBinding(e){return Module3||(Module3=await tree_sitter_default(e)),Module3}function checkModule(){return!!Module3}__name(initializeBinding,"initializeBinding"),__name(checkModule,"checkModule");var Parser=class{static{__name(this,"Parser")}0=0;1=0;logCallback=null;language=null;static async init(e){setModule(await initializeBinding(e)),TRANSFER_BUFFER=C._ts_init(),LANGUAGE_VERSION=C.getValue(TRANSFER_BUFFER,"i32"),MIN_COMPATIBLE_VERSION=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32")}constructor(){this.initialize()}initialize(){if(!checkModule())throw new Error("cannot construct a Parser before calling `init()`");C._ts_parser_new_wasm(),this[0]=C.getValue(TRANSFER_BUFFER,"i32"),this[1]=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32")}delete(){C._ts_parser_delete(this[0]),C._free(this[1]),this[0]=0,this[1]=0}setLanguage(e){let t;if(e){if(e.constructor!==Language)throw new Error("Argument must be a Language");{t=e[0];const i=C._ts_language_version(t);if(i<MIN_COMPATIBLE_VERSION||LANGUAGE_VERSION<i)throw new Error(`Incompatible language version ${i}. Compatibility range ${MIN_COMPATIBLE_VERSION} through ${LANGUAGE_VERSION}.`);this.language=e}}else t=0,this.language=null;return C._ts_parser_set_language(this[0],t),this}parse(e,t,i){if("string"==typeof e)C.currentParseCallback=t=>e.slice(t);else{if("function"!=typeof e)throw new Error("Argument must be a string or a function");C.currentParseCallback=e}C.currentProgressCallback=i?.progressCallback?i.progressCallback:null,this.logCallback?(C.currentLogCallback=this.logCallback,C._ts_parser_enable_logger_wasm(this[0],1)):(C.currentLogCallback=null,C._ts_parser_enable_logger_wasm(this[0],0));let n=0,r=0;if(i?.includedRanges){n=i.includedRanges.length,r=C._calloc(n,SIZE_OF_RANGE);let e=r;for(let t=0;t<n;t++)marshalRange(e,i.includedRanges[t]),e+=SIZE_OF_RANGE}const s=C._ts_parser_parse_wasm(this[0],this[1],t?t[0]:0,r,n);if(!s)return C.currentParseCallback=null,C.currentLogCallback=null,C.currentProgressCallback=null,null;if(!this.language)throw new Error("Parser must have a language to parse");const o=new Tree(INTERNAL,s,this.language,C.currentParseCallback);return C.currentParseCallback=null,C.currentLogCallback=null,C.currentProgressCallback=null,o}reset(){C._ts_parser_reset(this[0])}getIncludedRanges(){C._ts_parser_included_ranges_wasm(this[0]);const e=C.getValue(TRANSFER_BUFFER,"i32"),t=C.getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),i=new Array(e);if(e>0){let n=t;for(let t=0;t<e;t++)i[t]=unmarshalRange(n),n+=SIZE_OF_RANGE;C._free(t)}return i}getTimeoutMicros(){return C._ts_parser_timeout_micros(this[0])}setTimeoutMicros(e){C._ts_parser_set_timeout_micros(this[0],0,e)}setLogger(e){if(e){if("function"!=typeof e)throw new Error("Logger callback must be a function");this.logCallback=e}else this.logCallback=null;return this}getLogger(){return this.logCallback}};function buildIdentifier(e){return{type:"identifier",name:e.text}}function buildQualifiedIdentifier(e){const t=e.child(0),i=e.child(2);if(!t||!i)throw new Error("Qualified identifier missing table or column");return{type:"qualified_identifier",table:buildIdentifier(t),column:buildIdentifier(i)}}function buildStringLiteral(e){return{type:"string_literal",value:e.text.slice(1,-1)}}function buildNumberLiteral(e){return{type:"number_literal",value:parseFloat(e.text)}}function buildBooleanLiteral(e){return{type:"boolean_literal",value:"true"===e.text}}function buildNullLiteral(e){return{type:"null_literal",value:null}}function buildDynamicLiteral(e){let t="";for(let i=0;i<e.childCount;i++){const n=e.child(i);if(n&&"dynamic"!==n.type&&"("!==n.text&&")"!==n.text){t=n.text;break}}return{type:"dynamic_literal",value:t}}function buildDatetimeLiteral(e){let t="";for(let i=0;i<e.childCount;i++){const n=e.child(i);if(n&&"datetime"!==n.type&&"("!==n.text&&")"!==n.text){t=n.text;break}}return{type:"datetime_literal",value:t}}function buildTimespanLiteral(e){return{type:"timespan_literal",value:e.text}}function buildBinaryExpression(e,t){const i=e.child(0),n=e.child(1),r=e.child(2);if(!i||!n||!r)throw new Error("Binary expression missing operands");return{type:"binary_expression",operator:n.text,left:t(i),right:t(r)}}function buildComparisonExpression(e,t){const i=e.child(0),n=e.child(1),r=e.child(2);if(!i||!n||!r)throw new Error("Comparison expression missing operands");return{type:"comparison_expression",operator:n.text,left:buildIdentifier(i),right:t(r)}}function buildArithmeticExpression(e,t){const i=e.child(0),n=e.child(1),r=e.child(2);if(!i||!n||!r)throw new Error("Arithmetic expression missing operands");return{type:"arithmetic_expression",operator:n.text,left:t(i),right:t(r)}}function buildParenthesizedExpression(e,t){const i=e.children.find(e=>"("!==e.type&&")"!==e.type);if(!i)throw new Error("Parenthesized expression missing expression");return{type:"parenthesized_expression",expression:t(i)}}function buildConditionalExpression(e,t){const i=e.child(0)?.text;if("iff"!==i&&"case"!==i)throw new Error("Conditional expression must be iff or case");const n=[];for(let r=0;r<e.childCount;r++){const i=e.child(r);i&&("expression"===i.type||i.type.includes("_expression")||"identifier"===i.type||"literal"===i.type)&&n.push(t(i))}return{type:"conditional_expression",function:i,arguments:n}}function buildFunctionCall(e,t){const i=e.child(0);if(!i||"identifier"!==i.type)throw new Error("Function call missing name");const n=e.children.find(e=>"argument_list"===e.type),r=[];if(n)for(let s=0;s<n.childCount;s++){const e=n.child(s);if(e&&"argument"===e.type){const i=e.child(0);i&&("named_argument"===i.type?r.push(buildNamedArgument(i,t)):r.push(t(i)))}else e&&","!==e.type&&r.push(t(e))}return{type:"function_call",name:buildIdentifier(i),arguments:r}}function buildNamedArgument(e,t){const i=e.child(0),n=e.child(2);if(!i||!n)throw new Error("Named argument missing name or value");return{type:"named_argument",name:buildIdentifier(i),value:t(n)}}function buildTypeCastExpression(e,t){const i=e.children.some(e=>"::"===e.text);if(i){const i=e.child(0),n=e.child(2);if(!i||!n)throw new Error("Type cast expression missing expression or type");return{type:"type_cast_expression",expression:t(i),targetType:n.text}}{const i=e.child(1),n=e.children.find(e=>"expression"===e.type||e.type.includes("_expression")||"identifier"===e.type);if(!i||!n)throw new Error("Type cast expression missing type or expression");return{type:"type_cast_expression",expression:t(n),targetType:i.text}}}function buildStringExpression(e){const t=e.child(0),i=e.child(1),n=e.child(2);if(!t||!i||!n)throw new Error("String expression missing operands");return{type:"string_expression",operator:i.text,left:buildIdentifier(t),right:buildStringLiteral(n)}}function buildInExpression(e,t){const i=e.child(0),n=e.children.find(e=>"literal_list"===e.type);if(!i)throw new Error("In expression missing left operand");if(!n)throw new Error("In expression missing literal list");const r=[];for(let s=0;s<n.childCount;s++){const e=n.child(s);!e||"string_literal"!==e.type&&"number_literal"!==e.type&&"boolean_literal"!==e.type&&"null_literal"!==e.type||r.push(t(e))}return{type:"in_expression",left:buildIdentifier(i),values:r}}function buildBetweenExpression(e,t){const i=e.child(0),n=e.children.filter(e=>"string_literal"===e.type||"number_literal"===e.type||"boolean_literal"===e.type||"null_literal"===e.type);if(!i)throw new Error("Between expression missing left operand");if(2!==n.length)throw new Error("Between expression requires exactly two literal values");return{type:"between_expression",left:buildIdentifier(i),min:t(n[0]),max:t(n[1])}}function buildWhereClause(e,t){const i=e.children.find(e=>"where"!==e.type);if(!i)throw new Error("Where clause missing expression");return{type:"where_clause",expression:t(i)}}function buildProjectClause(e,t){const i=e.children.find(e=>"column_list"===e.type);if(!i)throw new Error("Project clause missing column list");const n=[];for(let r=0;r<i.childCount;r++){const e=i.child(r);if(e&&("column_expression"===e.type||"identifier"===e.type||"column_assignment"===e.type)){const i="column_expression"===e.type?e.child(0):e;if(i){const e=t(i);"identifier"!==e.type&&"column_assignment"!==e.type||n.push(e)}}}return{type:"project_clause",columns:n}}function buildExtendClause(e,t){const i=e.children.find(e=>"column_list"===e.type);if(!i)throw new Error("Extend clause missing column list");const n=[];for(let r=0;r<i.childCount;r++){const e=i.child(r);if(e&&("column_expression"===e.type||"identifier"===e.type||"column_assignment"===e.type)){const i="column_expression"===e.type?e.child(0):e;if(i){const e=t(i);"identifier"!==e.type&&"column_assignment"!==e.type||n.push(e)}}}return{type:"extend_clause",columns:n}}function buildSummarizeClause(e,t){const i=e.children.find(e=>"aggregation_list"===e.type);if(!i)throw new Error("Summarize clause missing aggregation list");const n=[];for(let o=0;o<i.childCount;o++){const e=i.child(o);e&&"aggregation_expression"===e.type&&n.push(buildAggregationExpression(e,t))}const r=e.children.findIndex(e=>"by"===e.text);let s;if(-1!==r){const i=e.children[r+1];if(i&&"expression_list"===i.type){s=[];for(let e=0;e<i.childCount;e++){const n=i.child(e);n&&","!==n.type&&s.push(t(n))}}}return{type:"summarize_clause",aggregations:n,by:s}}function buildAggregationExpression(e,t){const i=e.children.some(e=>"="===e.text);if(i){const i=e.child(0),n=e.child(2);if(!i||!n)throw new Error("Aggregation expression missing name or value");return{type:"aggregation_expression",name:buildIdentifier(i),aggregation:t(n)}}const n=e.child(0);if(!n)throw new Error("Aggregation expression missing expression");return{type:"aggregation_expression",aggregation:t(n)}}function buildJoinClause(e){let t;const i=e.children.find(e=>"join_kind"===e.type);i&&(t=i.text);const n=e.children.find(e=>"table_name"===e.type);if(!n)throw new Error("Join clause missing right table");const r=e.children.find(e=>"join_conditions"===e.type);if(!r)throw new Error("Join clause missing conditions");const s=[];for(let o=0;o<r.childCount;o++){const e=r.child(o);e&&"join_condition"===e.type&&s.push(buildJoinCondition(e))}return{type:"join_clause",kind:t,rightTable:buildIdentifier(n),conditions:s}}function buildJoinCondition(e){if(1===e.childCount&&"identifier"===e.child(0)?.type){const t=buildIdentifier(e.child(0));return{type:"join_condition",left:t,right:t}}let t=null,i=null;for(let n=0;n<e.childCount;n++){const r=e.child(n);if(r&&"identifier"===r.type)if(t){if(!i){i=r;break}}else t=r}if(!t||!i)throw new Error("Join condition missing identifiers");return{type:"join_condition",left:buildIdentifier(t),right:buildIdentifier(i)}}function buildColumnAssignment(e,t){const i=e.child(0),n=e.child(2);if(!i||!n)throw new Error("Column assignment missing name or value");return{type:"column_assignment",name:buildIdentifier(i),value:t(n)}}function buildUnionClause(e){let t;const i=e.children.find(e=>"union_kind"===e.type);let n;i&&(t=i.text);const r=e.children.findIndex(e=>"isfuzzy"===e.text);if(-1!==r){const t=e.children[r+2];!t||"true"!==t.text&&"false"!==t.text||(n="true"===t.text)}const s=e.children.find(e=>"table_list"===e.type);if(!s)throw new Error("Union clause missing table list");const o=[];for(let a=0;a<s.childCount;a++){const e=s.child(a);e&&"table_name"===e.type&&o.push(buildIdentifier(e))}return{type:"union_clause",kind:t,isfuzzy:n,tables:o}}function buildParseClause(e,t){let i;const n=e.children.find(e=>"parse_kind"===e.type);n&&(i=n.text);const r=e.children.find(e=>"expression"===e.type||"identifier"===e.type);if(!r)throw new Error("Parse clause missing source expression");const s=e.children.find(e=>"string_literal"===e.type);if(!s)throw new Error("Parse clause missing pattern");return{type:"parse_clause",kind:i,source:t(r),pattern:buildStringLiteral(s)}}function buildMvExpandClause(e,t){const i=e.children.find(e=>"expression"===e.type||"identifier"===e.type);if(!i)throw new Error("MV-expand clause missing column expression");let n;const r=e.children.findIndex(e=>"to"===e.text);if(-1!==r)for(let a=r+1;a<e.children.length;a++){const t=e.children[a];if(t&&"identifier"===t.type){n=buildIdentifier(t);break}}let s;const o=e.children.findIndex(e=>"limit"===e.text);if(-1!==o){const t=e.children[o+1];t&&"number_literal"===t.type&&(s=buildNumberLiteral(t))}return{type:"mv_expand_clause",column:t(i),to:n,limit:s}}function buildTakeClause(e){const t=e.children.find(e=>"number_literal"===e.type);if(!t)throw new Error("Take clause missing count");return{type:"take_clause",count:buildNumberLiteral(t)}}function buildLimitClause(e){const t=e.children.find(e=>"number_literal"===e.type);if(!t)throw new Error("Limit clause missing count");return{type:"limit_clause",count:buildNumberLiteral(t)}}function buildSortClause(e){const t=e.children.find(e=>"sort_expression_list"===e.type);if(!t)throw new Error("Sort clause missing expression list");const i=[];for(let n=0;n<t.childCount;n++){const e=t.child(n);e&&"sort_expression"===e.type&&i.push(buildSortExpression(e))}return{type:"sort_clause",expressions:i}}function buildSortExpression(e){const t=e.children.find(e=>"identifier"===e.type);if(!t)throw new Error("Sort expression missing column identifier");const i=e.children.find(e=>"asc"===e.text||"desc"===e.text);return{type:"sort_expression",column:buildIdentifier(t),direction:i?.text}}function buildDistinctClause(e,t){const i=e.children.find(e=>"column_list"===e.type);if(!i)return{type:"distinct_clause"};const n=[];for(let r=0;r<i.childCount;r++){const e=i.child(r);if(e&&("column_expression"===e.type||"identifier"===e.type||"column_assignment"===e.type)){const i="column_expression"===e.type?e.child(0):e;if(i){const e=t(i);"identifier"!==e.type&&"column_assignment"!==e.type||n.push(e)}}}return{type:"distinct_clause",columns:n}}function buildCountClause(e){return{type:"count_clause"}}function buildTopClause(e){const t=e.children.find(e=>"number_literal"===e.type);if(!t)throw new Error("Top clause missing count");const i=e.children.findIndex(e=>"by"===e.text);if(-1!==i){const n=e.children[i+1],r=e.children[i+2];if(n&&"identifier"===n.type)return{type:"top_clause",count:buildNumberLiteral(t),by:{column:buildIdentifier(n),direction:"asc"===r?.text||"desc"===r?.text?r.text:void 0}}}return{type:"top_clause",count:buildNumberLiteral(t)}}function buildSearchClause(e,t){const i=e.children.find(e=>"string_literal"===e.type);if(!i)throw new Error("Search clause missing search term");const n=e.children.find(e=>"column_list"===e.type);if(!n)return{type:"search_clause",term:buildStringLiteral(i)};const r=[];for(let s=0;s<n.childCount;s++){const e=n.child(s);if(e&&("column_expression"===e.type||"identifier"===e.type||"column_assignment"===e.type)){const i="column_expression"===e.type?e.child(0):e;if(i){const e=t(i);"identifier"!==e.type&&"column_assignment"!==e.type||r.push(e)}}}return{type:"search_clause",columns:r,term:buildStringLiteral(i)}}function buildSourceFile(e,t){const i=[];for(let n=0;n<e.childCount;n++){const r=e.child(n);r&&"let_statement"===r.type?i.push(buildLetStatement(r,t)):r&&"query_statement"===r.type&&i.push(buildQueryStatement(r,t))}return{type:"source_file",statements:i}}function buildLetStatement(e,t){const i=e.children.find(e=>"identifier"===e.type);if(!i)throw new Error("Let statement missing variable name");const n=e.children.find(e=>"expression"===e.type||e.type.includes("_expression")||"literal"===e.type||"function_call"===e.type);if(!n)throw new Error("Let statement missing value expression");return{type:"let_statement",name:buildIdentifier(i),value:t(n)}}function buildQueryStatement(e,t){const i=e.child(0),n=[];if(!i)throw new Error("Query statement missing table name");for(let r=1;r<e.childCount;r++){const i=e.child(r);i&&"pipe_expression"===i.type&&n.push(buildPipeExpression(i,t))}return{type:"query_statement",table:buildIdentifier(i),pipes:n}}function buildPipeExpression(e,t){const i=e.children.find(e=>"|"!==e.type);if(!i)throw new Error("Pipe expression missing operator");return{type:"pipe_expression",operator:t(i)}}function buildAST(e){switch(e.type){case"source_file":return buildSourceFile(e,buildAST);case"let_statement":return buildLetStatement(e,buildAST);case"query_statement":return buildQueryStatement(e,buildAST);case"pipe_expression":return buildPipeExpression(e,buildAST);case"operator":case"expression":case"literal":return buildAST(e.firstNamedChild);case"where_clause":return buildWhereClause(e,buildAST);case"project_clause":return buildProjectClause(e,buildAST);case"extend_clause":return buildExtendClause(e,buildAST);case"summarize_clause":return buildSummarizeClause(e,buildAST);case"aggregation_expression":return buildAggregationExpression(e,buildAST);case"join_clause":return buildJoinClause(e);case"union_clause":return buildUnionClause(e);case"parse_clause":return buildParseClause(e,buildAST);case"mv_expand_clause":return buildMvExpandClause(e,buildAST);case"take_clause":return buildTakeClause(e);case"limit_clause":return buildLimitClause(e);case"sort_clause":return buildSortClause(e);case"distinct_clause":return buildDistinctClause(e,buildAST);case"count_clause":return buildCountClause();case"top_clause":return buildTopClause(e);case"search_clause":return buildSearchClause(e,buildAST);case"column_assignment":return buildColumnAssignment(e,buildAST);case"conditional_expression":return buildConditionalExpression(e,buildAST);case"function_call":return buildFunctionCall(e,buildAST);case"named_argument":return buildNamedArgument(e,buildAST);case"type_cast_expression":return buildTypeCastExpression(e,buildAST);case"binary_expression":return buildBinaryExpression(e,buildAST);case"comparison_expression":return buildComparisonExpression(e,buildAST);case"arithmetic_expression":return buildArithmeticExpression(e,buildAST);case"string_expression":return buildStringExpression(e);case"in_expression":return buildInExpression(e,buildAST);case"between_expression":return buildBetweenExpression(e,buildAST);case"parenthesized_expression":return buildParenthesizedExpression(e,buildAST);case"identifier":return buildIdentifier(e);case"qualified_identifier":return buildQualifiedIdentifier(e);case"string_literal":return buildStringLiteral(e);case"number_literal":return buildNumberLiteral(e);case"boolean_literal":return buildBooleanLiteral(e);case"null_literal":return buildNullLiteral();case"dynamic_literal":return buildDynamicLiteral(e);case"datetime_literal":return buildDatetimeLiteral(e);case"timespan_literal":return buildTimespanLiteral(e);default:throw new Error(`Unknown node type: ${e.type}`)}}const variableMap=new Map;function translate(e){if(0===e.statements.length)return"";variableMap.clear();let t=null;for(const i of e.statements)if("let_statement"===i.type){const e=i;variableMap.set(e.name.name,e.value)}else"query_statement"===i.type&&(t=i);if(!t)throw new Error("No query statement found");return translateQuery(t)}function translateQuery(e){const t=e.table.name,i=[];let n=t,r=0;for(const s of e.pipes){if("union_clause"===s.operator.type){return translateUnion(s.operator,t)}const e="cte_"+r++,o=translatePipe(s.operator,n);i.push(`${e} AS (${o})`),n=e}return 0===i.length?`SELECT * FROM ${t}`:`WITH ${i.join(", ")} SELECT * FROM ${n}`}function translatePipe(e,t){switch(e.type){case"where_clause":return translateWhere(e,t);case"project_clause":return translateProject(e,t);case"take_clause":return translateTake(e,t);case"limit_clause":return translateLimit(e,t);case"summarize_clause":return translateSummarize(e,t);case"extend_clause":return translateExtend(e,t);case"sort_clause":return translateSort(e,t);case"distinct_clause":return translateDistinct(e,t);case"join_clause":return translateJoin(e,t);case"top_clause":return translateTop(e,t);case"mv_expand_clause":return translateMvExpand(e,t);case"search_clause":return translateSearch(e,t);default:throw new Error(`Unsupported operator: ${e.type}`)}}function translateWhere(e,t){return`SELECT * FROM ${t} WHERE ${translateExpression(e.expression)}`}function translateProject(e,t){return`SELECT ${e.columns.map(translateColumnExpression).join(", ")} FROM ${t}`}function translateSummarize(e,t){const i=e.aggregations.map(e=>{const t=translateExpression(e.aggregation);return e.name?`${t} AS ${e.name.name}`:t}),n=e.by?e.by.map(translateExpression):[];return`SELECT ${[...n,...i].join(", ")} FROM ${t}${n.length>0?` GROUP BY ${n.join(", ")}`:""}`}function translateTake(e,t){return`SELECT * FROM ${t} LIMIT ${e.count.value}`}function translateLimit(e,t){return`SELECT * FROM ${t} LIMIT ${e.count.value}`}function translateExtend(e,t){return`SELECT *, ${e.columns.map(translateColumnExpression).join(", ")} FROM ${t}`}function translateSort(e,t){return`SELECT * FROM ${t} ORDER BY ${e.expressions.map(translateSortExpression).join(", ")}`}function translateSortExpression(e){return`${e.column.name} ${e.direction?e.direction.toUpperCase():"ASC"}`}function translateDistinct(e,t){if(e.columns&&e.columns.length>0){return`SELECT DISTINCT ${e.columns.map(translateColumnExpression).join(", ")} FROM ${t}`}return`SELECT DISTINCT * FROM ${t}`}function translateJoin(e,t){const i=e.kind||"inner",n=e.rightTable.name,r={inner:"INNER",leftouter:"LEFT OUTER",rightouter:"RIGHT OUTER",fullouter:"FULL OUTER",leftanti:"LEFT ANTI",rightanti:"RIGHT ANTI",leftsemi:"LEFT SEMI",rightsemi:"RIGHT SEMI"}[i]||"INNER",s=e.conditions.map(e=>{const i=e.left.name,r=e.right.name;return`${t}.${i} = ${n}.${r}`}).join(" AND ");return`SELECT * FROM ${t} ${r} JOIN ${n} ON ${s}`}function translateTop(e,t){const i=e.count.value;if(e.by){return`SELECT * FROM ${t} ORDER BY ${e.by.column.name} ${e.by.direction?e.by.direction.toUpperCase():"DESC"} LIMIT ${i}`}return`SELECT * FROM ${t} LIMIT ${i}`}function translateUnion(e,t){const i="outer"===(e.kind||"inner")?" ALL":"",n=[t,...e.tables.map(e=>e.name)].map(e=>`SELECT * FROM ${e}`);return n.join(`\nUNION${i}\n`)}function translateTimespanLiteral(e){const t=e.value,i=t.match(/^(\d+)([dhms])$/);if(!i)return`INTERVAL '${t}'`;return`INTERVAL '${i[1]} ${{d:"day",h:"hour",m:"minute",s:"second"}[i[2]]}'`}function translateColumnExpression(e){if("identifier"===e.type)return e.name;if("column_assignment"===e.type)return`${translateExpression(e.value)} AS ${e.name.name}`;throw new Error("Unsupported column expression type")}function translateExpression(e){switch(e.type){case"binary_expression":return translateBinaryExpression(e);case"comparison_expression":return translateComparisonExpression(e);case"arithmetic_expression":return translateArithmeticExpression(e);case"string_expression":return translateStringExpression(e);case"function_call":return translateFunctionCall(e);case"identifier":if(variableMap.has(e.name)){return`(${translateExpression(variableMap.get(e.name))})`}return e.name;case"string_literal":return`'${e.value.replace(/'/g,"''")}'`;case"number_literal":return e.value.toString();case"boolean_literal":return e.value?"TRUE":"FALSE";case"null_literal":return"NULL";case"timespan_literal":return translateTimespanLiteral(e);default:throw new Error(`Unsupported expression type: ${e.type}`)}}function translateBinaryExpression(e){const t=translateExpression(e.left),i=translateExpression(e.right);return`(${t} ${e.operator.toUpperCase()} ${i})`}function translateComparisonExpression(e){const t="identifier"===e.left.type?e.left.name:translateExpression(e.left),i=translateExpression(e.right);return`${t} ${{"==":"=","!=":"!=",">":">","<":"<",">=":">=","<=":"<="}[e.operator]} ${i}`}function translateArithmeticExpression(e){const t=translateExpression(e.left),i=translateExpression(e.right);return`(${t} ${e.operator} ${i})`}function translateStringExpression(e){const t=e.left.name,i=translateExpression(e.right);return"contains"===e.operator?`${t} LIKE '%' || ${i} || '%'`:"startswith"===e.operator?`${t} LIKE ${i} || '%'`:"endswith"===e.operator?`${t} LIKE '%' || ${i}`:"matches"===e.operator?`${t} REGEXP ${i}`:"has"===e.operator?`${t} LIKE '%' || ${i} || '%'`:`${t} LIKE ${i}`}function translateFunctionCall(e){const t=e.name.name.toUpperCase();if("COUNT"===t&&0===e.arguments.length)return"COUNT(*)";if(["SUM","AVG","MIN","MAX","COUNT"].includes(t)){return`${t}(${e.arguments.map(e=>{if("named_argument"===e.type)throw new Error("Named arguments in functions not supported yet");return translateExpression(e)}).join(", ")})`}const i={SUBSTRING:"SUBSTR",TOLOWER:"LOWER",TOUPPER:"UPPER",INDEXOF:"STRPOS",SPLIT:"STRING_SPLIT",REPLACE:"REPLACE",LENGTH:"LENGTH",TRIM:"TRIM",LTRIM:"LTRIM",RTRIM:"RTRIM",REVERSE:"REVERSE",ROUND:"ROUND",FLOOR:"FLOOR",CEIL:"CEIL",ABS:"ABS",SQRT:"SQRT",POW:"POW",LOG:"LOG",LOG10:"LOG10",EXP:"EXP",SIN:"SIN",COS:"COS",TAN:"TAN",TOSTRING:"CAST",TOINT:"CAST",TODOUBLE:"CAST",TOBOOL:"CAST",TOLONG:"CAST",TOFLOAT:"CAST",TODATETIME:"CAST",TOTIMESPAN:"CAST",NOW:"NOW",AGO:"AGO"}[t]||t,n={TOSTRING:"VARCHAR",TOINT:"INTEGER",TODOUBLE:"DOUBLE",TOBOOL:"BOOLEAN",TOLONG:"BIGINT",TOFLOAT:"FLOAT",TODATETIME:"TIMESTAMP",TOTIMESPAN:"INTERVAL"};if(n[t]){const i=e.arguments[0];if("named_argument"===i?.type)throw new Error("Named arguments in functions not supported yet");return`CAST(${i?translateExpression(i):""} AS ${n[t]})`}if("AGO"===t){const t=e.arguments[0];if(!t)return"NOW()";if("named_argument"===t.type)throw new Error("Named arguments in AGO function not supported");return`NOW() - ${translateExpression(t)}`}return`${i}(${e.arguments.map(e=>{if("named_argument"===e.type)throw new Error("Named arguments in functions not supported yet");return translateExpression(e)}).join(", ")})`}function translateMvExpand(e,t){let i=`SELECT * FROM ${t}, UNNEST(${translateExpression(e.column)}) AS expanded_value`;return e.limit&&(i+=` LIMIT ${e.limit.value}`),i}function translateSearch(e,t){const i=`'%${e.term.value}%'`;if(e.columns&&e.columns.length>0){return`SELECT * FROM ${t} WHERE ${e.columns.map(e=>`LOWER(${"identifier"===e.type?e.name:e.name.name}) LIKE LOWER(${i})`).join(" OR ")}`}throw new Error("Search without specific columns requires schema metadata. Please specify columns: search in (col1, col2) 'term'")}let parser=null;async function initParser(e,t){if(parser)return;await Parser.init({locateFile:()=>t});const i=await Language.load(e);parser=new Parser,parser.setLanguage(i)}function parseKql(e){if(!parser)throw new Error("Parser not initialized. Call initParser() first.");return buildAST(parser.parse(e).rootNode)}function kqlToDuckDB(e){return translate(parseKql(e))}var _tmpl$=template("<div style=padding:1rem;color:#d32f2f;background-color:#ffebee><strong>Error:</strong> "),_tmpl$2=template('<div class=panes-container><div class=editor-pane><div class=pane-header><h2>Query</h2><div class=pane-actions><button title="Run query (Ctrl+Shift+Enter)"></button><button class=secondary title="Clear results">‚úï Clear</button></div></div><div class=editor-container></div></div><div class=results-pane><div class=pane-header><h2>Results ');const STORAGE_KEY_QUERY="fossiq-query",STORAGE_KEY_RESULTS="fossiq-results",AppContent=()=>{const e=localStorage.getItem(STORAGE_KEY_QUERY)||"Events | take 10",t=(()=>{try{const e=localStorage.getItem(STORAGE_KEY_RESULTS);return e?JSON.parse(e):[]}catch{return[]}})(),[i,n]=createSignal(e),[r,s]=createSignal(t),[o,a]=createSignal(null),[l,c]=createSignal(!1),{conn:h}=useSchema();createEffect(()=>{localStorage.setItem(STORAGE_KEY_QUERY,i())}),createEffect(()=>{const e=r();if(e.length>0){const t=JSON.stringify(e,(e,t)=>"bigint"==typeof t?Number(t):t);localStorage.setItem(STORAGE_KEY_RESULTS,t)}}),onMount(async()=>{try{await initParser("/tree-sitter-kql.wasm","/tree-sitter.wasm"),console.log("KQL Parser initialized")}catch(e){console.error("Failed to initialize KQL Parser",e),a("Failed to initialize parser. Check console.")}});const u=async()=>{const e=h();if(e){c(!0),a(null),s([]);try{console.log("Translating KQL:",i());const t=kqlToDuckDB(i());console.log("Executing SQL:",t);const n=(await e.query(t)).toArray().map(e=>e.toJSON());console.log("Query Results:",n),s(n)}catch(t){console.error("Query Error:",t),a(t.message||String(t))}finally{c(!1)}}else a("Database not initialized yet.")};return createComponent(Layout,{get children(){var e,t=_tmpl$2(),c=t.firstChild,d=c.firstChild,p=d.firstChild.nextSibling.firstChild,f=p.nextSibling,m=d.nextSibling,g=c.nextSibling,y=g.firstChild.firstChild;return y.firstChild,p.$$click=u,insert$1(p,()=>l()?"Running...":"‚ñ∂ Run"),f.$$click=()=>{s([]),a(null),localStorage.removeItem(STORAGE_KEY_RESULTS)},insert$1(m,createComponent(Editor,{get initialValue(){return i()},onChange:n,onRun:u})),insert$1(y,(e=memo$2(()=>r().length>0),()=>e()&&`(${r().length})`),null),insert$1(g,createComponent(Show,{get when(){return o()},get children(){var e=_tmpl$();return e.firstChild.nextSibling,insert$1(e,o,null),e}}),null),insert$1(g,createComponent(ResultsTable,{get data(){return r()}}),null),createRenderEffect(()=>p.disabled=l()||!h()),t}})};function App(){return createComponent(SchemaProvider,{get children(){return createComponent(AppContent,{})}})}delegateEvents(["click"]),render(()=>createComponent(App,{}),document.getElementById("app"));
//# sourceMappingURL=index-CHxBrwom.js.map
